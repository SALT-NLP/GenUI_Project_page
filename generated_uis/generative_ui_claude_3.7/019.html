<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Center Impact Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a45ba;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #212529;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --border-radius: 8px;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            background-color: white;
            border-right: 1px solid var(--gray-200);
            padding: 1.5rem;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: transform var(--transition);
        }

        .brand {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .brand-icon {
            background-color: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
        }

        .brand-text {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--gray-900);
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray-500);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .nav-items {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: var(--border-radius);
            color: var(--gray-700);
            text-decoration: none;
            transition: var(--transition);
        }

        .nav-link:hover {
            background-color: var(--gray-100);
            color: var(--primary);
        }

        .nav-link.active {
            background-color: var(--primary);
            color: white;
        }

        .nav-icon {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }

        /* Main Content Styles */
        .main-content {
            padding: 1.5rem;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.875rem;
        }

        .btn-icon {
            margin-right: 0.5rem;
            font-size: 1.25rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(67, 97, 238, 0.3);
        }

        .btn-outline {
            border: 1px solid var(--gray-300);
            background-color: white;
            color: var(--gray-700);
        }

        .btn-outline:hover {
            background-color: var(--gray-100);
            border-color: var(--gray-400);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(12, 1fr);
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: box-shadow var(--transition);
        }

        .card:hover {
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.25rem;
        }

        .card-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* KPI Cards */
        .kpi-section {
            grid-column: span 12;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .kpi-card {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition);
        }

        .kpi-card:hover {
            transform: translateY(-2px);
        }

        .kpi-title {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .kpi-change {
            display: flex;
            align-items: center;
            font-size: 0.75rem;
        }

        .kpi-change.positive {
            color: #10b981;
        }

        .kpi-change.negative {
            color: #ef4444;
        }

        .kpi-icon {
            margin-right: 0.25rem;
        }

        /* Chart Cards */
        .chart-card {
            grid-column: span 6;
            position: relative;
        }

        @media (max-width: 1200px) {
            .chart-card {
                grid-column: span 12;
            }
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .floating-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            opacity: 0;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 10;
            pointer-events: none;
            width: 240px;
        }

        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .control-group {
            margin-bottom: 0.75rem;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-group label {
            display: block;
            font-size: 0.75rem;
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-size: 0.875rem;
            transition: border-color var(--transition);
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .control-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        /* Data Upload Card */
        .upload-card {
            grid-column: span 6;
        }

        .upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-area:hover {
            border-color: var(--primary);
            background-color: var(--gray-100);
        }

        .upload-icon {
            font-size: 2.5rem;
            color: var(--gray-400);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1rem;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .upload-subtext {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        /* Demographics Card */
        .demographics-card {
            grid-column: span 6;
        }

        /* Resource Allocation Card */
        .resource-card {
            grid-column: span 12;
        }

        .resource-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .resource-control {
            display: flex;
            flex-direction: column;
        }

        .resource-label {
            font-size: 0.875rem;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }

        .resource-slider {
            width: 100%;
            appearance: none;
            height: 6px;
            background: var(--gray-300);
            border-radius: 3px;
            outline: none;
            transition: background var(--transition);
        }

        .resource-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            transition: transform var(--transition), box-shadow var(--transition);
        }

        .resource-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.2);
        }

        .resource-slider:focus {
            background: var(--primary-light);
        }

        .resource-value {
            font-size: 0.75rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
            text-align: center;
        }

        .resource-info {
            margin-left: 0.5rem;
            color: var(--gray-500);
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 1000;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .menu-toggle {
                display: block;
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                background: var(--primary);
                color: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 1001;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            }

            .kpi-section {
                grid-template-columns: repeat(2, 1fr);
            }

            .chart-card, 
            .upload-card,
            .demographics-card {
                grid-column: span 12;
            }

            .resource-controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .kpi-section {
                grid-template-columns: 1fr;
            }

            .resource-controls {
                grid-template-columns: 1fr;
            }
        }

        /* Data Table Styles */
        .data-table-container {
            grid-column: span 12;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .data-table th {
            background-color: var(--gray-100);
            font-weight: 600;
            color: var(--gray-700);
            position: sticky;
            top: 0;
            cursor: pointer;
            transition: background-color var(--transition);
        }

        .data-table th:hover {
            background-color: var(--gray-200);
        }

        .data-table th.sorted:after {
            content: "↑";
            margin-left: 5px;
            font-size: 0.75rem;
        }

        .data-table th.sorted.desc:after {
            content: "↓";
        }

        .data-table tbody tr {
            transition: background-color var(--transition);
        }

        .data-table tbody tr:hover {
            background-color: var(--gray-100);
        }

        .data-table .status {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .data-table .status-high {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .data-table .status-medium {
            background-color: #fef9c3;
            color: #ca8a04;
        }

        .data-table .status-low {
            background-color: #fee2e2;
            color: #dc2626;
        }

        /* Modal Styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal-backdrop.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-500);
            cursor: pointer;
            transition: color var(--transition);
        }

        .modal-close:hover {
            color: var(--gray-700);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* Filter Panel */
        .filter-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-size: 0.75rem;
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }

        .filter-select, 
        .filter-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-size: 0.875rem;
            transition: border-color var(--transition), box-shadow var(--transition);
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .filter-actions {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
        }

        /* Tooltip Styles */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity var(--transition);
            max-width: 200px;
        }

        .tooltip.visible {
            opacity: 1;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.success {
            background-color: #10b981;
        }

        .notification.error {
            background-color: #ef4444;
        }

        .notification.warning {
            background-color: #f59e0b;
        }

        .notification.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Progress Bar Styles */
        .progress-container {
            background-color: var(--gray-200);
            border-radius: 4px;
            height: 6px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            width: 0;
            transition: width 0.5s ease;
        }

        /* Checkbox and Radio Button Styles */
        .custom-control {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .custom-control input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .custom-control-label {
            position: relative;
            padding-left: 30px;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .checkbox-indicator {
            position: absolute;
            top: 0;
            left: 0;
            height: 18px;
            width: 18px;
            background-color: white;
            border: 1px solid var(--gray-400);
            border-radius: 3px;
            transition: all var(--transition);
        }

        .custom-control input:checked ~ .checkbox-indicator {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-indicator:after {
            content: "";
            position: absolute;
            display: none;
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .custom-control input:checked ~ .checkbox-indicator:after {
            display: block;
        }

        .radio-indicator {
            position: absolute;
            top: 0;
            left: 0;
            height: 18px;
            width: 18px;
            background-color: white;
            border: 1px solid var(--gray-400);
            border-radius: 50%;
            transition: all var(--transition);
        }

        .custom-control input:checked ~ .radio-indicator {
            background-color: white;
            border-color: var(--primary);
        }

        .radio-indicator:after {
            content: "";
            position: absolute;
            display: none;
            top: 4px;
            left: 4px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
        }

        .custom-control input:checked ~ .radio-indicator:after {
            display: block;
        }

        /* Tabbed Interface */
        .tab-container {
            margin-bottom: 1.5rem;
        }

        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--gray-300);
            margin-bottom: 1rem;
        }

        .tab-btn {
            padding: 0.75rem 1.25rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-600);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all var(--transition);
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(67, 97, 238, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Accessibility Focus Styles */
        :focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Skip to content link for keyboard users */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: white;
            padding: 8px;
            z-index: 2000;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 0;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--gray-700);
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 992px) {
            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Toast notifications for accessibility announcements */
        .sr-announcer {
            position: absolute;
            clip: rect(0, 0, 0, 0);
            height: 1px;
            width: 1px;
            margin: -1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to content</a>
    <div aria-live="polite" class="sr-announcer" id="announcer"></div>
    
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="brand">
                <div class="brand-icon">
                    <span class="material-symbols-rounded">hub</span>
                </div>
                <div class="brand-text">Impact Hub</div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Main</div>
                <ul class="nav-items">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" aria-current="page">
                            <span class="material-symbols-rounded nav-icon">dashboard</span>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="material-symbols-rounded nav-icon">trending_up</span>
                            Program Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="material-symbols-rounded nav-icon">groups</span>
                            Demographics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="material-symbols-rounded nav-icon">paid</span>
                            Resource Allocation
                        </a>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <div class="nav-title">Management</div>
                <ul class="nav-items">
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="material-symbols-rounded nav-icon">upload_file</span>
                            Data Upload
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="material-symbols-rounded nav-icon">description</span>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="material-symbols-rounded nav-icon">settings</span>
                            Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="menuToggle" aria-label="Toggle menu">
                        <span class="material-symbols-rounded">menu</span>
                    </button>
                    <h1 class="page-title">Community Impact Dashboard</h1>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" id="exportBtn" aria-label="Export report">
                        <span class="material-symbols-rounded btn-icon">download</span>
                        Export Report
                    </button>
                    <button class="btn btn-primary" id="uploadBtn" aria-label="Upload data">
                        <span class="material-symbols-rounded btn-icon">upload</span>
                        Upload Data
                    </button>
                </div>
            </div>

            <!-- Filter Panel -->
            <div class="filter-panel" aria-label="Data filters">
                <div class="filter-group">
                    <div class="filter-label">Program Type</div>
                    <select class="filter-select" id="programTypeFilter" aria-label="Select program type">
                        <option value="all">All Programs</option>
                        <option value="after-school">After-School Activities</option>
                        <option value="adult-education">Adult Education</option>
                        <option value="senior-services">Senior Services</option>
                        <option value="community-events">Community Events</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Time Period</div>
                    <select class="filter-select" id="timePeriodFilter" aria-label="Select time period">
                        <option value="last-month">Last Month</option>
                        <option value="last-quarter">Last Quarter</option>
                        <option value="last-year" selected>Last Year</option>
                        <option value="all-time">All Time</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Demographics</div>
                    <select class="filter-select" id="demographicsFilter" aria-label="Select demographic filter">
                        <option value="all">All Demographics</option>
                        <option value="age">Age Groups</option>
                        <option value="income">Income Levels</option>
                        <option value="ethnicity">Ethnicity</option>
                        <option value="neighborhood">Neighborhood</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" id="applyFiltersBtn" aria-label="Apply filters">
                        <span class="material-symbols-rounded btn-icon">filter_alt</span>
                        Apply Filters
                    </button>
                    <button class="btn btn-outline" id="resetFiltersBtn" aria-label="Reset filters">
                        <span class="material-symbols-rounded btn-icon">restart_alt</span>
                        Reset
                    </button>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- KPI Cards -->
                <div class="kpi-section" aria-label="Key performance indicators">
                    <div class="card kpi-card" tabindex="0">
                        <div class="kpi-title">Total Participants</div>
                        <div class="kpi-value">4,285</div>
                        <div class="kpi-change positive">
                            <span class="material-symbols-rounded kpi-icon">trending_up</span>
                            12.3% vs previous period
                        </div>
                    </div>
                    <div class="card kpi-card" tabindex="0">
                        <div class="kpi-title">Program Cost</div>
                        <div class="kpi-value">$156,430</div>
                        <div class="kpi-change negative">
                            <span class="material-symbols-rounded kpi-icon">trending_down</span>
                            5.2% vs previous period
                        </div>
                    </div>
                    <div class="card kpi-card" tabindex="0">
                        <div class="kpi-title">Average Impact Score</div>
                        <div class="kpi-value">8.4/10</div>
                        <div class="kpi-change positive">
                            <span class="material-symbols-rounded kpi-icon">trending_up</span>
                            0.6 points vs previous period
                        </div>
                    </div>
                    <div class="card kpi-card" tabindex="0">
                        <div class="kpi-title">Cost per Participant</div>
                        <div class="kpi-value">$36.51</div>
                        <div class="kpi-change positive">
                            <span class="material-symbols-rounded kpi-icon">trending_up</span>
                            15.7% vs previous period
                        </div>
                    </div>
                </div>

                <!-- Program Impact vs Cost Chart -->
                <div class="card chart-card">
                    <div class="card-header">
                        <h2 class="card-title">Program Impact vs. Cost</h2>
                        <div class="card-actions">
                            <button class="btn btn-outline" id="impactChartControlsBtn" aria-label="Show chart controls">
                                <span class="material-symbols-rounded">tune</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" id="impactCostChart">
                            <canvas id="impactVsCostChart" aria-label="Impact vs Cost Chart" role="img"></canvas>
                            <!-- Floating controls for the chart -->
                            <div class="floating-controls" id="impactChartControls">
                                <div class="control-group">
                                    <label for="impactChartType">Chart Type</label>
                                    <select id="impactChartType" aria-label="Select chart type">
                                        <option value="scatter">Scatter Plot</option>
                                        <option value="bubble" selected>Bubble Chart</option>
                                        <option value="bar">Bar Chart</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="impactMetric">Impact Metric</label>
                                    <select id="impactMetric" aria-label="Select impact metric">
                                        <option value="feedback" selected>Participant Feedback</option>
                                        <option value="outcomes">Measured Outcomes</option>
                                        <option value="attendance">Attendance Rate</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="costMetric">Cost Metric</label>
                                    <select id="costMetric" aria-label="Select cost metric">
                                        <option value="total">Total Cost</option>
                                        <option value="per-participant" selected>Cost Per Participant</option>
                                        <option value="per-hour">Cost Per Hour</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="bubbleSizeMetric">Bubble Size Represents</label>
                                    <select id="bubbleSizeMetric" aria-label="Select what the bubble size represents">
                                        <option value="participants" selected>Number of Participants</option>
                                        <option value="sessions">Program Sessions</option>
                                        <option value="duration">Program Duration (hours)</option>
                                    </select>
                                </div>
                                <div class="control-actions">
                                    <button class="btn btn-outline" id="resetImpactChart">Reset</button>
                                    <button class="btn btn-primary" id="applyImpactChartSettings">Apply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Program Attendance Chart -->
                <div class="card chart-card">
                    <div class="card-header">
                        <h2 class="card-title">Program Attendance Trends</h2>
                        <div class="card-actions">
                            <button class="btn btn-outline" id="attendanceChartControlsBtn" aria-label="Show chart controls">
                                <span class="material-symbols-rounded">tune</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" id="attendanceChart">
                            <canvas id="programAttendanceChart" aria-label="Program Attendance Chart" role="img"></canvas>
                            <!-- Floating controls for the chart -->
                            <div class="floating-controls" id="attendanceChartControls">
                                <div class="control-group">
                                    <label for="attendanceChartType">Chart Type</label>
                                    <select id="attendanceChartType" aria-label="Select chart type">
                                        <option value="line" selected>Line Chart</option>
                                        <option value="bar">Bar Chart</option>
                                        <option value="area">Area Chart</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="attendanceTimeScale">Time Scale</label>
                                    <select id="attendanceTimeScale" aria-label="Select time scale">
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly" selected>Monthly</option>
                                        <option value="quarterly">Quarterly</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="programVisibility">Program Visibility</label>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                                        <label class="custom-control">
                                            <input type="checkbox" id="showAfterSchool" checked aria-label="Show After-School Activities">
                                            <span class="checkbox-indicator"></span>
                                            <span class="custom-control-label">After-School</span>
                                        </label>
                                        <label class="custom-control">
                                            <input type="checkbox" id="showAdultEd" checked aria-label="Show Adult Education">
                                            <span class="checkbox-indicator"></span>
                                            <span class="custom-control-label">Adult Education</span>
                                        </label>
                                        <label class="custom-control">
                                            <input type="checkbox" id="showSenior" checked aria-label="Show Senior Services">
                                            <span class="checkbox-indicator"></span>
                                            <span class="custom-control-label">Senior Services</span>
                                        </label>
                                        <label class="custom-control">
                                            <input type="checkbox" id="showCommunity" checked aria-label="Show Community Events">
                                            <span class="checkbox-indicator"></span>
                                            <span class="custom-control-label">Community Events</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="custom-control">
                                        <input type="checkbox" id="showTarget" checked aria-label="Show target attendance line">
                                        <span class="checkbox-indicator"></span>
                                        <span class="custom-control-label">Show Target Line</span>
                                    </label>
                                </div>
                                <div class="control-actions">
                                    <button class="btn btn-outline" id="resetAttendanceChart">Reset</button>
                                    <button class="btn btn-primary" id="applyAttendanceChartSettings">Apply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Demographics Chart -->
                <div class="card demographics-card">
                    <div class="card-header">
                        <h2 class="card-title">Participant Demographics</h2>
                        <div class="card-actions">
                            <button class="btn btn-outline" id="demographicsChartControlsBtn" aria-label="Show chart controls">
                                <span class="material-symbols-rounded">tune</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" id="demographicsChartContainer">
                            <canvas id="demographicsChart" aria-label="Demographics Chart" role="img"></canvas>
                            <!-- Floating controls for the chart -->
                            <div class="floating-controls" id="demographicsChartControls">
                                <div class="control-group">
                                    <label for="demographicType">Demographic Type</label>
                                    <select id="demographicType" aria-label="Select demographic type">
                                        <option value="age" selected>Age Distribution</option>
                                        <option value="income">Income Levels</option>
                                        <option value="ethnicity">Ethnicity</option>
                                        <option value="neighborhood">Neighborhood</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="demographicChartType">Chart Type</label>
                                    <select id="demographicChartType" aria-label="Select chart type">
                                        <option value="pie" selected>Pie Chart</option>
                                        <option value="doughnut">Doughnut Chart</option>
                                        <option value="bar">Bar Chart</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="demographicCompare">Compare With</label>
                                    <select id="demographicCompare" aria-label="Select comparison data">
                                        <option value="none" selected>No Comparison</option>
                                        <option value="community">Community Demographics</option>
                                        <option value="previous">Previous Period</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="programFilter">Program Filter</label>
                                    <select id="programFilter" aria-label="Filter by program">
                                        <option value="all" selected>All Programs</option>
                                        <option value="after-school">After-School Activities</option>
                                        <option value="adult-education">Adult Education</option>
                                        <option value="senior-services">Senior Services</option>
                                        <option value="community-events">Community Events</option>
                                    </select>
                                </div>
                                <div class="control-actions">
                                    <button class="btn btn-outline" id="resetDemographicsChart">Reset</button>
                                    <button class="btn btn-primary" id="applyDemographicsChartSettings">Apply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Upload Card -->
                <div class="card upload-card">
                    <div class="card-header">
                        <h2 class="card-title">Data Upload & Integration</h2>
                    </div>
                    <div class="card-body">
                        <div class="upload-area" id="uploadArea" tabindex="0" role="button" aria-label="Upload files by clicking or dragging and dropping">
                            <span class="material-symbols-rounded upload-icon">cloud_upload</span>
                            <div class="upload-text">Drag and drop files here or click to browse</div>
                            <div class="upload-subtext">Supports CSV, Excel, and JSON formats</div>
                        </div>
                        <input type="file" id="fileUpload" style="display: none;" multiple aria-hidden="true">
                        <div class="progress-container" id="uploadProgress" style="display: none;">
                            <div class="progress-bar" id="uploadProgressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div>Recent uploads: <span id="uploadCount">3</span> files</div>
                        <button class="btn btn-outline" id="viewUploadsBtn" aria-label="View all uploads">View All</button>
                    </div>
                </div>

                <!-- Resource Allocation Simulation -->
                <div class="card resource-card">
                    <div class="card-header">
                        <h2 class="card-title">Resource Allocation Simulator</h2>
                        <div class="card-actions">
                            <button class="btn btn-primary" id="runSimulationBtn" aria-label="Run resource allocation simulation">
                                <span class="material-symbols-rounded btn-icon">play_arrow</span>
                                Run Simulation
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="resource-controls">
                            <div class="resource-control">
                                <div class="resource-label">
                                    <span>After-School Activities</span>
                                    <span class="resource-info" tabindex="0" aria-label="Current budget: $28,560" title="Current budget: $28,560">ⓘ</span>
                                </div>
                                <input type="range" class="resource-slider" id="afterSchoolSlider" min="0" max="100" value="30" 
                                    aria-label="Allocate budget percentage for After-School Activities" aria-valuemin="0" aria-valuemax="100" aria-valuenow="30">
                                <div class="resource-value" id="afterSchoolValue">30%</div>
                            </div>
                            <div class="resource-control">
                                <div class="resource-label">
                                    <span>Adult Education</span>
                                    <span class="resource-info" tabindex="0" aria-label="Current budget: $21,100" title="Current budget: $21,100">ⓘ</span>
                                </div>
                                <input type="range" class="resource-slider" id="adultEducationSlider" min="0" max="100" value="25" 
                                    aria-label="Allocate budget percentage for Adult Education" aria-valuemin="0" aria-valuemax="100" aria-valuenow="25">
                                <div class="resource-value" id="adultEducationValue">25%</div>
                            </div>
                            <div class="resource-control">
                                <div class="resource-label">
                                    <span>Senior Services</span>
                                    <span class="resource-info" tabindex="0" aria-label="Current budget: $18,760" title="Current budget: $18,760">ⓘ</span>
                                </div>
                                <input type="range" class="resource-slider" id="seniorServicesSlider" min="0" max="100" value="20" 
                                    aria-label="Allocate budget percentage for Senior Services" aria-valuemin="0" aria-valuemax="100" aria-valuenow="20">
                                <div class="resource-value" id="seniorServicesValue">20%</div>
                            </div>
                            <div class="resource-control">
                                <div class="resource-label">
                                    <span>Community Events</span>
                                    <span class="resource-info" tabindex="0" aria-label="Current budget: $22,500" title="Current budget: $22,500">ⓘ</span>
                                </div>
                                <input type="range" class="resource-slider" id="communityEventsSlider" min="0" max="100" value="25" 
                                    aria-label="Allocate budget percentage for Community Events" aria-valuemin="0" aria-valuemax="100" aria-valuenow="25">
                                <div class="resource-value" id="communityEventsValue">25%</div>
                            </div>
                        </div>
                        <div class="tab-container" id="simulationTabs">
                            <div class="tab-nav" role="tablist">
                                <button class="tab-btn active" id="budgetTab" role="tab" aria-selected="true" aria-controls="budgetPanel">Budget Impact</button>
                                <button class="tab-btn" id="participantsTab" role="tab" aria-selected="false" aria-controls="participantsPanel">Projected Participants</button>
                                <button class="tab-btn" id="impactTab" role="tab" aria-selected="false" aria-controls="impactPanel">Impact Projection</button>
                            </div>
                            <div class="tab-content active" id="budgetPanel" role="tabpanel" aria-labelledby="budgetTab">
                                <div class="chart-container" id="simulationBudgetChartContainer">
                                    <canvas id="simulationBudgetChart" aria-label="Budget Allocation Chart" role="img"></canvas>
                                </div>
                            </div>
                            <div class="tab-content" id="participantsPanel" role="tabpanel" aria-labelledby="participantsTab">
                                <div class="chart-container" id="simulationParticipantsChartContainer">
                                    <canvas id="simulationParticipantsChart" aria-label="Projected Participants Chart" role="img"></canvas>
                                </div>
                            </div>
                            <div class="tab-content" id="impactPanel" role="tabpanel" aria-labelledby="impactTab">
                                <div class="chart-container" id="simulationImpactChartContainer">
                                    <canvas id="simulationImpactChart" aria-label="Impact Projection Chart" role="img"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Program Data Table -->
                <div class="card data-table-container">
                    <div class="card-header">
                        <h2 class="card-title">Program Performance Data</h2>
                        <div class="card-actions">
                            <div class="filter-group" style="width: 200px; margin-right: 10px;">
                                <input type="text" class="filter-input" id="tableSearchInput" placeholder="Search programs..." aria-label="Search programs">
                            </div>
                            <button class="btn btn-outline" id="exportTableBtn" aria-label="Export table data">
                                <span class="material-symbols-rounded btn-icon">download</span>
                                Export
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="data-table" id="programDataTable" aria-label="Program Performance Data Table">
                            <thead>
                                <tr>
                                    <th scope="col" tabindex="0" aria-sort="none" data-sort="name">Program Name</th>
                                    <th scope="col" tabindex="0" aria-sort="none" data-sort="participants">Participants</th>
                                    <th scope="col" tabindex="0" aria-sort="none" data-sort="cost">Total Cost</th>
                                    <th scope="col" tabindex="0" aria-sort="none" data-sort="costPerParticipant">Cost/Participant</th>
                                    <th scope="col" tabindex="0" aria-sort="none" data-sort="impact">Impact Score</th>
                                    <th scope="col" tabindex="0" aria-sort="none" data-sort="status">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>After-School Tutoring</td>
                                    <td>245</td>
                                    <td>$28,560</td>
                                    <td>$116.57</td>
                                    <td>8.7</td>
                                    <td><span class="status status-high">High Impact</span></td>
                                </tr>
                                <tr>
                                    <td>Computer Skills Workshop</td>
                                    <td>178</td>
                                    <td>$12,350</td>
                                    <td>$69.38</td>
                                    <td>7.9</td>
                                    <td><span class="status status-medium">Medium Impact</span></td>
                                </tr>
                                <tr>
                                    <td>Senior Wellness Program</td>
                                    <td>132</td>
                                    <td>$18,760</td>
                                    <td>$142.12</td>
                                    <td>9.2</td>
                                    <td><span class="status status-high">High Impact</span></td>
                                </tr>
                                <tr>
                                    <td>Youth Sports League</td>
                                    <td>310</td>
                                    <td>$35,420</td>
                                    <td>$114.26</td>
                                    <td>8.5</td>
                                    <td><span class="status status-high">High Impact</span></td>
                                </tr>
                                <tr>
                                    <td>Job Search Assistance</td>
                                    <td>95</td>
                                    <td>$8,750</td>
                                    <td>$92.11</td>
                                    <td>7.6</td>
                                    <td><span class="status status-medium">Medium Impact</span></td>
                                </tr>
                                <tr>
                                    <td>Community Garden</td>
                                    <td>68</td>
                                    <td>$6,240</td>
                                    <td>$91.76</td>
                                    <td>6.8</td>
                                    <td><span class="status status-medium">Medium Impact</span></td>
                                </tr>
                                <tr>
                                    <td>Neighborhood Festival</td>
                                    <td>1250</td>
                                    <td>$22,500</td>
                                    <td>$18.00</td>
                                    <td>7.2</td>
                                    <td><span class="status status-medium">Medium Impact</span></td>
                                </tr>
                                <tr>
                                    <td>Financial Literacy</td>
                                    <td>85</td>
                                    <td>$7,850</td>
                                    <td>$92.35</td>
                                    <td>8.1</td>
                                    <td><span class="status status-high">High Impact</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer">
                        <div>
                            <span id="tableInfo">Showing 1-8 of 8 programs</span>
                        </div>
                        <div class="pagination">
                            <button class="btn btn-outline" id="prevPage" disabled aria-label="Previous page">
                                <span class="material-symbols-rounded">chevron_left</span>
                            </button>
                            <button class="btn btn-outline" id="nextPage" disabled aria-label="Next page">
                                <span class="material-symbols-rounded">chevron_right</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" id="mobileMenuToggle" aria-label="Toggle sidebar menu">
        <span class="material-symbols-rounded">menu</span>
    </button>

    <!-- Upload Data Modal -->
    <div class="modal-backdrop" id="uploadModal" role="dialog" aria-labelledby="uploadModalTitle" aria-hidden="true">
        <div class="modal" role="document">
            <div class="modal-header">
                <h3 class="modal-title" id="uploadModalTitle">Upload Program Data</h3>
                <button class="modal-close" id="closeUploadModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="control-group">
                    <label for="dataType">Data Type</label>
                    <select id="dataType" class="filter-select" aria-label="Select data type">
                        <option value="attendance">Attendance Records</option>
                        <option value="demographic">Participant Demographics</option>
                        <option value="cost">Program Costs</option>
                        <option value="feedback">Participant Feedback</option>
                        <option value="outcomes">Outcome Measurements</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="dataFormat">File Format</label>
                    <select id="dataFormat" class="filter-select" aria-label="Select file format">
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                        <option value="json">JSON</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="dataPeriod">Time Period</label>
                    <input type="month" id="dataPeriod" class="filter-input" aria-label="Select time period">
                </div>
                <div class="control-group">
                    <label for="dataDescription">Description (Optional)</label>
                    <textarea id="dataDescription" class="filter-input" rows="3" placeholder="Enter a brief description of the data..." aria-label="Enter data description"></textarea>
                </div>
                <div class="upload-area" style="margin-top: 1rem;" tabindex="0" role="button" aria-label="Upload files by clicking or dragging and dropping">
                    <span class="material-symbols-rounded upload-icon">cloud_upload</span>
                    <div class="upload-text">Drag and drop files here or click to browse</div>
                    <div class="upload-subtext">Supports CSV, Excel, and JSON formats</div>
                </div>
                <div class="progress-container" id="modalUploadProgress" style="display: none;">
                    <div class="progress-bar" id="modalUploadProgressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelUploadBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmUploadBtn">Upload Data</button>
            </div>
        </div>
    </div>

    <!-- Export Report Modal -->
    <div class="modal-backdrop" id="exportModal" role="dialog" aria-labelledby="exportModalTitle" aria-hidden="true">
        <div class="modal" role="document">
            <div class="modal-header">
                <h3 class="modal-title" id="exportModalTitle">Export Report</h3>
                <button class="modal-close" id="closeExportModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="control-group">
                    <label for="reportType">Report Type</label>
                    <select id="reportType" class="filter-select" aria-label="Select report type">
                        <option value="executive">Executive Summary</option>
                        <option value="detailed">Detailed Program Analysis</option>
                        <option value="demographic">Demographic Analysis</option>
                        <option value="financial">Financial Analysis</option>
                        <option value="impact">Impact Assessment</option>
                        <option value="custom">Custom Report</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="reportFormat">File Format</label>
                    <select id="reportFormat" class="filter-select" aria-label="Select file format">
                        <option value="pdf">PDF</option>
                        <option value="excel">Excel</option>
                        <option value="ppt">PowerPoint</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="reportPeriod">Time Period</label>
                    <select id="reportPeriod" class="filter-select" aria-label="Select time period">
                        <option value="last-month">Last Month</option>
                        <option value="last-quarter">Last Quarter</option>
                        <option value="last-year" selected>Last Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div id="customDateRange" style="display: none;">
                    <div class="control-group">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startDate" class="filter-input" aria-label="Select start date">
                    </div>
                    <div class="control-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" class="filter-input" aria-label="Select end date">
                    </div>
                </div>
                <div class="control-group">
                    <label>Include Sections</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem;">
                        <label class="custom-control">
                            <input type="checkbox" id="includeKPI" checked aria-label="Include KPI Summary">
                            <span class="checkbox-indicator"></span>
                            <span class="custom-control-label">KPI Summary</span>
                        </label>
                        <label class="custom-control">
                            <input type="checkbox" id="includeCharts" checked aria-label="Include Charts & Graphs">
                            <span class="checkbox-indicator"></span>
                            <span class="custom-control-label">Charts & Graphs</span>
                        </label>
                        <label class="custom-control">
                            <input type="checkbox" id="includeTables" checked aria-label="Include Data Tables">
                            <span class="checkbox-indicator"></span>
                            <span class="custom-control-label">Data Tables</span>
                        </label>
                        <label class="custom-control">
                            <input type="checkbox" id="includeRecommendations" aria-label="Include Recommendations">
                            <span class="checkbox-indicator"></span>
                            <span class="custom-control-label">Recommendations</span>
                        </label>
                    </div>
                </div>
                <div class="control-group">
                    <label for="reportTitle">Report Title</label>
                    <input type="text" id="reportTitle" class="filter-input" placeholder="Community Center Impact Report" aria-label="Enter report title">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelExportBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmExportBtn">Generate Report</button>
            </div>
        </div>
    </div>

    <!-- Program Details Modal -->
    <div class="modal-backdrop" id="programDetailsModal" role="dialog" aria-labelledby="programDetailsTitle" aria-hidden="true">
        <div class="modal" role="document">
            <div class="modal-header">
                <h3 class="modal-title" id="programDetailsTitle">Program Details</h3>
                <button class="modal-close" id="closeProgramDetailsModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body" id="programDetailsContent">
                <!-- Content will be dynamically populated -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeProgramDetailsBtn">Close</button>
                <button class="btn btn-primary" id="exportProgramDetailsBtn">Export Details</button>
            </div>
        </div>
    </div>

    <!-- Tooltip element -->
    <div class="tooltip" id="tooltip" role="tooltip"></div>

    <!-- Notification container -->
    <div class="notification" id="notification" role="alert" aria-live="polite"></div>

    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // Initialize all charts when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            initImpactVsCostChart();
            initProgramAttendanceChart();
            initDemographicsChart();
            initSimulationCharts();
            setupEventListeners();
            setupAccessibility();
            setupTableFunctionality();
        });

        // Setup accessibility features
        function setupAccessibility() {
            const announcer = document.getElementById('announcer');
            
            // Function to announce messages to screen readers
            window.announce = function(message, assertive = false) {
                announcer.textContent = message;
                announcer.setAttribute('aria-live', assertive ? 'assertive' : 'polite');
                
                // Clear after a delay to allow for re-announcing the same message
                setTimeout(() => {
                    announcer.textContent = '';
                }, 3000);
            };

            // Setup keyboard navigation for the sidebar
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach((link, index) => {
                link.addEventListener('keydown', (e) => {
                    // Arrow down or right
                    if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                        e.preventDefault();
                        const nextLink = navLinks[index + 1] || navLinks[0];
                        nextLink.focus();
                    }
                    // Arrow up or left
                    else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                        e.preventDefault();
                        const prevLink = navLinks[index - 1] || navLinks[navLinks.length - 1];
                        prevLink.focus();
                    }
                });
            });

            // Make table headers announce their sort state
            const tableHeaders = document.querySelectorAll('.data-table th[data-sort]');
            tableHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const sortDirection = header.classList.contains('sorted') && !header.classList.contains('desc') ? 'descending' : 'ascending';
                    const columnName = header.textContent;
                    announce(`Sorted ${columnName} ${sortDirection}`);
                });
            });

            // Setup tooltips for resource allocation info icons
            const infoIcons = document.querySelectorAll('.resource-info');
            infoIcons.forEach(icon => {
                icon.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        showTooltip(icon, icon.getAttribute('title'));
                    }
                });
                
                icon.addEventListener('blur', () => {
                    hideTooltip();
                });
            });
        }

        // Setup table functionality (sorting, filtering, pagination)
        function setupTableFunctionality() {
            const table = document.getElementById('programDataTable');
            const searchInput = document.getElementById('tableSearchInput');
            const tableHeaders = table.querySelectorAll('th[data-sort]');
            const tableInfo = document.getElementById('tableInfo');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            
            let currentPage = 1;
            const rowsPerPage = 8;
            let filteredRows = [...table.querySelectorAll('tbody tr')];
            
            // Handle table sorting
            tableHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const sortBy = header.getAttribute('data-sort');
                    const isDescending = header.classList.contains('sorted') && !header.classList.contains('desc');
                    
                    // Remove sorted class from all headers
                    tableHeaders.forEach(h => {
                        h.classList.remove('sorted', 'desc');
                        h.setAttribute('aria-sort', 'none');
                    });
                    
                    // Add sorted class to clicked header
                    header.classList.add('sorted');
                    if (isDescending) {
                        header.classList.add('desc');
                        header.setAttribute('aria-sort', 'descending');
                    } else {
                        header.setAttribute('aria-sort', 'ascending');
                    }
                    
                    // Sort table rows
                    sortTable(table, sortBy, isDescending);
                    
                    // Reset pagination
                    currentPage = 1;
                    updateTableDisplay();
                });
            });
            
            // Handle table search
            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value.toLowerCase();
                
                filteredRows = [...table.querySelectorAll('tbody tr')].filter(row => {
                    const text = row.textContent.toLowerCase();
                    return text.includes(searchTerm);
                });
                
                // Reset pagination
                currentPage = 1;
                updateTableDisplay();
            });
            
            // Handle pagination
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateTableDisplay();
                }
            });
            
            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    updateTableDisplay();
                }
            });
            
            // Function to sort table
            function sortTable(table, sortBy, isDescending) {
                const tbody = table.querySelector('tbody');
                const rows = [...tbody.querySelectorAll('tr')];
                
                // Sort rows
                rows.sort((a, b) => {
                    let aValue, bValue;
                    
                    if (sortBy === 'name') {
                        aValue = a.cells[0].textContent.trim();
                        bValue = b.cells[0].textContent.trim();
                    } else if (sortBy === 'participants' || sortBy === 'impact') {
                        aValue = parseFloat(a.cells[sortBy === 'participants' ? 1 : 4].textContent.trim());
                        bValue = parseFloat(b.cells[sortBy === 'participants' ? 1 : 4].textContent.trim());
                    } else if (sortBy === 'cost' || sortBy === 'costPerParticipant') {
                        aValue = parseFloat(a.cells[sortBy === 'cost' ? 2 : 3].textContent.trim().replace('$', '').replace(',', ''));
                        bValue = parseFloat(b.cells[sortBy === 'cost' ? 2 : 3].textContent.trim().replace('$', '').replace(',', ''));
                    } else if (sortBy === 'status') {
                        aValue = a.cells[5].textContent.trim();
                        bValue = b.cells[5].textContent.trim();
                    }
                    
                    if (isDescending) {
                        return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
                    } else {
                        return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
                    }
                });
                
                // Reorder rows
                rows.forEach(row => tbody.appendChild(row));
                
                // Update filtered rows
                filteredRows = rows;
            }
            
            // Function to update table display (pagination)
            function updateTableDisplay() {
                const startIndex = (currentPage - 1) * rowsPerPage;
                const endIndex = startIndex + rowsPerPage;
                const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
                
                // Hide all rows
                table.querySelectorAll('tbody tr').forEach(row => {
                    row.style.display = 'none';
                });
                
                // Show filtered rows for current page
                filteredRows.slice(startIndex, endIndex).forEach(row => {
                    row.style.display = '';
                });
                
                // Update pagination info
                tableInfo.textContent = `Showing ${startIndex + 1}-${Math.min(endIndex, filteredRows.length)} of ${filteredRows.length} programs`;
                
                // Update pagination buttons
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            }
            
            // Initialize table display
            updateTableDisplay();
            
            // Add click event to table rows to show program details
            table.querySelectorAll('tbody tr').forEach(row => {
                row.addEventListener('click', () => {
                    const programName = row.cells[0].textContent;
                    showProgramDetails(programName);
                });
                
                // Make rows keyboard accessible
                row.setAttribute('tabindex', '0');
                row.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const programName = row.cells[0].textContent;
                        showProgramDetails(programName);
                    }
                });
            });
        }

        // Impact vs Cost Chart
        function initImpactVsCostChart() {
            const ctx = document.getElementById('impactVsCostChart').getContext('2d');
            
            // Sample data for programs
            const data = {
                datasets: [{
                    label: 'Programs (Size = Participants)',
                    data: [
                        { x: 116.57, y: 8.7, r: 15, program: 'After-School Tutoring' },
                        { x: 69.38, y: 7.9, r: 12, program: 'Computer Skills Workshop' },
                        { x: 142.12, y: 9.2, r: 10, program: 'Senior Wellness Program' },
                        { x: 114.26, y: 8.5, r: 17, program: 'Youth Sports League' },
                        { x: 92.11, y: 7.6, r: 8, program: 'Job Search Assistance' },
                        { x: 91.76, y: 6.8, r: 7, program: 'Community Garden' },
                        { x: 18.00, y: 7.2, r: 25, program: 'Neighborhood Festival' },
                        { x: 92.35, y: 8.1, r: 8, program: 'Financial Literacy' }
                    ],
                    backgroundColor: [
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(72, 149, 239, 0.7)',
                        'rgba(63, 55, 201, 0.7)',
                        'rgba(76, 201, 240, 0.7)',
                        'rgba(247, 37, 133, 0.7)',
                        'rgba(58, 12, 163, 0.7)',
                        'rgba(114, 9, 183, 0.7)',
                        'rgba(67, 97, 238, 0.7)'
                    ],
                    borderColor: [
                        'rgba(67, 97, 238, 1)',
                        'rgba(72, 149, 239, 1)',
                        'rgba(63, 55, 201, 1)',
                        'rgba(76, 201, 240, 1)',
                        'rgba(247, 37, 133, 1)',
                        'rgba(58, 12, 163, 1)',
                        'rgba(114, 9, 183, 1)',
                        'rgba(67, 97, 238, 1)'
                    ],
                    borderWidth: 1
                }]
            };

            const impactVsCostChart = new Chart(ctx, {
                type: 'bubble',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Cost per Participant ($)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Impact Score (1-10)'
                            },
                            min: 5,
                            max: 10
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const item = context.raw;
                                    return [
                                        `Program: ${item.program}`,
                                        `Cost per Participant: $${item.x}`,
                                        `Impact Score: ${item.y}/10`,
                                        `Participants: ${Math.round(item.r * 10)}`
                                    ];
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                        }
                    },
                    onClick: (e) => {
                        const points = impactVsCostChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                        
                        if (points.length) {
                            const firstPoint = points[0];
                            const programData = data.datasets[firstPoint.datasetIndex].data[firstPoint.index];
                            showProgramDetails(programData.program);
                        } else {
                            toggleChartControls('impactChartControls');
                        }
                    }
                }
            });

            // Update chart based on control changes
            document.getElementById('impactChartType').addEventListener('change', (e) => {
                updateImpactChart(impactVsCostChart, e.target.value);
            });

            document.getElementById('impactMetric').addEventListener('change', () => {
                // In a real implementation, this would fetch new data based on the selected metric
                announce("Changed impact metric. Chart data updated.");
                impactVsCostChart.update();
            });

            document.getElementById('costMetric').addEventListener('change', () => {
                // In a real implementation, this would fetch new data based on the selected metric
                announce("Changed cost metric. Chart data updated.");
                impactVsCostChart.update();
            });

            document.getElementById('bubbleSizeMetric').addEventListener('change', () => {
                // In a real implementation, this would update bubble sizes based on the selected metric
                announce("Changed bubble size metric. Chart data updated.");
                impactVsCostChart.update();
            });

            document.getElementById('applyImpactChartSettings').addEventListener('click', () => {
                toggleChartControls('impactChartControls');
                showNotification('Chart settings applied successfully!', 'success');
            });

            document.getElementById('resetImpactChart').addEventListener('click', () => {
                document.getElementById('impactChartType').value = 'bubble';
                document.getElementById('impactMetric').value = 'feedback';
                document.getElementById('costMetric').value = 'per-participant';
                document.getElementById('bubbleSizeMetric').value = 'participants';
                updateImpactChart(impactVsCostChart, 'bubble');
                showNotification('Chart settings reset to defaults', 'info');
            });
        }

        function updateImpactChart(chart, type) {
            if (type === 'scatter') {
                chart.config.type = 'scatter';
                chart.data.datasets[0].data = chart.data.datasets[0].data.map(item => ({
                    x: item.x,
                    y: item.y,
                    program: item.program
                }));
            } else if (type === 'bubble') {
                chart.config.type = 'bubble';
                // Restore the radius data if switching back to bubble
                chart.data.datasets[0].data = chart.data.datasets[0].data.map((item, index) => ({
                    x: item.x,
                    y: item.y,
                    r: [15, 12, 10, 17, 8, 7, 25, 8][index],
                    program: item.program
                }));
            } else if (type === 'bar') {
                chart.config.type = 'bar';
                // Transform data for bar chart
                const programs = chart.data.datasets[0].data.map(item => item.program);
                const impacts = chart.data.datasets[0].data.map(item => item.y);
                const costs = chart.data.datasets[0].data.map(item => item.x);
                
                chart.data.labels = programs;
                chart.data.datasets = [
                    {
                        label: 'Impact Score',
                        data: impacts,
                        backgroundColor: 'rgba(67, 97, 238, 0.7)',
                        borderColor: 'rgba(67, 97, 238, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Cost per Participant ($)',
                        data: costs,
                        backgroundColor: 'rgba(247, 37, 133, 0.7)',
                        borderColor: 'rgba(247, 37, 133, 1)',
                        borderWidth: 1
                    }
                ];
            }
            chart.update();
            announce(`Chart type changed to ${type}`, false);
        }

        // Program Attendance Chart
        function initProgramAttendanceChart() {
            const ctx = document.getElementById('programAttendanceChart').getContext('2d');
            
            const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            const data = {
                labels: labels,
                datasets: [
                    {
                        label: 'After-School Activities',
                        data: [120, 135, 142, 156, 145, 80, 75, 90, 165, 182, 190, 175],
                        borderColor: 'rgba(67, 97, 238, 1)',
                        backgroundColor: 'rgba(67, 97, 238, 0.2)',
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Adult Education',
                        data: [85, 90, 88, 95, 102, 98, 75, 80, 92, 105, 110, 108],
                        borderColor: 'rgba(76, 201, 240, 1)',
                        backgroundColor: 'rgba(76, 201, 240, 0.2)',
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Senior Services',
                        data: [65, 68, 72, 75, 80, 85, 82, 78, 76, 82, 85, 88],
                        borderColor: 'rgba(247, 37, 133, 1)',
                        backgroundColor: 'rgba(247, 37, 133, 0.2)',
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Community Events',
                        data: [250, 180, 220, 310, 290, 350, 320, 380, 400, 420, 390, 450],
                        borderColor: 'rgba(58, 12, 163, 1)',
                        backgroundColor: 'rgba(58, 12, 163, 0.2)',
                        tension: 0.3,
                        fill: false
                    }
                ]
            };

            // Add target line
            const targetData = {
                label: 'Target Attendance',
                data: Array(12).fill(300),
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 2,
                borderDash: [5, 5],
                fill: false,
                pointRadius: 0,
                type: 'line'
            };

            data.datasets.push(targetData);
            
            const attendanceChart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Participants'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            onClick: function(e, legendItem, legend) {
                                // Toggle dataset visibility
                                const index = legendItem.datasetIndex;
                                const meta = attendanceChart.getDatasetMeta(index);
                                meta.hidden = !meta.hidden;
                                
                                // Also toggle the corresponding checkbox in the controls
                                if (index === 0) document.getElementById('showAfterSchool').checked = !meta.hidden;
                                if (index === 1) document.getElementById('showAdultEd').checked = !meta.hidden;
                                if (index === 2) document.getElementById('showSenior').checked = !meta.hidden;
                                if (index === 3) document.getElementById('showCommunity').checked = !meta.hidden;
                                if (index === 4) document.getElementById('showTarget').checked = !meta.hidden;
                                
                                attendanceChart.update();
                            }
                        },
                        tooltip: {
                            callbacks: {
                                footer: (tooltipItems) => {
                                    // Calculate the total for this month
                                    const month = tooltipItems[0].label;
                                    const monthIndex = labels.indexOf(month);
                                    let total = 0;
                                    
                                    // Sum all visible datasets except the target line
                                    for (let i = 0; i < 4; i++) {
                                        const meta = attendanceChart.getDatasetMeta(i);
                                        if (!meta.hidden) {
                                            total += data.datasets[i].data[monthIndex];
                                        }
                                    }
                                    
                                    return `Total Participants: ${total}`;
                                }
                            }
                        }
                    },
                    onClick: () => {
                        toggleChartControls('attendanceChartControls');
                    }
                }
            });

            // Update chart based on control changes
            document.getElementById('attendanceChartType').addEventListener('change', (e) => {
                updateAttendanceChart(attendanceChart, e.target.value);
            });

            document.getElementById('attendanceTimeScale').addEventListener('change', () => {
                // In a real implementation, this would fetch data with a different time granularity
                announce("Changed time scale. Chart data updated.");
                attendanceChart.update();
            });

            // Program visibility checkboxes
            document.getElementById('showAfterSchool').addEventListener('change', (e) => {
                attendanceChart.getDatasetMeta(0).hidden = !e.target.checked;
                attendanceChart.update();
            });
            
            document.getElementById('showAdultEd').addEventListener('change', (e) => {
                attendanceChart.getDatasetMeta(1).hidden = !e.target.checked;
                attendanceChart.update();
            });
            
            document.getElementById('showSenior').addEventListener('change', (e) => {
                attendanceChart.getDatasetMeta(2).hidden = !e.target.checked;
                attendanceChart.update();
            });
            
            document.getElementById('showCommunity').addEventListener('change', (e) => {
                attendanceChart.getDatasetMeta(3).hidden = !e.target.checked;
                attendanceChart.update();
            });

            document.getElementById('showTarget').addEventListener('change', (e) => {
                attendanceChart.getDatasetMeta(4).hidden = !e.target.checked;
                attendanceChart.update();
            });

            document.getElementById('applyAttendanceChartSettings').addEventListener('click', () => {
                toggleChartControls('attendanceChartControls');
                showNotification('Chart settings applied successfully!', 'success');
            });

            document.getElementById('resetAttendanceChart').addEventListener('click', () => {
                document.getElementById('attendanceChartType').value = 'line';
                document.getElementById('attendanceTimeScale').value = 'monthly';
                document.getElementById('showAfterSchool').checked = true;
                document.getElementById('showAdultEd').checked = true;
                document.getElementById('showSenior').checked = true;
                document.getElementById('showCommunity').checked = true;
                document.getElementById('showTarget').checked = true;
                
                // Update chart
                updateAttendanceChart(attendanceChart, 'line');
                
                // Show all datasets
                for (let i = 0; i < attendanceChart.data.datasets.length; i++) {
                    attendanceChart.getDatasetMeta(i).hidden = false;
                }
                
                attendanceChart.update();
                showNotification('Chart settings reset to defaults', 'info');
            });
        }

        function updateAttendanceChart(chart, type) {
            const isLine = type === 'line';
            const isArea = type === 'area';
            
            chart.config.type = isLine || isArea ? 'line' : type;
            
            // Update dataset properties based on chart type
            chart.data.datasets.forEach((dataset, index) => {
                // Skip the target line dataset
                if (index < chart.data.datasets.length - 1) {
                    dataset.fill = isArea;
                    dataset.tension = isLine || isArea ? 0.3 : 0;
                }
            });
            
            chart.update();
            announce(`Chart type changed to ${type}`, false);
        }

        // Demographics Chart
        function initDemographicsChart() {
            const ctx = document.getElementById('demographicsChart').getContext('2d');
            
            const data = {
                labels: ['Under 18', '18-24', '25-34', '35-44', '45-54', '55-64', '65+'],
                datasets: [{
                    label: 'Participant Age Distribution',
                    data: [35, 12, 15, 10, 8, 10, 10],
                    backgroundColor: [
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(72, 149, 239, 0.7)',
                        'rgba(63, 55, 201, 0.7)',
                        'rgba(76, 201, 240, 0.7)',
                        'rgba(247, 37, 133, 0.7)',
                        'rgba(58, 12, 163, 0.7)',
                        'rgba(114, 9, 183, 0.7)'
                    ],
                    borderColor: [
                        'rgba(67, 97, 238, 1)',
                        'rgba(72, 149, 239, 1)',
                        'rgba(63, 55, 201, 1)',
                        'rgba(76, 201, 240, 1)',
                        'rgba(247, 37, 133, 1)',
                        'rgba(58, 12, 163, 1)',
                        'rgba(114, 9, 183, 1)'
                    ],
                    borderWidth: 1
                }]
            };
            
            const demographicsChart = new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${percentage}% (${value})`;
                                }
                            }
                        }
                    },
                    onClick: () => {
                        toggleChartControls('demographicsChartControls');
                    }
                }
            });

            // Demographic type change handler
            document.getElementById('demographicType').addEventListener('change', (e) => {
                updateDemographicData(demographicsChart, e.target.value);
            });

            // Chart type change handler
            document.getElementById('demographicChartType').addEventListener('change', (e) => {
                demographicsChart.config.type = e.target.value;
                demographicsChart.update();
                announce(`Chart type changed to ${e.target.value}`, false);
            });

            // Comparison type change handler
            document.getElementById('demographicCompare').addEventListener('change', (e) => {
                const compareWith = e.target.value;
                
                // In a real implementation, this would fetch comparison data
                if (compareWith !== 'none') {
                    // Add a second dataset for comparison
                    if (demographicsChart.data.datasets.length === 1) {
                        let comparisonData = [];
                        
                        if (compareWith === 'community') {
                            // Mock community demographic data
                            comparisonData = [25, 15, 20, 15, 10, 8, 7];
                            demographicsChart.data.datasets.push({
                                label: 'Community Demographics',
                                data: comparisonData,
                                backgroundColor: demographicsChart.data.datasets[0].backgroundColor.map(color => color.replace('0.7', '0.3')),
                                borderColor: demographicsChart.data.datasets[0].borderColor,
                                borderWidth: 1
                            });
                        } else if (compareWith === 'previous') {
                            // Mock previous period data
                            comparisonData = [30, 10, 18, 12, 10, 8, 12];
                            demographicsChart.data.datasets.push({
                                label: 'Previous Period',
                                data: comparisonData,
                                backgroundColor: demographicsChart.data.datasets[0].backgroundColor.map(color => color.replace('0.7', '0.3')),
                                borderColor: demographicsChart.data.datasets[0].borderColor,
                                borderWidth: 1
                            });
                        }
                        
                        // For pie/doughnut charts, switch to bar chart for better comparison
                        if (demographicsChart.config.type === 'pie' || demographicsChart.config.type === 'doughnut') {
                            document.getElementById('demographicChartType').value = 'bar';
                            demographicsChart.config.type = 'bar';
                        }
                    }
                } else {
                    // Remove comparison dataset
                    if (demographicsChart.data.datasets.length > 1) {
                        demographicsChart.data.datasets.pop();
                    }
                }
                
                demographicsChart.update();
                announce(`Comparison data ${compareWith === 'none' ? 'removed' : 'added'}`, false);
            });

            // Program filter change handler
            document.getElementById('programFilter').addEventListener('change', (e) => {
                // In a real implementation, this would filter data by program
                announce(`Filtered demographics to ${e.target.options[e.target.selectedIndex].text}`, false);
                
                // Mock different distributions for different programs
                const programType = e.target.value;
                let filteredData = [];
                
                switch(programType) {
                    case 'after-school':
                        filteredData = [70, 5, 5, 10, 5, 3, 2];
                        break;
                    case 'adult-education':
                        filteredData = [5, 20, 30, 25, 15, 5, 0];
                        break;
                    case 'senior-services':
                        filteredData = [0, 0, 0, 5, 15, 30, 50];
                        break;
                    case 'community-events':
                        filteredData = [25, 15, 20, 15, 10, 8, 7];
                        break;
                    default: // all
                        filteredData = [35, 12, 15, 10, 8, 10, 10];
                }
                
                demographicsChart.data.datasets[0].data = filteredData;
                
                // Update comparison data if present
                if (demographicsChart.data.datasets.length > 1) {
                    const compareWith = document.getElementById('demographicCompare').value;
                    
                    if (compareWith === 'community') {
                        demographicsChart.data.datasets[1].data = [25, 15, 20, 15, 10, 8, 7];
                    } else if (compareWith === 'previous') {
                        demographicsChart.data.datasets[1].data = filteredData.map(val => val * (0.8 + Math.random() * 0.4));
                    }
                }
                
                demographicsChart.update();
            });

            document.getElementById('applyDemographicsChartSettings').addEventListener('click', () => {
                toggleChartControls('demographicsChartControls');
                showNotification('Chart settings applied successfully!', 'success');
            });

            document.getElementById('resetDemographicsChart').addEventListener('click', () => {
                document.getElementById('demographicType').value = 'age';
                document.getElementById('demographicChartType').value = 'pie';
                document.getElementById('demographicCompare').value = 'none';
                document.getElementById('programFilter').value = 'all';
                
                // Reset to single dataset
                demographicsChart.data.datasets = [{
                    label: 'Participant Age Distribution',
                    data: [35, 12, 15, 10, 8, 10, 10],
                    backgroundColor: [
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(72, 149, 239, 0.7)',
                        'rgba(63, 55, 201, 0.7)',
                        'rgba(76, 201, 240, 0.7)',
                        'rgba(247, 37, 133, 0.7)',
                        'rgba(58, 12, 163, 0.7)',
                        'rgba(114, 9, 183, 0.7)'
                    ],
                    borderColor: [
                        'rgba(67, 97, 238, 1)',
                        'rgba(72, 149, 239, 1)',
                        'rgba(63, 55, 201, 1)',
                        'rgba(76, 201, 240, 1)',
                        'rgba(247, 37, 133, 1)',
                        'rgba(58, 12, 163, 1)',
                        'rgba(114, 9, 183, 1)'
                    ],
                    borderWidth: 1
                }];
                
                // Reset chart type
                demographicsChart.config.type = 'pie';
                
                demographicsChart.update();
                showNotification('Chart settings reset to defaults', 'info');
            });
        }

        function updateDemographicData(chart, type) {
            let labels = [];
            let data = [];
            
            // Update labels and data based on demographic type
            switch(type) {
                case 'age':
                    labels = ['Under 18', '18-24', '25-34', '35-44', '45-54', '55-64', '65+'];
                    data = [35, 12, 15, 10, 8, 10, 10];
                    chart.data.datasets[0].label = 'Participant Age Distribution';
                    break;
                case 'income':
                    labels = ['Under $25K', '$25K-$50K', '$50K-$75K', '$75K-$100K', 'Over $100K'];
                    data = [25, 30, 20, 15, 10];
                    chart.data.datasets[0].label = 'Participant Income Levels';
                    break;
                case 'ethnicity':
                    labels = ['White', 'Black', 'Hispanic', 'Asian', 'Other'];
                    data = [40, 25, 20, 10, 5];
                    chart.data.datasets[0].label = 'Participant Ethnicity';
                    break;
                case 'neighborhood':
                    labels = ['Downtown', 'Westside', 'Northside', 'Eastside', 'Southside', 'Suburbs'];
                    data = [15, 20, 25, 15, 15, 10];
                    chart.data.datasets[0].label = 'Participant Neighborhoods';
                    break;
            }
            
            chart.data.labels = labels;
            chart.data.datasets[0].data = data;
            
            // Update comparison data if present
            if (chart.data.datasets.length > 1) {
                const compareWith = document.getElementById('demographicCompare').value;
                
                if (compareWith === 'community') {
                    if (type === 'age') {
                        chart.data.datasets[1].data = [25, 15, 20, 15, 10, 8, 7];
                    } else if (type === 'income') {
                        chart.data.datasets[1].data = [30, 25, 20, 15, 10];
                    } else if (type === 'ethnicity') {
                        chart.data.datasets[1].data = [45, 20, 25, 8, 2];
                    } else if (type === 'neighborhood') {
                        chart.data.datasets[1].data = [18, 22, 20, 15, 15, 10];
                    }
                } else if (compareWith === 'previous') {
                    chart.data.datasets[1].data = data.map(val => val * (0.8 + Math.random() * 0.4));
                }
            }
            
            chart.update();
            announce(`Demographic type changed to ${type}`, false);
        }

        // Resource Allocation Simulation Charts
        function initSimulationCharts() {
            const budgetCtx = document.getElementById('simulationBudgetChart').getContext('2d');
            const participantsCtx = document.getElementById('simulationParticipantsChart').getContext('2d');
            const impactCtx = document.getElementById('simulationImpactChart').getContext('2d');
            
            const data = {
                labels: ['Current', 'Simulated'],
                datasets: [
                    {
                        label: 'After-School Activities',
                        data: [28560, 28560],
                        backgroundColor: 'rgba(67, 97, 238, 0.7)',
                        borderColor: 'rgba(67, 97, 238, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Adult Education',
                        data: [21100, 21100],
                        backgroundColor: 'rgba(76, 201, 240, 0.7)',
                        borderColor: 'rgba(76, 201, 240, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Senior Services',
                        data: [18760, 18760],
                        backgroundColor: 'rgba(247, 37, 133, 0.7)',
                        borderColor: 'rgba(247, 37, 133, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Community Events',
                        data: [22500, 22500],
                        backgroundColor: 'rgba(58, 12, 163, 0.7)',
                        borderColor: 'rgba(58, 12, 163, 1)',
                        borderWidth: 1
                    }
                ]
            };
            
            const participantsData = {
                labels: ['Current', 'Simulated'],
                datasets: [
                    {
                        label: 'After-School Activities',
                        data: [245, 245],
                        backgroundColor: 'rgba(67, 97, 238, 0.7)',
                        borderColor: 'rgba(67, 97, 238, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Adult Education',
                        data: [178, 178],
                        backgroundColor: 'rgba(76, 201, 240, 0.7)',
                        borderColor: 'rgba(76, 201, 240, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Senior Services',
                        data: [132, 132],
                        backgroundColor: 'rgba(247, 37, 133, 0.7)',
                        borderColor: 'rgba(247, 37, 133, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Community Events',
                        data: [1250, 1250],
                        backgroundColor: 'rgba(58, 12, 163, 0.7)',
                        borderColor: 'rgba(58, 12, 163, 1)',
                        borderWidth: 1
                    }
                ]
            };
            
            const impactData = {
                labels: ['Current', 'Simulated'],
                datasets: [
                    {
                        label: 'Overall Impact Score',
                        data: [8.4, 8.4],
                        backgroundColor: 'rgba(67, 97, 238, 0.7)',
                        borderColor: 'rgba(67, 97, 238, 1)',
                        borderWidth: 1
                    }
                ]
            };
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: false,
                    },
                    y: {
                        stacked: false,
                        title: {
                            display: true,
                            text: 'Budget Allocation ($)'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            footer: (tooltipItems) => {
                                const dataIndex = tooltipItems[0].dataIndex;
                                if (dataIndex === 1) {
                                    return 'This is a simulation based on current slider values';
                                }
                                return '';
                            }
                        }
                    }
                }
            };
            
            const participantsOptions = {
                ...chartOptions,
                scales: {
                    ...chartOptions.scales,
                    y: {
                        ...chartOptions.scales.y,
                        title: {
                            display: true,
                            text: 'Projected Participants'
                        }
                    }
                }
            };
            
            const impactOptions = {
                ...chartOptions,
                scales: {
                    ...chartOptions.scales,
                    y: {
                        ...chartOptions.scales.y,
                        title: {
                            display: true,
                            text: 'Impact Score (1-10)'
                        },
                        min: 0,
                        max: 10
                    }
                }
            };
            
            const budgetChart = new Chart(budgetCtx, {
                type: 'bar',
                data: data,
                options: chartOptions
            });
            
            const participantsChart = new Chart(participantsCtx, {
                type: 'bar',
                data: participantsData,
                options: participantsOptions
            });
            
            const impactChart = new Chart(impactCtx, {
                type: 'bar',
                data: impactData,
                options: impactOptions
            });

            // Setup sliders for resource allocation
            const sliders = [
                {element: document.getElementById('afterSchoolSlider'), index: 0, valueDisplay: document.getElementById('afterSchoolValue')},
                {element: document.getElementById('adultEducationSlider'), index: 1, valueDisplay: document.getElementById('adultEducationValue')},
                {element: document.getElementById('seniorServicesSlider'), index: 2, valueDisplay: document.getElementById('seniorServicesValue')},
                {element: document.getElementById('communityEventsSlider'), index: 3, valueDisplay: document.getElementById('communityEventsValue')}
            ];

            const totalBudget = 90920; // Sum of all current allocations
            const currentParticipants = [245, 178, 132, 1250];
            const currentImpactScores = [8.7, 7.9, 9.2, 7.2];

            sliders.forEach(slider => {
                slider.element.addEventListener('input', (e) => {
                    // Update the percentage display
                    slider.valueDisplay.textContent = `${e.target.value}%`;
                    slider.element.setAttribute('aria-valuenow', e.target.value);
                    
                    // Normalize all sliders to ensure they sum to 100%
                    normalizeSliders(sliders, slider.element);
                    
                    // Update the charts (but don't run full simulation)
                    updateSimulationCharts(budgetChart, participantsChart, impactChart, sliders, totalBudget, currentParticipants, currentImpactScores, false);
                });
            });

            // Run simulation button
            document.getElementById('runSimulationBtn').addEventListener('click', () => {
                // Show a loading indicator
                showNotification('Running simulation...', 'info');
                
                // Simulate a delay for processing
                setTimeout(() => {
                    // Run full simulation with all calculations
                    updateSimulationCharts(budgetChart, participantsChart, impactChart, sliders, totalBudget, currentParticipants, currentImpactScores, true);
                    showNotification('Simulation complete!', 'success');
                    announce('Simulation complete. Results now available in the charts.', true);
                }, 1000);
            });

            // Tab functionality
            const tabButtons = document.querySelectorAll('#simulationTabs .tab-btn');
            const tabContents = document.querySelectorAll('#simulationTabs .tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding content
                    button.classList.add('active');
                    button.setAttribute('aria-selected', 'true');
                    const tabId = button.id;
                    const contentId = tabId.replace('Tab', 'Panel');
                    document.getElementById(contentId).classList.add('active');
                    
                    // Announce tab change
                    announce(`Switched to ${button.textContent} tab`, false);
                    
                    // Trigger resize to fix chart rendering
                    window.dispatchEvent(new Event('resize'));
                });
                
                // Keyboard navigation
                button.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        const nextButton = button.nextElementSibling || tabButtons[0];
                        nextButton.click();
                        nextButton.focus();
                    } else if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        const prevButton = button.previousElementSibling || tabButtons[tabButtons.length - 1];
                        prevButton.click();
                        prevButton.focus();
                    }
                });
            });
        }

        function normalizeSliders(sliders, changedSlider) {
            // Get the sum of all slider values
            const total = sliders.reduce((sum, s) => sum + parseInt(s.element.value), 0);
            
            // If the total is not 100, adjust other sliders proportionally
            if (total !== 100) {
                const excess = total - 100;
                const otherSliders = sliders.filter(s => s.element !== changedSlider);
                
                // Calculate the sum of other sliders
                const otherSum = otherSliders.reduce((sum, s) => sum + parseInt(s.element.value), 0);
                
                if (otherSum > 0) {
                    // Distribute the excess proportionally among other sliders
                    otherSliders.forEach(s => {
                        const currentValue = parseInt(s.element.value);
                        const proportion = currentValue / otherSum;
                        const adjustment = Math.round(excess * proportion);
                        const newValue = Math.max(0, currentValue - adjustment);
                        
                        s.element.value = newValue;
                        s.element.setAttribute('aria-valuenow', newValue);
                        s.valueDisplay.textContent = `${newValue}%`;
                    });
                }
            }
        }

        function updateSimulationCharts(budgetChart, participantsChart, impactChart, sliders, totalBudget, currentParticipants, currentImpactScores, runFullSimulation) {
            // Get the current slider values
            const percentages = sliders.map(s => parseInt(s.element.value) / 100);
            
            // Update the budget chart data for the simulated allocation
            sliders.forEach((slider, i) => {
                const simulatedValue = Math.round(totalBudget * percentages[i]);
                budgetChart.data.datasets[i].data[1] = simulatedValue;
            });
            
            budgetChart.update();
            
            // Only update the other charts if running a full simulation
            if (runFullSimulation) {
                // Update participants chart
                // In a real implementation, this would use a more complex model
                // For now, we'll use a simple linear relationship with some randomness
                sliders.forEach((slider, i) => {
                    const budgetRatio = percentages[i] * totalBudget / budgetChart.data.datasets[i].data[0];
                    let simulatedParticipants = Math.round(currentParticipants[i] * budgetRatio * (0.9 + Math.random() * 0.2));
                    
                    // Ensure we don't go too low
                    simulatedParticipants = Math.max(simulatedParticipants, Math.round(currentParticipants[i] * 0.5));
                    
                    participantsChart.data.datasets[i].data[1] = simulatedParticipants;
                });
                
                participantsChart.update();
                
                // Update impact chart
                // Calculate a weighted average impact score
                let totalCurrentImpact = 0;
                let totalSimulatedImpact = 0;
                let currentWeightSum = 0;
                let simulatedWeightSum = 0;
                
                sliders.forEach((slider, i) => {
                    // Use participants as weights
                    const currentWeight = currentParticipants[i];
                    const simulatedWeight = participantsChart.data.datasets[i].data[1];
                    
                    totalCurrentImpact += currentImpactScores[i] * currentWeight;
                    
                    // Simulate how impact might change with budget changes
                    const budgetChange = budgetChart.data.datasets[i].data[1] / budgetChart.data.datasets[i].data[0];
                    const simulatedImpact = Math.min(10, currentImpactScores[i] * (0.8 + budgetChange * 0.2));
                    totalSimulatedImpact += simulatedImpact * simulatedWeight;
                    
                    currentWeightSum += currentWeight;
                    simulatedWeightSum += simulatedWeight;
                });
                
                const avgCurrentImpact = totalCurrentImpact / currentWeightSum;
                const avgSimulatedImpact = totalSimulatedImpact / simulatedWeightSum;
                
                impactChart.data.datasets[0].data[1] = parseFloat(avgSimulatedImpact.toFixed(1));
                impactChart.update();
            }
        }

        // Toggle chart controls visibility
        function toggleChartControls(controlsId) {
            const controls = document.getElementById(controlsId);
            controls.classList.toggle('active');
            
            // Close other control panels
            document.querySelectorAll('.floating-controls').forEach(panel => {
                if (panel.id !== controlsId) {
                    panel.classList.remove('active');
                }
            });
            
            // Announce to screen readers
            if (controls.classList.contains('active')) {
                announce(`Chart controls opened for ${controls.id.replace('Controls', '')}`, false);
            } else {
                announce('Chart controls closed', false);
            }
        }

        // Show program details modal
        function showProgramDetails(programName) {
            const modal = document.getElementById('programDetailsModal');
            const modalTitle = document.getElementById('programDetailsTitle');
            const modalContent = document.getElementById('programDetailsContent');
            
            modalTitle.textContent = programName;
            
            // In a real implementation, this would fetch detailed data for the program
            // For now, we'll generate some mock data
            
            // Find program data from the table
            const table = document.getElementById('programDataTable');
            const rows = table.querySelectorAll('tbody tr');
            let programData = null;
            
            rows.forEach(row => {
                if (row.cells[0].textContent === programName) {
                    programData = {
                        name: row.cells[0].textContent,
                        participants: row.cells[1].textContent,
                        cost: row.cells[2].textContent,
                        costPerParticipant: row.cells[3].textContent,
                        impact: row.cells[4].textContent,
                        status: row.cells[5].querySelector('.status').textContent
                    };
                }
            });
            
            if (programData) {
                // Generate modal content
                modalContent.innerHTML = `
                    <div class="tab-container" id="programDetailsTabs">
                        <div class="tab-nav" role="tablist">
                            <button class="tab-btn active" id="overviewTab" role="tab" aria-selected="true" aria-controls="overviewPanel">Overview</button>
                            <button class="tab-btn" id="demographicsTab" role="tab" aria-selected="false" aria-controls="demographicsPanel">Demographics</button>
                            <button class="tab-btn" id="trendsTab" role="tab" aria-selected="false" aria-controls="trendsPanel">Trends</button>
                            <button class="tab-btn" id="outcomesTab" role="tab" aria-selected="false" aria-controls="outcomesPanel">Outcomes</button>
                        </div>
                        <div class="tab-content active" id="overviewPanel" role="tabpanel" aria-labelledby="overviewTab">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
                                <div class="card" style="padding: 1rem;">
                                    <div class="kpi-title">Total Participants</div>
                                    <div class="kpi-value">${programData.participants}</div>
                                </div>
                                <div class="card" style="padding: 1rem;">
                                    <div class="kpi-title">Total Cost</div>
                                    <div class="kpi-value">${programData.cost}</div>
                                </div>
                                <div class="card" style="padding: 1rem;">
                                    <div class="kpi-title">Cost per Participant</div>
                                    <div class="kpi-value">${programData.costPerParticipant}</div>
                                </div>
                                <div class="card" style="padding: 1rem;">
                                    <div class="kpi-title">Impact Score</div>
                                    <div class="kpi-value">${programData.impact}/10</div>
                                </div>
                            </div>
                            
                            <h3 style="margin-bottom: 0.5rem;">Program Description</h3>
                            <p style="margin-bottom: 1rem;">
                                ${generateProgramDescription(programData.name)}
                            </p>
                            
                            <h3 style="margin-bottom: 0.5rem;">Key Metrics</h3>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Attendance Rate</span>
                                    <span>