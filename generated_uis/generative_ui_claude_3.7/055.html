<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Customer Segmentation Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary: #4285f4;
            --primary-light: #80b1ff;
            --primary-dark: #0d5bdd;
            --secondary: #34a853;
            --secondary-light: #66c985;
            --secondary-dark: #1e7e34;
            --accent: #fbbc05;
            --accent-light: #ffd04c;
            --accent-dark: #f09c00;
            --error: #ea4335;
            --error-light: #ff7961;
            --error-dark: #c62828;
            --text-primary: #212121;
            --text-secondary: #757575;
            --text-hint: #9e9e9e;
            --background: #ffffff;
            --surface: #f5f5f5;
            --border: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--surface);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 4px var(--shadow);
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
        }

        .logo .material-icons {
            margin-right: 8px;
            font-size: 32px;
        }

        .progress-container {
            width: 100%;
            max-width: 600px;
            margin-left: 20px;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-step {
            position: relative;
            width: 20%;
            text-align: center;
            font-size: 12px;
            color: white;
            opacity: 0.7;
        }

        .progress-step.active {
            opacity: 1;
            font-weight: 500;
        }

        .progress-bar-track {
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: white;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        main {
            margin: 40px 0;
        }

        .card {
            background-color: var(--background);
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow);
            padding: 24px;
            margin-bottom: 24px;
        }

        h2 {
            margin-bottom: 16px;
            color: var(--primary);
            font-weight: 500;
        }

        h3 {
            margin-bottom: 12px;
            color: var(--text-primary);
            font-weight: 500;
        }

        p {
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover, .upload-area.drag-over {
            border-color: var(--primary);
            background-color: rgba(66, 133, 244, 0.05);
        }

        .upload-area .material-icons {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .upload-area p {
            margin-bottom: 8px;
        }

        .upload-area small {
            color: var(--text-hint);
        }

        .data-preview {
            overflow-x: auto;
            margin-bottom: 24px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        thead {
            background-color: var(--surface);
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-weight: 500;
            color: var(--text-primary);
        }

        td {
            color: var(--text-secondary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 4px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn .material-icons {
            margin-right: 8px;
            font-size: 18px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background-color: var(--border);
        }

        .btn-success {
            background-color: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--secondary-dark);
        }

        .btn-group {
            display: flex;
            justify-content: space-between;
            margin-top: 24px;
        }

        .variable-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .variable-category {
            margin-bottom: 24px;
        }

        .variable-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--border);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .variable-item:hover {
            border-color: var(--primary-light);
            background-color: rgba(66, 133, 244, 0.05);
        }

        .variable-item input[type="checkbox"] {
            margin-right: 12px;
        }

        .variable-item label {
            flex: 1;
            cursor: pointer;
        }

        .variable-info {
            color: var(--text-hint);
            font-size: 12px;
        }

        .cluster-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            margin-bottom: 24px;
        }

        .cluster-slider {
            flex: 1;
            min-width: 300px;
        }

        .cluster-input {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cluster-input input {
            width: 60px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .chart-container {
            height: 400px;
            position: relative;
            margin-bottom: 24px;
        }

        .segment-profiles {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .segment-card {
            border-radius: 8px;
            border: 1px solid var(--border);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .segment-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .segment-header {
            padding: 16px;
            color: white;
        }

        .segment-body {
            padding: 16px;
        }

        .segment-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .segment-stat:last-child {
            border-bottom: none;
        }

        .segment-stat-label {
            color: var(--text-secondary);
        }

        .segment-stat-value {
            font-weight: 500;
        }

        .strategy-container {
            margin-bottom: 24px;
        }

        .strategy-item {
            border-left: 4px solid var(--primary);
            background-color: rgba(66, 133, 244, 0.05);
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 0 4px 4px 0;
        }

        .strategy-segment {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .strategy-actions {
            margin-top: 8px;
        }

        .strategy-action {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .strategy-action .material-icons {
            color: var(--secondary);
            margin-right: 8px;
            font-size: 18px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .material-icons {
            color: var(--text-hint);
            font-size: 16px;
            vertical-align: middle;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: var(--text-primary);
            color: white;
            text-align: center;
            border-radius: 4px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
            font-size: 12px;
            line-height: 1.4;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .progress-container {
                display: none;
            }
            
            .variable-selection {
                grid-template-columns: 1fr;
            }
            
            .cluster-controls {
                flex-direction: column;
                gap: 16px;
            }
            
            .segment-profiles {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <span class="material-icons">insights</span>
                Customer Segmentation Tool
            </div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-step active" data-step="1">Data Upload</div>
                    <div class="progress-step" data-step="2">Variable Selection</div>
                    <div class="progress-step" data-step="3">Model Configuration</div>
                    <div class="progress-step" data-step="4">Results Analysis</div>
                    <div class="progress-step" data-step="5">Strategy Creation</div>
                </div>
                <div class="progress-bar-track">
                    <div class="progress-bar-fill" style="width: 20%"></div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="step-content active" id="step1">
                <div class="card">
                    <h2>Step 1: Upload Your Customer Data</h2>
                    <p>Start by uploading your e-commerce customer data. The file should include purchase history, customer demographics, and behavioral data. We accept CSV, Excel, or JSON formats.</p>
                    
                    <div class="upload-area" id="uploadArea">
                        <span class="material-icons">cloud_upload</span>
                        <p>Drag and drop your file here or click to browse</p>
                        <small>Supported formats: CSV, XLSX, JSON (max 100MB)</small>
                        <input type="file" id="fileUpload" style="display: none" accept=".csv,.xlsx,.json">
                    </div>
                    
                    <div class="data-preview" id="dataPreview" style="display: none;">
                        <h3>Data Preview</h3>
                        <table id="previewTable">
                            <thead>
                                <tr>
                                    <th>Customer ID</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Purchase Frequency</th>
                                    <th>Average Order Value</th>
                                    <th>Total Spend</th>
                                    <th>Product Categories</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data rows will be inserted here -->
                            </tbody>
                        </table>
                        <p><strong>Rows:</strong> <span id="rowCount">0</span> | <strong>Columns:</strong> <span id="columnCount">0</span></p>
                    </div>
                    
                    <div class="btn-group">
                        <div></div>
                        <button class="btn btn-primary" id="nextStep1">
                            <span class="material-icons">arrow_forward</span>
                            Next: Select Variables
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="step-content" id="step2">
                <div class="card">
                    <h2>Step 2: Select Variables for Segmentation</h2>
                    <p>Choose the variables that will be used to segment your customers. Select variables that you believe will create meaningful and actionable customer groups.</p>
                    
                    <div class="variable-selection">
                        <div class="variable-category">
                            <h3>Demographics</h3>
                            <div class="variable-item">
                                <input type="checkbox" id="var_age" checked>
                                <label for="var_age">Age</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Customer's age in years. Important for life-stage targeted marketing.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_gender" checked>
                                <label for="var_gender">Gender</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Customer's gender. Useful for personalized marketing campaigns.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_location">
                                <label for="var_location">Location</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Customer's geographic location. Important for regional targeting.</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="variable-category">
                            <h3>Purchase Behavior</h3>
                            <div class="variable-item">
                                <input type="checkbox" id="var_frequency" checked>
                                <label for="var_frequency">Purchase Frequency</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">How often the customer makes purchases. Key for identifying loyal customers.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_aov" checked>
                                <label for="var_aov">Average Order Value</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Average amount spent per order. Helps identify high-value customers.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_total_spend" checked>
                                <label for="var_total_spend">Total Spend</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Total amount spent by the customer. Important for lifetime value analysis.</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="variable-category">
                            <h3>Product Preferences</h3>
                            <div class="variable-item">
                                <input type="checkbox" id="var_categories" checked>
                                <label for="var_categories">Product Categories</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Types of products purchased. Essential for interest-based targeting.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_price_sensitivity">
                                <label for="var_price_sensitivity">Price Sensitivity</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">How responsive customers are to price changes. Useful for pricing strategies.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_seasonal_buying">
                                <label for="var_seasonal_buying">Seasonal Buying Patterns</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">When customers tend to make purchases. Important for timing promotions.</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="variable-category">
                            <h3>Engagement</h3>
                            <div class="variable-item">
                                <input type="checkbox" id="var_recency">
                                <label for="var_recency">Recency</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">How recently the customer made a purchase. Key for RFM analysis.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_email_engagement">
                                <label for="var_email_engagement">Email Engagement</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">How often customers open or click on emails. Useful for communication strategy.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="checkbox" id="var_returns">
                                <label for="var_returns">Return Rate</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Frequency of product returns. Important for identifying problematic customers.</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="prevStep2">
                            <span class="material-icons">arrow_back</span>
                            Back
                        </button>
                        <button class="btn btn-primary" id="nextStep2">
                            <span class="material-icons">arrow_forward</span>
                            Next: Configure Model
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="step-content" id="step3">
                <div class="card">
                    <h2>Step 3: Configure Clustering Model</h2>
                    <p>Determine the optimal number of customer segments using statistical methods. The system will help you find the right balance between too few segments (overly general) and too many segments (difficult to manage).</p>
                    
                    <div class="cluster-controls">
                        <div class="cluster-slider">
                            <h3>Number of Segments</h3>
                            <p>Drag the slider to select the number of customer segments you want to create.</p>
                            <input type="range" min="2" max="10" value="4" id="clusterSlider" style="width: 100%;">
                            <div class="cluster-input">
                                <label for="clusterNumber">Segments:</label>
                                <input type="number" id="clusterNumber" min="2" max="10" value="4">
                            </div>
                        </div>
                        
                        <div class="cluster-methods">
                            <h3>Clustering Method</h3>
                            <p>Select the algorithm to use for customer segmentation.</p>
                            <div class="variable-item">
                                <input type="radio" id="method_kmeans" name="clusterMethod" checked>
                                <label for="method_kmeans">K-Means (Recommended)</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Fast and efficient for large datasets. Creates spherical clusters of similar sizes.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="radio" id="method_hierarchical" name="clusterMethod">
                                <label for="method_hierarchical">Hierarchical Clustering</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Creates a tree of clusters. Good for exploring different numbers of segments.</span>
                                </span>
                            </div>
                            <div class="variable-item">
                                <input type="radio" id="method_dbscan" name="clusterMethod">
                                <label for="method_dbscan">DBSCAN</label>
                                <span class="tooltip">
                                    <span class="material-icons">info</span>
                                    <span class="tooltip-text">Density-based clustering. Good for finding clusters of irregular shapes.</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <h3>Optimal Cluster Determination</h3>
                    <p>These visualizations help you determine the ideal number of customer segments based on statistical methods.</p>
                    
                    <div class="chart-container">
                        <canvas id="elbowChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="silhouetteChart"></canvas>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="prevStep3">
                            <span class="material-icons">arrow_back</span>
                            Back
                        </button>
                        <button class="btn btn-success" id="runSegmentation">
                            <span class="material-icons">play_arrow</span>
                            Run Segmentation
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="step-content" id="step4">
                <div class="card">
                    <h2>Step 4: Analyze Segmentation Results</h2>
                    <p>Explore the customer segments identified by the clustering algorithm. Understand what makes each segment unique and how they differ from each other.</p>
                    
                    <div class="chart-container">
                        <canvas id="scatterChart"></canvas>
                    </div>
                    
                    <h3>Segment Profiles</h3>
                    <p>Below are the key characteristics of each identified customer segment.</p>
                    
                    <div class="segment-profiles" id="segmentProfiles">
                        <!-- Segment cards will be inserted here -->
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="prevStep4">
                            <span class="material-icons">arrow_back</span>
                            Back
                        </button>
                        <button class="btn btn-primary" id="nextStep4">
                            <span class="material-icons">arrow_forward</span>
                            Next: Create Strategies
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="step-content" id="step5">
                <div class="card">
                    <h2>Step 5: Develop Marketing Strategies</h2>
                    <p>Based on the characteristics of each segment, create targeted marketing strategies to effectively engage with each customer group.</p>
                    
                    <div class="strategy-container">
                        <div class="strategy-item" style="border-color: #4285f4;">
                            <div class="strategy-segment">Segment 1: High-Value Loyalists (22% of customers)</div>
                            <p>These customers have high purchase frequency, high average order value, and tend to buy premium products. They are your most valuable customers.</p>
                            <div class="strategy-actions">
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Implement a VIP loyalty program with exclusive benefits</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Send early access to new products and collections</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Personalized recommendations based on purchase history</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="strategy-item" style="border-color: #34a853;">
                            <div class="strategy-segment">Segment 2: Potential Enthusiasts (35% of customers)</div>
                            <p>These customers have moderate purchase frequency and average order value, but show potential for growth. They are consistent but not yet fully engaged.</p>
                            <div class="strategy-actions">
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Implement a tiered loyalty program to encourage more frequent purchases</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Create bundle offers to increase average order value</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Send educational content about product benefits</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="strategy-item" style="border-color: #fbbc05;">
                            <div class="strategy-segment">Segment 3: Occasional Shoppers (28% of customers)</div>
                            <p>These customers make infrequent purchases with low to moderate order values. They might be price-sensitive or only shop during specific seasons.</p>
                            <div class="strategy-actions">
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Send targeted promotions and discounts to encourage more frequent purchases</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Create re-engagement email campaigns for customers who haven't purchased recently</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Offer limited-time promotions to create urgency</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="strategy-item" style="border-color: #ea4335;">
                            <div class="strategy-segment">Segment 4: One-Time Buyers (15% of customers)</div>
                            <p>These customers have made only one purchase and haven't returned. They might have had a negative experience or simply forgotten about your store.</p>
                            <div class="strategy-actions">
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Send a "We miss you" campaign with a special comeback offer</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Request feedback on their shopping experience to identify improvement areas</div>
                                </div>
                                <div class="strategy-action">
                                    <span class="material-icons">check_circle</span>
                                    <div>Showcase new products or improvements since their last purchase</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="prevStep5">
                            <span class="material-icons">arrow_back</span>
                            Back
                        </button>
                        <button class="btn btn-success" id="finishButton">
                            <span class="material-icons">check_circle</span>
                            Finish & Export Results
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // Navigation between steps
        const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
        const progressSteps = document.querySelectorAll('.progress-step');
        const progressBarFill = document.querySelector('.progress-bar-fill');
        let currentStepIndex = 0;

        function showStep(index) {
            document.querySelectorAll('.step-content').forEach(step => step.classList.remove('active'));
            document.getElementById(steps[index]).classList.add('active');
            
            progressSteps.forEach((step, i) => {
                if (i <= index) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
            
            progressBarFill.style.width = `${((index + 1) / steps.length) * 100}%`;
            currentStepIndex = index;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Step 1: File Upload
        const uploadArea = document.getElementById('uploadArea');
        const fileUpload = document.getElementById('fileUpload');
        const dataPreview = document.getElementById('dataPreview');
        const previewTable = document.getElementById('previewTable');
        const rowCount = document.getElementById('rowCount');
        const columnCount = document.getElementById('columnCount');

        uploadArea.addEventListener('click', () => {
            fileUpload.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        fileUpload.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            // In a real application, this would parse the file
            // For demo purposes, we'll just show a sample preview
            
            // Display sample data
            const sampleData = [
                { id: 'C1001', age: 34, gender: 'F', frequency: 12, aov: 120, total: 1440, categories: 'Clothing, Accessories' },
                { id: 'C1002', age: 28, gender: 'M', frequency: 5, aov: 85, total: 425, categories: 'Electronics' },
                { id: 'C1003', age: 45, gender: 'F', frequency: 20, aov: 150, total: 3000, categories: 'Home Decor, Furniture' },
                { id: 'C1004', age: 32, gender: 'M', frequency: 8, aov: 95, total: 760, categories: 'Clothing, Sports' },
                { id: 'C1005', age: 50, gender: 'M', frequency: 15, aov: 200, total: 3000, categories: 'Electronics, Appliances' }
            ];
            
            // Clear existing rows
            const tbody = previewTable.querySelector('tbody');
            tbody.innerHTML = '';
            
            // Add sample data rows
            sampleData.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.id}</td>
                    <td>${customer.age}</td>
                    <td>${customer.gender}</td>
                    <td>${customer.frequency}</td>
                    <td>$${customer.aov}</td>
                    <td>$${customer.total}</td>
                    <td>${customer.categories}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Update stats
            rowCount.textContent = '50,000';
            columnCount.textContent = '15';
            
            // Show data preview
            dataPreview.style.display = 'block';
            
            // Update upload area
            uploadArea.querySelector('p').textContent = `File loaded: ${file.name}`;
            uploadArea.querySelector('.material-icons').textContent = 'check_circle';
        }

        // Step 3: Charts
        function createElbowChart() {
            const ctx = document.getElementById('elbowChart').getContext('2d');
            
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2', '3', '4', '5', '6', '7', '8', '9', '10'],
                    datasets: [{
                        label: 'Inertia (Within-Cluster Sum of Squares)',
                        data: [120000, 80000, 50000, 30000, 25000, 22000, 20000, 18000, 16000],
                        borderColor: '#4285f4',
                        backgroundColor: 'rgba(66, 133, 244, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        pointBackgroundColor: '#4285f4',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Elbow Method for Optimal Number of Clusters',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Inertia: ${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Number of Clusters'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Inertia'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createSilhouetteChart() {
            const ctx = document.getElementById('silhouetteChart').getContext('2d');
            
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2', '3', '4', '5', '6', '7', '8', '9', '10'],
                    datasets: [{
                        label: 'Silhouette Score',
                        data: [0.45, 0.52, 0.68, 0.63, 0.58, 0.55, 0.51, 0.48, 0.45],
                        backgroundColor: '#34a853',
                        borderColor: '#1e7e34',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Silhouette Score for Different Numbers of Clusters',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Silhouette Score: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Number of Clusters'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Silhouette Score'
                            },
                            min: 0,
                            max: 1
                        }
                    }
                }
            });
        }

        function createScatterChart() {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            
            return new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Segment 1: High-Value Loyalists',
                            data: Array.from({ length: 30 }, () => ({
                                x: Math.random() * 20 + 80, // AOV
                                y: Math.random() * 5 + 15   // Frequency
                            })),
                            backgroundColor: 'rgba(66, 133, 244, 0.7)',
                            borderColor: '#4285f4'
                        },
                        {
                            label: 'Segment 2: Potential Enthusiasts',
                            data: Array.from({ length: 50 }, () => ({
                                x: Math.random() * 30 + 50, // AOV
                                y: Math.random() * 5 + 5    // Frequency
                            })),
                            backgroundColor: 'rgba(52, 168, 83, 0.7)',
                            borderColor: '#34a853'
                        },
                        {
                            label: 'Segment 3: Occasional Shoppers',
                            data: Array.from({ length: 40 }, () => ({
                                x: Math.random() * 30 + 30, // AOV
                                y: Math.random() * 3 + 2    // Frequency
                            })),
                            backgroundColor: 'rgba(251, 188, 5, 0.7)',
                            borderColor: '#fbbc05'
                        },
                        {
                            label: 'Segment 4: One-Time Buyers',
                            data: Array.from({ length: 20 }, () => ({
                                x: Math.random() * 50 + 10, // AOV
                                y: Math.random() * 1 + 0.5  // Frequency
                            })),
                            backgroundColor: 'rgba(234, 67, 53, 0.7)',
                            borderColor: '#ea4335'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Customer Segments by Average Order Value and Purchase Frequency',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Average Order Value ($)'
                            },
                            min: 0
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Purchase Frequency (orders/year)'
                            },
                            min: 0
                        }
                    }
                }
            });
        }

        function createRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            return new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: [
                        'Purchase Frequency',
                        'Average Order Value',
                        'Total Spend',
                        'Age',
                        'Email Engagement',
                        'Product Diversity'
                    ],
                    datasets: [
                        {
                            label: 'Segment 1: High-Value Loyalists',
                            data: [9, 9, 10, 6, 8, 7],
                            backgroundColor: 'rgba(66, 133, 244, 0.2)',
                            borderColor: '#4285f4',
                            pointBackgroundColor: '#4285f4'
                        },
                        {
                            label: 'Segment 2: Potential Enthusiasts',
                            data: [6, 6, 6, 5, 7, 6],
                            backgroundColor: 'rgba(52, 168, 83, 0.2)',
                            borderColor: '#34a853',
                            pointBackgroundColor: '#34a853'
                        },
                        {
                            label: 'Segment 3: Occasional Shoppers',
                            data: [3, 4, 3, 5, 4, 5],
                            backgroundColor: 'rgba(251, 188, 5, 0.2)',
                            borderColor: '#fbbc05',
                            pointBackgroundColor: '#fbbc05'
                        },
                        {
                            label: 'Segment 4: One-Time Buyers',
                            data: [1, 3, 1, 4, 2, 3],
                            backgroundColor: 'rgba(234, 67, 53, 0.2)',
                            borderColor: '#ea4335',
                            pointBackgroundColor: '#ea4335'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Segment Comparison Across Key Variables',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        r: {
                            min: 0,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    }
                }
            });
        }

        // Create segment profiles
        function createSegmentProfiles() {
            const segmentProfiles = document.getElementById('segmentProfiles');
            const segments = [
                {
                    name: 'High-Value Loyalists',
                    color: '#4285f4',
                    percent: 22,
                    stats: {
                        'Average Age': '42 years',
                        'Gender Split': '65% F, 35% M',
                        'Avg. Order Value': '$145',
                        'Purchase Frequency': '18.3/year',
                        'Total Annual Spend': '$2,654',
                        'Top Categories': 'Clothing, Home Decor'
                    }
                },
                {
                    name: 'Potential Enthusiasts',
                    color: '#34a853',
                    percent: 35,
                    stats: {
                        'Average Age': '36 years',
                        'Gender Split': '55% F, 45% M',
                        'Avg. Order Value': '$85',
                        'Purchase Frequency': '7.2/year',
                        'Total Annual Spend': '$612',
                        'Top Categories': 'Electronics, Clothing'
                    }
                },
                {
                    name: 'Occasional Shoppers',
                    color: '#fbbc05',
                    percent: 28,
                    stats: {
                        'Average Age': '31 years',
                        'Gender Split': '48% F, 52% M',
                        'Avg. Order Value': '$65',
                        'Purchase Frequency': '3.4/year',
                        'Total Annual Spend': '$221',
                        'Top Categories': 'Accessories, Gifts'
                    }
                },
                {
                    name: 'One-Time Buyers',
                    color: '#ea4335',
                    percent: 15,
                    stats: {
                        'Average Age': '29 years',
                        'Gender Split': '50% F, 50% M',
                        'Avg. Order Value': '$55',
                        'Purchase Frequency': '1/year',
                        'Total Annual Spend': '$55',
                        'Top Categories': 'Seasonal Items, Sale Items'
                    }
                }
            ];
            
            segmentProfiles.innerHTML = '';
            
            segments.forEach(segment => {
                const card = document.createElement('div');
                card.className = 'segment-card';
                
                const header = document.createElement('div');
                header.className = 'segment-header';
                header.style.backgroundColor = segment.color;
                header.innerHTML = `
                    <h3 style="color: white; margin-bottom: 5px;">${segment.name}</h3>
                    <div>${segment.percent}% of customers</div>
                `;
                
                const body = document.createElement('div');
                body.className = 'segment-body';
                
                let statsHtml = '';
                for (const [label, value] of Object.entries(segment.stats)) {
                    statsHtml += `
                        <div class="segment-stat">
                            <div class="segment-stat-label">${label}</div>
                            <div class="segment-stat-value">${value}</div>
                        </div>
                    `;
                }
                
                body.innerHTML = statsHtml;
                
                card.appendChild(header);
                card.appendChild(body);
                segmentProfiles.appendChild(card);
            });
        }

        // Initialize charts when needed
        let elbowChart, silhouetteChart, scatterChart, radarChart;

        // Event listeners for navigation
        document.getElementById('nextStep1').addEventListener('click', () => {
            showStep(1);
        });

        document.getElementById('prevStep2').addEventListener('click', () => {
            showStep(0);
        });

        document.getElementById('nextStep2').addEventListener('click', () => {
            showStep(2);
            
            // Initialize charts for step 3
            if (!elbowChart) elbowChart = createElbowChart();
            if (!silhouetteChart) silhouetteChart = createSilhouetteChart();
        });

        document.getElementById('prevStep3').addEventListener('click', () => {
            showStep(1);
        });

        document.getElementById('runSegmentation').addEventListener('click', () => {
            // Show loading state
            const runButton = document.getElementById('runSegmentation');
            const originalText = runButton.innerHTML;
            runButton.innerHTML = '<span class="material-icons">hourglass_top</span> Processing...';
            runButton.disabled = true;
            
            // Simulate processing time
            setTimeout(() => {
                showStep(3);
                
                // Initialize charts for step 4
                if (!scatterChart) scatterChart = createScatterChart();
                if (!radarChart) radarChart = createRadarChart();
                createSegmentProfiles();
                
                // Reset button
                runButton.innerHTML = originalText;
                runButton.disabled = false;
            }, 1500);
        });

        document.getElementById('prevStep4').addEventListener('click', () => {
            showStep(2);
        });

        document.getElementById('nextStep4').addEventListener('click', () => {
            showStep(4);
        });

        document.getElementById('prevStep5').addEventListener('click', () => {
            showStep(3);
        });

        document.getElementById('finishButton').addEventListener('click', () => {
            alert('Segmentation complete! Your results have been exported.');
        });

        // Sync cluster slider and input
        const clusterSlider = document.getElementById('clusterSlider');
        const clusterNumber = document.getElementById('clusterNumber');

        clusterSlider.addEventListener('input', () => {
            clusterNumber.value = clusterSlider.value;
        });

        clusterNumber.addEventListener('input', () => {
            if (clusterNumber.value < 2) clusterNumber.value = 2;
            if (clusterNumber.value > 10) clusterNumber.value = 10;
            clusterSlider.value = clusterNumber.value;
        });
    </script>
</body>
</html>