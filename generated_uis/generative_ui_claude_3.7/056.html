<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoExplorer: Interactive Ecosystem Learning</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4CAF50;
            --primary-light: #81C784;
            --primary-dark: #388E3C;
            --secondary-color: #2196F3;
            --secondary-light: #64B5F6;
            --secondary-dark: #1976D2;
            --accent-color: #FF9800;
            --accent-light: #FFB74D;
            --accent-dark: #F57C00;
            --text-color: #333333;
            --text-light: #757575;
            --background-light: #f9f9f9;
            --background-white: #ffffff;
            --shadow: 0 2px 5px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 10px rgba(0,0,0,0.15);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            color: var(--text-color);
            background-color: var(--background-light);
            line-height: 1.6;
        }

        .container {
            display: grid;
            grid-template-columns: 240px 1fr;
            grid-template-rows: 60px 1fr;
            grid-template-areas: 
                "header header"
                "sidebar main";
            min-height: 100vh;
        }

        header {
            grid-area: header;
            background-color: var(--primary-color);
            color: white;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .logo i {
            font-size: 24px;
        }

        .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-controls button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .user-controls button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .user-controls button:focus {
            outline: 2px solid white;
            outline-offset: 2px;
        }

        aside {
            grid-area: sidebar;
            background-color: var(--background-white);
            box-shadow: var(--shadow);
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section h3 {
            padding: 10px 20px;
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--text-light);
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .nav-item.active {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 3px solid var(--primary-color);
            font-weight: 600;
        }

        .nav-item i {
            color: var(--text-light);
        }

        .nav-item.active i {
            color: var(--primary-color);
        }

        main {
            grid-area: main;
            padding: 20px;
            overflow-y: auto;
        }

        .module-container {
            background: var(--background-white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .module-container:hover {
            box-shadow: var(--shadow-hover);
        }

        .module-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .module-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .module-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .content-block {
            position: relative;
        }

        .text-content {
            margin-bottom: 15px;
            position: relative;
            padding-right: 40px;
        }

        .text-content h3 {
            margin-bottom: 10px;
            color: var(--primary-dark);
        }

        .text-content p {
            margin-bottom: 15px;
            line-height: 1.7;
        }

        .text-content ol, .text-content ul {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        .text-content li {
            margin-bottom: 5px;
        }

        .text-to-speech {
            position: absolute;
            right: 0;
            top: 0;
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .text-to-speech:hover {
            background-color: rgba(33, 150, 243, 0.1);
            transform: scale(1.1);
        }

        .text-to-speech:focus {
            outline: 2px solid var(--secondary-color);
            outline-offset: 2px;
        }

        .vocabulary {
            position: relative;
            display: inline-block;
            color: var(--secondary-color);
            font-weight: 600;
            cursor: pointer;
            border-bottom: 1px dotted var(--secondary-color);
        }

        .tooltip {
            position: absolute;
            background-color: var(--background-white);
            box-shadow: var(--shadow-hover);
            border-radius: var(--border-radius);
            padding: 15px;
            width: 280px;
            top: 100%;
            left: 0;
            z-index: 10;
            display: none;
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.1);
        }

        .vocabulary:hover .tooltip {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tooltip-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tooltip-content button {
            align-self: flex-start;
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .tooltip-content button:hover {
            background-color: rgba(33, 150, 243, 0.1);
        }

        .tooltip-content button:focus {
            outline: 2px solid var(--secondary-color);
            outline-offset: 2px;
        }

        .canvas-container {
            background-color: #f5f5f5;
            border-radius: var(--border-radius);
            height: 300px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        #foodWebCanvas {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #e6f7ff 0%, #ffffff 100%);
        }

        .organism-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .organism-card {
            background-color: var(--background-white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 80px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: var(--transition);
            padding: 5px;
        }

        .organism-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .organism-card:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .organism-card img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .organism-card span {
            font-size: 0.8rem;
            text-align: center;
            margin-top: 5px;
        }

        .canvas-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .canvas-controls button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
            font-weight: 600;
        }

        .canvas-controls button:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
        }

        .canvas-controls button:focus {
            outline: 2px solid var(--secondary-dark);
            outline-offset: 2px;
        }

        .canvas-controls button.clear {
            background-color: #F44336;
        }

        .canvas-controls button.clear:hover {
            background-color: #D32F2F;
        }

        .energy-flow-container {
            position: relative;
            height: 300px;
            background-color: #f5f5f5;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        .pyramid-level {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .pyramid-level:hover {
            filter: brightness(1.1);
            cursor: pointer;
            transform: translateX(-50%) scale(1.02);
        }

        .pyramid-level:focus {
            outline: 2px solid white;
            outline-offset: 2px;
        }

        .pyramid-level:nth-child(1) {
            bottom: 20px;
            width: 80%;
            height: 60px;
            background-color: var(--primary-color);
        }

        .pyramid-level:nth-child(2) {
            bottom: 90px;
            width: 60%;
            height: 60px;
            background-color: #8BC34A;
        }

        .pyramid-level:nth-child(3) {
            bottom: 160px;
            width: 40%;
            height: 60px;
            background-color: #CDDC39;
        }

        .pyramid-level:nth-child(4) {
            bottom: 230px;
            width: 20%;
            height: 60px;
            background-color: #FFEB3B;
        }

        .pyramid-info {
            position: absolute;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--shadow-hover);
            max-width: 300px;
            z-index: 5;
            display: none;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .pyramid-info h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .pyramid-info p {
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .pyramid-info button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .pyramid-info button:hover {
            background-color: #f5f5f5;
        }

        .habitat-explorer {
            position: relative;
            height: 300px;
            background-color: #f5f5f5;
            border-radius: var(--border-radius);
            overflow: hidden;
            background-image: url('https://placehold.co/600x400?text=Forest+Habitat');
            background-size: cover;
            background-position: center;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        .hotspot {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 2;
        }

        .hotspot:hover {
            transform: scale(1.2);
            background-color: white;
        }

        .hotspot:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
            transform: scale(1.2);
        }

        .hotspot-1 {
            top: 30%;
            left: 20%;
        }

        .hotspot-2 {
            top: 60%;
            left: 40%;
        }

        .hotspot-3 {
            top: 25%;
            left: 70%;
        }

        .hotspot-info {
            position: absolute;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            width: 250px;
            box-shadow: var(--shadow-hover);
            z-index: 5;
            display: none;
            border: 1px solid rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease;
        }

        .hotspot-info h4 {
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .hotspot-info img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
            margin: 5px 0;
        }

        .hotspot-info p {
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .hotspot-info button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .hotspot-info button:hover {
            background-color: #f5f5f5;
        }

        .hotspot-info button:focus {
            outline: 2px solid #999;
            outline-offset: 2px;
        }

        .quiz-container {
            margin-top: 30px;
            background-color: var(--background-white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            transition: var(--transition);
        }

        .quiz-container:hover {
            box-shadow: var(--shadow-hover);
        }

        .quiz-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quiz-question {
            margin-bottom: 20px;
        }

        .quiz-question p {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .quiz-option {
            padding: 12px;
            background-color: #f5f5f5;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .quiz-option:hover {
            background-color: #eeeeee;
            transform: translateY(-2px);
        }

        .quiz-option:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .quiz-option.selected {
            background-color: rgba(76, 175, 80, 0.1);
            border-color: var(--primary-color);
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: var(--border-radius);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .quiz-feedback.correct {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }

        .quiz-feedback.incorrect {
            background-color: rgba(244, 67, 54, 0.1);
            color: #F44336;
            border-left: 4px solid #F44336;
        }

        .progress-container {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }

        .progress-indicator {
            display: flex;
            gap: 10px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ddd;
            cursor: pointer;
            transition: var(--transition);
        }

        .progress-dot.active {
            background-color: var(--primary-color);
        }

        .progress-dot:hover {
            transform: scale(1.2);
        }

        .progress-dot:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Accessibility features */
        .accessibility-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            z-index: 100;
            width: 250px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .accessibility-panel h3 {
            margin-bottom: 15px;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .accessibility-option {
            margin-bottom: 15px;
        }

        .accessibility-option label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .font-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .font-size-control button {
            background-color: #f5f5f5;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .font-size-control button:hover {
            background-color: #e0e0e0;
        }

        .font-size-control button:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .font-size-display {
            min-width: 30px;
            text-align: center;
        }

        /* High contrast mode */
        body.high-contrast {
            --primary-color: #00AA00;
            --primary-light: #00CC00;
            --primary-dark: #008800;
            --secondary-color: #0066CC;
            --secondary-light: #0088FF;
            --secondary-dark: #004499;
            --text-color: #000000;
            --text-light: #333333;
            --background-light: #FFFFFF;
            --background-white: #FFFFFF;
        }

        body.high-contrast .module-container,
        body.high-contrast .quiz-container,
        body.high-contrast aside {
            border: 2px solid #000;
            box-shadow: none;
        }

        body.high-contrast .vocabulary {
            color: #0000FF;
            font-weight: 700;
            text-decoration: underline;
            border-bottom: none;
        }

        body.high-contrast .hotspot {
            background-color: yellow;
            color: black;
            border: 2px solid black;
        }

        body.high-contrast .pyramid-level:nth-child(1) {
            background-color: #00AA00;
        }

        body.high-contrast .pyramid-level:nth-child(2) {
            background-color: #66CC00;
        }

        body.high-contrast .pyramid-level:nth-child(3) {
            background-color: #AACC00;
        }

        body.high-contrast .pyramid-level:nth-child(4) {
            background-color: #FFCC00;
        }

        /* Large font mode */
        body.large-font {
            font-size: 1.2rem;
        }

        body.large-font h2 {
            font-size: 1.8rem;
        }

        body.large-font h3 {
            font-size: 1.5rem;
        }

        body.large-font .text-content p,
        body.large-font .text-content li {
            line-height: 1.8;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "main";
            }

            aside {
                display: none;
                position: fixed;
                top: 60px;
                left: 0;
                width: 240px;
                height: calc(100vh - 60px);
                z-index: 5;
            }

            aside.active {
                display: block;
            }

            .module-content {
                grid-template-columns: 1fr;
            }

            .quiz-options {
                grid-template-columns: 1fr;
            }

            .mobile-only {
                display: block;
            }
        }

        @media (min-width: 769px) {
            .mobile-only {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="material-icons">eco</i>
                <span>EcoExplorer</span>
            </div>
            <div class="user-controls">
                <button id="toggleAccessibility" aria-label="Accessibility Options">
                    <i class="material-icons">accessibility</i>
                    <span>Accessibility</span>
                </button>
                <button id="toggleMenu" class="mobile-only" aria-label="Toggle Menu">
                    <i class="material-icons">menu</i>
                </button>
            </div>
        </header>

        <aside id="sidebar">
            <div class="nav-section">
                <h3>Lesson Modules</h3>
                <ul class="nav-list">
                    <li class="nav-item active" data-module="food-web" tabindex="0" role="button" aria-pressed="true">
                        <i class="material-icons">bubble_chart</i>
                        <span>Food Webs</span>
                    </li>
                    <li class="nav-item" data-module="energy-flow" tabindex="0" role="button" aria-pressed="false">
                        <i class="material-icons">bolt</i>
                        <span>Energy Flow</span>
                    </li>
                    <li class="nav-item" data-module="habitats" tabindex="0" role="button" aria-pressed="false">
                        <i class="material-icons">terrain</i>
                        <span>Habitat Interdependence</span>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Resources</h3>
                <ul class="nav-list">
                    <li class="nav-item" tabindex="0" role="button" aria-pressed="false">
                        <i class="material-icons">quiz</i>
                        <span>Quizzes</span>
                    </li>
                    <li class="nav-item" tabindex="0" role="button" aria-pressed="false">
                        <i class="material-icons">book</i>
                        <span>Glossary</span>
                    </li>
                    <li class="nav-item" tabindex="0" role="button" aria-pressed="false">
                        <i class="material-icons">help_outline</i>
                        <span>Help</span>
                    </li>
                </ul>
            </div>
        </aside>

        <div class="accessibility-panel" id="accessibilityPanel">
            <h3>
                <i class="material-icons">accessibility</i>
                Accessibility Options
            </h3>
            <div class="accessibility-option">
                <label for="highContrastToggle">High Contrast</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="highContrastToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="accessibility-option">
                <label for="autoReadToggle">Auto-Read Text</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="autoReadToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="accessibility-option">
                <label>Font Size</label>
                <div class="font-size-control">
                    <button id="decreaseFontSize" aria-label="Decrease Font Size">
                        <i class="material-icons">remove</i>
                    </button>
                    <span class="font-size-display" id="fontSizeDisplay">100%</span>
                    <button id="increaseFontSize" aria-label="Increase Font Size">
                        <i class="material-icons">add</i>
                    </button>
                </div>
            </div>
        </div>

        <main>
            <div class="module-container" id="food-web-module">
                <div class="module-header">
                    <h2 class="module-title">
                        <i class="material-icons">bubble_chart</i>
                        Food Webs
                    </h2>
                </div>

                <div class="module-content">
                    <div class="content-block">
                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>What is a Food Web?</h3>
                            <p>A food web shows how energy moves through an ecosystem. It's made up of many food chains connected together. Each living thing in an ecosystem is part of multiple food chains. Each food chain is one possible path that energy and nutrients can follow in an ecosystem.</p>
                            <p>In a food web, <span class="vocabulary" tabindex="0">producers<div class="tooltip">
                                <div class="tooltip-content">
                                    <strong>Producer</strong>
                                    <p>An organism that makes its own food, like plants that use sunlight.</p>
                                    <button><i class="material-icons">volume_up</i> Listen</button>
                                </div>
                            </div></span> (usually plants) make their own food using sunlight. <span class="vocabulary" tabindex="0">Consumers<div class="tooltip">
                                <div class="tooltip-content">
                                    <strong>Consumer</strong>
                                    <p>An organism that eats other organisms to get energy.</p>
                                    <button><i class="material-icons">volume_up</i> Listen</button>
                                </div>
                            </div></span> eat producers or other consumers. <span class="vocabulary" tabindex="0">Decomposers<div class="tooltip">
                                <div class="tooltip-content">
                                    <strong>Decomposer</strong>
                                    <p>An organism that breaks down dead plants and animals into simpler substances.</p>
                                    <button><i class="material-icons">volume_up</i> Listen</button>
                                </div>
                            </div></span> break down dead organisms and return nutrients to the soil.</p>
                        </div>

                        <div class="canvas-container">
                            <canvas id="foodWebCanvas" aria-label="Interactive food web builder canvas" role="application"></canvas>
                        </div>

                        <div class="organism-palette" aria-label="Drag these organisms to the canvas above">
                            <div class="organism-card" draggable="true" data-type="producer" tabindex="0" aria-label="Grass - producer">
                                <img src="https://placehold.co/100?text=Grass" alt="Grass">
                                <span>Grass</span>
                            </div>
                            <div class="organism-card" draggable="true" data-type="producer" tabindex="0" aria-label="Tree - producer">
                                <img src="https://placehold.co/100?text=Tree" alt="Tree">
                                <span>Tree</span>
                            </div>
                            <div class="organism-card" draggable="true" data-type="consumer" tabindex="0" aria-label="Rabbit - consumer">
                                <img src="https://placehold.co/100?text=Rabbit" alt="Rabbit">
                                <span>Rabbit</span>
                            </div>
                            <div class="organism-card" draggable="true" data-type="consumer" tabindex="0" aria-label="Mouse - consumer">
                                <img src="https://placehold.co/100?text=Mouse" alt="Mouse">
                                <span>Mouse</span>
                            </div>
                            <div class="organism-card" draggable="true" data-type="consumer" tabindex="0" aria-label="Fox - consumer">
                                <img src="https://placehold.co/100?text=Fox" alt="Fox">
                                <span>Fox</span>
                            </div>
                            <div class="organism-card" draggable="true" data-type="consumer" tabindex="0" aria-label="Hawk - consumer">
                                <img src="https://placehold.co/100?text=Hawk" alt="Hawk">
                                <span>Hawk</span>
                            </div>
                            <div class="organism-card" draggable="true" data-type="decomposer" tabindex="0" aria-label="Fungi - decomposer">
                                <img src="https://placehold.co/100?text=Fungi" alt="Fungi">
                                <span>Fungi</span>
                            </div>
                        </div>

                        <div class="canvas-controls">
                            <button id="drawArrow" aria-label="Draw connections between organisms">
                                <i class="material-icons">arrow_forward</i>
                                Draw Arrow
                            </button>
                            <button class="clear" id="clearCanvas" aria-label="Clear the canvas">
                                <i class="material-icons">clear</i>
                                Clear
                            </button>
                        </div>
                    </div>

                    <div class="content-block">
                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>How to Build a Food Web</h3>
                            <p>To build a food web, follow these steps:</p>
                            <ol>
                                <li>Drag organisms from the palette onto the canvas.</li>
                                <li>Click the "Draw Arrow" button to connect organisms.</li>
                                <li>Click on the first organism (what gets eaten) and then the second organism (what does the eating).</li>
                                <li>Continue adding organisms and connections to build your food web.</li>
                            </ol>
                            <p>Remember that arrows point from the organism being eaten to the organism doing the eating, showing the direction that energy flows.</p>
                        </div>

                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>Why Food Webs Matter</h3>
                            <p>Food webs help us understand how all living things in an ecosystem are connected. If one organism disappears, it affects many others. For example, if bees disappeared, many plants wouldn't get pollinated, and animals that eat those plants would have less food.</p>
                            <p>Food webs also show us how <span class="vocabulary" tabindex="0">energy<div class="tooltip">
                                <div class="tooltip-content">
                                    <strong>Energy</strong>
                                    <p>The ability to do work or cause change. In ecosystems, energy flows from the sun to producers to consumers.</p>
                                    <button><i class="material-icons">volume_up</i> Listen</button>
                                </div>
                            </div></span> moves through an ecosystem, starting with the sun and flowing through producers, consumers, and decomposers.</p>
                        </div>

                        <div class="quiz-container">
                            <h3 class="quiz-title">
                                <i class="material-icons">quiz</i>
                                Quick Check
                            </h3>
                            <div class="quiz-question">
                                <p>Which of the following is a producer in a food web?</p>
                                <div class="quiz-options" role="radiogroup" aria-labelledby="producer-question">
                                    <div class="quiz-option" data-correct="true" tabindex="0" role="radio" aria-checked="false">
                                        <p>A tree</p>
                                    </div>
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>A rabbit</p>
                                    </div>
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>A fox</p>
                                    </div>
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>A hawk</p>
                                    </div>
                                </div>
                                <div class="quiz-feedback" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-container" id="energy-flow-module" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">
                        <i class="material-icons">bolt</i>
                        Energy Flow
                    </h2>
                </div>

                <div class="module-content">
                    <div class="content-block">
                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>How Energy Moves Through Ecosystems</h3>
                            <p>Energy in ecosystems flows in one direction, from the sun to producers to consumers. This is different from nutrients, which cycle through ecosystems.</p>
                            <p>The sun provides energy for plants through <span class="vocabulary" tabindex="0">photosynthesis<div class="tooltip">
                                <div class="tooltip-content">
                                    <strong>Photosynthesis</strong>
                                    <p>The process by which plants use sunlight, water, and carbon dioxide to create oxygen and energy in the form of sugar.</p>
                                    <button><i class="material-icons">volume_up</i> Listen</button>
                                </div>
                            </div></span>. Plants use this energy to grow and store some of it in their tissues. When animals eat plants, they get this stored energy.</p>
                            <p>At each step in a food chain, about 90% of the energy is lost as heat. This means that less energy is available at each higher level of the food chain.</p>
                        </div>

                        <div class="energy-flow-container">
                            <div class="pyramid-level" data-level="4" tabindex="0" aria-label="Tertiary Consumers - top level of energy pyramid">Tertiary Consumers</div>
                            <div class="pyramid-level" data-level="3" tabindex="0" aria-label="Secondary Consumers - third level of energy pyramid">Secondary Consumers</div>
                            <div class="pyramid-level" data-level="2" tabindex="0" aria-label="Primary Consumers - second level of energy pyramid">Primary Consumers</div>
                            <div class="pyramid-level" data-level="1" tabindex="0" aria-label="Producers - base level of energy pyramid">Producers</div>
                            
                            <div class="pyramid-info" id="level-1-info" style="bottom: 90px; left: 50%; transform: translateX(-50%);">
                                <button class="close-info" aria-label="Close information"><i class="material-icons">close</i></button>
                                <h4>Producers</h4>
                                <p>Producers (plants) capture energy from the sun through photosynthesis. They form the base of the energy pyramid and contain the most energy.</p>
                            </div>
                            
                            <div class="pyramid-info" id="level-2-info" style="bottom: 160px; left: 50%; transform: translateX(-50%);">
                                <button class="close-info" aria-label="Close information"><i class="material-icons">close</i></button>
                                <h4>Primary Consumers</h4>
                                <p>Primary Consumers (herbivores) eat plants and get about 10% of the energy stored in plants. The rest is lost as heat during the transfer.</p>
                            </div>
                            
                            <div class="pyramid-info" id="level-3-info" style="bottom: 230px; left: 50%; transform: translateX(-50%);">
                                <button class="close-info" aria-label="Close information"><i class="material-icons">close</i></button>
                                <h4>Secondary Consumers</h4>
                                <p>Secondary Consumers (carnivores that eat herbivores) get about 10% of the energy stored in primary consumers. This is why there are fewer secondary consumers than primary consumers.</p>
                            </div>
                            
                            <div class="pyramid-info" id="level-4-info" style="top: 20px; left: 50%; transform: translateX(-50%);">
                                <button class="close-info" aria-label="Close information"><i class="material-icons">close</i></button>
                                <h4>Tertiary Consumers</h4>
                                <p>Tertiary Consumers (top predators) get about 10% of the energy stored in secondary consumers. Very little energy reaches this level, which is why top predators are rare in ecosystems.</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>Energy Pyramid</h3>
                            <p>An energy pyramid shows how much energy is available at each level of a food chain. The pyramid shape shows that there is less energy available at higher levels.</p>
                            <p>This is why there are usually more producers (plants) than top predators in an ecosystem. For example, it takes many plants to feed a rabbit, and many rabbits to feed a fox.</p>
                            <p>Click on each level of the pyramid to learn more about it.</p>
                        </div>

                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>Why Energy Flow Matters</h3>
                            <p>Understanding energy flow helps us see why ecosystems have the structure they do. It explains why there are fewer carnivores than herbivores, and why removing even a small part of an ecosystem can have big effects.</p>
                            <p>Energy flow also helps us understand how humans impact ecosystems. When we remove top predators or change habitats, we change how energy flows through the ecosystem.</p>
                        </div>

                        <div class="quiz-container">
                            <h3 class="quiz-title">
                                <i class="material-icons">quiz</i>
                                Quick Check
                            </h3>
                            <div class="quiz-question">
                                <p id="energy-question">About how much energy is transferred from one trophic level to the next in a food chain?</p>
                                <div class="quiz-options" role="radiogroup" aria-labelledby="energy-question">
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>90%</p>
                                    </div>
                                    <div class="quiz-option" data-correct="true" tabindex="0" role="radio" aria-checked="false">
                                        <p>10%</p>
                                    </div>
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>50%</p>
                                    </div>
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>100%</p>
                                    </div>
                                </div>
                                <div class="quiz-feedback" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-container" id="habitats-module" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">
                        <i class="material-icons">terrain</i>
                        Habitat Interdependence
                    </h2>
                </div>

                <div class="module-content">
                    <div class="content-block">
                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>What is a Habitat?</h3>
                            <p>A <span class="vocabulary" tabindex="0">habitat<div class="tooltip">
                                <div class="tooltip-content">
                                    <strong>Habitat</strong>
                                    <p>The natural home or environment of an animal, plant, or other organism.</p>
                                    <button><i class="material-icons">volume_up</i> Listen</button>
                                </div>
                            </div></span> is the natural home of a plant or animal. It provides everything the organism needs to survive: food, water, shelter, and space.</p>
                            <p>Different organisms have adapted to live in different habitats. For example, fish have gills to breathe underwater, while desert plants have special ways to store water.</p>
                            <p>Within a habitat, organisms depend on each other and on their environment. This is called <span class="vocabulary" tabindex="0">interdependence<div class="tooltip">
                                <div class="tooltip-content">
                                    <strong>Interdependence</strong>
                                    <p>The way in which living things rely on each other to survive.</p>
                                    <button><i class="material-icons">volume_up</i> Listen</button>
                                </div>
                            </div></span>.</p>
                        </div>

                        <div class="habitat-explorer" aria-label="Interactive forest habitat explorer with clickable hotspots">
                            <div class="hotspot hotspot-1" tabindex="0" aria-label="Hotspot 1: Tree Canopy">1</div>
                            <div class="hotspot hotspot-2" tabindex="0" aria-label="Hotspot 2: Forest Floor">2</div>
                            <div class="hotspot hotspot-3" tabindex="0" aria-label="Hotspot 3: Stream">3</div>
                            
                            <div class="hotspot-info" id="info-1" style="top: 30%; left: 25%;" aria-hidden="true">
                                <button class="close-info" aria-label="Close information"><i class="material-icons">close</i></button>
                                <h4>Tree Canopy</h4>
                                <img src="https://placehold.co/300x200?text=Tree+Canopy" alt="Tree Canopy">
                                <p>Trees provide homes for birds and insects. They also create shade, which changes the temperature and moisture below.</p>
                            </div>
                            
                            <div class="hotspot-info" id="info-2" style="top: 60%; left: 45%;" aria-hidden="true">
                                <button class="close-info" aria-label="Close information"><i class="material-icons">close</i></button>
                                <h4>Forest Floor</h4>
                                <img src="https://placehold.co/300x200?text=Forest+Floor" alt="Forest Floor">
                                <p>The forest floor is home to decomposers like fungi and bacteria. They break down dead leaves and return nutrients to the soil.</p>
                            </div>
                            
                            <div class="hotspot-info" id="info-3" style="top: 25%; left: 75%;" aria-hidden="true">
                                <button class="close-info" aria-label="Close information"><i class="material-icons">close</i></button>
                                <h4>Stream</h4>
                                <img src="https://placehold.co/300x200?text=Stream" alt="Stream">
                                <p>Streams provide water for plants and animals. They also connect different parts of the forest, allowing animals to move and seeds to spread.</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>Habitat Interdependence</h3>
                            <p>In a forest habitat, trees provide homes for birds and squirrels. Fallen leaves feed decomposers in the soil. Decomposers release nutrients that help trees grow.</p>
                            <p>If one part of this cycle is disrupted, it affects everything else. For example, if trees are cut down, birds lose their homes, and there are fewer leaves to feed decomposers.</p>
                            <p>Click on the numbered spots in the habitat explorer to learn more about how different parts of a forest ecosystem depend on each other.</p>
                        </div>

                        <div class="text-content">
                            <button class="text-to-speech" aria-label="Listen to text">
                                <i class="material-icons">volume_up</i>
                            </button>
                            <h3>Why Habitats Matter</h3>
                            <p>Healthy habitats support biodiversity, which means having many different kinds of plants and animals. Biodiversity helps ecosystems recover from disturbances like fires or storms.</p>
                            <p>Humans depend on healthy habitats too. Forests clean our air and water. Wetlands prevent flooding. Grasslands provide food for livestock.</p>
                            <p>When we protect habitats, we're protecting all the services they provide for us and for other living things.</p>
                        </div>

                        <div class="quiz-container">
                            <h3 class="quiz-title">
                                <i class="material-icons">quiz</i>
                                Quick Check
                            </h3>
                            <div class="quiz-question">
                                <p id="habitat-question">Which of the following is an example of interdependence in a forest ecosystem?</p>
                                <div class="quiz-options" role="radiogroup" aria-labelledby="habitat-question">
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>A rabbit eating only grass</p>
                                    </div>
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>A hawk flying alone</p>
                                    </div>
                                    <div class="quiz-option" data-correct="true" tabindex="0" role="radio" aria-checked="false">
                                        <p>Decomposers breaking down leaves and releasing nutrients for trees</p>
                                    </div>
                                    <div class="quiz-option" tabindex="0" role="radio" aria-checked="false">
                                        <p>A tree growing taller than other trees</p>
                                    </div>
                                </div>
                                <div class="quiz-feedback" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-indicator" role="tablist" aria-label="Lesson progress">
                    <div class="progress-dot active" data-page="1" tabindex="0" role="tab" aria-selected="true" aria-label="Food Webs module"></div>
                    <div class="progress-dot" data-page="2" tabindex="0" role="tab" aria-selected="false" aria-label="Energy Flow module"></div>
                    <div class="progress-dot" data-page="3" tabindex="0" role="tab" aria-selected="false" aria-label="Habitat Interdependence module"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const accessibilityPanel = document.getElementById('accessibilityPanel');
        const highContrastToggle = document.getElementById('highContrastToggle');
        const autoReadToggle = document.getElementById('autoReadToggle');
        const fontSizeDisplay = document.getElementById('fontSizeDisplay');
        let currentFontSize = 100;
        let autoReadEnabled = false;
        let currentModule = 'food-web';

        // Navigation functionality
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                navigateToModule(this.getAttribute('data-module'));
            });
            
            // Keyboard navigation
            item.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    navigateToModule(this.getAttribute('data-module'));
                }
            });
        });

        function navigateToModule(moduleId) {
            if (!moduleId) return;
            
            // Update active state
            document.querySelectorAll('.nav-item').forEach(navItem => {
                const isActive = navItem.getAttribute('data-module') === moduleId;
                navItem.classList.toggle('active', isActive);
                navItem.setAttribute('aria-pressed', isActive);
            });

            // Show corresponding module
            document.querySelectorAll('.module-container').forEach(module => {
                module.style.display = 'none';
            });
            document.getElementById(`${moduleId}-module`).style.display = 'block';

            // Update progress dots
            updateProgressDots(moduleId);
            
            // Store current module
            currentModule = moduleId;
            
            // Hide sidebar on mobile after navigation
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('active');
            }
            
            // Auto-read module title if enabled
            if (autoReadEnabled) {
                const moduleTitle = document.querySelector(`#${moduleId}-module .module-title`).textContent;
                speakText(moduleTitle);
            }
        }

        // Update progress dots based on current module
        function updateProgressDots(moduleId) {
            const moduleIndex = ['food-web', 'energy-flow', 'habitats'].indexOf(moduleId);
            document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                const isActive = index === moduleIndex;
                dot.classList.toggle('active', isActive);
                dot.setAttribute('aria-selected', isActive);
            });
        }

        // Progress dot navigation
        document.querySelectorAll('.progress-dot').forEach((dot, index) => {
            dot.addEventListener('click', function() {
                navigateToModuleByIndex(index);
            });
            
            // Keyboard navigation
            dot.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    navigateToModuleByIndex(index);
                }
                
                // Left/right arrow navigation between dots
                if (e.key === 'ArrowLeft' && index > 0) {
                    document.querySelectorAll('.progress-dot')[index - 1].focus();
                } else if (e.key === 'ArrowRight' && index < 2) {
                    document.querySelectorAll('.progress-dot')[index + 1].focus();
                }
            });
        });

        function navigateToModuleByIndex(index) {
            const modules = ['food-web', 'energy-flow', 'habitats'];
            navigateToModule(modules[index]);
        }

        // Text-to-speech functionality
        function speakText(text) {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9; // Slightly slower for better comprehension
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }

        document.querySelectorAll('.text-to-speech').forEach(button => {
            button.addEventListener('click', function() {
                const textContainer = this.parentElement;
                const headingText = textContainer.querySelector('h3')?.textContent || '';
                const paragraphText = Array.from(textContainer.querySelectorAll('p, li'))
                    .map(el => el.textContent)
                    .join('. ');
                
                speakText(headingText + '. ' + paragraphText);
            });
        });

        // Vocabulary tooltip text-to-speech
        document.querySelectorAll('.tooltip-content button').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                const definition = this.parentElement.querySelector('p').textContent;
                const term = this.parentElement.querySelector('strong').textContent;
                speakText(term + '. ' + definition);
            });
        });

        // Quiz functionality
        document.querySelectorAll('.quiz-option').forEach(option => {
            option.addEventListener('click', function() {
                handleQuizOptionSelection(this);
            });
            
            // Keyboard selection
            option.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleQuizOptionSelection(this);
                }
            });
        });

        function handleQuizOptionSelection(option) {
            const quizOptions = option.parentElement.querySelectorAll('.quiz-option');
            
            // Update ARIA states
            quizOptions.forEach(opt => {
                opt.classList.remove('selected');
                opt.setAttribute('aria-checked', 'false');
            });
            
            option.classList.add('selected');
            option.setAttribute('aria-checked', 'true');

            const feedbackElement = option.closest('.quiz-question').querySelector('.quiz-feedback');
            const isCorrect = option.hasAttribute('data-correct');

            feedbackElement.textContent = isCorrect 
                ? 'Correct! Great job!' 
                : 'Not quite. Try again!';
            feedbackElement.className = 'quiz-feedback ' + (isCorrect ? 'correct' : 'incorrect');
            feedbackElement.style.display = 'block';
            
            // Read feedback if auto-read is enabled
            if (autoReadEnabled) {
                speakText(feedbackElement.textContent);
            }
        }

        // Habitat explorer hotspots
        document.querySelectorAll('.hotspot').forEach(hotspot => {
            hotspot.addEventListener('click', function() {
                toggleHotspotInfo(this);
            });
            
            // Keyboard activation
            hotspot.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleHotspotInfo(this);
                }
            });
        });

        function toggleHotspotInfo(hotspot) {
            const hotspotNumber = hotspot.classList[1].split('-')[1];
            const infoBox = document.getElementById(`info-${hotspotNumber}`);
            
            // Hide all other info boxes
            document.querySelectorAll('.hotspot-info').forEach(box => {
                box.style.display = 'none';
                box.setAttribute('aria-hidden', 'true');
            });
            
            // Show this info box
            infoBox.style.display = 'block';
            infoBox.setAttribute('aria-hidden', 'false');
            
            // Auto-read if enabled
            if (autoReadEnabled) {
                const title = infoBox.querySelector('h4').textContent;
                const description = infoBox.querySelector('p').textContent;
                speakText(title + '. ' + description);
            }
        }

        // Close hotspot info boxes
        document.querySelectorAll('.close-info').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                const infoBox = this.parentElement;
                infoBox.style.display = 'none';
                infoBox.setAttribute('aria-hidden', 'true');
            });
            
            // Keyboard closing
            button.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ' || e.key === 'Escape') {
                    e.preventDefault();
                    const infoBox = this.parentElement;
                    infoBox.style.display = 'none';
                    infoBox.setAttribute('aria-hidden', 'true');
                }
            });
        });

        // Energy pyramid interaction
        document.querySelectorAll('.pyramid-level').forEach(level => {
            level.addEventListener('click', function() {
                showPyramidLevelInfo(this);
            });
            
            // Keyboard activation
            level.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    showPyramidLevelInfo(this);
                }
            });
        });

        function showPyramidLevelInfo(level) {
            const levelNumber = level.getAttribute('data-level');
            const infoBox = document.getElementById(`level-${levelNumber}-info`);
            
            // Hide all other info boxes
            document.querySelectorAll('.pyramid-info').forEach(box => {
                box.style.display = 'none';
            });
            
            // Show this info box
            infoBox.style.display = 'block';
            
            // Auto-read if enabled
            if (autoReadEnabled) {
                const title = infoBox.querySelector('h4').textContent;
                const description = infoBox.querySelector('p').textContent;
                speakText(title + '. ' + description);
            }
        }

        // Close pyramid level info boxes
        document.querySelectorAll('.pyramid-info .close-info').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                this.parentElement.style.display = 'none';
            });
        });

        // Food web canvas functionality
        const canvas = document.getElementById('foodWebCanvas');
        const ctx = canvas.getContext('2d');
        let organisms = [];
        let connections = [];
        let drawingArrow = false;
        let selectedOrganism = null;
        let draggingOrganism = null;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        // Set canvas size
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            redrawCanvas();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Drag and drop functionality
        document.querySelectorAll('.organism-card').forEach(card => {
            card.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('text/plain', JSON.stringify({
                    type: this.getAttribute('data-type'),
                    name: this.querySelector('span').textContent,
                    imgSrc: this.querySelector('img').src
                }));
            });
            
            // Keyboard drag and drop alternative
            card.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    
                    const data = {
                        type: this.getAttribute('data-type'),
                        name: this.querySelector('span').textContent,
                        imgSrc: this.querySelector('img').src
                    };
                    
                    // Add organism to center of canvas
                    organisms.push({
                        type: data.type,
                        name: data.name,
                        imgSrc: data.imgSrc,
                        x: canvas.width / 2,
                        y: canvas.height / 2,
                        width: 60,
                        height: 60
                    });
                    
                    redrawCanvas();
                    
                    // Announce to screen readers
                    const announcement = `Added ${data.name} to the canvas`;
                    const liveRegion = document.createElement('div');
                    liveRegion.setAttribute('aria-live', 'assertive');
                    liveRegion.setAttribute('class', 'sr-only');
                    document.body.appendChild(liveRegion);
                    setTimeout(() => {
                        liveRegion.textContent = announcement;
                        setTimeout(() => document.body.removeChild(liveRegion), 1000);
                    }, 100);
                }
            });
        });

        canvas.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        canvas.addEventListener('drop', function(e) {
            e.preventDefault();
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            organisms.push({
                type: data.type,
                name: data.name,
                imgSrc: data.imgSrc,
                x: x,
                y: y,
                width: 60,
                height: 60
            });
            
            redrawCanvas();
        });

        // Canvas mouse down for organism dragging
        canvas.addEventListener('mousedown', function(e) {
            if (drawingArrow) {
                handleCanvasClick(e);
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Check if clicked on an organism
            for (let i = organisms.length - 1; i >= 0; i--) {
                const org = organisms[i];
                if (
                    x >= org.x - org.width/2 && 
                    x <= org.x + org.width/2 && 
                    y >= org.y - org.height/2 && 
                    y <= org.y + org.height/2
                ) {
                    draggingOrganism = org;
                    dragOffsetX = x - org.x;
                    dragOffsetY = y - org.y;
                    canvas.style.cursor = 'grabbing';
                    break;
                }
            }
        });

        // Canvas mouse move for organism dragging
        canvas.addEventListener('mousemove', function(e) {
            if (draggingOrganism) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                draggingOrganism.x = x - dragOffsetX;
                draggingOrganism.y = y - dragOffsetY;
                
                redrawCanvas();
            }
        });

        // Canvas mouse up for organism dragging
        canvas.addEventListener('mouseup', function() {
            draggingOrganism = null;
            canvas.style.cursor = drawingArrow ? 'crosshair' : 'default';
        });

        // Canvas mouse leave for organism dragging
        canvas.addEventListener('mouseleave', function() {
            draggingOrganism = null;
            canvas.style.cursor = drawingArrow ? 'crosshair' : 'default';
        });

        // Draw arrow button
        document.getElementById('drawArrow').addEventListener('click', function() {
            drawingArrow = !drawingArrow;
            selectedOrganism = null;
            canvas.style.cursor = drawingArrow ? 'crosshair' : 'default';
            this.classList.toggle('selected', drawingArrow);
            
            // Announce mode change to screen readers
            const announcement = drawingArrow ? 'Arrow drawing mode activated' : 'Arrow drawing mode deactivated';
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('aria-live', 'assertive');
            liveRegion.setAttribute('class', 'sr-only');
            document.body.appendChild(liveRegion);
            setTimeout(() => {
                liveRegion.textContent = announcement;
                setTimeout(() => document.body.removeChild(liveRegion), 1000);
            }, 100);
        });

        // Clear canvas button
        document.getElementById('clearCanvas').addEventListener('click', function() {
            organisms = [];
            connections = [];
            redrawCanvas();
            
            // Announce to screen readers
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('aria-live', 'assertive');
            liveRegion.setAttribute('class', 'sr-only');
            document.body.appendChild(liveRegion);
            setTimeout(() => {
                liveRegion.textContent = 'Canvas cleared';
                setTimeout(() => document.body.removeChild(liveRegion), 1000);
            }, 100);
        });

        // Canvas click handler
        function handleCanvasClick(e) {
            if (!drawingArrow) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Find if clicked on an organism
            const clickedOrganism = organisms.find(org => 
                x >= org.x - org.width/2 && 
                x <= org.x + org.width/2 && 
                y >= org.y - org.height/2 && 
                y <= org.y + org.height/2
            );
            
            if (clickedOrganism) {
                if (!selectedOrganism) {
                    // First click - select source organism
                    selectedOrganism = clickedOrganism;
                    redrawCanvas(); // Redraw to show selection highlight
                } else if (selectedOrganism !== clickedOrganism) {
                    // Second click - create connection
                    connections.push({
                        from: selectedOrganism,
                        to: clickedOrganism
                    });
                    
                    // Announce connection to screen readers
                    const announcement = `Connected ${selectedOrganism.name} to ${clickedOrganism.name}`;
                    const liveRegion = document.createElement('div');
                    liveRegion.setAttribute('aria-live', 'assertive');
                    liveRegion.setAttribute('class', 'sr-only');
                    document.body.appendChild(liveRegion);
                    setTimeout(() => {
                        liveRegion.textContent = announcement;
                        setTimeout(() => document.body.removeChild(liveRegion), 1000);
                    }, 100);
                    
                    // Reset selection
                    selectedOrganism = null;
                    
                    redrawCanvas();
                }
            }
        }

        canvas.addEventListener('click', handleCanvasClick);

        // Redraw canvas
        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw connections
            connections.forEach(conn => {
                drawArrow(conn.from.x, conn.from.y, conn.to.x, conn.to.y);
            });
            
            // Draw organisms
            organisms.forEach(org => {
                // Draw image
                const img = new Image();
                img.src = org.imgSrc;
                img.onload = function() {
                    ctx.drawImage(img, org.x - org.width/2, org.y - org.height/2, org.width, org.height);
                    
                    // Draw label
                    ctx.fillStyle = '#333';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(org.name, org.x, org.y + org.height/2 + 15);
                    
                    // Draw organism type indicator
                    let typeColor;
                    switch(org.type) {
                        case 'producer': typeColor = '#4CAF50'; break;
                        case 'consumer': typeColor = '#2196F3'; break;
                        case 'decomposer': typeColor = '#FF9800'; break;
                        default: typeColor = '#999';
                    }
                    
                    ctx.fillStyle = typeColor;
                    ctx.beginPath();
                    ctx.arc(org.x + org.width/2 - 5, org.y - org.height/2 + 5, 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Highlight selected organism
                    if (selectedOrganism === org) {
                        ctx.strokeStyle = '#4CAF50';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(org.x - org.width/2 - 5, org.y - org.height/2 - 5, org.width + 10, org.height + 10);
                    }
                };
                
                // Draw placeholder while image loads
                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(org.x - org.width/2, org.y - org.height/2, org.width, org.height);
                
                // Highlight selected organism
                if (selectedOrganism === org) {
                    ctx.strokeStyle = '#4CAF50';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(org.x - org.width/2 - 5, org.y - org.height/2 - 5, org.width + 10, org.height + 10);
                }
            });
        }

        // Draw arrow between points
        function drawArrow(fromX, fromY, toX, toY) {
            const headLength = 10;
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);
            
            // Calculate points to avoid drawing over organisms
            const fromRadius = 35;
            const toRadius = 35;
            const fromAngle = angle;
            const toAngle = angle + Math.PI;
            
            const adjustedFromX = fromX + fromRadius * Math.cos(fromAngle);
            const adjustedFromY = fromY + fromRadius * Math.sin(fromAngle);
            const adjustedToX = toX + toRadius * Math.cos(toAngle);
            const adjustedToY = toY + toRadius * Math.sin(toAngle);
            
            // Draw arrow line with animation effect
            const gradient = ctx.createLinearGradient(
                adjustedFromX, adjustedFromY, 
                adjustedToX, adjustedToY
            );
            
            gradient.addColorStop(0, '#555');
            gradient.addColorStop(1, '#333');
            
            ctx.beginPath();
            ctx.moveTo(adjustedFromX, adjustedFromY);
            ctx.lineTo(adjustedToX, adjustedToY);
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Arrow head
            ctx.beginPath();
            ctx.moveTo(adjustedToX, adjustedToY);
            ctx.lineTo(
                adjustedToX - headLength * Math.cos(angle - Math.PI/6),
                adjustedToY - headLength * Math.sin(angle - Math.PI/6)
            );
            ctx.lineTo(
                adjustedToX - headLength * Math.cos(angle + Math.PI/6),
                adjustedToY - headLength * Math.sin(angle + Math.PI/6)
            );
            ctx.closePath();
            ctx.fillStyle = '#333';
            ctx.fill();
        }

        // Toggle accessibility panel
        document.getElementById('toggleAccessibility').addEventListener('click', function() {
            accessibilityPanel.style.display = accessibilityPanel.style.display === 'block' ? 'none' : 'block';
        });

        // Toggle sidebar on mobile
        document.getElementById('toggleMenu').addEventListener('click', function() {
            sidebar.classList.toggle('active');
        });

        // High contrast mode toggle
        highContrastToggle.addEventListener('change', function() {
            document.body.classList.toggle('high-contrast', this.checked);
            
            // Announce change to screen readers
            const announcement = this.checked ? 'High contrast mode enabled' : 'High contrast mode disabled';
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('aria-live', 'assertive');
            liveRegion.setAttribute('class', 'sr-only');
            document.body.appendChild(liveRegion);
            setTimeout(() => {
                liveRegion.textContent = announcement;
                setTimeout(() => document.body.removeChild(liveRegion), 1000);
            }, 100);
        });

        // Auto-read toggle
        autoReadToggle.addEventListener('change', function() {
            autoReadEnabled = this.checked;
            
            // Announce change to screen readers
            const announcement = this.checked ? 'Automatic reading enabled' : 'Automatic reading disabled';
            speakText(announcement);
        });

        // Font size controls
        document.getElementById('increaseFontSize').addEventListener('click', function() {
            if (currentFontSize < 150) {
                currentFontSize += 10;
                updateFontSize();
            }
        });

        document.getElementById('decreaseFontSize').addEventListener('click', function() {
            if (currentFontSize > 90) {
                currentFontSize -= 10;
                updateFontSize();
            }
        });

        function updateFontSize() {
            document.body.style.fontSize = `${currentFontSize / 100}rem`;
            fontSizeDisplay.textContent = `${currentFontSize}%`;
            
            // Add or remove large-font class based on size
            document.body.classList.toggle('large-font', currentFontSize >= 120);
            
            // Announce change to screen readers
            const announcement = `Font size changed to ${currentFontSize} percent`;
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('aria-live', 'polite');
            liveRegion.setAttribute('class', 'sr-only');
            document.body.appendChild(liveRegion);
            setTimeout(() => {
                liveRegion.textContent = announcement;
                setTimeout(() => document.body.removeChild(liveRegion), 1000);
            }, 100);
        }

        // Keyboard support for accessibility panel
        document.addEventListener('keydown', function(e) {
            // Close accessibility panel with Escape key
            if (e.key === 'Escape' && accessibilityPanel.style.display === 'block') {
                accessibilityPanel.style.display = 'none';
            }
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Show food web module by default
            document.getElementById('food-web-module').style.display = 'block';
            
            // Set active nav item
            document.querySelector('.nav-item[data-module="food-web"]').classList.add('active');
            document.querySelector('.nav-item[data-module="food-web"]').setAttribute('aria-pressed', 'true');
            
            // Set active progress dot
            document.querySelector('.progress-dot[data-page="1"]').classList.add('active');
            document.querySelector('.progress-dot[data-page="1"]').setAttribute('aria-selected', 'true');
            
            // Preload images for better performance
            const imageSources = [
                'https://placehold.co/100?text=Grass',
                'https://placehold.co/100?text=Tree',
                'https://placehold.co/100?text=Rabbit',
                'https://placehold.co/100?text=Mouse',
                'https://placehold.co/100?text=Fox',
                'https://placehold.co/100?text=Hawk',
                'https://placehold.co/100?text=Fungi',
                'https://placehold.co/300x200?text=Tree+Canopy',
                'https://placehold.co/300x200?text=Forest+Floor',
                'https://placehold.co/300x200?text=Stream'
            ];
            
            imageSources.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        });
    </script>
</body>
</html>