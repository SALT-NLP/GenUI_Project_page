<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Change Research Notes</title>
    <style>
        :root {
            --primary-color: #3a9679;
            --secondary-color: #2c7d98;
            --accent-color: #43b692;
            --light-color: #f4f9f7;
            --dark-color: #2d3e4e;
            --gray-color: #e0e5e9;
            --danger-color: #e74c3c;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: var(--light-color);
            height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
        }

        header {
            background-color: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 600;
        }

        main {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: 100%;
            overflow: hidden;
        }

        .sidebar {
            background-color: white;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            overflow-y: auto;
        }

        .sidebar h2 {
            color: var(--secondary-color);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--gray-color);
        }

        .category-list, .tag-list {
            margin-bottom: 2rem;
        }

        .category-item, .tag-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .category-item:hover, .tag-item:hover {
            background-color: var(--gray-color);
        }

        .category-item.active, .tag-item.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tag-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: var(--accent-color);
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .tag-badge:hover {
            background-color: var(--secondary-color);
        }

        .count {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .content {
            padding: 2rem;
            overflow-y: auto;
        }

        .search-container {
            position: relative;
            width: 300px;
        }

        .search-bar {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--gray-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(58, 150, 121, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--dark-color);
            opacity: 0.5;
        }

        .note-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .note-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .note-card h3 {
            color: var(--secondary-color);
            margin-bottom: 0.75rem;
        }

        .note-content {
            color: var(--dark-color);
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .note-tags {
            display: flex;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .note-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: var(--transition);
        }

        .note-card:hover .note-actions {
            opacity: 1;
        }

        .action-btn {
            background-color: transparent;
            border: none;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .action-btn:hover {
            background-color: var(--gray-color);
        }

        .action-btn svg {
            width: 16px;
            height: 16px;
            fill: var(--dark-color);
        }

        .delete-btn:hover svg {
            fill: var(--danger-color);
        }

        .note-form {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-color);
        }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(58, 150, 121, 0.2);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .tag-input-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .tag-input {
            flex: 1;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: var(--gray-color);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: #d0d5d9;
        }

        .btn-small {
            padding: 0.4rem 0.75rem;
            font-size: 0.85rem;
        }

        .filter-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .filter-group {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .sort-select {
            padding: 0.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-color);
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem;
            border-radius: var(--border-radius);
            background-color: var(--light-color);
            border: 1px solid var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .view-btn.active, .view-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            color: var(--secondary-color);
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #aaa;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            fill: #ddd;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: #888;
        }

        @media (max-width: 768px) {
            main {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                padding: 1rem;
            }

            .search-container {
                width: 100%;
            }

            .sidebar {
                grid-row: 2;
                padding: 1rem;
                max-height: 300px;
            }

            .content {
                grid-row: 3;
                padding: 1rem;
            }

            .note-grid {
                grid-template-columns: 1fr;
            }

            .filter-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Climate Change Research Notes</h1>
        <div class="search-container">
            <span class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </span>
            <input type="text" class="search-bar" id="search-input" placeholder="Search notes...">
        </div>
    </header>
    <main>
        <aside class="sidebar">
            <div class="category-list">
                <h2>Categories</h2>
                <div class="category-item active" data-category="all">
                    <span>All Categories</span>
                    <span class="count" id="all-count">0</span>
                </div>
                <div class="category-item" data-category="scientific-research">
                    <span>Scientific Research</span>
                    <span class="count" id="scientific-research-count">0</span>
                </div>
                <div class="category-item" data-category="policy">
                    <span>Policy & Regulation</span>
                    <span class="count" id="policy-count">0</span>
                </div>
                <div class="category-item" data-category="impacts">
                    <span>Environmental Impacts</span>
                    <span class="count" id="impacts-count">0</span>
                </div>
                <div class="category-item" data-category="solutions">
                    <span>Solutions & Innovations</span>
                    <span class="count" id="solutions-count">0</span>
                </div>
                <div class="category-item" data-category="other">
                    <span>Other</span>
                    <span class="count" id="other-count">0</span>
                </div>
            </div>
            <div class="tag-list">
                <h2>Popular Tags</h2>
                <div id="tags-container">
                    <!-- Tags will be dynamically inserted here -->
                </div>
            </div>
        </aside>
        <section class="content">
            <div class="note-form">
                <h2>Add New Research Note</h2>
                <form id="add-note-form">
                    <div class="form-group">
                        <label for="note-title">Title</label>
                        <input type="text" id="note-title" required>
                    </div>
                    <div class="form-group">
                        <label for="note-category">Category</label>
                        <select id="note-category" required>
                            <option value="">Select a category</option>
                            <option value="scientific-research">Scientific Research</option>
                            <option value="policy">Policy & Regulation</option>
                            <option value="impacts">Environmental Impacts</option>
                            <option value="solutions">Solutions & Innovations</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="note-content">Content</label>
                        <textarea id="note-content" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="note-tags">Tags (comma separated)</label>
                        <div class="tag-input-container">
                            <input type="text" id="note-tags" class="tag-input" placeholder="e.g., ocean, carbon, policy">
                        </div>
                    </div>
                    <button type="submit" class="btn">Add Note</button>
                </form>
            </div>

            <div class="filter-controls">
                <div class="filter-group">
                    <label for="sort-select">Sort by:</label>
                    <select id="sort-select" class="sort-select">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="title">Title (A-Z)</option>
                    </select>
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                    </button>
                    <button class="view-btn" data-view="list">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="note-grid" id="notes-container">
                <!-- Notes will be dynamically inserted here -->
                <div class="empty-state" id="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <h3>No Research Notes Yet</h3>
                    <p>Start adding your climate change research notes using the form above.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Edit Note Modal -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Note</h2>
                <button class="close-btn" id="close-edit-modal">&times;</button>
            </div>
            <form id="edit-note-form">
                <input type="hidden" id="edit-note-id">
                <div class="form-group">
                    <label for="edit-note-title">Title</label>
                    <input type="text" id="edit-note-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-note-category">Category</label>
                    <select id="edit-note-category" required>
                        <option value="">Select a category</option>
                        <option value="scientific-research">Scientific Research</option>
                        <option value="policy">Policy & Regulation</option>
                        <option value="impacts">Environmental Impacts</option>
                        <option value="solutions">Solutions & Innovations</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-note-content">Content</label>
                    <textarea id="edit-note-content" required></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-note-tags">Tags (comma separated)</label>
                    <input type="text" id="edit-note-tags">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel-edit">Cancel</button>
                    <button type="submit" class="btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Deletion</h2>
                <button class="close-btn" id="close-delete-modal">&times;</button>
            </div>
            <p>Are you sure you want to delete this note? This action cannot be undone.</p>
            <input type="hidden" id="delete-note-id">
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-delete">Cancel</button>
                <button class="btn" style="background-color: var(--danger-color);" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const addNoteForm = document.getElementById('add-note-form');
        const notesContainer = document.getElementById('notes-container');
        const tagsContainer = document.getElementById('tags-container');
        const searchInput = document.getElementById('search-input');
        const sortSelect = document.getElementById('sort-select');
        const categoryItems = document.querySelectorAll('.category-item');
        const viewButtons = document.querySelectorAll('.view-btn');
        const emptyState = document.getElementById('empty-state');
        
        // Edit Modal Elements
        const editModal = document.getElementById('edit-modal');
        const editNoteForm = document.getElementById('edit-note-form');
        const editNoteId = document.getElementById('edit-note-id');
        const editNoteTitle = document.getElementById('edit-note-title');
        const editNoteCategory = document.getElementById('edit-note-category');
        const editNoteContent = document.getElementById('edit-note-content');
        const editNoteTags = document.getElementById('edit-note-tags');
        const closeEditModal = document.getElementById('close-edit-modal');
        const cancelEdit = document.getElementById('cancel-edit');
        
        // Delete Modal Elements
        const deleteModal = document.getElementById('delete-modal');
        const deleteNoteId = document.getElementById('delete-note-id');
        const closeDeleteModal = document.getElementById('close-delete-modal');
        const cancelDelete = document.getElementById('cancel-delete');
        const confirmDelete = document.getElementById('confirm-delete');

        // State
        let notes = JSON.parse(localStorage.getItem('climateNotes')) || [];
        let activeCategory = 'all';
        let activeTags = [];
        let viewMode = 'grid';

        // Sample Data for Demonstration
        const sampleNotes = [
            {
                id: 1,
                title: 'IPCC Sixth Assessment Report',
                content: 'The IPCC's Sixth Assessment Report indicates that climate change is widespread, rapid, and intensifying. Many changes due to past and future greenhouse gas emissions are irreversible for centuries to millennia, especially changes in the ocean, ice sheets, and global sea level.',
                category: 'scientific-research',
                tags: ['ipcc', 'assessment', 'global warming'],
                date: new Date('2023-06-15').toISOString()
            },
            {
                id: 2,
                title: 'Paris Agreement Implementation',
                content: 'The Paris Agreement aims to limit global warming to well below 2°C, preferably to 1.5°C, compared to pre-industrial levels. Implementation requires economic and social transformation, based on the best available science.',
                category: 'policy',
                tags: ['paris agreement', 'policy', 'international'],
                date: new Date('2023-05-20').toISOString()
            },
            {
                id: 3,
                title: 'Ocean Acidification Effects on Coral Reefs',
                content: 'Ocean acidification, caused by increased CO2 absorption, is reducing carbonate ion concentration in seawater, making it difficult for marine organisms like corals to build and maintain their skeletons and shells.',
                category: 'impacts',
                tags: ['ocean', 'coral reefs', 'acidification'],
                date: new Date('2023-07-05').toISOString()
            }
        ];

        // Initialize app
        function init() {
            // Load sample data if no notes exist
            if (notes.length === 0) {
                notes = sampleNotes;
                saveNotes();
            }
            
            renderNotes();
            updateCategoryCounts();
            renderTags();
            
            // Event Listeners
            addNoteForm.addEventListener('submit', handleAddNote);
            searchInput.addEventListener('input', handleSearch);
            sortSelect.addEventListener('change', handleSort);
            categoryItems.forEach(item => {
                item.addEventListener('click', () => handleCategoryFilter(item.dataset.category));
            });
            viewButtons.forEach(btn => {
                btn.addEventListener('click', () => handleViewChange(btn.dataset.view));
            });
            
            // Modal Event Listeners
            editNoteForm.addEventListener('submit', handleEditNote);
            closeEditModal.addEventListener('click', () => toggleModal(editModal, false));
            cancelEdit.addEventListener('click', () => toggleModal(editModal, false));
            
            closeDeleteModal.addEventListener('click', () => toggleModal(deleteModal, false));
            cancelDelete.addEventListener('click', () => toggleModal(deleteModal, false));
            confirmDelete.addEventListener('click', handleDeleteNote);
        }

        // Render notes to the DOM
        function renderNotes() {
            const filteredNotes = filterNotes();
            
            if (filteredNotes.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
            
            // Clear notes container except for empty state
            const notesElements = notesContainer.querySelectorAll('.note-card');
            notesElements.forEach(el => el.remove());
            
            // Sort notes
            const sortedNotes = sortNotes(filteredNotes);
            
            // Render each note
            sortedNotes.forEach(note => {
                const noteCard = document.createElement('div');
                noteCard.className = 'note-card';
                noteCard.dataset.id = note.id;
                
                const formattedDate = new Date(note.date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                noteCard.innerHTML = `
                    <div class="note-actions">
                        <button class="action-btn edit-btn" data-id="${note.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                            </svg>
                        </button>
                        <button class="action-btn delete-btn" data-id="${note.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                        </button>
                    </div>
                    <h3>${note.title}</h3>
                    <div class="note-content">${note.content}</div>
                    <div class="note-meta">
                        <small>${getCategoryLabel(note.category)} • ${formattedDate}</small>
                    </div>
                    <div class="note-tags">
                        ${note.tags.map(tag => `<span class="tag-badge" data-tag="${tag}">${tag}</span>`).join('')}
                    </div>
                `;
                
                notesContainer.appendChild(noteCard);
            });
            
            // Add event listeners to the new elements
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => openEditModal(btn.dataset.id));
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => openDeleteModal(btn.dataset.id));
            });
            
            document.querySelectorAll('.note-tags .tag-badge').forEach(badge => {
                badge.addEventListener('click', () => handleTagFilter(badge.dataset.tag));
            });
        }

        // Filter notes based on active category, tags, and search
        function filterNotes() {
            return notes.filter(note => {
                // Category filter
                if (activeCategory !== 'all' && note.category !== activeCategory) {
                    return false;
                }
                
                // Tags filter
                if (activeTags.length > 0) {
                    const hasAllTags = activeTags.every(tag => 
                        note.tags.some(noteTag => noteTag.toLowerCase().includes(tag.toLowerCase()))
                    );
                    if (!hasAllTags) return false;
                }
                
                // Search filter
                const searchTerm = searchInput.value.toLowerCase();
                if (searchTerm) {
                    return (
                        note.title.toLowerCase().includes(searchTerm) ||
                        note.content.toLowerCase().includes(searchTerm) ||
                        note.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                    );
                }
                
                return true;
            });
        }

        // Sort notes based on the selected sort option
        function sortNotes(notesToSort) {
            const sortBy = sortSelect.value;
            
            return [...notesToSort].sort((a, b) => {
                if (sortBy === 'newest') {
                    return new Date(b.date) - new Date(a.date);
                } else if (sortBy === 'oldest') {
                    return new Date(a.date) - new Date(b.date);
                } else if (sortBy === 'title') {
                    return a.title.localeCompare(b.title);
                }
                return 0;
            });
        }

        // Update category counts
        function updateCategoryCounts() {
            // All categories count
            document.getElementById('all-count').textContent = notes.length;
            
            // Individual category counts
            const categories = ['scientific-research', 'policy', 'impacts', 'solutions', 'other'];
            categories.forEach(category => {
                const count = notes.filter(note => note.category === category).length;
                document.getElementById(`${category}-count`).textContent = count;
            });
        }

        // Render tags in the sidebar
        function renderTags() {
            // Get all tags and count occurrences
            const tagCounts = {};
            notes.forEach(note => {
                note.tags.forEach(tag => {
                    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                });
            });
            
            // Sort tags by count (descending)
            const sortedTags = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15); // Show top 15 tags
            
            // Clear tags container
            tagsContainer.innerHTML = '';
            
            // Render tags
            sortedTags.forEach(([tag, count]) => {
                const tagElement = document.createElement('div');
                tagElement.className = `tag-item ${activeTags.includes(tag) ? 'active' : ''}`;
                tagElement.dataset.tag = tag;
                tagElement.innerHTML = `
                    <span>${tag}</span>
                    <span class="count">${count}</span>
                `;
                tagElement.addEventListener('click', () => handleTagFilter(tag));
                tagsContainer.appendChild(tagElement);
            });
        }

        // Handle adding a new note
        function handleAddNote(e) {
            e.preventDefault();
            
            const titleInput = document.getElementById('note-title');
            const categoryInput = document.getElementById('note-category');
            const contentInput = document.getElementById('note-content');
            const tagsInput = document.getElementById('note-tags');
            
            // Validate inputs
            if (!titleInput.value || !categoryInput.value || !contentInput.value) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Create new note object
            const newNote = {
                id: Date.now(),
                title: titleInput.value,
                category: categoryInput.value,
                content: contentInput.value,
                tags: tagsInput.value.split(',')
                    .map(tag => tag.trim())
                    .filter(tag => tag !== ''),
                date: new Date().toISOString()
            };
            
            // Add to notes array
            notes.unshift(newNote);
            saveNotes();
            
            // Reset form
            addNoteForm.reset();
            
            // Update UI
            renderNotes();
            updateCategoryCounts();
            renderTags();
        }

        // Handle editing a note
        function handleEditNote(e) {
            e.preventDefault();
            
            const id = parseInt(editNoteId.value);
            const noteIndex = notes.findIndex(note => note.id === id);
            
            if (noteIndex === -1) return;
            
            // Update note
            notes[noteIndex] = {
                ...notes[noteIndex],
                title: editNoteTitle.value,
                category: editNoteCategory.value,
                content: editNoteContent.value,
                tags: editNoteTags.value.split(',')
                    .map(tag => tag.trim())
                    .filter(tag => tag !== '')
            };
            
            saveNotes();
            toggleModal(editModal, false);
            
            // Update UI
            renderNotes();
            updateCategoryCounts();
            renderTags();
        }

        // Handle deleting a note
        function handleDeleteNote() {
            const id = parseInt(deleteNoteId.value);
            notes = notes.filter(note => note.id !== id);
            
            saveNotes();
            toggleModal(deleteModal, false);
            
            // Update UI
            renderNotes();
            updateCategoryCounts();
            renderTags();
        }

        // Handle search
        function handleSearch() {
            renderNotes();
        }

        // Handle sort
        function handleSort() {
            renderNotes();
        }

        // Handle category filter
        function handleCategoryFilter(category) {
            activeCategory = category;
            
            // Update active class
            categoryItems.forEach(item => {
                item.classList.toggle('active', item.dataset.category === category);
            });
            
            renderNotes();
        }

        // Handle tag filter
        function handleTagFilter(tag) {
            const tagIndex = activeTags.indexOf(tag);
            
            if (tagIndex === -1) {
                // Add tag to filter
                activeTags.push(tag);
            } else {
                // Remove tag from filter
                activeTags.splice(tagIndex, 1);
            }
            
            // Update tag UI
            document.querySelectorAll(`.tag-item[data-tag="${tag}"]`).forEach(item => {
                item.classList.toggle('active', activeTags.includes(tag));
            });
            
            renderNotes();
        }

        // Handle view change
        function handleViewChange(view) {
            viewMode = view;
            
            // Update active class
            viewButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            
            // Update note grid layout
            if (view === 'grid') {
                notesContainer.classList.remove('list-view');
                notesContainer.classList.add('note-grid');
            } else {
                notesContainer.classList.remove('note-grid');
                notesContainer.classList.add('list-view');
            }
        }

        // Open edit modal
        function openEditModal(id) {
            const note = notes.find(note => note.id === parseInt(id));
            
            if (!note) return;
            
            // Populate form
            editNoteId.value = note.id;
            editNoteTitle.value = note.title;
            editNoteCategory.value = note.category;
            editNoteContent.value = note.content;
            editNoteTags.value = note.tags.join(', ');
            
            // Show modal
            toggleModal(editModal, true);
        }

        // Open delete modal
        function openDeleteModal(id) {
            deleteNoteId.value = id;
            toggleModal(deleteModal, true);
        }

        // Toggle modal visibility
        function toggleModal(modal, show) {
            if (show) {
                modal.classList.add('active');
            } else {
                modal.classList.remove('active');
            }
        }

        // Get category label
        function getCategoryLabel(category) {
            const categories = {
                'scientific-research': 'Scientific Research',
                'policy': 'Policy & Regulation',
                'impacts': 'Environmental Impacts',
                'solutions': 'Solutions & Innovations',
                'other': 'Other'
            };
            
            return categories[category] || 'Uncategorized';
        }

        // Save notes to localStorage
        function saveNotes() {
            localStorage.setItem('climateNotes', JSON.stringify(notes));
        }

        // Initialize the app
        init();
    </script>
</body>
</html>