<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Program Impact Analysis</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        :root {
            --primary-color: #3498db;
            --primary-color-dark: #2980b9;
            --secondary-color: #2ecc71;
            --secondary-color-dark: #27ae60;
            --background-color: #f4f7f6; /* Light gray background */
            --surface-color: #ffffff; /* Pure white for cards/containers */
            --text-color-primary: #2c3e50; /* Dark text */
            --text-color-secondary: #7f8c8d; /* Gray text */
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --spacing-unit: 8px;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color-primary);
            line-height: 1.6;
        }

        .layout-container {
            display: grid;
            grid-template-columns: 250px 1fr; /* Desktop: Sidebar 250px, Main 1fr */
            min-height: 100vh;
        }

        header {
            grid-column: 1 / -1; /* Span across both columns */
            background-color: var(--surface-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            box-shadow: 0 2px 4px var(--shadow-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-color-dark);
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: calc(var(--spacing-unit) * 3);
        }

        nav a {
            text-decoration: none;
            color: var(--text-color-secondary);
            font-weight: 500;
            padding: var(--spacing-unit);
            transition: color 0.2s ease, border-bottom 0.2s ease;
            border-bottom: 2px solid transparent;
        }

        nav a:hover,
        nav a.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        aside {
            grid-column: 1 / 2;
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
        }

        .filter-section {
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .filter-section h3 {
            margin-top: 0;
            margin-bottom: var(--spacing-unit) * 2;
            font-size: 1.1em;
            color: var(--text-color-primary);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--spacing-unit);
        }

        .filter-group {
            margin-bottom: var(--spacing-unit) * 2;
        }

        .filter-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
            color: var(--text-color-secondary);
            font-size: 0.9em;
        }

        .filter-group select,
        .filter-group input[type="date"] {
            width: 100%;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1em;
            color: var(--text-color-primary);
            background-color: var(--surface-color);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .filter-group select:focus,
        .filter-group input[type="date"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        main {
            grid-column: 2 / 3;
            padding: calc(var(--spacing-unit) * 3);
            overflow-y: auto;
        }

        .section {
            display: none; /* Sections are hidden by default */
        }

        .section.active {
            display: block; /* Active section is displayed */
        }

        h1 {
            font-size: 2em;
            color: var(--text-color-primary);
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .card {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--shadow-color);
            margin-bottom: calc(var(--spacing-unit) * 4);
            position: relative; /* Needed for floating controls */
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .summary-card {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--shadow-color);
            text-align: center;
        }

        .summary-card h4 {
            margin-top: 0;
            color: var(--text-color-secondary);
            font-size: 1em;
            font-weight: 500;
        }

        .summary-card p {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0;
        }

        .chart-container {
            position: relative;
            height: 400px; /* Fixed height for charts */
            cursor: pointer;
        }

        .floating-controls {
            position: absolute;
            top: var(--spacing-unit) * 2;
            right: var(--spacing-unit) * 2;
            background: rgba(255, 255, 255, 0.95);
            padding: var(--spacing-unit) * 2;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow-color);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 50;
        }

        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .control-group {
            margin: var(--spacing-unit) 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
        }

        .control-group label {
            font-size: 0.9em;
            color: var(--text-color-secondary);
            flex-shrink: 0;
        }

        .control-group input[type="color"],
        .control-group select,
        .control-group input[type="number"] {
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--text-color-primary);
            background-color: var(--surface-color);
            transition: border-color 0.2s ease;
        }
         .control-group input[type="color"] {
             padding: 4px; /* Adjust padding for color input */
             height: 32px; /* Match height */
         }

        .control-group select:focus,
        .control-group input[type="color"]:focus,
        .control-group input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .data-upload-section {
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .data-upload-section h2 {
             margin-top: 0;
             margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .file-input-group {
            display: flex;
            gap: calc(var(--spacing-unit) * 2);
            align-items: center;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .file-input-group input[type="file"] {
            border: 1px solid var(--border-color);
            padding: var(--spacing-unit);
            border-radius: 4px;
            background-color: var(--surface-color);
        }

        button {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: background-color 0.2s ease, opacity 0.2s ease;
            min-width: 100px; /* Ensure consistent button size */
        }

        button.primary {
            background-color: var(--primary-color);
            color: white;
        }

        button.primary:hover {
            background-color: var(--primary-color-dark);
        }

        button.secondary {
            background-color: var(--border-color);
            color: var(--text-color-primary);
        }

        button.secondary:hover {
            background-color: #d0d0d0;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-indicator {
            margin-top: var(--spacing-unit) * 2;
            height: var(--spacing-unit);
            background-color: var(--border-color);
            border-radius: var(--spacing-unit);
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--secondary-color);
            transition: width 0.3s ease;
        }

        .data-table-section {
            margin-top: calc(var(--spacing-unit) * 4);
        }

        .data-table-section h2 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .data-table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-unit) * 2;
            background-color: var(--surface-color);
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply */
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .data-table th,
        .data-table td {
            padding: calc(var(--spacing-unit) * 2);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background-color: var(--background-color);
            font-weight: 600;
            color: var(--text-color-primary);
            cursor: pointer; /* Indicate sortable */
        }

        .data-table th:hover {
            background-color: #e9eceb;
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .data-table tbody tr:hover {
            background-color: #f9f9f9;
        }

        .data-table td {
            color: var(--text-color-secondary);
        }

        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--surface-color);
            margin: auto;
            padding: calc(var(--spacing-unit) * 4);
            border-radius: 8px;
            box-shadow: 0 8px 16px var(--shadow-color);
            width: 90%;
            max-width: 600px;
            transform: translateY(-50px);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

        .modal.active .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .close-button {
            color: var(--text-color-secondary);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--text-color-primary);
            text-decoration: none;
            outline: none;
        }

        .modal h2 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 3);
            color: var(--text-color-primary);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .layout-container {
                grid-template-columns: 1fr; /* Stack on smaller screens */
            }

            aside {
                display: none; /* Hide sidebar by default on mobile */
                grid-column: 1 / -1; /* Allow sidebar to span if shown */
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }

            main {
                grid-column: 1 / -1; /* Main content spans full width */
            }

            header {
                 flex-direction: column;
                 gap: var(--spacing-unit) * 2;
                 padding: calc(var(--spacing-unit) * 2);
            }

            nav ul {
                gap: var(--spacing-unit) * 2;
            }

            .dashboard-grid {
                grid-template-columns: 1fr; /* Stack cards on mobile */
            }

            .floating-controls {
                position: static; /* Position normally within the card */
                margin-top: var(--spacing-unit) * 2;
                transform: none;
                opacity: 1;
                pointer-events: all;
                box-shadow: none;
                background: none;
                padding: 0;
            }

            .control-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .control-group label {
                margin-bottom: var(--spacing-unit);
            }
        }
    </style>
</head>
<body>

    <div class="layout-container">
        <header>
            <div class="logo">Community Impact</div>
            <nav>
                <ul>
                    <li><a href="#dashboard" class="nav-link active">Dashboard</a></li>
                    <li><a href="#data" class="nav-link">Data</a></li>
                    <li><a href="#reports" class="nav-link">Reports</a></li>
                    <li><a href="#settings" class="nav-link">Settings</a></li>
                </ul>
            </nav>
        </header>

        <aside>
            <div class="filter-section">
                <h3>Filters</h3>
                <div class="filter-group">
                    <label for="program-filter">Program</label>
                    <select id="program-filter" aria-label="Filter by Program">
                        <option value="">All Programs</option>
                        <option value="after-school">After-School</option>
                        <option value="adult-education">Adult Education</option>
                        <option value="senior-services">Senior Services</option>
                        <option value="community-events">Community Events</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="time-filter-start">Time Period (Start)</label>
                    <input type="date" id="time-filter-start" aria-label="Filter by Start Date">
                </div>
                <div class="filter-group">
                    <label for="time-filter-end">Time Period (End)</label>
                    <input type="date" id="time-filter-end" aria-label="Filter by End Date">
                </div>
                <div class="filter-group">
                    <label for="demographic-filter">Demographic Segment</label>
                    <select id="demographic-filter" aria-label="Filter by Demographic Segment">
                        <option value="">All Segments</option>
                        <option value="youth">Youth (0-18)</option>
                        <option value="adults">Adults (19-64)</option>
                        <option value="seniors">Seniors (65+)</option>
                        <option value="low-income">Low Income</option>
                        <option value="minority">Minority Groups</option>
                    </select>
                </div>
            </div>
        </aside>

        <main>
            <section id="dashboard" class="section active">
                <h1>Dashboard</h1>

                <div class="dashboard-grid">
                    <div class="summary-card">
                        <h4>Total Participants</h4>
                        <p>1,250</p>
                    </div>
                    <div class="summary-card">
                        <h4>Total Programs</h4>
                        <p>15</p>
                    </div>
                    <div class="summary-card">
                        <h4>Total Cost</h4>
                        <p>$150,000</p>
                    </div>
                    <div class="summary-card">
                        <h4>Average Impact Score</h4>
                        <p>4.2 / 5</p>
                    </div>
                </div>

                <div class="card">
                    <h2>Cost vs. Impact per Program</h2>
                    <div class="chart-container" id="chart1-container">
                        <canvas id="chart1"></canvas>
                         <div class="floating-controls" id="controls1">
                            <div class="control-group">
                                <label for="chartType1">Chart Type:</label>
                                <select id="chartType1" aria-label="Chart Type">
                                    <option value="bar">Bar</option>
                                    <option value="line">Line</option>
                                    <option value="scatter">Scatter</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="barColor1">Bar Color:</label>
                                <input type="color" id="barColor1" value="#3498db" aria-label="Bar Color">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Participants by Demographic</h2>
                     <div class="chart-container" id="chart2-container">
                        <canvas id="chart2"></canvas>
                         <div class="floating-controls" id="controls2">
                            <div class="control-group">
                                <label for="chartType2">Chart Type:</label>
                                <select id="chartType2" aria-label="Chart Type">
                                    <option value="pie">Pie</option>
                                    <option value="doughnut">Doughnut</option>
                                    <option value="bar">Bar</option>
                                </select>
                            </div>
                             <div class="control-group">
                                <label for="pieColor2">Color Palette:</label>
                                 <select id="pieColor2" aria-label="Color Palette">
                                    <option value="default">Default</option>
                                    <option value="pastel">Pastel</option>
                                    <option value="vivid">Vivid</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                 <div class="card">
                    <h2>Participants Over Time</h2>
                     <div class="chart-container" id="chart3-container">
                        <canvas id="chart3"></canvas>
                         <div class="floating-controls" id="controls3">
                            <div class="control-group">
                                <label for="chartType3">Chart Type:</label>
                                <select id="chartType3" aria-label="Chart Type">
                                    <option value="line">Line</option>
                                    <option value="bar">Bar</option>
                                </select>
                            </div>
                             <div class="control-group">
                                <label for="lineColor3">Line Color:</label>
                                <input type="color" id="lineColor3" value="#2ecc71" aria-label="Line Color">
                            </div>
                        </div>
                    </div>
                </div>

            </section>

            <section id="data" class="section">
                <h1>Data Management</h1>

                <div class="card data-upload-section">
                    <h2>Upload Data</h2>
                    <p>Upload your program data files (CSV, Excel) here.</p>
                    <div class="file-input-group">
                        <input type="file" id="data-file-input" accept=".csv, .xls, .xlsx" aria-label="Select data file">
                        <button class="primary" id="upload-button">Upload</button>
                    </div>
                    <div class="progress-indicator">
                        <div class="progress-bar" id="upload-progress"></div>
                    </div>
                    <p id="upload-status" style="margin-top: var(--spacing-unit); font-size: 0.9em; color: var(--text-color-secondary);"></p>
                </div>

                 <div class="card data-table-section">
                    <h2>Data Cleaning & Mapping (Preview)</h2>
                     <p>Review uploaded data and map columns to required fields.</p>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Original Column <span style="font-weight: normal; color: var(--text-color-secondary);">(Click to map)</span></th>
                                    <th>Mapped Field</th>
                                    <th>Sample Data</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Column A</td>
                                    <td><select aria-label="Map Column A"><option value="">Select Field</option><option value="program">Program Name</option><option value="participants">Participants</option></select></td>
                                    <td>Sample Value 1</td>
                                </tr>
                                <tr>
                                    <td>Column B</td>
                                     <td><select aria-label="Map Column B"><option value="">Select Field</option><option value="program">Program Name</option><option value="participants">Participants</option></select></td>
                                    <td>Sample Value 2</td>
                                </tr>
                                <!-- More rows would be added dynamically -->
                            </tbody>
                        </table>
                    </div>
                     <button class="primary" style="margin-top: calc(var(--spacing-unit) * 3);">Process Data</button>
                </div>

            </section>

            <section id="reports" class="section">
                <h1>Reports</h1>
                 <div class="card">
                    <h2>Generate Reports</h2>
                    <p>Select report type and format to generate.</p>
                     <div class="filter-group">
                        <label for="report-type">Report Type</label>
                        <select id="report-type" aria-label="Select Report Type">
                            <option value="summary">Summary Report</option>
                            <option value="program-detail">Program Detail</option>
                            <option value="demographic-analysis">Demographic Analysis</option>
                        </select>
                    </div>
                     <div class="filter-group">
                        <label for="report-format">Format</label>
                        <select id="report-format" aria-label="Select Report Format">
                            <option value="pdf">PDF</option>
                            <option value="csv">CSV</option>
                            <option value="excel">Excel</option>
                        </select>
                    </div>
                     <button class="primary" id="generate-report-button">Generate Report</button>
                 </div>
            </section>

            <section id="settings" class="section">
                <h1>Settings</h1>
                <div class="card">
                    <h2>Application Settings</h2>
                    <p>Manage application settings here (e.g., data sources, user accounts).</p>
                    <!-- Placeholder settings content -->
                    <p style="color: var(--text-color-secondary);">Settings options will be available soon.</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for Data Upload Confirmation/Status -->
    <div id="upload-modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="modal-title">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal('upload-modal')" aria-label="Close Modal">&times;</span>
        <h2 id="modal-title">Data Upload</h2>
        <p id="modal-message">Processing your data...</p>
        <div class="progress-indicator" style="margin-top: calc(var(--spacing-unit) * 2);">
            <div class="progress-bar" id="modal-progress"></div>
        </div>
         <button class="secondary" onclick="closeModal('upload-modal')" style="margin-top: calc(var(--spacing-unit) * 3);">Close</button>
      </div>
    </div>


    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // --- Navigation ---
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');

        function showSection(id) {
            sections.forEach(section => {
                section.classList.remove('active');
                section.setAttribute('aria-hidden', 'true');
            });
            const activeSection = document.querySelector(id);
            if (activeSection) {
                activeSection.classList.add('active');
                activeSection.setAttribute('aria-hidden', 'false');
                document.title = `Community Impact - ${activeSection.querySelector('h1').textContent}`;
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');
                showSection(link.getAttribute('href'));
            });
        });

        // Show dashboard by default
        showSection('#dashboard');

        // --- Filters ---
        const filterElements = document.querySelectorAll('aside select, aside input[type="date"]');
        filterElements.forEach(filter => {
            filter.addEventListener('change', (e) => {
                console.log(`Filter changed: ${filter.id} = ${e.target.value}`);
                // In a real app, this would trigger data fetching/filtering and chart updates
                // For now, just log
            });
        });

        // --- Chart Data and Configuration ---
        const chartData1 = {
            labels: ['After-School', 'Adult Ed', 'Senior Services', 'Community Events'],
            datasets: [{
                label: 'Impact Score (1-5)',
                data: [4.5, 4.0, 4.8, 3.5],
                backgroundColor: 'var(--primary-color)',
            },
            {
                label: 'Cost ($)',
                data: [20000, 50000, 30000, 10000],
                 backgroundColor: 'var(--secondary-color)',
            }]
        };

         const chartConfig1 = {
            type: 'bar',
            data: chartData1,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.dataset.label.includes('Cost') ? `$${context.parsed.y.toLocaleString()}` : context.parsed.y;
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Value'
                        }
                    },
                     x: {
                        title: {
                            display: true,
                            text: 'Program'
                        }
                    }
                },
                 onClick: (e, elements) => {
                    if (elements.length > 0) {
                        toggleControls('controls1');
                    } else {
                         hideControls('controls1');
                    }
                }
            }
        };

         const chartData2 = {
            labels: ['Youth (0-18)', 'Adults (19-64)', 'Seniors (65+)', 'Low Income', 'Minority Groups'],
            datasets: [{
                label: 'Participants',
                data: [400, 500, 200, 300, 250],
                backgroundColor: [
                    '#3498db', '#2ecc71', '#f1c40f', '#e74c3c', '#9b59b6'
                ],
                 hoverOffset: 4
            }]
        };

        const chartConfig2 = {
            type: 'pie',
            data: chartData2,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                         callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                     const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                     const percentage = ((context.parsed / total) * 100).toFixed(1) + '%';
                                     label += `${context.parsed} (${percentage})`;
                                }
                                return label;
                            }
                        }
                    }
                },
                 onClick: (e, elements) => {
                    if (elements.length > 0) {
                        toggleControls('controls2');
                    } else {
                         hideControls('controls2');
                    }
                }
            }
        };

         const chartData3 = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Participants',
                data: [100, 120, 150, 130, 180, 200, 220, 210, 190, 170, 160, 140],
                borderColor: 'var(--secondary-color)',
                backgroundColor: 'rgba(46, 204, 113, 0.2)',
                tension: 0.1,
                fill: true
            }]
        };

        const chartConfig3 = {
            type: 'line',
            data: chartData3,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                     tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Participants'
                        }
                    },
                     x: {
                        title: {
                            display: true,
                            text: 'Month'
                        }
                    }
                },
                 onClick: (e, elements) => {
                    if (elements.length > 0) {
                        toggleControls('controls3');
                    } else {
                         hideControls('controls3');
                    }
                }
            }
        };


        // --- Render Charts ---
        const ctx1 = document.getElementById('chart1').getContext('2d');
        const chart1 = new Chart(ctx1, chartConfig1);

        const ctx2 = document.getElementById('chart2').getContext('2d');
        const chart2 = new Chart(ctx2, chartConfig2);

        const ctx3 = document.getElementById('chart3').getContext('2d');
        const chart3 = new Chart(ctx3, chartConfig3);

        // --- Floating Controls Logic ---
        function toggleControls(controlsId) {
            const controls = document.getElementById(controlsId);
            controls.classList.toggle('active');
        }

         function hideControls(controlsId) {
             const controls = document.getElementById(controlsId);
             controls.classList.remove('active');
         }

        document.addEventListener('click', (e) => {
            // Hide controls if click is outside any chart container or controls
            const isClickInsideChartOrControls = e.target.closest('.chart-container') || e.target.closest('.floating-controls');
            if (!isClickInsideChartOrControls) {
                document.querySelectorAll('.floating-controls').forEach(ctrl => ctrl.classList.remove('active'));
            }
        });


        // --- Chart Controls Event Listeners ---
        document.getElementById('chartType1').addEventListener('change', (e) => {
            chart1.config.type = e.target.value;
            chart1.update();
        });
         document.getElementById('barColor1').addEventListener('input', (e) => {
            chart1.config.data.datasets.forEach(dataset => {
                 // Apply color only to the first dataset (Impact Score) for simplicity
                 if (dataset.label.includes('Impact')) {
                     dataset.backgroundColor = e.target.value;
                 }
            });
            chart1.update();
        });

        document.getElementById('chartType2').addEventListener('change', (e) => {
            chart2.config.type = e.target.value;
            chart2.update();
        });
         document.getElementById('pieColor2').addEventListener('change', (e) => {
            let colors;
            switch(e.target.value) {
                case 'pastel':
                    colors = ['#a8dadc', '#457b9d', '#1d3557', '#f4a261', '#e76f51'];
                    break;
                case 'vivid':
                     colors = ['#e63946', '#f1faee', '#a8dadc', '#457b9d', '#1d3557'];
                    break;
                case 'default':
                default:
                    colors = ['#3498db', '#2ecc71', '#f1c40f', '#e74c3c', '#9b59b6'];
                    break;
            }
             chart2.config.data.datasets[0].backgroundColor = colors;
             chart2.update();
        });


        document.getElementById('chartType3').addEventListener('change', (e) => {
            chart3.config.type = e.target.value;
            chart3.update();
        });
         document.getElementById('lineColor3').addEventListener('input', (e) => {
            chart3.config.data.datasets[0].borderColor = e.target.value;
             chart3.config.data.datasets[0].backgroundColor = e.target.value + '33'; // Add transparency for fill
            chart3.update();
        });


        // --- Data Upload Simulation ---
        const uploadButton = document.getElementById('upload-button');
        const fileInput = document.getElementById('data-file-input');
        const uploadProgress = document.getElementById('upload-progress');
        const uploadStatus = document.getElementById('upload-status');
        const uploadModal = document.getElementById('upload-modal');
        const modalProgress = document.getElementById('modal-progress');
        const modalMessage = document.getElementById('modal-message');

        uploadButton.addEventListener('click', () => {
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                console.log(`Uploading file: ${file.name}`);
                uploadStatus.textContent = `Uploading ${file.name}...`;
                openModal('upload-modal', `Uploading ${file.name}`);

                // Simulate upload progress
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    uploadProgress.style.width = `${progress}%`;
                    modalProgress.style.width = `${progress}%`;
                    if (progress >= 100) {
                        clearInterval(interval);
                        uploadStatus.textContent = `${file.name} uploaded successfully.`;
                        modalMessage.textContent = `${file.name} uploaded successfully. Ready for processing.`;
                         // In a real app, trigger data parsing/cleaning here
                         console.log('Upload complete. Ready for processing.');
                         // Simulate showing data preview after a delay
                         setTimeout(() => {
                             // This is where you'd load data into the table preview
                             console.log('Simulating data preview load...');
                         }, 1000);
                    }
                }, 200);

            } else {
                uploadStatus.textContent = 'Please select a file to upload.';
            }
        });

        // --- Modal Logic ---
        function openModal(modalId, message = '') {
            const modal = document.getElementById(modalId);
            const msgElement = modal.querySelector('#modal-message');
            const progressBar = modal.querySelector('.progress-bar');

            if (msgElement) msgElement.textContent = message;
             if (progressBar) progressBar.style.width = '0%'; // Reset progress bar
            modal.classList.add('active');
             modal.setAttribute('aria-hidden', 'false');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
             modal.setAttribute('aria-hidden', 'true');
        }

        // Close modal if clicking outside the modal content
        window.addEventListener('click', (event) => {
          if (event.target.classList.contains('modal')) {
            closeModal(event.target.id);
          }
        });

         // Close modal if pressing Escape key
         document.addEventListener('keydown', (event) => {
             if (event.key === 'Escape') {
                 document.querySelectorAll('.modal.active').forEach(modal => {
                     closeModal(modal.id);
                 });
             }
         });


        // --- Report Generation Simulation ---
        const generateReportButton = document.getElementById('generate-report-button');
        generateReportButton.addEventListener('click', () => {
            const reportType = document.getElementById('report-type').value;
            const reportFormat = document.getElementById('report-format').value;
            console.log(`Generating report: Type=${reportType}, Format=${reportFormat}`);
            // Simulate report generation
             generateReportButton.textContent = 'Generating...';
             generateReportButton.disabled = true;

             setTimeout(() => {
                 console.log('Report generated.');
                 alert(`Report "${reportType}" generated in ${reportFormat} format! (Simulated)`);
                 generateReportButton.textContent = 'Generate Report';
                 generateReportButton.disabled = false;
             }, 2000);
        });

         // --- Basic Table Sorting (Placeholder) ---
         document.querySelectorAll('.data-table th').forEach(header => {
             header.addEventListener('click', () => {
                 const columnName = header.textContent.trim().split(' ')[0]; // Simple extraction
                 console.log(`Sorting table by: ${columnName}`);
                 // In a real app, implement actual sorting logic here
                 // For now, just log the action
             });
         });


    </script>

</body>
</html>
