<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Readmission Risk Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        :root {
            --primary-blue: #007bff;
            --secondary-grey: #f4f7f6;
            --text-color: #333;
            --border-color: #e0e0e0;
            --card-background: #ffffff;
            --risk-low: #28a745; /* Green */
            --risk-medium: #ffc107; /* Yellow */
            --risk-high: #dc3545; /* Red */
            --risk-unknown: #6c757d; /* Grey */
            --shadow-subtle: 0 2px 4px rgba(0, 0, 0, 0.05);
            --spacing-unit: 8px;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--secondary-grey);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--primary-blue);
            color: white;
            padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 4);
            box-shadow: var(--shadow-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 600;
        }

        .container {
            flex-grow: 1;
            padding: calc(var(--spacing-unit) * 4);
            display: grid;
            grid-template-columns: 1fr;
            gap: calc(var(--spacing-unit) * 4);
        }

        .dashboard-section {
            background-color: var(--card-background);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: 8px;
            box-shadow: var(--shadow-subtle);
        }

        .dashboard-section h2 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 3);
            font-size: 1.5em;
            font-weight: 600;
            color: var(--primary-blue);
        }

        .filter-sort-bar {
            display: flex;
            gap: calc(var(--spacing-unit) * 2);
            margin-bottom: calc(var(--spacing-unit) * 3);
            align-items: center;
        }

        .filter-sort-bar input[type="text"],
        .filter-sort-bar select {
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1em;
            flex-grow: 1;
        }

        .filter-sort-bar button {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
        }

        .filter-sort-bar button:hover {
            background-color: #0056b3;
        }

        .patient-list {
            display: grid;
            gap: calc(var(--spacing-unit) * 2);
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        .patient-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-left: 6px solid; /* Placeholder for risk color */
            border-radius: 4px;
            padding: calc(var(--spacing-unit) * 2);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .patient-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-subtle);
        }

        .patient-card .patient-id {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: var(--spacing-unit);
        }

        .patient-card .demographics {
            font-size: 0.9em;
            color: #555;
            margin-bottom: var(--spacing-unit) * 2;
        }

        .patient-card .risk-score {
            font-size: 1.1em;
            font-weight: 700;
            text-align: right;
        }

        .risk-low { border-left-color: var(--risk-low); color: var(--risk-low); }
        .risk-medium { border-left-color: var(--risk-medium); color: var(--risk-medium); }
        .risk-high { border-left-color: var(--risk-high); color: var(--risk-high); }
        .risk-unknown { border-left-color: var(--risk-unknown); color: var(--risk-unknown); }

        /* Detailed View Side Panel */
        .detail-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none; /* Hidden by default */
            justify-content: flex-end; /* Align panel to the right */
        }

        .detail-panel {
            background-color: var(--card-background);
            width: 400px; /* Adjust width as needed */
            max-width: 90%;
            height: 100%;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.1);
            transform: translateX(100%); /* Start off-screen */
            transition: transform 0.3s ease-out;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .detail-panel-overlay.visible {
            display: flex;
        }

        .detail-panel-overlay.visible .detail-panel {
            transform: translateX(0); /* Slide in */
        }

        .detail-panel-header {
            padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 3);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-panel-header h3 {
            margin: 0;
            font-size: 1.4em;
            font-weight: 600;
        }

        .detail-panel-close {
            background: none;
            border: none;
            font-size: 1.8em;
            cursor: pointer;
            color: var(--text-color);
            transition: color 0.2s ease;
        }

        .detail-panel-close:hover {
            color: var(--risk-high);
        }

        .detail-panel-content {
            padding: calc(var(--spacing-unit) * 3);
            flex-grow: 1;
        }

        .detail-section {
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .detail-section h4 {
            margin-top: 0;
            margin-bottom: var(--spacing-unit) * 2;
            font-size: 1.1em;
            font-weight: 600;
            color: #555;
            border-bottom: 1px solid var(--secondary-grey);
            padding-bottom: var(--spacing-unit);
        }

        .detail-item {
            margin-bottom: var(--spacing-unit);
            font-size: 0.95em;
        }

        .detail-item strong {
            display: inline-block;
            min-width: 100px; /* Align labels */
            margin-right: var(--spacing-unit);
            color: var(--text-color);
        }

        .detail-risk-score {
            font-size: 1.8em;
            font-weight: 700;
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .detail-risk-low { color: var(--risk-low); }
        .detail-risk-medium { color: var(--risk-medium); }
        .detail-risk-high { color: var(--risk-high); }
        .detail-risk-unknown { color: var(--risk-unknown); }

        /* Chart Styling */
        .chart-container {
            position: relative;
            height: 250px; /* Adjust height as needed */
            width: 100%;
        }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .container {
                 grid-template-columns: 1fr 300px; /* Example: Main list + Aggregate view */
            }
             .patient-list {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* More cards on wider screens */
            }
             .detail-panel {
                width: 500px; /* Wider panel on larger screens */
            }
        }

        @media (min-width: 1024px) {
             .container {
                 grid-template-columns: 1fr 400px; /* Larger aggregate view */
            }
             .patient-list {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Even wider cards */
            }
             .detail-panel {
                width: 600px; /* Even wider panel */
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Patient Readmission Risk Dashboard</h1>
        <!-- Could add navigation links here -->
    </header>

    <div class="container">
        <div class="dashboard-section">
            <h2>Patient List</h2>
            <div class="filter-sort-bar">
                <input type="text" id="patient-search" placeholder="Search by Patient ID...">
                <select id="risk-filter">
                    <option value="">All Risk Levels</option>
                    <option value="low">Low Risk</option>
                    <option value="medium">Medium Risk</option>
                    <option value="high">High Risk</option>
                </select>
                <button id="apply-filters">Apply</button>
            </div>
            <div class="patient-list" id="patient-list">
                <!-- Patient cards will be loaded here by JavaScript -->
            </div>
        </div>

        <div class="dashboard-section">
            <h2>Aggregate Risk Overview</h2>
            <!-- Placeholder for aggregate data visualization -->
             <div class="chart-container">
                <canvas id="aggregate-risk-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Detailed View Side Panel -->
    <div class="detail-panel-overlay" id="detail-panel-overlay">
        <div class="detail-panel" id="detail-panel">
            <div class="detail-panel-header">
                <h3 id="detail-patient-id">Patient Details</h3>
                <button class="detail-panel-close" id="close-detail-panel">&times;</button>
            </div>
            <div class="detail-panel-content">
                <div class="detail-section">
                    <h4>Predicted Risk</h4>
                    <div id="detail-risk-score" class="detail-risk-score"></div>
                </div>

                <div class="detail-section">
                    <h4>Patient Demographics</h4>
                    <div class="detail-item"><strong>Age:</strong> <span id="detail-age"></span></div>
                    <div class="detail-item"><strong>Gender:</strong> <span id="detail-gender"></span></div>
                    <div class="detail-item"><strong>Ethnicity:</strong> <span id="detail-ethnicity"></span></div>
                    <!-- Add more demographics as needed -->
                </div>

                 <div class="detail-section">
                    <h4>Contributing Factors</h4>
                     <!-- Placeholder for factor importance chart -->
                     <div class="chart-container">
                        <canvas id="factor-importance-chart"></canvas>
                    </div>
                </div>

                <!-- Add more sections for diagnosis, medications, labs etc. -->

            </div>
        </div>
    </div>

    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // Dummy Data (Replace with actual data fetching)
        const patientData = [
            { id: 'Patient-001', age: 65, gender: 'Female', ethnicity: 'Caucasian', risk: 'low', score: 15, factors: [{name: 'Age', value: 5}, {name: 'Diagnosis A', value: 3}, {name: 'Medication X', value: 2}] },
            { id: 'Patient-002', age: 78, gender: 'Male', ethnicity: 'African American', risk: 'high', score: 85, factors: [{name: 'Diagnosis B', value: 20}, {name: 'Prior Readmission', value: 15}, {name: 'Lab Result Y (Abnormal)', value: 10}] },
            { id: 'Patient-003', age: 55, gender: 'Female', ethnicity: 'Hispanic', risk: 'medium', score: 45, factors: [{name: 'Medication Z', value: 8}, {name: 'Diagnosis C', value: 7}, {name: 'Age', value: 5}] },
            { id: 'Patient-004', age: 82, gender: 'Male', ethnicity: 'Caucasian', risk: 'high', score: 92, factors: [{name: 'Prior Readmission', value: 25}, {name: 'Age', value: 10}, {name: 'Diagnosis D', value: 8}] },
             { id: 'Patient-005', age: 45, gender: 'Female', ethnicity: 'Asian', risk: 'low', score: 10, factors: [{name: 'No Prior Issues', value: -5}, {name: 'Age', value: 3}] },
             { id: 'Patient-006', age: 70, gender: 'Male', ethnicity: 'Caucasian', risk: 'medium', score: 58, factors: [{name: 'Diagnosis E', value: 12}, {name: 'Medication W', value: 9}, {name: 'Age', value: 6}] },
        ];

        let currentPatientList = [...patientData]; // Data currently displayed

        const patientListContainer = document.getElementById('patient-list');
        const detailPanelOverlay = document.getElementById('detail-panel-overlay');
        const detailPanel = document.getElementById('detail-panel');
        const closeDetailPanelButton = document.getElementById('close-detail-panel');
        const detailPatientId = document.getElementById('detail-patient-id');
        const detailRiskScore = document.getElementById('detail-risk-score');
        const detailAge = document.getElementById('detail-age');
        const detailGender = document.getElementById('detail-gender');
        const detailEthnicity = document.getElementById('detail-ethnicity');
        const searchInput = document.getElementById('patient-search');
        const riskFilterSelect = document.getElementById('risk-filter');
        const applyFiltersButton = document.getElementById('apply-filters');

        let factorImportanceChart = null; // To hold the chart instance

        // Function to render patient cards
        function renderPatientList(patients) {
            patientListContainer.innerHTML = ''; // Clear current list
            if (patients.length === 0) {
                 patientListContainer.innerHTML = '<p>No patients found matching criteria.</p>';
                 return;
            }
            patients.forEach(patient => {
                const card = document.createElement('div');
                card.classList.add('patient-card', `risk-${patient.risk}`);
                card.dataset.patientId = patient.id; // Store ID for lookup

                card.innerHTML = `
                    <div class="patient-id">${patient.id}</div>
                    <div class="demographics">Age: ${patient.age}, Gender: ${patient.gender}</div>
                    <div class="risk-score">Risk: ${patient.score}%</div>
                `;

                card.addEventListener('click', () => showDetailPanel(patient.id));
                patientListContainer.appendChild(card);
            });
        }

        // Function to show the detail panel
        function showDetailPanel(patientId) {
            const patient = patientData.find(p => p.id === patientId);
            if (!patient) return;

            detailPatientId.textContent = `Details for ${patient.id}`;
            detailRiskScore.textContent = `${patient.score}%`;
            detailRiskScore.className = `detail-risk-score detail-risk-${patient.risk}`; // Update class for color

            detailAge.textContent = patient.age;
            detailGender.textContent = patient.gender;
            detailEthnicity.textContent = patient.ethnicity;

            // Render Factor Importance Chart
            renderFactorImportanceChart(patient.factors);

            detailPanelOverlay.classList.add('visible');
        }

        // Function to hide the detail panel
        function hideDetailPanel() {
            detailPanelOverlay.classList.remove('visible');
             // Destroy chart when panel is hidden to free up resources
            if (factorImportanceChart) {
                factorImportanceChart.destroy();
                factorImportanceChart = null;
            }
        }

        // Function to render the factor importance chart
        function renderFactorImportanceChart(factors) {
             // Ensure previous chart is destroyed if it exists
            if (factorImportanceChart) {
                factorImportanceChart.destroy();
            }

            const ctx = document.getElementById('factor-importance-chart').getContext('2d');

            // Sort factors by absolute value for better visualization
            const sortedFactors = [...factors].sort((a, b) => Math.abs(b.value) - Math.abs(a.value));

            factorImportanceChart = new Chart(ctx, {
                type: 'bar', // Bar chart is good for showing individual contributions
                data: {
                    labels: sortedFactors.map(f => f.name),
                    datasets: [{
                        label: 'Contribution to Risk Score',
                        data: sortedFactors.map(f => f.value),
                         backgroundColor: sortedFactors.map(f => f.value > 0 ? 'rgba(220, 53, 69, 0.8)' : 'rgba(40, 167, 69, 0.8)'), // Red for positive contribution, Green for negative
                         borderColor: sortedFactors.map(f => f.value > 0 ? 'rgba(220, 53, 69, 1)' : 'rgba(40, 167, 69, 1)'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Make it a horizontal bar chart
                    plugins: {
                        legend: {
                            display: false // Hide legend for single dataset
                        },
                        title: {
                            display: true,
                            text: 'Factors Influencing Risk',
                            font: { size: 14 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.raw.toFixed(1); // Show value with one decimal
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Contribution Value'
                            },
                             ticks: {
                                beginAtZero: true // Start x-axis at zero
                            }
                        },
                        y: {
                            title: {
                                display: false // Y-axis labels are factor names
                            }
                        }
                    }
                }
            });
        }

         // Function to render the aggregate risk chart
        function renderAggregateRiskChart() {
            const ctx = document.getElementById('aggregate-risk-chart').getContext('2d');

            // Calculate counts per risk level
            const riskCounts = patientData.reduce((acc, patient) => {
                acc[patient.risk]++;
                return acc;
            }, { low: 0, medium: 0, high: 0 });

            new Chart(ctx, {
                type: 'pie', // Pie chart for risk distribution
                data: {
                    labels: ['Low Risk', 'Medium Risk', 'High Risk'],
                    datasets: [{
                        data: [riskCounts.low, riskCounts.medium, riskCounts.high],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)', // Low
                            'rgba(255, 193, 7, 0.8)', // Medium
                            'rgba(220, 53, 69, 0.8)'  // High
                        ],
                         borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Overall Risk Distribution',
                             font: { size: 14 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                    const percentage = ((value / total) * 100).toFixed(1) + '%';
                                    return `${label}: ${value} (${percentage})`;
                                }
                            }
                        }
                    }
                }
            });
        }


        // Function to apply filters and search
        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const riskFilter = riskFilterSelect.value;

            currentPatientList = patientData.filter(patient => {
                const matchesSearch = patient.id.toLowerCase().includes(searchTerm);
                const matchesRisk = riskFilter === '' || patient.risk === riskFilter;
                return matchesSearch && matchesRisk;
            });

            renderPatientList(currentPatientList);
        }


        // Event Listeners
        closeDetailPanelButton.addEventListener('click', hideDetailPanel);
        detailPanelOverlay.addEventListener('click', (e) => {
            // Close panel if click is outside the panel content
            if (e.target === detailPanelOverlay) {
                hideDetailPanel();
            }
        });

        applyFiltersButton.addEventListener('click', applyFilters);

        // Initial render
        renderPatientList(currentPatientData);
        renderAggregateRiskChart(); // Render aggregate chart on load

        // Allow closing with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && detailPanelOverlay.classList.contains('visible')) {
                hideDetailPanel();
            }
        });

        // Basic keyboard navigation for patient cards (example)
        patientListContainer.addEventListener('keydown', (e) => {
            const activeElement = document.activeElement;
            if (!activeElement || !activeElement.classList.contains('patient-card')) return;

            const cards = Array.from(patientListContainer.querySelectorAll('.patient-card'));
            const currentIndex = cards.indexOf(activeElement);

            let nextIndex = -1;

            if (e.key === 'ArrowRight' && currentIndex < cards.length - 1) {
                nextIndex = currentIndex + 1;
            } else if (e.key === 'ArrowLeft' && currentIndex > 0) {
                nextIndex = currentIndex - 1;
            } else if (e.key === 'Enter' || e.key === ' ') {
                 activeElement.click(); // Trigger click on Enter/Space
                 e.preventDefault(); // Prevent space from scrolling
            }

            if (nextIndex !== -1) {
                cards[nextIndex].focus();
            }
        });

        // Make cards focusable for keyboard navigation
        patientListContainer.querySelectorAll('.patient-card').forEach(card => {
            card.setAttribute('tabindex', '0');
            card.setAttribute('role', 'button'); // Indicate it's clickable
            card.setAttribute('aria-label', `View details for ${card.dataset.patientId}`);
        });


    </script>

</body>
</html>
