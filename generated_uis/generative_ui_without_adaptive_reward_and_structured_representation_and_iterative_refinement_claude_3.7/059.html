<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethical Ethnography Planner</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <style>
        :root {
            --primary-color: #007bff; /* Example vibrant blue */
            --primary-dark: #0056b3;
            --secondary-color: #28a745; /* Example vibrant green */
            --background-color: #ffffff;
            --surface-color: #f8f9fa; /* Light grey for cards/sections */
            --text-color: #333;
            --text-light: #666;
            --border-color: #dee2e6;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --spacing-unit: 16px;
            --border-radius: 8px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--surface-color);
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        header {
            background-color: var(--background-color);
            color: var(--text-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            box-shadow: 0 2px 4px var(--shadow-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }

        header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 700;
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr; /* Sidebar and main content */
            flex-grow: 1;
            gap: var(--spacing-unit);
            padding: var(--spacing-unit);
        }

        aside {
            background-color: var(--background-color);
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        nav li {
            margin-bottom: var(--spacing-unit);
        }

        nav a {
            display: block;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 0.75);
            text-decoration: none;
            color: var(--text-color);
            border-radius: var(--border-radius);
            transition: background-color 0.2s ease, color 0.2s ease;
            outline-offset: 2px; /* For accessibility focus */
        }

        nav a:hover,
        nav a.active {
            background-color: var(--primary-color);
            color: var(--background-color);
        }

         nav a:focus {
             outline: 2px solid var(--primary-dark);
         }


        main {
            background-color: var(--background-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px var(--shadow-color);
            overflow-y: auto; /* Enable scrolling for content */
        }

        .module-section {
            display: none; /* Hide all sections by default */
        }

        .module-section.active {
            display: block; /* Show active section */
        }

        h2, h3 {
            color: var(--primary-color);
            margin-top: 0;
        }

        h2 {
            font-size: 1.5em;
            margin-bottom: var(--spacing-unit);
        }

        h3 {
            font-size: 1.2em;
            margin-top: calc(var(--spacing-unit) * 1.5);
            margin-bottom: var(--spacing-unit);
        }

        p {
            margin-bottom: var(--spacing-unit);
            color: var(--text-light);
        }

        textarea {
            width: 100%;
            padding: var(--spacing-unit);
            margin-bottom: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: 'Roboto', sans-serif;
            font-size: 1em;
            min-height: 150px;
            resize: vertical;
            outline-offset: 2px; /* For accessibility focus */
        }

         textarea:focus {
             outline: 2px solid var(--primary-dark);
             border-color: var(--primary-dark);
         }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 1.5);
        }

        label {
            display: block;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
            font-weight: 500;
            color: var(--text-color);
            cursor: pointer; /* Indicate label is interactive for checkbox */
        }

        .checklist {
            list-style: none;
            padding: 0;
            margin-bottom: var(--spacing-unit);
        }

        .checklist li {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            padding: var(--spacing-unit);
            margin-bottom: var(--spacing-unit);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .checklist li:hover {
             background-color: #e9ecef; /* Slightly darker surface */
        }

        .checklist input[type="checkbox"] {
            margin-right: var(--spacing-unit);
            cursor: pointer;
            outline-offset: 2px; /* For accessibility focus */
        }

         .checklist input[type="checkbox"]:focus {
             outline: 2px solid var(--primary-dark);
         }


        button {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s ease, opacity 0.2s ease;
            margin-right: var(--spacing-unit);
            outline-offset: 2px; /* For accessibility focus */
        }

        button:hover {
            background-color: #218838; /* Darker green */
        }

         button:focus {
             outline: 2px solid #1a6d2e; /* Darker green outline */
         }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .expandable-panel {
            margin-bottom: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .expandable-panel-header {
            background-color: var(--surface-color);
            padding: var(--spacing-unit);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            transition: background-color 0.2s ease;
            outline-offset: 2px; /* For accessibility focus */
        }

        .expandable-panel-header:hover {
            background-color: #e9ecef;
        }

         .expandable-panel-header:focus {
             outline: 2px solid var(--primary-dark);
         }


        .expandable-panel-content {
            padding: var(--spacing-unit);
            border-top: 1px solid var(--border-color);
            display: none; /* Hidden by default */
        }

        .expandable-panel.expanded .expandable-panel-content {
            display: block; /* Show when expanded */
        }

        .resource-list ul {
            list-style: none;
            padding: 0;
        }

        .resource-list li {
            margin-bottom: calc(var(--spacing-unit) * 0.75);
            padding-bottom: calc(var(--spacing-unit) * 0.75);
            border-bottom: 1px dashed var(--border-color);
        }

        .resource-list li:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .resource-list p { /* Changed from a to p as external links are forbidden */
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s ease;
            margin-bottom: 0; /* Remove default p margin */
        }


        /* Progress Indicator Styling */
        .progress-indicator {
            margin-top: calc(var(--spacing-unit) * 1.5);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .progress-bar {
            height: 20px;
            width: 0%;
            background-color: var(--secondary-color);
            text-align: center;
            line-height: 20px;
            color: white;
            transition: width 0.4s ease;
            font-size: 0.9em;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-unit);
            font-size: 0.9em;
            color: var(--text-light);
            position: relative; /* For the line */
        }

         .progress-steps::before {
             content: '';
             position: absolute;
             top: 5px;
             left: 0;
             right: 0;
             height: 2px;
             background-color: #e0e0e0;
             z-index: 0;
         }

        .progress-step {
            text-align: center;
            flex-grow: 1;
            position: relative;
            z-index: 1; /* Above the line */
            background-color: var(--surface-color); /* Match body background */
            padding-top: 10px; /* Space for the dot */
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 0; /* Position at the top of the step div */
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 50%;
            border: 2px solid var(--surface-color); /* Border to cover the line */
        }

        .progress-step.completed::after {
            background-color: var(--secondary-color);
        }

         .progress-step.active::after {
            background-color: var(--primary-color);
            width: 12px;
            height: 12px;
            top: -1px; /* Adjust position slightly */
            border-width: 3px;
         }


        /* Responsive adjustments (basic) */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr; /* Stack columns */
                padding: var(--spacing-unit);
            }

            aside {
                display: none; /* Hide sidebar on small screens, could be a drawer */
            }

            main {
                padding: var(--spacing-unit);
            }

            header h1 {
                font-size: 1.5em;
            }

             .progress-steps {
                 flex-wrap: wrap; /* Allow steps to wrap */
             }

             .progress-step {
                 flex-basis: 50%; /* Two steps per row */
                 margin-bottom: var(--spacing-unit);
             }

             .progress-steps::before {
                 display: none; /* Hide line on small screens */
             }

             .progress-step::after {
                 top: -5px; /* Adjust dot position */
             }
        }

    </style>
</head>
<body>
    <header>
        <h1>Ethical Ethnography Planner</h1>
        <!-- Mobile nav toggle could go here -->
    </header>

    <div class="container">
        <aside>
            <nav>
                <ul>
                    <li><a href="#dashboard" class="nav-link active">Dashboard</a></li>
                    <li><a href="#positionality" class="nav-link">Positionality</a></li>
                    <li><a href="#engagement" class="nav-link">Community Engagement</a></li>
                    <li><a href="#consent" class="nav-link">Consent Processes</a></li>
                    <li><a href="#observation" class="nav-link">Participant Observation</a></li>
                    <li><a href="#interviews" class="nav-link">Interviews</a></li>
                    <li><a href="#mapping" class="nav-link">Community Mapping</a></li>
                    <li><a href="#data-ethics" class="nav-link">Data Ethics & Representation</a></li>
                    <li><a href="#resources" class="nav-link">Resources</a></li>
                </ul>
            </nav>
        </aside>

        <main>
            <div id="dashboard" class="module-section active">
                <h2>Welcome to the Ethical Ethnography Planner</h2>
                <p>This tool guides you through planning your research methodology with a focus on addressing power dynamics and avoiding colonial practices. Use the navigation on the left to access different planning modules.</p>

                <div class="progress-indicator">
                    <h3>Planning Progress</h3>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;">0%</div>
                    </div>
                    <div class="progress-steps">
                        <div class="progress-step active" data-module="dashboard">Start</div>
                        <div class="progress-step" data-module="positionality">Positionality</div>
                        <div class="progress-step" data-module="engagement">Engagement</div>
                        <div class="progress-step" data-module="consent">Consent</div>
                        <div class="progress-step" data-module="observation">Observation</div>
                        <div class="progress-step" data-module="interviews">Interviews</div>
                        <div class="progress-step" data-module="mapping">Mapping</div>
                        <div class="progress-step" data-module="data-ethics">Data Ethics</div>
                        <div class="progress-step" data-module="resources">Resources</div>
                         <div class="progress-step" data-module="complete">Complete</div>
                    </div>
                </div>

                <!-- Module Cards could go here, but the nav links serve a similar purpose -->

            </div>

            <div id="positionality" class="module-section">
                <h2>Positionality Reflection</h2>
                <p>Reflecting on your positionality is crucial for ethical research. Consider your identity, background, and how they might influence your research questions, interactions, and interpretations.</p>

                <div class="form-group">
                    <label for="positionality-reflection">Your Reflection:</label>
                    <textarea id="positionality-reflection" placeholder="Write your reflections here..."></textarea>
                </div>

                <h3>Key Considerations Checklist:</h3>
                <ul class="checklist" data-module="positionality">
                    <li>
                        <input type="checkbox" id="pos-check1">
                        <label for="pos-check1">Identified my own social identities (race, gender, class, nationality, etc.).</label>
                    </li>
                    <li>
                        <input type="checkbox" id="pos-check2">
                        <label for="pos-check2">Considered how my identities might be perceived by the community.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="pos-check3">
                        <label for="pos-check3">Reflected on potential power imbalances between myself and participants.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="pos-check4">
                        <label for="pos-check4">Thought about how my research questions are shaped by my perspective.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="pos-check5">
                        <label for="pos-check5">Planned how to be transparent about my positionality in my research outputs.</label>
                    </li>
                </ul>

                 <div class="expandable-panel">
                    <div class="expandable-panel-header" tabindex="0" role="button" aria-expanded="false">
                        Understanding Positionality
                        <!-- Icon could go here -->
                    </div>
                    <div class="expandable-panel-content" aria-hidden="true">
                        <p>Positionality refers to your social and political context. It is important to understand how your own identities and experiences shape your worldview and, consequently, your research. This is not just about acknowledging bias, but about understanding the power dynamics inherent in the research relationship.</p>
                    </div>
                </div>

                 <button>Save Reflection</button>
            </div>

            <div id="engagement" class="module-section">
                <h2>Community Engagement</h2>
                <p>Building respectful relationships with the community is fundamental. Plan how you will introduce yourself, your research, and establish trust.</p>

                 <h3>Key Considerations Checklist:</h3>
                <ul class="checklist" data-module="engagement">
                    <li>
                        <input type="checkbox" id="eng-check1">
                        <label for="eng-check1">Identified key community members or gatekeepers to approach first.</label>
                    </li>
                    <li>
                        <input type="checkbox" id="eng-check2">
                        <label for="eng-check2">Planned how to introduce myself and the research in a culturally sensitive manner.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="eng-check3">
                        <label for="eng-check3">Considered offering something back to the community (e.g., sharing findings, practical support).</label>
                    </li>
                     <li>
                        <input type="checkbox" id="eng-check4">
                        <label for="eng-check4">Planned for ongoing communication and feedback loops with the community.</label>
                    </li>
                </ul>

                 <div class="expandable-panel">
                    <div class="expandable-panel-header" tabindex="0" role="button" aria-expanded="false">
                        Principles of Respectful Engagement
                    </div>
                    <div class="expandable-panel-content" aria-hidden="true">
                        <p>Respectful engagement involves genuine listening, humility, and recognizing the community's expertise about their own lives. Avoid making assumptions and be prepared to adapt your plans based on community input. Building trust takes time and consistent effort.</p>
                    </div>
                </div>

                <button>Save Engagement Plan</button>
            </div>

             <div id="consent" class="module-section">
                <h2>Consent Processes</h2>
                <p>Ethical consent goes beyond a signature. Plan for informed, voluntary, and ongoing consent that respects community norms and power dynamics.</p>

                 <h3>Key Considerations Checklist:</h3>
                <ul class="checklist" data-module="consent">
                    <li>
                        <input type="checkbox" id="con-check1">
                        <label for="con-check1">Planned how to explain the research purpose, risks, and benefits clearly.</label>
                    </li>
                    <li>
                        <input type="checkbox" id="con-check2">
                        <label for="con-check2">Considered different forms of consent (e.g., verbal, written, community-level) appropriate for the context.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="con-check3">
                        <label for="con-check3">Ensured participants understand they can withdraw at any time without penalty.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="con-check4">
                        <label for="con-check4">Planned for how to re-seek consent if the research focus changes.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="con-check5">
                        <label for="con-check5">Considered who should be present during the consent process (e.g., a trusted community member).</label>
                    </li>
                </ul>

                 <div class="expandable-panel">
                    <div class="expandable-panel-header" tabindex="0" role="button" aria-expanded="false">
                        Informed, Voluntary, and Ongoing Consent
                    </div>
                    <div class="expandable-panel-content" aria-hidden="true">
                        <p>Informed consent means participants fully understand what they are agreeing to. Voluntary means they feel no pressure to participate. Ongoing means consent is not a one-time event but a continuous process throughout the research relationship.</p>
                    </div>
                </div>

                <button>Save Consent Plan</button>
            </div>

            <div id="observation" class="module-section">
                <h2>Participant Observation</h2>
                <p>Plan your approach to participant observation, considering how your presence might affect interactions and how to minimize intrusion.</p>

                 <h3>Key Considerations Checklist:</h3>
                <ul class="checklist" data-module="observation">
                    <li>
                        <input type="checkbox" id="obs-check1">
                        <label for="obs-check1">Reflected on how my presence might alter the observed setting.</label>
                    </li>
                    <li>
                        <input type="checkbox" id="obs-check2">
                        <label for="obs-check2">Planned strategies to build rapport and become a less intrusive presence.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="obs-check3">
                        <label for="obs-check3">Considered ethical ways to record observations (field notes, photos, etc.).</label>
                    </li>
                     <li>
                        <input type="checkbox" id="obs-check4">
                        <label for="obs-check4">Planned how to debrief or share observations with participants if appropriate.</label>
                    </li>
                </ul>

                 <div class="expandable-panel">
                    <div class="expandable-panel-header" tabindex="0" role="button" aria-expanded="false">
                        Ethical Observation Practices
                    </div>
                    <div class="expandable-panel-content" aria-hidden="true">
                        <p>Participant observation requires careful ethical consideration. Be mindful of privacy in public and private spaces. Always prioritize the well-being and comfort of the community members you are observing. Seek permission where necessary and appropriate.</p>
                    </div>
                </div>

                <button>Save Observation Plan</button>
            </div>

             <div id="interviews" class="module-section">
                <h2>Interviews</h2>
                <p>Plan your interview strategy, focusing on creating a safe space for participants and ensuring their voices are heard authentically.</p>

                 <h3>Key Considerations Checklist:</h3>
                <ul class="checklist" data-module="interviews">
                    <li>
                        <input type="checkbox" id="int-check1">
                        <label for="int-check1">Developed open-ended questions that avoid leading or biased framing.</label>
                    </li>
                    <li>
                        <input type="checkbox" id="int-check2">
                        <label for="int-check2">Planned how to conduct interviews in a comfortable and private setting.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="int-check3">
                        <label for="int-check3">Considered the use of translators and how to ensure accuracy and ethical representation.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="int-check4">
                        <label for="int-check4">Planned how to manage sensitive topics if they arise.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="int-check5">
                        <label for="int-check5">Considered offering participants the chance to review transcripts or findings.</label>
                    </li>
                </ul>

                 <div class="expandable-panel">
                    <div class="expandable-panel-header" tabindex="0" role="button" aria-expanded="false">
                        Conducting Ethical Interviews
                    </div>
                    <div class="expandable-panel-content" aria-hidden="true">
                        <p>Interviews are conversations, not interrogations. Listen actively, be empathetic, and respect silences. Be transparent about how the interview data will be used and stored. Ensure participants feel empowered, not exploited.</p>
                    </div>
                </div>

                <button>Save Interview Plan</button>
            </div>

             <div id="mapping" class="module-section">
                <h2>Community Mapping</h2>
                <p>Plan your approach to community mapping, ensuring it is a collaborative process that empowers the community to represent their own space and knowledge.</p>

                 <h3>Key Considerations Checklist:</h3>
                <ul class="checklist" data-module="mapping">
                    <li>
                        <input type="checkbox" id="map-check1">
                        <label for="map-check1">Planned how to involve community members in the mapping process from the start.</label>
                    </li>
                    <li>
                        <input type="checkbox" id="map-check2">
                        <label for="map-check2">Considered what the community wants to map and why.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="map-check3">
                        <label for="map-check3">Planned how the mapping data will be used and who will have access to it.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="map-check4">
                        <label for="map-check4">Considered potential risks of mapping sensitive information (e.g., sacred sites, resource locations).</label>
                    </li>
                </ul>

                 <div class="expandable-panel">
                    <div class="expandable-panel-header" tabindex="0" role="button" aria-expanded="false">
                        Collaborative Mapping Ethics
                    </div>
                    <div class="expandable-panel-content" aria-hidden="true">
                        <p>Community mapping should be a tool for community empowerment, not just data extraction. The community should lead the process, define what is important to map, and decide how the maps will be used and shared. Be mindful of potential power imbalances in facilitating the process.</p>
                    </div>
                </div>

                <button>Save Mapping Plan</button>
            </div>

            <div id="data-ethics" class="module-section">
                <h2>Data Ethics & Representation</h2>
                <p>Plan how you will manage, store, analyze, and represent your data ethically, ensuring participant anonymity and avoiding misrepresentation.</p>

                 <h3>Key Considerations Checklist:</h3>
                <ul class="checklist" data-module="data-ethics">
                    <li>
                        <input type="checkbox" id="data-check1">
                        <label for="data-check1">Planned for secure storage of data (notes, recordings, maps).</label>
                    </li>
                    <li>
                        <input type="checkbox" id="data-check2">
                        <label for="data-check2">Considered strategies for anonymizing or pseudonymizing data to protect identities.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="data-check3">
                        <label for="data-check3">Planned how to analyze data collaboratively with community members if appropriate.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="data-check4">
                        <label for="data-check4">Reflected on potential biases in data interpretation.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="data-check5">
                        <label for="data-check5">Planned how to represent findings respectfully and accurately, avoiding stereotypes.</label>
                    </li>
                     <li>
                        <input type="checkbox" id="data-check6">
                        <label for="data-check6">Considered how findings will be shared back with the community.</label>
                    </li>
                </ul>

                 <div class="expandable-panel">
                    <div class="expandable-panel-header" tabindex="0" role="button" aria-expanded="false">
                        Ethical Data Management
                    </div>
                    <div class="expandable-panel-content" aria-hidden="true">
                        <p>Data ethics involves more than just storage. It's about respecting the information shared, managing it responsibly, and representing it in a way that honors the source and avoids harm. Consider who owns the data and how it can be used in the future.</p>
                    </div>
                </div>

                <button>Save Data Ethics Plan</button>
            </div>

             <div id="resources" class="module-section">
                <h2>Resources</h2>
                <p>Here are some resources to help you plan your ethical research.</p>

                <div class="resource-list">
                    <ul>
                        <li>
                            <p>Example: American Anthropological Association (AAA) Code of Ethics</p>
                        </li>
                        <li>
                            <p>Example: Principles of Indigenous Data Sovereignty</p>
                        </li>
                         <li>
                            <p>Example: Guide to Decolonizing Methodologies</p>
                        </li>
                         <li>
                            <p>Example: Best Practices for Community-Based Participatory Research</p>
                        </li>
                    </ul>
                </div>
            </div>

             <div id="complete" class="module-section">
                <h2>Planning Complete!</h2>
                <p>Congratulations on completing your ethical research methodology plan. Remember that ethical reflection is an ongoing process throughout your research journey.</p>
                 <p>Review your plans in each section and continue to engage ethically with the community.</p>
            </div>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const moduleSections = document.querySelectorAll('.module-section');
            const checklists = document.querySelectorAll('.checklist');
            const progressSteps = document.querySelectorAll('.progress-step');
            const progressBar = document.querySelector('.progress-bar');

            // Function to show a specific module section
            function showModule(id) {
                moduleSections.forEach(section => {
                    section.classList.remove('active');
                });
                const activeSection = document.getElementById(id);
                if (activeSection) {
                    activeSection.classList.add('active');
                     // Scroll to top of main content
                     activeSection.closest('main').scrollTop = 0;
                }
            }

            // Function to update active navigation link
            function updateNavLink(id) {
                 navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${id}`) {
                        link.classList.add('active');
                    }
                });
            }

            // Function to update progress based on completed checklists per module
            function updateProgress() {
                const modulesWithChecklists = document.querySelectorAll('.module-section .checklist');
                let completedModuleCount = 0;

                modulesWithChecklists.forEach(checklist => {
                    const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
                    if (checkboxes.length > 0) {
                         let allChecked = true;
                         checkboxes.forEach(checkbox => {
                            if (!checkbox.checked) {
                                allChecked = false;
                            }
                         });
                         if (allChecked) {
                             completedModuleCount++;
                             // Mark the corresponding progress step as completed
                             const moduleName = checklist.closest('.module-section').id;
                             progressSteps.forEach(step => {
                                 if (step.dataset.module === moduleName) {
                                     step.classList.add('completed');
                                     step.classList.remove('active'); // Remove active if completed
                                 }
                             });
                         } else {
                              // If a checklist becomes incomplete, unmark the step
                              const moduleName = checklist.closest('.module-section').id;
                              progressSteps.forEach(step => {
                                  if (step.dataset.module === moduleName) {
                                      step.classList.remove('completed');
                                  }
                              });
                         }
                    }
                });

                const totalModulesWithChecklists = modulesWithChecklists.length;
                const progressPercentage = (totalModulesWithChecklists === 0) ? 0 : (completedModuleCount / totalModulesWithChecklists) * 100;

                progressBar.style.width = progressPercentage + '%';
                progressBar.textContent = `${Math.round(progressPercentage)}%`;

                 // Update active step based on current module
                 const activeModuleId = document.querySelector('.module-section.active').id;
                 progressSteps.forEach(step => {
                    step.classList.remove('active');
                    if (step.dataset.module === activeModuleId) {
                        step.classList.add('active');
                    } else if (activeModuleId === 'dashboard' && step.dataset.module === 'dashboard') {
                         step.classList.add('active');
                    } else if (activeModuleId === 'resources' && step.dataset.module === 'resources') {
                         step.classList.add('active');
                    } else if (activeModuleId === 'complete' && step.dataset.module === 'complete') {
                        step.classList.add('active');
                    }
                 });

                 // Mark 'Complete' step if all modules are done
                 if (progressPercentage === 100 && document.getElementById('complete')) {
                     progressSteps.forEach(step => {
                         if (step.dataset.module === 'complete') {
                             step.classList.add('completed');
                         }
                     });
                      // Automatically navigate to 'complete' section if 100% reached?
                      // Optional: show a modal or notification instead. Sticking to navigation for now.
                      // showModule('complete');
                      // updateNavLink('complete');
                 } else {
                      progressSteps.forEach(step => {
                         if (step.dataset.module === 'complete') {
                             step.classList.remove('completed');
                         }
                     });
                 }
            }

            // Handle navigation clicks
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    showModule(targetId);
                    updateNavLink(targetId);
                    updateProgress(); // Update active step on navigation
                });
            });

            // Initial load: show dashboard
            showModule('dashboard');
            updateNavLink('dashboard'); // Ensure dashboard link is active on load

             // Handle checklist clicks - delegated listener
             document.body.addEventListener('change', (e) => {
                 if (e.target.type === 'checkbox' && e.target.closest('.checklist')) {
                     updateProgress();
                 }
             });

            // Handle expandable panel clicks
            document.querySelectorAll('.expandable-panel-header').forEach(header => {
                header.addEventListener('click', () => {
                    const panel = header.closest('.expandable-panel');
                    const content = header.nextElementSibling; // The content div is the next sibling

                    const isExpanded = panel.classList.contains('expanded');

                    panel.classList.toggle('expanded');
                    header.setAttribute('aria-expanded', !isExpanded);

                    if (content) {
                         content.setAttribute('aria-hidden', isExpanded);
                    }
                });
                 // Set initial ARIA state
                 const panel = header.closest('.expandable-panel');
                 const content = header.nextElementSibling;
                 header.setAttribute('aria-expanded', 'false');
                 if (content) {
                    content.setAttribute('aria-hidden', 'true');
                 }
            });

             // Add keyboard support for expandable panels
             document.querySelectorAll('.expandable-panel-header').forEach(header => {
                 header.addEventListener('keydown', (e) => {
                     if (e.key === 'Enter' || e.key === ' ') {
                         e.preventDefault();
                         header.click(); // Simulate click
                     }
                 });
             });


             // Initial progress update
             updateProgress();
        });
    </script>
</body>
</html>
