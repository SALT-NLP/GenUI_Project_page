<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Regression Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --primary-color-dark: #0056b3;
            --secondary-color: #6c757d;
            --background-color: #ffffff;
            --surface-color: #f8f9fa;
            --text-color: #212529;
            --border-color: #dee2e6;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --spacing-unit: 1rem;
            --border-radius: 0.5rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-areas:
                "header header"
                "sidebar main"
                "footer footer";
            grid-template-columns: 250px 1fr; /* Desktop layout */
            grid-template-rows: auto 1fr auto;
            min-height: 100vh;
        }

        header {
            grid-area: header;
            background-color: var(--primary-color);
            color: white;
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 2);
            box-shadow: 0 2px 4px var(--shadow-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        .hamburger-menu {
            display: none; /* Hide on desktop */
            cursor: pointer;
            font-size: 2rem;
        }

        .sidebar {
            grid-area: sidebar;
            background-color: var(--surface-color);
            padding: var(--spacing-unit);
            border-right: 1px solid var(--border-color);
            position: sticky;
            top: 80px; /* Adjust based on header height */
            height: calc(100vh - 80px); /* Adjust based on header height */
            overflow-y: auto;
            box-shadow: 2px 0 4px var(--shadow-color);
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar nav a {
            display: block;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--text-color);
            border-radius: var(--border-radius);
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .sidebar nav a:hover {
            background-color: var(--border-color);
        }

        .sidebar nav a.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        main.content {
            grid-area: main;
            padding: calc(var(--spacing-unit) * 2);
            overflow-y: auto;
        }

        section {
            margin-bottom: calc(var(--spacing-unit) * 3);
            padding-bottom: calc(var(--spacing-unit) * 2);
            border-bottom: 1px solid var(--border-color);
        }

        section:last-child {
            border-bottom: none;
        }

        h2 {
            color: var(--primary-color-dark);
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 1.5);
            font-size: 1.6rem;
        }

        .panel {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-unit);
            box-shadow: 0 1px 3px var(--shadow-color);
            overflow: hidden;
        }

        .panel-header {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            background-color: #e9ecef;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }

        .panel-header:hover {
            background-color: #dee2e6;
        }

        .panel-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .panel-header .chevron {
            width: 1.2rem;
            height: 1.2rem;
            transition: transform 0.3s ease;
        }

        .panel-header[aria-expanded="true"] .chevron {
            transform: rotate(180deg);
        }

        .panel-body {
            padding: 0 calc(var(--spacing-unit) * 1.5);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out;
        }

        .panel-body.expanded {
            max-height: 1000px; /* Sufficiently large value */
            padding-top: var(--spacing-unit);
            padding-bottom: var(--spacing-unit);
        }

        .panel-body p {
            margin-bottom: var(--spacing-unit);
        }

        .panel-body p:last-child {
            margin-bottom: 0;
        }

        .interactive-area,
        .results-area {
            margin-top: calc(var(--spacing-unit) * 2);
            padding: calc(var(--spacing-unit) * 1.5);
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: 0 1px 3px var(--shadow-color);
        }

        .input-group {
            display: flex;
            gap: var(--spacing-unit);
            margin-bottom: var(--spacing-unit);
            align-items: flex-end;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }

        .input-group input[type="number"] {
            flex-grow: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .input-group input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        button {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s ease, opacity 0.2s ease;
        }

        button:hover {
            background-color: var(--primary-color-dark);
        }

        button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .visualization-container {
            margin-top: calc(var(--spacing-unit) * 2);
            position: relative; /* Needed for floating controls */
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-unit);
            box-shadow: 0 1px 3px var(--shadow-color);
            height: 400px; /* Fixed height for chart */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chart-canvas {
             max-width: 100%;
             max-height: 100%;
        }


        .floating-controls {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            background: rgba(255, 255, 255, 0.95);
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px var(--shadow-color);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }

        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

         .control-group {
            margin-bottom: var(--spacing-unit);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .control-group input[type="color"] {
            padding: 0.25rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            height: 38px; /* Match button/input height */
        }


        .results-area p {
            margin: 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .glossary dl {
            display: grid;
            grid-template-columns: max-content 1fr;
            gap: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
        }

        .glossary dt {
            font-weight: 700;
            grid-column: 1;
            color: var(--primary-color-dark);
        }

        .glossary dd {
            grid-column: 2;
            margin: 0;
        }


        footer {
            grid-area: footer;
            background-color: var(--surface-color);
            color: var(--secondary-color);
            text-align: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        /* Mobile Navigation Overlay */
        .mobile-nav-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            transition: opacity 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }

        .mobile-nav-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .mobile-nav {
            position: fixed;
            top: 0;
            left: -300px; /* Off-screen */
            width: 280px;
            height: 100%;
            background-color: var(--surface-color);
            padding: var(--spacing-unit);
            box-shadow: 4px 0 8px var(--shadow-color);
            transition: left 0.3s ease;
            z-index: 1002;
            display: flex;
            flex-direction: column;
        }

        .mobile-nav.active {
            left: 0;
        }

        .mobile-nav .close-btn {
            align-self: flex-end;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-color);
            padding: 0;
            margin-bottom: var(--spacing-unit);
        }

         .mobile-nav nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .mobile-nav nav li {
            margin-bottom: 0.5rem;
        }

        .mobile-nav nav a {
            display: block;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--text-color);
            border-radius: var(--border-radius);
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .mobile-nav nav a:hover {
            background-color: var(--border-color);
        }

        .mobile-nav nav a.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }


        /* Responsive Adjustments */
        @media (max-width: 768px) {
            body {
                grid-template-areas:
                    "header"
                    "main"
                    "footer";
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }

            .sidebar {
                display: none; /* Hide sidebar on mobile */
            }

            .hamburger-menu {
                display: block; /* Show hamburger on mobile */
            }

            main.content {
                padding: var(--spacing-unit);
            }

            .input-group {
                flex-direction: column;
                gap: 0.5rem;
            }

            .input-group input[type="number"] {
                width: 100%;
            }

            button {
                width: 100%;
            }

            .glossary dl {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .glossary dt, .glossary dd {
                grid-column: 1;
            }

            .glossary dt {
                margin-top: var(--spacing-unit);
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Regression Analysis Explorer</h1>
        <div class="hamburger-menu" id="hamburgerMenu">&#9776;</div>
    </header>

    <aside class="sidebar" id="sidebar">
        <nav>
            <ul>
                <li><a href="#introduction" class="nav-link active">Introduction</a></li>
                <li><a href="#linear-regression" class="nav-link">Simple Linear Regression</a></li>
                <li><a href="#key-concepts" class="nav-link">Key Concepts</a></li>
                <li><a href="#visualization" class="nav-link">Interactive Visualization</a></li>
                <li><a href="#glossary" class="nav-link">Glossary</a></li>
            </ul>
        </nav>
    </aside>

    <main class="content">
        <section id="introduction">
            <h2>Introduction to Regression Analysis</h2>
            <div class="panel" role="region" aria-labelledby="intro-heading">
                <div class="panel-header" role="button" aria-expanded="false" aria-controls="intro-body" id="intro-heading" tabindex="0">
                    <h3>What is Regression Analysis?</h3>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.0006L7.75736 10.758L9.17157 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"></path></svg>
                </div>
                <div class="panel-body" id="intro-body" aria-hidden="true">
                    <p>Regression analysis is a statistical method used to determine the strength of the relationship between one dependent variable (usually denoted by Y) and one or more independent variables (usually denoted by X). It helps us understand how the dependent variable changes when any one of the independent variables is varied, while the other independent variables are held fixed.</p>
                    <p>The primary goal of regression analysis is to build a model that can predict the value of the dependent variable based on the values of the independent variables. It's widely used in various fields like economics, finance, social sciences, engineering, and machine learning.</p>
                </div>
            </div>
             <div class="panel" role="region" aria-labelledby="purpose-heading">
                <div class="panel-header" role="button" aria-expanded="false" aria-controls="purpose-body" id="purpose-heading" tabindex="0">
                    <h3>Purpose and Use Cases</h3>
                     <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.0006L7.75736 10.758L9.17157 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"></path></svg>
                </div>
                <div class="panel-body" id="purpose-body" aria-hidden="true">
                    <p>Regression analysis serves several key purposes:</p>
                    <ul>
                        <li>**Forecasting:** Predicting future values (e.g., sales based on advertising spend).</li>
                        <li>**Modeling Relationships:** Quantifying the strength and direction of relationships between variables (e.g., how does education level relate to income?).</li>
                        <li>**Identifying Drivers:** Determining which independent variables have a significant impact on the dependent variable.</li>
                        <li>**Optimization:** Finding the optimal levels of independent variables to achieve a desired outcome for the dependent variable.</li>
                    </ul>
                    <p>Common use cases include predicting stock prices, analyzing the impact of policy changes, understanding customer behavior, and forecasting demand.</p>
                </div>
            </div>
        </section>

        <section id="linear-regression">
            <h2>Simple Linear Regression</h2>
            <div class="panel" role="region" aria-labelledby="simple-linear-heading">
                <div class="panel-header" role="button" aria-expanded="false" aria-controls="simple-linear-body" id="simple-linear-heading" tabindex="0">
                    <h3>Understanding Simple Linear Regression</h3>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.0006L7.75736 10.758L9.17157 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"></path></svg>
                </div>
                <div class="panel-body" id="simple-linear-body" aria-hidden="true">
                    <p>Simple linear regression is the most basic form of regression analysis, involving only one independent variable (X) and one dependent variable (Y). The goal is to find a linear equation that best describes the relationship between X and Y.</p>
                    <p>The equation for a simple linear regression model is typically written as:</p>
                    <p><code>Y = β₀ + β₁X + ε</code></p>
                    <p>Where:</p>
                    <ul>
                        <li><code>Y</code> is the dependent variable.</li>
                        <li><code>X</code> is the independent variable.</li>
                        <li><code>β₀</code> (Beta-zero) is the Y-intercept, the expected mean value of Y when X is 0.</li>
                        <li><code>β₁</code> (Beta-one) is the slope, representing the change in Y for a one-unit increase in X.</li>
                        <li><code>ε</code> (Epsilon) is the error term, representing the part of Y that the linear model cannot explain.</li>
                    </ul>
                    <p>The process of simple linear regression involves finding the values of β₀ and β₁ that minimize the sum of the squared differences between the actual Y values and the Y values predicted by the line (this is known as the method of Least Squares).</p>
                </div>
            </div>
        </section>

        <section id="key-concepts">
            <h2>Key Concepts</h2>
            <div class="panel" role="region" aria-labelledby="variables-heading">
                <div class="panel-header" role="button" aria-expanded="false" aria-controls="variables-body" id="variables-heading" tabindex="0">
                    <h3>Independent and Dependent Variables</h3>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.0006L7.75736 10.758L9.17157 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"></path></svg>
                </div>
                <div class="panel-body" id="variables-body" aria-hidden="true">
                    <p>In regression analysis, we distinguish between two main types of variables:</p>
                    <ul>
                        <li>**Dependent Variable (Response Variable):** This is the variable you are trying to predict or explain. Its value depends on the independent variable(s). In the equation <code>Y = β₀ + β₁X + ε</code>, Y is the dependent variable.</li>
                        <li>**Independent Variable (Predictor Variable):** This is the variable used to predict or explain the dependent variable. Its value is assumed to be independent of the dependent variable. In the equation <code>Y = β₀ + β₁X + ε</code>, X is the independent variable.</li>
                    </ul>
                    <p>Think of it as cause and effect, though correlation does not imply causation. The independent variable is the potential "cause" or predictor, and the dependent variable is the potential "effect" or outcome.</p>
                </div>
            </div>
             <div class="panel" role="region" aria-labelledby="slope-intercept-heading">
                <div class="panel-header" role="button" aria-expanded="false" aria-controls="slope-intercept-body" id="slope-intercept-heading" tabindex="0">
                    <h3>Slope and Intercept</h3>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.0006L7.75736 10.758L9.17157 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"></path></svg>
                </div>
                <div class="panel-body" id="slope-intercept-body" aria-hidden="true">
                    <p>These are the key parameters of the linear regression line:</p>
                    <ul>
                        <li>**Intercept (β₀):** This is the point where the regression line crosses the Y-axis. It represents the predicted value of the dependent variable when the independent variable is zero. In some contexts, an intercept of zero might be expected or required; in others, it might not have a meaningful interpretation if the independent variable can never be zero.</li>
                        <li>**Slope (β₁):** This indicates the steepness and direction of the regression line. It tells us how much the dependent variable is expected to change for every one-unit increase in the independent variable. A positive slope means Y increases as X increases, a negative slope means Y decreases as X increases, and a slope near zero suggests little to no linear relationship.</li>
                    </ul>
                </div>
            </div>
             <div class="panel" role="region" aria-labelledby="residuals-heading">
                <div class="panel-header" role="button" aria-expanded="false" aria-controls="residuals-body" id="residuals-heading" tabindex="0">
                    <h3>Residuals</h3>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.0006L7.75736 10.758L9.17157 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"></path></svg>
                </div>
                <div class="panel-body" id="residuals-body" aria-hidden="true">
                    <p>A residual is the difference between the actual observed value of the dependent variable (Y) and the value predicted by the regression line (Ŷ, pronounced "Y-hat").</p>
                    <p><code>Residual = Actual Y - Predicted Ŷ</code></p>
                    <p>Residuals represent the errors in the model's prediction. The goal of the least squares method is to find the line that minimizes the sum of the squared residuals. Analyzing residuals is crucial for checking the assumptions of the regression model.</p>
                </div>
            </div>
             <div class="panel" role="region" aria-labelledby="r-squared-heading">
                <div class="panel-header" role="button" aria-expanded="false" aria-controls="r-squared-body" id="r-squared-heading" tabindex="0">
                    <h3>R-squared (Coefficient of Determination)</h3>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.0006L7.75736 10.758L9.17157 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"></path></svg>
                </div>
                <div class="panel-body" id="r-squared-body" aria-hidden="true">
                    <p>R-squared is a statistical measure that represents the proportion of the variance in the dependent variable that is predictable from the independent variable(s).</p>
                    <p>It is a value between 0 and 1 (or 0% and 100%):</p>
                    <ul>
                        <li>An R-squared of 0 means the model explains none of the variability of the dependent variable around its mean.</li>
                        <li>An R-squared of 1 means the model explains all the variability of the dependent variable around its mean.</li>
                    </ul>
                    <p>In simple terms, R-squared tells us how well the regression line fits the data points. A higher R-squared generally indicates a better fit, but it's important to consider other factors and not rely solely on R-squared.</p>
                </div>
            </div>
        </section>

        <section id="visualization">
            <h2>Interactive Linear Regression Visualization</h2>
            <p>Add your own data points (X, Y) below and click "Add Data Point" to see them appear on the scatter plot. Then, click "Calculate Regression Line" to find the best-fitting line and see the equation and R-squared value.</p>

            <div class="interactive-area">
                <h3>Add Data Points</h3>
                <div class="input-group">
                    <div>
                        <label for="input-x">X Value:</label>
                        <input type="number" id="input-x" value="1">
                    </div>
                    <div>
                        <label for="input-y">Y Value:</label>
                        <input type="number" id="input-y" value="2">
                    </div>
                    <button id="add-data-point">Add Data Point</button>
                </div>
                 <button id="calculate-regression">Calculate Regression Line</button>
            </div>

            <div class="visualization-container">
                <canvas id="regressionChart" class="chart-canvas"></canvas>
                 <div class="floating-controls" id="chart-controls">
                    <div class="control-group">
                        <label for="point-color">Point Color</label>
                        <input type="color" id="point-color" value="#007bff">
                    </div>
                    <div class="control-group">
                        <label for="line-color">Line Color</label>
                        <input type="color" id="line-color" value="#dc3545">
                    </div>
                 </div>
            </div>

            <div class="results-area">
                <h3>Results</h3>
                <p id="regression-equation">Equation: Y = mX + b</p>
                <p id="r-squared-value">R-squared: --</p>
            </div>
        </section>

        <section id="glossary">
            <h2>Glossary</h2>
            <dl>
                <dt>Dependent Variable (Y)</dt>
                <dd>The variable whose value is being predicted or explained.</dd>

                <dt>Independent Variable (X)</dt>
                <dd>The variable used to predict or explain the dependent variable.</dd>

                <dt>Regression Line</dt>
                <dd>The line that best describes the linear relationship between the independent and dependent variables.</dd>

                <dt>Intercept (β₀)</dt>
                <dd>The predicted value of the dependent variable when the independent variable is zero; where the regression line crosses the Y-axis.</dd>

                <dt>Slope (β₁)</dt>
                <dd>The expected change in the dependent variable for a one-unit increase in the independent variable; the steepness of the regression line.</dd>

                <dt>Residual</dt>
                <dd>The difference between an observed value and the value predicted by the regression model.</dd>

                <dt>Least Squares Method</dt>
                <dd>A method used to find the regression line that minimizes the sum of the squared residuals.</dd>

                <dt>R-squared</dt>
                <dd>A measure (between 0 and 1) indicating the proportion of the variance in the dependent variable that is predictable from the independent variable(s).</dd>
            </dl>
        </section>
    </main>

    <footer>
        <p>&copy; 2023 Regression Analysis Explorer. All rights reserved.</p>
    </footer>

    <!-- Mobile Navigation Overlay -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay">
        <div class="mobile-nav" id="mobileNav">
            <button class="close-btn" id="closeMobileNav">&times;</button>
             <nav>
                <ul>
                    <li><a href="#introduction" class="nav-link active">Introduction</a></li>
                    <li><a href="#linear-regression" class="nav-link">Simple Linear Regression</a></li>
                    <li><a href="#key-concepts" class="nav-link">Key Concepts</a></li>
                    <li><a href="#visualization" class="nav-link">Interactive Visualization</a></li>
                    <li><a href="#glossary" class="nav-link">Glossary</a></li>
                </ul>
            </nav>
        </div>
    </div>


    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // --- Data and State ---
        let dataPoints = [];
        let regressionChart = null;
        let regressionLine = null; // Store the regression line dataset

        // --- DOM Elements ---
        const navLinks = document.querySelectorAll('.nav-link');
        const panels = document.querySelectorAll('.panel');
        const inputX = document.getElementById('input-x');
        const inputY = document.getElementById('input-y');
        const addDataButton = document.getElementById('add-data-point');
        const calculateButton = document.getElementById('calculate-regression');
        const regressionEquation = document.getElementById('regression-equation');
        const rSquaredValue = document.getElementById('r-squared-value');
        const chartCanvas = document.getElementById('regressionChart');
        const chartControls = document.getElementById('chart-controls');
        const pointColorInput = document.getElementById('point-color');
        const lineColorInput = document.getElementById('line-color');

        // Mobile Nav
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const mobileNavOverlay = document.getElementById('mobileNavOverlay');
        const mobileNav = document.getElementById('mobileNav');
        const closeMobileNav = document.getElementById('closeMobileNav');


        // --- Utility Functions ---

        // Calculate linear regression (Least Squares Method)
        function calculateLinearRegression(data) {
            if (data.length < 2) {
                return { slope: NaN, intercept: NaN, rSquared: NaN };
            }

            const n = data.length;
            let sumX = 0;
            let sumY = 0;
            let sumXY = 0;
            let sumXX = 0;
            let sumYY = 0;

            data.forEach(point => {
                sumX += point.x;
                sumY += point.y;
                sumXY += point.x * point.y;
                sumXX += point.x * point.x;
                sumYY += point.y * point.y;
            });

            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            // Calculate R-squared
            const ssTotal = sumYY - (sumY * sumY) / n;
            const ssResidual = data.reduce((sum, point) => {
                const predictedY = intercept + slope * point.x;
                return sum + Math.pow(point.y - predictedY, 2);
            }, 0);
            const ssRegression = ssTotal - ssResidual;
            const rSquared = ssTotal === 0 ? 1 : ssRegression / ssTotal; // Handle case where all Y values are the same

            return { slope, intercept, rSquared };
        }

        // Generate points for the regression line
        function getRegressionLinePoints(data, slope, intercept) {
             if (isNaN(slope) || isNaN(intercept) || data.length === 0) {
                 return [];
             }
            const minX = Math.min(...data.map(p => p.x));
            const maxX = Math.max(...data.map(p => p.x));

            // Add a small buffer to the min/max X for the line
             const buffer = (maxX - minX) * 0.1;
             const startX = minX - buffer;
             const endX = maxX + buffer;

            return [
                { x: startX, y: intercept + slope * startX },
                { x: endX, y: intercept + slope * endX }
            ];
        }


        // --- Chart Initialization and Updates ---

        function initializeChart() {
            const ctx = chartCanvas.getContext('2d');
            regressionChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Data Points',
                        data: [], // Initial empty data
                        backgroundColor: pointColorInput.value,
                        borderColor: pointColorInput.value,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        showLine: false, // Don't connect scatter points
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `(X: ${point.x.toFixed(2)}, Y: ${point.y.toFixed(2)})`;
                                }
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Independent Variable (X)',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        y: {
                            type: 'linear',
                             title: {
                                display: true,
                                text: 'Dependent Variable (Y)',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            mode: 'nearest',
                            intersect: false,
                        }
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                     onClick: (e) => showChartControls(e), // Show controls on chart click
                     layout: {
                         padding: {
                             right: 100 // Make space for controls
                         }
                     }
                }
            });
        }

        function updateChart() {
            // Update scatter points
            regressionChart.data.datasets[0].data = dataPoints;
            regressionChart.data.datasets[0].backgroundColor = pointColorInput.value;
            regressionChart.data.datasets[0].borderColor = pointColorInput.value;


            // Update or remove regression line
            if (regressionLine) {
                const lineIndex = regressionChart.data.datasets.indexOf(regressionLine);
                if (lineIndex > -1) {
                     regressionChart.data.datasets.splice(lineIndex, 1); // Remove old line
                }
                regressionLine = null; // Clear stored line
            }

            // If there's calculated regression data, add the line dataset
             const { slope, intercept, rSquared } = calculateLinearRegression(dataPoints);

             if (!isNaN(slope) && dataPoints.length >= 2) {
                 const linePoints = getRegressionLinePoints(dataPoints, slope, intercept);
                 regressionLine = {
                     label: 'Regression Line',
                     data: linePoints,
                     borderColor: lineColorInput.value,
                     backgroundColor: lineColorInput.value, // Use same color for consistency
                     borderWidth: 2,
                     pointRadius: 0, // Hide points on the line
                     fill: false,
                     type: 'line', // Explicitly set type to line
                     tooltip: { enabled: false } // Disable tooltips for the line
                 };
                 regressionChart.data.datasets.push(regressionLine);

                 // Update results display
                 regressionEquation.textContent = `Equation: Y = ${slope.toFixed(3)}X + ${intercept.toFixed(3)}`;
                 rSquaredValue.textContent = `R-squared: ${rSquared.toFixed(4)}`;

             } else {
                 // Clear results display if no valid regression
                 regressionEquation.textContent = 'Equation: Y = mX + b';
                 rSquaredValue.textContent = 'R-squared: --';
             }


            regressionChart.update(); // Animate chart update
        }


        // --- Event Handlers ---

        // Smooth scrolling for navigation
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);

                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 90, // Adjust for fixed header height
                        behavior: 'smooth'
                    });

                    // Update active class
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    // Close mobile nav if open
                    if (mobileNavOverlay.classList.contains('active')) {
                        toggleMobileNav();
                    }
                }
            });
        });

        // Collapsible Panels
        panels.forEach(panel => {
            const header = panel.querySelector('.panel-header');
            const body = panel.querySelector('.panel-body');
            const chevron = panel.querySelector('.chevron');

            const togglePanel = () => {
                const isExpanded = header.getAttribute('aria-expanded') === 'true';
                header.setAttribute('aria-expanded', !isExpanded);
                body.setAttribute('aria-hidden', isExpanded);
                body.classList.toggle('expanded', !isExpanded);
                // Chevron rotation handled by CSS
            };

            header.addEventListener('click', togglePanel);
             // Add keyboard support for accessibility
            header.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    togglePanel();
                }
            });
        });

        // Add Data Point
        addDataButton.addEventListener('click', () => {
            const x = parseFloat(inputX.value);
            const y = parseFloat(inputY.value);

            if (!isNaN(x) && !isNaN(y)) {
                dataPoints.push({ x, y });
                updateChart();
                // Clear inputs after adding
                inputX.value = '';
                inputY.value = '';
                inputX.focus(); // Focus back to X input
            } else {
                alert('Please enter valid numbers for X and Y.');
            }
        });

        // Calculate Regression
        calculateButton.addEventListener('click', () => {
            // Calculation and display handled within updateChart
            updateChart();
        });

        // Chart Control visibility
        function showChartControls(event) {
            // Check if the click was inside the chart canvas itself, not just the container
            const rect = chartCanvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
                 chartControls.classList.add('active');
            }
        }

        // Close control panel when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.floating-controls') &&
                !e.target.closest('.visualization-container')) { // Keep open if clicking on chart container
                chartControls.classList.remove('active');
            }
        });

        // Update chart colors from controls
        pointColorInput.addEventListener('input', () => {
             if (regressionChart && regressionChart.data.datasets.length > 0) {
                 regressionChart.data.datasets[0].backgroundColor = pointColorInput.value;
                 regressionChart.data.datasets[0].borderColor = pointColorInput.value;
                 regressionChart.update();
             }
        });

         lineColorInput.addEventListener('input', () => {
             if (regressionChart && regressionLine) {
                 regressionLine.borderColor = lineColorInput.value;
                 regressionLine.backgroundColor = lineColorInput.value; // Keep consistent
                 regressionChart.update();
             }
        });


        // Mobile Navigation Toggle
        function toggleMobileNav() {
            mobileNavOverlay.classList.toggle('active');
            mobileNav.classList.toggle('active');
        }

        hamburgerMenu.addEventListener('click', toggleMobileNav);
        closeMobileNav.addEventListener('click', toggleMobileNav);
        // Close mobile nav when clicking overlay
        mobileNavOverlay.addEventListener('click', (e) => {
            if (e.target === mobileNavOverlay) {
                toggleMobileNav();
            }
        });


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeChart();
            // Add some initial data points for demonstration
            dataPoints = [
                { x: 1, y: 2 },
                { x: 2, y: 4 },
                { x: 3, y: 5 },
                { x: 4, y: 4 },
                { x: 5, y: 5 }
            ];
            updateChart(); // Draw initial chart and regression line
        });

        // Update active nav link on scroll (optional but nice)
        window.addEventListener('scroll', () => {
            let current = '';
            document.querySelectorAll('section').forEach(section => {
                const sectionTop = section.offsetTop - 100; // Adjust offset
                if (scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === current) {
                    link.classList.add('active');
                }
            });
             mobileNav.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === current) {
                    link.classList.add('active');
                }
            });
        });

    </script>
</body>
</html>
