<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EngageMail - Newsletter Mastery</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --primary-color: #007bff;
            --primary-color-dark: #0056b3;
            --secondary-color: #6c757d;
            --secondary-color-dark: #5a6268;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-color: #343a40;
            --text-light-color: #6c757d;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --spacing-unit: 8px;
            --header-height: 60px;
            --sidebar-width: 250px;
            --border-radius: 8px;
            --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            --transition-speed: 0.2s ease-in-out;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-y: hidden; /* Prevent main body scroll */
        }

        header {
            background-color: var(--surface-color);
            color: var(--text-color);
            padding: 0 calc(var(--spacing-unit) * 3);
            height: var(--header-height);
            display: flex;
            align-items: center;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-shrink: 0;
        }

        header h1 {
            margin: 0;
            font-size: 1.5em;
            font-weight: 700;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden; /* Prevent container scroll */
        }

        aside {
            width: var(--sidebar-width);
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3) 0;
            box-shadow: var(--box-shadow);
            flex-shrink: 0;
            overflow-y: auto; /* Allow sidebar scroll */
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        nav li {
            margin-bottom: var(--spacing-unit);
        }

        nav a {
            display: flex;
            align-items: center;
            padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 3);
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            transition: background-color var(--transition-speed), color var(--transition-speed);
            border-left: 4px solid transparent;
            outline: none; /* Remove default outline */
        }

        nav a:hover {
            background-color: var(--background-color);
        }

        nav a:focus {
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5); /* Focus indicator */
        }

        nav a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.1);
        }

        nav a span.material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 1.2em;
        }

        main {
            flex: 1;
            padding: calc(var(--spacing-unit) * 4);
            overflow-y: auto; /* Allow main content scroll */
            transition: opacity var(--transition-speed);
        }

        .content-section {
            display: none;
            opacity: 0;
            transition: opacity var(--transition-speed);
        }

        .content-section.active {
            display: block;
            opacity: 1;
        }

        h2 {
            font-size: 2em;
            margin-bottom: calc(var(--spacing-unit) * 3);
            color: var(--text-color);
            font-weight: 700;
        }

        h3 {
            font-size: 1.5em;
            margin-top: calc(var(--spacing-unit) * 4);
            margin-bottom: calc(var(--spacing-unit) * 2);
            color: var(--text-color);
            font-weight: 600;
        }

        p {
            margin-bottom: calc(var(--spacing-unit) * 2);
            color: var(--text-light-color);
        }

        ul {
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-left: calc(var(--spacing-unit) * 3);
            list-style: disc;
        }

        li {
            margin-bottom: var(--spacing-unit);
            color: var(--text-light-color);
        }

        .card {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1em;
            color: var(--text-color);
            background-color: var(--background-color);
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            outline: none;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
        }

        button {
            display: inline-flex; /* Use flex for icon alignment */
            align-items: center;
            justify-content: center;
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 3);
            font-size: 1em;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), opacity var(--transition-speed), box-shadow var(--transition-speed);
            outline: none; /* Remove default outline */
        }

        button .material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 1.2em;
        }

        button:focus {
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5); /* Focus indicator */
        }


        button.primary {
            background-color: var(--primary-color);
            color: white;
        }

        button.primary:hover {
            background-color: var(--primary-color-dark);
        }

        button.secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        button.secondary:hover {
            background-color: var(--secondary-color-dark);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .interactive-example {
            background-color: #e9ecef;
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            margin-top: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .interactive-example textarea {
            background-color: var(--surface-color);
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .analysis-results {
            margin-top: calc(var(--spacing-unit) * 4);
            padding-top: calc(var(--spacing-unit) * 4);
            border-top: 1px solid var(--border-color);
        }

        .analysis-results h3 {
            margin-top: 0;
        }

        .result-item {
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .result-item label {
            display: block; /* Ensure label is on its own line */
            margin-bottom: var(--spacing-unit);
            font-weight: 700;
        }

        .result-value {
            background-color: var(--background-color);
            padding: calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; /* Monospaced for code/text analysis */
        }

        .progress-bar {
            height: calc(var(--spacing-unit) * 2);
            background-color: var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-top: var(--spacing-unit);
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width var(--transition-speed), background-color var(--transition-speed);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            border-bottom: 1px dotted var(--text-light-color); /* Indicate it's interactive */
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-color);
            color: var(--surface-color);
            text-align: center;
            border-radius: var(--border-radius);
            padding: var(--spacing-unit);
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the text */
            left: 50%;
            margin-left: -100px; /* Center the tooltip */
            opacity: 0;
            transition: opacity var(--transition-speed);
            font-size: 0.9em;
            line-height: 1.4;
        }

         .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--text-color) transparent transparent transparent;
        }


        .tooltip:hover .tooltiptext,
        .tooltip:focus .tooltiptext { /* Add focus state for accessibility */
            visibility: visible;
            opacity: 1;
        }

        footer {
            background-color: var(--surface-color);
            color: var(--text-light-color);
            text-align: center;
            padding: calc(var(--spacing-unit) * 3);
            margin-top: auto; /* Push footer to the bottom */
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity var(--transition-speed);
        }

        .modal-content {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 4);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            position: relative;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform var(--transition-speed), opacity var(--transition-speed);
            outline: none; /* Allow focusing modal content */
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-close {
            position: absolute;
            top: calc(var(--spacing-unit) * 2);
            right: calc(var(--spacing-unit) * 2);
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-light-color);
            background: none; /* Remove button default style */
            border: none; /* Remove button default style */
            padding: 0; /* Remove button default style */
            line-height: 1;
            outline: none;
            transition: color var(--transition-speed);
        }

        .modal-close:hover {
            color: var(--text-color);
        }

         .modal-close:focus {
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5); /* Focus indicator */
             border-radius: var(--border-radius);
         }


        .modal-content h3 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        /* Accessibility */
        [aria-hidden="true"] {
             display: none;
        }

        /* Focus styles for skip link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-color);
            color: white;
            padding: var(--spacing-unit);
            z-index: 2001;
            text-decoration: none;
            transition: top var(--transition-speed);
        }

        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>

    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header role="banner">
        <h1>EngageMail</h1>
    </header>

    <div class="container">
        <aside role="complementary" aria-label="Main Navigation">
            <nav>
                <ul>
                    <li><a href="#learn" class="nav-link active" data-section="learn" aria-current="page">
                         <span class="material-symbols-rounded" aria-hidden="true">school</span> Learn
                    </a></li>
                    <li><a href="#draft" class="nav-link" data-section="draft">
                        <span class="material-symbols-rounded" aria-hidden="true">edit</span> Draft
                    </a></li>
                    <li><a href="#analyze" class="nav-link" data-section="analyze">
                        <span class="material-symbols-rounded" aria-hidden="true">analytics</span> Analyze
                    </a></li>
                </ul>
            </nav>
        </aside>

        <main role="main" id="main-content">
            <section id="learn" class="content-section active" aria-labelledby="learn-heading">
                <h2 id="learn-heading">Mastering Email Newsletters</h2>
                <div class="card">
                    <h3>Why Email Newsletters Matter</h3>
                    <p>Email newsletters are a powerful tool for building relationships, driving traffic, and promoting your brand. Unlike social media, you own your email list, giving you direct access to your audience without algorithm interference.</p>
                    <p>An engaging newsletter keeps subscribers interested, builds trust, and encourages action. This section will guide you through the key principles.</p>
                </div>

                <div class="card">
                    <h3>Crafting Compelling Subject Lines</h3>
                    <p>The subject line is the first thing subscribers see. It needs to be concise, intriguing, and relevant to the content inside. A good subject line increases open rates.</p>
                    <ul>
                        <li>Keep it short (under 50 characters is often recommended) for mobile readability.</li>
                        <li>Use clear and specific language that sets expectations.</li>
                        <li>Create urgency or curiosity (use sparingly and genuinely).</li>
                        <li>Personalize when possible using the subscriber's name or relevant data.</li>
                        <li>Avoid <span class="tooltip" tabindex="0" role="tooltip" aria-label="Spam trigger words include terms like 'free money', 'win', 'urgent', 'act now' which can flag filters.">spam trigger words<span class="tooltiptext">Words like "free money", "win", "urgent", "act now" can flag filters.</span></span> and excessive punctuation (like multiple exclamation points).</li>
                        <li>Consider using relevant emojis to stand out (test with your audience).</li>
                    </ul>
                    <p><strong>Interactive Example:</strong> Try writing a few subject lines for a hypothetical newsletter about productivity tips. See how they look below.</p>
                    <div class="interactive-example">
                        <div class="form-group">
                            <label for="subjectLineInput">Draft Subject Lines (one per line):</label>
                            <textarea id="subjectLineInput" rows="4" placeholder="e.g., Boost Your Productivity Today!" aria-describedby="subject-line-input-help"></textarea>
                            <small id="subject-line-input-help" class="form-text text-muted">Enter each subject line on a new line.</small>
                        </div>
                        <button class="primary" onclick="updateSubjectLinePreview()">
                            <span class="material-symbols-rounded" aria-hidden="true">visibility</span> See Preview
                        </button>
                        <div style="margin-top: calc(var(--spacing-unit) * 2);">
                            <strong>Preview:</strong>
                            <p id="subjectLinePreview" style="font-style: italic; color: var(--primary-color);" aria-live="polite">Type subject lines above to see preview</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Writing Engaging Body Content</h3>
                    <p>Once opened, the body content needs to hold attention. Use clear, scannable text, compelling visuals, and a clear call to action (CTA).</p>
                    <ul>
                        <li>Start with a strong hook that grabs attention immediately.</li>
                        <li>Use short paragraphs and sentences to improve readability.</li>
                        <li>Break up text with headings, bullet points, and relevant images or GIFs.</li>
                        <li>Maintain a consistent, authentic tone of voice.</li>
                        <li>Focus on providing value to the subscriber â€“ educate, entertain, or solve a problem.</li>
                        <li>Tell a story to connect emotionally with your audience.</li>
                        <li>Include a single, clear Call to Action (CTA) that tells the reader exactly what to do next.</li>
                        <li>Place your CTA strategically where it's easy to find.</li>
                    </ul>
                    <p><strong>Interactive Tip:</strong> Think about your last newsletter. Was the main point clear? Was the CTA obvious?</p>
                </div>

                 <div class="card">
                    <h3>Audience Segmentation & Personalization</h3>
                    <p>Sending the same email to everyone on your list is less effective than tailoring your message. Segmenting your audience allows you to send more relevant content.</p>
                    <ul>
                        <li>Divide your list based on demographics, interests, purchase history, or engagement level.</li>
                        <li>Use merge tags to personalize greetings (e.g., "Hi [Name]").</li>
                        <li>Tailor content blocks or entire emails based on segment interests.</li>
                        <li>Personalized emails have significantly higher open and click-through rates.</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>Design and Formatting</h3>
                    <p>A clean, visually appealing design enhances readability and professionalism. Use your brand's colors and fonts consistently.</p>
                    <ul>
                        <li>Use a mobile-responsive template that looks good on all devices.</li>
                        <li>Ensure sufficient line spacing and paragraph breaks for easy scanning.</li>
                        <li>Use high-quality images (optimize file size for fast loading).</li>
                        <li>Make sure links and buttons are clearly visible and clickable, especially on mobile.</li>
                        <li>Maintain consistent branding (logo, colors, fonts) across all emails.</li>
                    </ul>
                </div>

                 <div class="card">
                    <h3>Testing and Optimization</h3>
                    <p>The best way to improve engagement is to test what works for your specific audience.</p>
                    <ul>
                        <li>Conduct A/B tests on subject lines, CTAs, content, and send times.</li>
                        <li>Monitor key metrics: Open Rate, Click-Through Rate (CTR), Conversion Rate, Unsubscribe Rate.</li>
                        <li>Use the insights from your analytics to refine your strategy over time.</li>
                        <li>Don't be afraid to experiment!</li>
                    </ul>
                </div>

            </section>

            <section id="draft" class="content-section" aria-labelledby="draft-heading" aria-hidden="true">
                <h2 id="draft-heading">Draft Your Newsletter</h2>
                <div class="card">
                    <div class="form-group">
                        <label for="draftSubjectLine">Subject Line:</label>
                        <input type="text" id="draftSubjectLine" placeholder="Enter your subject line" aria-label="Newsletter Subject Line">
                    </div>
                    <div class="form-group">
                        <label for="draftPreviewText">Preview Text (Optional):</label>
                        <input type="text" id="draftPreviewText" placeholder="Enter preview text" aria-label="Newsletter Preview Text">
                    </div>
                    <div class="form-group">
                        <label for="newsletterBody">Newsletter Body:</label>
                        <textarea id="newsletterBody" placeholder="Write your newsletter content here..." aria-label="Newsletter Body Content"></textarea>
                    </div>
                    <button class="primary" onclick="saveDraft()">
                        <span class="material-symbols-rounded" aria-hidden="true">save</span> Save Draft
                    </button>
                    <button class="secondary" onclick="showModal('testEmailModal')">
                        <span class="material-symbols-rounded" aria-hidden="true">send</span> Send Test Email
                    </button>
                </div>
            </section>

            <section id="analyze" class="content-section" aria-labelledby="analyze-heading" aria-hidden="true">
                <h2 id="analyze-heading">Analyze Your Newsletter</h2>
                <div class="card">
                    <div class="form-group">
                        <label for="analysisInput">Paste Newsletter Content for Analysis:</label>
                        <textarea id="analysisInput" placeholder="Paste your subject line and body content here..." aria-label="Content for Analysis"></textarea>
                    </div>
                    <button class="primary" onclick="analyzeContent()">
                        <span class="material-symbols-rounded" aria-hidden="true">search</span> Analyze Content
                    </button>

                    <div id="analysisResults" class="analysis-results" style="display: none;" aria-live="polite">
                        <h3>Analysis Results</h3>
                        <div class="result-item">
                            <label>Subject Line Analysis:</label>
                            <div id="subjectAnalysisResult" class="result-value" aria-atomic="true">-</div>
                        </div>
                        <div class="result-item">
                            <label>Readability Score (Simulated):</label>
                            <div id="readabilityScore" class="result-value" aria-atomic="true">-</div>
                            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Readability Score Progress">
                                <div id="readabilityProgress" class="progress-bar-fill"></div>
                            </div>
                        </div>
                        <div class="result-item">
                            <label>Word Count:</label>
                            <div id="wordCountResult" class="result-value" aria-atomic="true">-</div>
                        </div>
                        <div class="result-item">
                            <label>Estimated Reading Time:</label>
                            <div id="readingTimeResult" class="result-value" aria-atomic="true">-</div>
                        </div>
                        <div class="result-item">
                            <label>Sentiment Analysis (Simulated):</label>
                            <div id="sentimentResult" class="result-value" aria-atomic="true">-</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer role="contentinfo">
        <p>&copy; 2023 EngageMail. All rights reserved.</p>
    </footer>

    <!-- Modals -->
    <div id="testEmailModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="testEmailModalHeading" aria-hidden="true">
        <div class="modal-content" tabindex="-1"> <!-- Make modal content focusable -->
            <button class="modal-close" onclick="hideModal('testEmailModal')" aria-label="Close modal">&times;</button>
            <h3 id="testEmailModalHeading">Send Test Email</h3>
            <div class="form-group">
                <label for="testEmailAddress">Recipient Email:</label>
                <input type="email" id="testEmailAddress" placeholder="Enter email address" required aria-required="true">
            </div>
            <button class="primary" onclick="sendTestEmail()">
                <span class="material-symbols-rounded" aria-hidden="true">send</span> Send
            </button>
        </div>
    </div>

    <script>
        // --- State Management ---
        let currentState = {
            activeSection: 'learn',
            draft: {
                subject: '',
                preview: '',
                body: ''
            }
        };

        // --- DOM Elements ---
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        const draftSubjectLineInput = document.getElementById('draftSubjectLine');
        const draftPreviewTextInput = document.getElementById('draftPreviewText');
        const newsletterBodyTextarea = document.getElementById('newsletterBody');
        const analysisInputTextarea = document.getElementById('analysisInput');
        const analysisResultsDiv = document.getElementById('analysisResults');
        const subjectAnalysisResultDiv = document.getElementById('subjectAnalysisResult');
        const readabilityScoreDiv = document.getElementById('readabilityScore');
        const readabilityProgressDiv = document.getElementById('readabilityProgress');
        const wordCountResultDiv = document.getElementById('wordCountResult');
        const readingTimeResultDiv = document.getElementById('readingTimeResult');
        const sentimentResultDiv = document.getElementById('sentimentResult');
        const subjectLinePreviewP = document.getElementById('subjectLinePreview');
        const interactiveSubjectLineInput = document.getElementById('subjectLineInput');
        const testEmailModal = document.getElementById('testEmailModal');
        const testEmailAddressInput = document.getElementById('testEmailAddress');
        const sendTestEmailButton = testEmailModal ? testEmailModal.querySelector('button.primary') : null;
        const mainContent = document.getElementById('main-content');


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial state (optional: from localStorage)
            // Check hash for initial section, default to 'learn'
            const initialSection = window.location.hash ? window.location.hash.substring(1) : 'learn';
            if (document.getElementById(initialSection)) {
                 currentState.activeSection = initialSection;
            } else {
                 currentState.activeSection = 'learn';
            }

            renderState();
            addEventListeners();
        });

        // --- Event Listeners ---
        function addEventListeners() {
            navLinks.forEach(link => {
                link.addEventListener('click', handleNavClick);
            });

            // Sync draft inputs with state
            if (draftSubjectLineInput) draftSubjectLineInput.addEventListener('input', (e) => {
                currentState.draft.subject = e.target.value;
            });
            if (draftPreviewTextInput) draftPreviewTextInput.addEventListener('input', (e) => {
                currentState.draft.preview = e.target.value;
            });
            if (newsletterBodyTextarea) newsletterBodyTextarea.addEventListener('input', (e) => {
                currentState.draft.body = e.target.value;
            });
             if (interactiveSubjectLineInput) interactiveSubjectLineInput.addEventListener('input', updateSubjectLinePreview);

            // Add focus listener to tooltips for keyboard access
            document.querySelectorAll('.tooltip').forEach(tooltip => {
                tooltip.addEventListener('focus', () => {
                    tooltip.classList.add('active'); // Add active class for focus state if needed for styling
                });
                tooltip.addEventListener('blur', () => {
                    tooltip.classList.remove('active');
                });
            });


            // Simple validation example for test email modal
            if (testEmailAddressInput && sendTestEmailButton) {
                 testEmailAddressInput.addEventListener('input', () => {
                    sendTestEmailButton.disabled = !testEmailAddressInput.value.includes('@') || testEmailAddressInput.value.trim() === '';
                 });
                 sendTestEmailButton.disabled = true; // Disable initially
            }

            // Close modal when clicking outside
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal-overlay')) {
                    hideModal(event.target.id);
                }
            });

            // Close modal with Escape key
            window.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    const activeModal = document.querySelector('.modal-overlay.active');
                    if (activeModal) {
                        hideModal(activeModal.id);
                    }
                }
            });
        }


        // --- State Rendering ---
        function renderState() {
            // Update navigation active state and aria-current
            navLinks.forEach(link => {
                if (link.dataset.section === currentState.activeSection) {
                    link.classList.add('active');
                    link.setAttribute('aria-current', 'page');
                } else {
                    link.classList.remove('active');
                    link.removeAttribute('aria-current');
                }
            });

            // Show/hide content sections
            contentSections.forEach(section => {
                if (section.id === currentState.activeSection) {
                    section.classList.add('active');
                     section.setAttribute('aria-hidden', 'false');
                } else {
                    section.classList.remove('active');
                     section.setAttribute('aria-hidden', 'true');
                }
            });

            // Populate draft inputs when switching to draft section
            if (currentState.activeSection === 'draft') {
                if (draftSubjectLineInput) draftSubjectLineInput.value = currentState.draft.subject;
                if (draftPreviewTextInput) draftPreviewTextInput.value = currentState.draft.preview;
                if (newsletterBodyTextarea) newsletterBodyTextarea.value = currentState.draft.body;
            }

            // Clear analysis results when switching away from analyze
             if (currentState.activeSection !== 'analyze') {
                 if (analysisResultsDiv) analysisResultsDiv.style.display = 'none';
                 if (analysisInputTextarea) analysisInputTextarea.value = ''; // Clear input
             }
        }

        // --- Navigation Handler ---
        function handleNavClick(event) {
            event.preventDefault();
            const targetSection = event.currentTarget.dataset.section; // Use currentTarget
            if (targetSection && targetSection !== currentState.activeSection) {
                currentState.activeSection = targetSection;
                window.history.pushState(null, '', `#${targetSection}`); // Update URL hash
                renderState();
                // Focus the main content area for accessibility
                if (mainContent) {
                    mainContent.setAttribute('tabindex', '-1'); // Make it focusable
                    mainContent.focus();
                    mainContent.removeAttribute('tabindex'); // Remove tabindex after focusing
                }
            }
        }

        // --- Interactive Example Function (Learn Section) ---
        function updateSubjectLinePreview() {
             if (!interactiveSubjectLineInput || !subjectLinePreviewP) return;
            const subjectLines = interactiveSubjectLineInput.value.split('\n').filter(line => line.trim() !== '');
            subjectLinePreviewP.textContent = subjectLines.length > 0 ? subjectLines.join(' | ') : 'Type subject lines above to see preview';
        }

        // --- Draft Section Functions ---
        function saveDraft() {
            // In a real app, this would save to localStorage or a backend
            console.log('Draft Saved:', currentState.draft);
            // Use a more user-friendly notification than alert in a real app
            alert('Draft saved locally!');
        }

        function sendTestEmail() {
             if (!testEmailAddressInput || !sendTestEmailButton) return;
             const email = testEmailAddressInput.value;
             if (!email || !email.includes('@')) {
                 alert('Please enter a valid recipient email address.');
                 testEmailAddressInput.focus();
                 return;
             }
             // In a real app, this would send the draft content via a backend service
             console.log(`Simulating sending test email to ${email} with content:`, currentState.draft);
             // Use a more user-friendly notification than alert in a real app
             alert(`Test email simulated to ${email}! (Content logged to console)`);
             hideModal('testEmailModal');
        }

        // --- Analyze Section Functions ---
        function analyzeContent() {
            if (!analysisInputTextarea || !analysisResultsDiv || !subjectAnalysisResultDiv || !readabilityScoreDiv || !readabilityProgressDiv || !wordCountResultDiv || !readingTimeResultDiv || !sentimentResultDiv) {
                console.error("Analysis DOM elements not found.");
                return;
            }

            const content = analysisInputTextarea.value;
            if (!content.trim()) {
                alert('Please paste content to analyze.');
                analysisInputTextarea.focus();
                return;
            }

            // Simulate analysis process
            analysisResultsDiv.style.display = 'block';
            subjectAnalysisResultDiv.textContent = 'Analyzing...';
            readabilityScoreDiv.textContent = 'Calculating...';
            readabilityProgressDiv.style.width = '0%';
            readabilityProgressDiv.style.backgroundColor = "var('--border-color')"; // Reset color
            readabilityProgressDiv.setAttribute('aria-valuenow', '0');
            wordCountResultDiv.textContent = 'Calculating...';
            readingTimeResultDiv.textContent = 'Calculating...';
            sentimentResultDiv.textContent = 'Analyzing...';

            // Basic simulated results after a delay
            setTimeout(() => {
                const words = content.split(/\s+/).filter(word => word.length > 0);
                const wordCount = words.length;
                const sentences = content.split(/[.!?]+/).filter(sentence => sentence.length > 0).length;
                // const syllables = countSyllables(content); // Placeholder function, too complex for simple demo

                // Simulate Flesch-Kincaid (simplified)
                let readability = 0;
                if (wordCount > 0 && sentences > 0) {
                     // Simplified formula based on word/sentence length for demo
                     const avgWordsPerSentence = wordCount / sentences;
                     readability = Math.max(0, 100 - (avgWordsPerSentence * 2) - (sentences / 5)); // Rough estimate
                     readability = Math.min(100, readability); // Cap at 100
                } else if (wordCount > 0) {
                     // If only words, assume very high readability
                     readability = 90;
                } else {
                     readability = 0;
                }


                const readingTimeMinutes = Math.ceil(wordCount / 200); // Avg reading speed 200 WPM

                // Simple sentiment analysis (very basic keywords)
                let sentiment = 'Neutral';
                const lowerContent = content.toLowerCase();
                if (lowerContent.includes('great') || lowerContent.includes('exciting') || lowerContent.includes('love') || lowerContent.includes('happy') || lowerContent.includes('excellent') || lowerContent.includes('positive')) {
                    sentiment = 'Positive';
                } else if (lowerContent.includes('bad') || lowerContent.includes('difficult') || lowerContent.includes('problem') || lowerContent.includes('sad') || lowerContent.includes('negative') || lowerContent.includes('poor')) {
                    sentiment = 'Negative';
                }


                subjectAnalysisResultDiv.textContent = analyzeSubjectLine(content.split('\n')[0] || ''); // Analyze first line as subject
                readabilityScoreDiv.textContent = `${readability.toFixed(1)} (Simulated Score)`;
                readabilityProgressDiv.style.width = `${readability}%`;
                readabilityProgressDiv.setAttribute('aria-valuenow', readability.toFixed(1));

                // Update progress bar color based on score
                if (readability > 70) {
                    readabilityProgressDiv.style.backgroundColor = "var('--success-color')";
                } else if (readability > 40) {
                    readabilityProgressDiv.style.backgroundColor = "var('--warning-color')";
                } else {
                    readabilityProgressDiv.style.backgroundColor = "var('--danger-color')";
                }

                wordCountResultDiv.textContent = wordCount;
                readingTimeResultDiv.textContent = `${readingTimeMinutes} min`;
                sentimentResultDiv.textContent = sentiment;

            }, 1000); // Simulate processing time

        }

        // Placeholder for syllable counting (complex topic, simplified for demo)
        // function countSyllables(text) {
        //      // This is a very basic approximation and not accurate for real analysis
        //      text = text.toLowerCase().replace(/[^a-z]+/g, ' ');
        //      let count = 0;
        //      const words = text.split(' ');
        //      for (const word of words) {
        //          if (word.length <= 3) {
        //              count += 1;
        //          } else {
        //              // Simple vowel count heuristic
        //              const vowelMatches = word.match(/[aeiouy]+/g);
        //              count += Math.max(1, vowelMatches ? vowelMatches.length : 0);
        //          }
        //      }
        //      return count;
        // }

        // Placeholder for subject line analysis
        function analyzeSubjectLine(subject) {
            if (!subject.trim()) return 'No subject line provided.';
            let feedback = [];
            if (subject.length > 50) {
                feedback.push('Consider shortening for better mobile display.');
            }
            if (subject.includes('!') && subject.split('!').length > 2) {
                 feedback.push('Too many exclamation points can look spammy.');
            }
             if (subject.toLowerCase().includes('free') || subject.toLowerCase().includes('win') || subject.toLowerCase().includes('cash') || subject.toLowerCase().includes('urgent') || subject.toLowerCase().includes('$$$')) {
                 feedback.push('Watch out for common spam trigger words.');
             }
             if (subject.length < 10) {
                 feedback.push('Subject line is very short. Is it clear enough?');
             }
             if (subject.trim().endsWith('.')) {
                 feedback.push('Avoid periods at the end of subject lines.');
             }
            if (feedback.length === 0) {
                feedback.push('Looks good!');
            }
            return feedback.join(' ');
        }


        // --- Modal Functions ---
        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.add('active');
                modal.setAttribute('aria-hidden', 'false');
                // Trap focus inside modal (basic)
                const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                const firstElement = focusableElements[0];
                if (firstElement) {
                    firstElement.focus();
                } else {
                     // If no focusable elements, focus the modal content itself
                     modal.querySelector('.modal-content').focus();
                }
            }
        }

        function hideModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.remove('active');
                modal.setAttribute('aria-hidden', 'true');
                // Return focus to the element that opened the modal (more complex, skipping for basic demo)
                // For now, focus the main content area
                 if (mainContent) mainContent.focus();
            }
        }

    </script>

</body>
</html>
