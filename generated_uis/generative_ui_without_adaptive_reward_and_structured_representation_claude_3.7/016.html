<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare CE Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <style>
        :root {
            --primary-blue: #007bff;
            --primary-blue-dark: #0056b3;
            --secondary-green: #28a745;
            --secondary-green-dark: #218838;
            --accent-orange: #fd7e14;
            --text-color: #343a40;
            --text-light: #6c757d;
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --border-color: #dee2e6;
            --shadow-subtle: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-card-hover: 0 4px 8px rgba(0, 0, 0, 0.1);
            --spacing-unit: 8px;
            --sidebar-width-desktop: 250px;
            --header-height: 60px; /* Approximate height */
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-light);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
            transition: margin-left 0.3s ease;
        }

        /* Layout adjustments for sidebar */
        body.sidebar-open {
             margin-left: var(--sidebar-width-desktop);
        }

        .header {
            background-color: var(--bg-white);
            color: var(--text-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            box-shadow: var(--shadow-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%; /* Default to full width */
            top: 0;
            left: 0; /* Default to left 0 */
            height: var(--header-height);
            z-index: 1000;
            box-sizing: border-box;
            transition: width 0.3s ease, left 0.3s ease;
        }

        body.sidebar-open .header {
             width: calc(100% - var(--sidebar-width-desktop));
             left: var(--sidebar-width-desktop);
        }

        .header .hamburger-menu {
            display: none; /* Hidden by default on desktop */
            font-size: 1.5em;
            margin-right: calc(var(--spacing-unit) * 2);
            cursor: pointer;
            color: var(--text-color);
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
        }

        .header .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-blue);
            flex-grow: 1; /* Allow logo area to grow */
        }

        .header .user-menu {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: var(--spacing-unit);
            border-radius: 4px;
            transition: background-color 0.2s ease;
            outline: none; /* Remove default outline */
            background: none;
            border: none;
            color: var(--text-color);
        }

        .header .user-menu:hover,
        .header .user-menu:focus {
            background-color: rgba(0, 0, 0, 0.05);
        }
         .header .user-menu:focus-visible {
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5);
         }


        .header .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--primary-blue);
            margin-right: var(--spacing-unit);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-white);
            font-size: 0.9em;
            font-weight: 600;
        }

        .header .user-name {
            font-weight: 500;
        }

        .sidebar {
            width: var(--sidebar-width-desktop);
            background-color: var(--bg-white);
            box-shadow: var(--shadow-subtle);
            padding-top: var(--header-height); /* Space for fixed header */
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            overflow-y: auto;
            z-index: 999;
            transition: transform 0.3s ease, width 0.3s ease;
            transform: translateX(0); /* Default state */
        }

        body:not(.sidebar-open) .sidebar {
             transform: translateX(-var(--sidebar-width-desktop)); /* Hide sidebar */
        }


        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav ul li {
            margin-bottom: var(--spacing-unit);
        }

        .sidebar nav ul li a {
            display: flex;
            align-items: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-left: 4px solid transparent;
            outline: none; /* Remove default outline */
        }

        .sidebar nav ul li a i.material-symbols-rounded {
             margin-right: var(--spacing-unit);
             font-size: 1.5em; /* Increased icon size */
             width: 24px; /* Fixed width for alignment */
             text-align: center;
             flex-shrink: 0; /* Prevent icon from shrinking */
        }

        .sidebar nav ul li a:hover,
        .sidebar nav ul li a:focus-visible {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--primary-blue);
        }
         .sidebar nav ul li a:focus-visible {
             box-shadow: inset 0 0 0 2px rgba(0, 123, 255, 0.5);
         }


        .sidebar nav ul li a.active {
            background-color: rgba(0, 123, 255, 0.1);
            color: var(--primary-blue);
            border-left-color: var(--primary-blue);
        }

        .main-content {
            flex-grow: 1;
            padding: calc(var(--header-height) + var(--spacing-unit) * 3) calc(var(--spacing-unit) * 3) calc(var(--spacing-unit) * 3) calc(var(--spacing-unit) * 3); /* Space for fixed header */
            width: 100%; /* Default to full width */
            box-sizing: border-box;
            transition: margin-left 0.3s ease;
        }

        body.sidebar-open .main-content {
             margin-left: var(--sidebar-width-desktop);
        }


        .section {
            display: none;
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .section.active {
            display: block;
        }

        h1, h2, h3, h4 {
            color: var(--text-color);
            margin-bottom: calc(var(--spacing-unit) * 2);
            line-height: 1.3;
        }

        h1 { font-size: 2em; font-weight: 700;}
        h2 { font-size: 1.5em; font-weight: 600;}
        h3 { font-size: 1.2em; font-weight: 600;}
        h4 { font-size: 1em; font-weight: 600;}


        .card {
            background-color: var(--bg-white);
            border-radius: 8px;
            box-shadow: var(--shadow-subtle);
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: calc(var(--spacing-unit) * 3);
        }

        .progress-card {
            background-color: var(--bg-white);
            border-radius: 8px;
            box-shadow: var(--shadow-subtle);
            padding: calc(var(--spacing-unit) * 2);
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
         .progress-card:hover {
             transform: translateY(-3px);
             box-shadow: var(--shadow-card-hover);
         }


        .progress-card .value {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: var(--spacing-unit);
        }

        .progress-card .label {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .recommended-modules .module-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: calc(var(--spacing-unit) * 2);
        }

        .module-item {
            background-color: var(--bg-light);
            border-radius: 8px;
            padding: calc(var(--spacing-unit) * 2);
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            outline: none; /* Remove default outline */
            text-align: left;
            display: block; /* Make the whole item clickable */
            width: 100%;
            color: inherit;
            text-decoration: none;
        }

        .module-item:hover,
        .module-item:focus-visible {
            transform: translateY(-3px);
            box-shadow: var(--shadow-card-hover);
        }
         .module-item:focus-visible {
             border-color: var(--primary-blue);
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
         }


        .module-item h4 {
            margin-top: 0;
            margin-bottom: var(--spacing-unit);
            color: var(--primary-blue);
        }

        .module-item p {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: var(--spacing-unit);
        }

        .module-item .progress-bar-container {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .module-item .progress-bar {
            height: 100%;
            background-color: var(--secondary-green);
            width: 0%; /* JS will update */
            transition: width 0.4s ease;
        }

        .button {
            display: inline-flex; /* Use flex to center icon/text */
            align-items: center;
            justify-content: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            background-color: var(--primary-blue);
            color: var(--bg-white);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            text-decoration: none;
            transition: background-color 0.2s ease, opacity 0.2s ease, box-shadow 0.2s ease;
            outline: none; /* Remove default outline */
            min-width: 80px; /* Ensure minimum touch/click target size */
            text-align: center;
        }

        .button i.material-symbols-rounded {
             margin-right: var(--spacing-unit);
             font-size: 1.2em;
        }
         .button:hover:not(:disabled) {
             background-color: var(--primary-blue-dark);
         }
         .button:focus-visible:not(:disabled) {
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5);
         }


        .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .button.secondary {
            background-color: var(--bg-white);
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }

        .button.secondary:hover:not(:disabled) {
            background-color: rgba(0, 123, 255, 0.1);
            color: var(--primary-blue-dark);
            border-color: var(--primary-blue-dark);
        }
         .button.secondary:focus-visible:not(:disabled) {
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5);
         }


        .button-group {
            display: flex;
            gap: var(--spacing-unit);
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
            color: var(--text-color);
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1em;
            box-sizing: border-box; /* Include padding in width */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            outline: none; /* Remove default outline */
        }

        .form-group input[type="text"]:focus-visible,
        .form-group input[type="email"]:focus-visible,
        .form-group input[type="number"]:focus-visible,
        .form-group textarea:focus-visible,
        .form-group select:focus-visible {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group .error-message {
            color: #dc3545; /* Red */
            font-size: 0.8em;
            margin-top: var(--spacing-unit);
        }

        .form-group input.error,
        .form-group textarea.error,
        .form-group select.error {
             border-color: #dc3545;
        }
         .form-group input.error:focus-visible,
         .form-group textarea.error:focus-visible,
         .form-group select.error:focus-visible {
             box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25); /* Red shadow */
         }


        .search-filter-bar {
            display: flex;
            gap: calc(var(--spacing-unit) * 2);
            margin-bottom: calc(var(--spacing-unit) * 3);
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .search-filter-bar input[type="text"] {
            flex-grow: 1;
            min-width: 200px; /* Minimum width for search input */
            padding: calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1em;
            outline: none;
        }
         .search-filter-bar input[type="text"]:focus-visible {
             border-color: var(--primary-blue);
             box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
         }


        .search-filter-bar .filter-buttons {
            display: flex;
            gap: var(--spacing-unit);
            flex-wrap: wrap;
        }

        .search-filter-bar .filter-buttons .button {
            /* Styles inherited from .button */
        }
         .search-filter-bar .filter-buttons .button.active {
             background-color: var(--primary-blue);
             color: var(--bg-white);
             border-color: var(--primary-blue);
         }
         .search-filter-bar .filter-buttons .button.active:hover {
             background-color: var(--primary-blue-dark);
             border-color: var(--primary-blue-dark);
         }


        .content-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: calc(var(--spacing-unit) * 2);
        }

        .content-item {
            background-color: var(--bg-light);
            border-radius: 8px;
            padding: calc(var(--spacing-unit) * 2);
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            outline: none; /* Remove default outline */
            text-align: left;
            display: block; /* Make the whole item clickable */
            width: 100%;
            color: inherit;
            text-decoration: none;
        }

        .content-item:hover,
        .content-item:focus-visible {
            transform: translateY(-3px);
            box-shadow: var(--shadow-card-hover);
        }
         .content-item:focus-visible {
             border-color: var(--primary-blue);
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
         }


        .content-item h4 {
            margin-top: 0;
            margin-bottom: var(--spacing-unit);
            color: var(--primary-blue);
        }

        .content-item p {
            font-size: 0.9em;
            color: var(--text-light);
        }

        /* Chart specific styles */
        .chart-container {
            position: relative;
            height: 300px; /* Fixed height for charts */
            margin-bottom: calc(var(--spacing-unit) * 3);
            cursor: pointer;
            border: 1px solid var(--border-color); /* Add border for click target */
            border-radius: 8px;
            overflow: hidden; /* Hide overflow from controls */
            background-color: var(--bg-white); /* Ensure white background */
            display: flex; /* Use flex to center canvas */
            justify-content: center;
            align-items: center;
        }
         .chart-container canvas {
             max-width: 100%;
             max-height: 100%;
         }


        .floating-controls {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            background: rgba(255, 255, 255, 0.95);
            padding: calc(var(--spacing-unit) * 2);
            border-radius: 8px;
            box-shadow: var(--shadow-subtle);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
            border: 1px solid var(--border-color);
            min-width: 200px; /* Ensure controls are readable */
        }
        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        .control-group {
            margin-bottom: calc(var(--spacing-unit) * 1.5);
        }
        .control-group:last-child {
            margin-bottom: 0;
        }
        .control-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-size: 0.9em;
            color: var(--text-light);
        }
        .control-group input[type="color"],
        .control-group input[type="number"],
        .control-group select {
            width: 100%;
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9em;
            box-sizing: border-box;
            outline: none;
        }
         .control-group input[type="color"]:focus-visible,
         .control-group input[type="number"]:focus-visible,
         .control-group select:focus-visible {
             border-color: var(--primary-blue);
             box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
         }


        /* Specific section styles */
        #dashboard .card {
            min-height: 150px; /* Ensure cards have some size */
        }

        #assessment .question-area {
            min-height: 200px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
            background-color: var(--bg-light);
        }
         #assessment .question-area p {
             font-size: 1.1em;
             margin-bottom: calc(var(--spacing-unit) * 2);
             font-weight: 500;
         }
         #assessment .question-area label {
             cursor: pointer;
             margin-bottom: var(--spacing-unit); /* Add spacing between options */
         }
         #assessment .question-area input[type="radio"],
         #assessment .question-area input[type="checkbox"] {
             margin-right: var(--spacing-unit);
         }


        #assessment .progress-bar-assessment {
            height: 12px;
            background-color: #e9ecef;
            border-radius: 6px;
            margin-bottom: calc(var(--spacing-unit) * 3);
            overflow: hidden;
        }

        #assessment .progress-bar-assessment-fill {
            height: 100%;
            background-color: var(--secondary-green);
            width: 0%; /* JS will update */
            transition: width 0.4s ease;
        }

        #assessment .assessment-controls {
            display: flex;
            justify-content: space-between;
            gap: calc(var(--spacing-unit) * 2);
        }
         #assessment .assessment-controls .button {
             flex-grow: 1; /* Allow buttons to grow */
         }

         #assessment #results-summary ul {
             list-style: none;
             padding: 0;
         }
         #assessment #results-summary li {
             margin-bottom: calc(var(--spacing-unit) * 2);
             padding-bottom: var(--spacing-unit);
             border-bottom: 1px dashed var(--border-color);
         }
          #assessment #results-summary li:last-child {
              border-bottom: none;
          }
         #assessment #results-summary li strong {
             display: inline-block;
             margin-right: var(--spacing-unit);
         }


        #progress-tracking .chart-section {
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        #completed-modules-list {
            list-style: none;
            padding: 0;
        }
         #completed-modules-list li {
             background-color: var(--bg-light);
             border: 1px solid var(--border-color);
             border-radius: 4px;
             padding: calc(var(--spacing-unit) * 1.5);
             margin-bottom: var(--spacing-unit);
             font-size: 0.95em;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }
          #completed-modules-list li:last-child {
              margin-bottom: 0;
          }
         #completed-modules-list li .completion-date {
             font-size: 0.85em;
             color: var(--text-light);
             flex-shrink: 0; /* Prevent date from shrinking */
             margin-left: var(--spacing-unit); /* Add space */
         }


        #certification-management .certification-list {
            list-style: none;
            padding: 0;
        }

        #certification-management .certification-item {
            background-color: var(--bg-light);
            border-radius: 8px;
            padding: calc(var(--spacing-unit) * 2);
            margin-bottom: var(--spacing-unit) * 2;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            outline: none;
            width: 100%; /* Make item full width clickable */
            text-align: left;
            color: inherit;
            text-decoration: none;
        }
         #certification-management .certification-item:last-child {
             margin-bottom: 0;
         }
         #certification-management .certification-item:hover,
         #certification-management .certification-item:focus-visible {
             transform: translateY(-3px);
             box-shadow: var(--shadow-card-hover);
         }
         #certification-management .certification-item:focus-visible {
             border-color: var(--primary-blue);
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
         }


        #certification-management .certification-item .status {
            font-weight: 600;
            color: var(--accent-orange); /* Default */
            min-width: 120px; /* Ensure status text doesn't wrap awkwardly */
            text-align: right;
            flex-shrink: 0;
        }

        #certification-management .certification-item .status.complete {
            color: var(--secondary-green);
        }
         #certification-management .certification-item .status.expired {
             color: #dc3545; /* Red */
         }


        #practice-scenarios .scenario-area {
            min-height: 300px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
            background-color: var(--bg-light);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: var(--text-light);
        }
         #practice-scenarios .scenario-area p {
             margin-bottom: var(--spacing-unit);
         }
         #practice-scenarios .scenario-area .simulation-placeholder {
             border: 1px dashed var(--primary-blue);
             padding: calc(var(--spacing-unit) * 2);
             margin-top: calc(var(--spacing-unit) * 2);
             text-align: center;
             width: 100%; /* Take full width of area */
             box-sizing: border-box;
         }


        #profile .profile-form .form-group {
            max-width: 500px; /* Limit form width */
        }

        #credentialing .document-preview {
            min-height: 200px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
            background-color: var(--bg-light);
            text-align: center;
            color: var(--text-light);
            overflow-y: auto; /* Allow scrolling if content is large */
        }
         #credentialing .document-preview h3,
         #credentialing .document-preview h4 {
             color: var(--text-color);
             text-align: left;
         }
         #credentialing .document-preview p,
         #credentialing .document-preview ul {
              text-align: left;
              color: var(--text-color);
         }
         #credentialing .document-preview ul {
             list-style: disc;
             padding-left: calc(var(--spacing-unit) * 3);
         }
         #credentialing .document-preview li {
             margin-bottom: var(--spacing-unit);
             color: var(--text-color);
         }


        /* Utility classes */
        .text-center { text-align: center; }
        .mb-3 { margin-bottom: calc(var(--spacing-unit) * 3); }
        .mt-3 { margin-top: calc(var(--spacing-unit) * 3); }
        .flex-end { display: flex; justify-content: flex-end; }
        .flex-start { display: flex; justify-content: flex-start; }
        .flex-center { display: flex; justify-content: center; }
        .align-items-center { display: flex; align-items: center; }
        .w-100 { width: 100%; }
        .text-light { color: var(--text-light); }

        /* Accessibility: Focus indicator */
        *:focus-visible {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }
         /* Hide default outline for elements with custom focus styles */
        .sidebar nav ul li a:focus,
        .header .user-menu:focus,
        .button:focus:not(:disabled),
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus,
        .search-filter-bar input[type="text"]:focus,
        .content-item:focus,
        .module-item:focus,
        .certification-item:focus,
        .control-group input:focus,
        .control-group select:focus {
            outline: none;
        }


        /* Loading Indicator (Simple Spinner) */
        .loading-indicator {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .loading-indicator.active {
            display: flex;
        }
        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        /* Responsive adjustments */
        @media (max-width: 1024px) {
             /* Adjust layout slightly for larger tablets/small desktops */
             body.sidebar-open {
                 margin-left: var(--sidebar-width-desktop);
             }
             body.sidebar-open .header {
                 width: calc(100% - var(--sidebar-width-desktop));
                 left: var(--sidebar-width-desktop);
             }
             body:not(.sidebar-open) .main-content {
                 margin-left: 0;
             }
             body:not(.sidebar-open) .header {
                 width: 100%;
                 left: 0;
             }
        }


        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-width-desktop); /* Keep width consistent */
                transform: translateX(-var(--sidebar-width-desktop)); /* Hide by default */
            }
            body.sidebar-open .sidebar {
                 transform: translateX(0); /* Show sidebar */
            }
             /* Prevent body margin when sidebar is open on mobile */
             body.sidebar-open {
                 margin-left: 0;
                 overflow-y: hidden; /* Prevent scrolling body when sidebar is open */
             }


            .main-content {
                margin-left: 0; /* Always 0 margin on mobile/tablet */
                width: 100%;
                padding: calc(var(--header-height) + var(--spacing-unit) * 2) var(--spacing-unit) * 2 calc(var(--spacing-unit) * 2); /* Adjust padding */
            }

            .header {
                width: 100%;
                left: 0;
                padding: var(--spacing-unit) * 2; /* Adjust padding */
            }
             body.sidebar-open .header {
                 width: 100%; /* Header stays full width */
                 left: 0;
             }

            .header .hamburger-menu {
                display: block; /* Show hamburger on tablet/mobile */
            }

            .header .logo {
                flex-grow: 0; /* Don't let logo push user menu */
                margin-right: auto; /* Push user menu to the right */
            }

            .progress-summary {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Adjust min width for smaller screens */
                gap: var(--spacing-unit) * 2;
            }

             .search-filter-bar {
                 flex-direction: column;
                 align-items: stretch;
                 gap: calc(var(--spacing-unit) * 1.5);
             }
             .search-filter-bar input[type="text"] {
                 width: 100%; /* Full width input */
                 min-width: auto;
             }
             .search-filter-bar .filter-buttons {
                 width: 100%; /* Full width button group */
                 justify-content: center; /* Center buttons */
             }
             .search-filter-bar .filter-buttons .button {
                 flex-grow: 1; /* Allow buttons to grow */
             }

             .content-list {
                 grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Adjust min width */
             }

             #assessment .assessment-controls {
                 flex-direction: column; /* Stack buttons */
             }
             #assessment .assessment-controls .button {
                 width: 100%;
             }

             .floating-controls {
                 right: var(--spacing-unit);
                 left: var(--spacing-unit);
                 width: auto; /* Allow controls to take full width */
                 min-width: auto;
             }

        }

         @media (max-width: 480px) {
             .header {
                 padding: calc(var(--spacing-unit) * 1.5);
             }
             .main-content {
                 padding: calc(var(--header-height) + var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 1.5);
             }
             .progress-summary {
                 grid-template-columns: 1fr; /* Stack cards on mobile */
                 gap: calc(var(--spacing-unit) * 1.5);
             }
             .card {
                 padding: calc(var(--spacing-unit) * 2);
             }
             .card-title {
                 font-size: 1.1em;
             }
             h1 { font-size: 1.8em; }
             h2 { font-size: 1.3em; }
             h3 { font-size: 1.1em; }
             h4 { font-size: 1em; }

             .search-filter-bar .filter-buttons .button {
                 font-size: 0.9em; /* Smaller font for filter buttons */
                 padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
             }

             .content-list {
                 grid-template-columns: 1fr; /* Stack content items */
             }

             .module-item, .content-item, .certification-item {
                 padding: calc(var(--spacing-unit) * 1.5);
             }

         }
    </style>
</head>
<body>

    <div class="loading-indicator" id="loading-indicator" aria-hidden="true">
        <div class="spinner"></div>
    </div>

    <header class="header">
        <button class="hamburger-menu" aria-label="Toggle sidebar navigation">
             <span class="material-symbols-rounded">menu</span>
        </button>
        <div class="logo">CE Platform</div>
        <button class="user-menu" aria-label="User menu">
            <div class="user-avatar" id="user-avatar" aria-hidden="true">JD</div>
            <div class="user-name" id="user-name" aria-hidden="true">Dr. Jane Doe</div>
            <span class="material-symbols-rounded" aria-hidden="true">arrow_drop_down</span>
        </button>
    </header>

    <aside class="sidebar">
        <nav aria-label="Main navigation">
            <ul>
                <li><a href="#dashboard" class="nav-link active" aria-current="page"><i class="material-symbols-rounded">dashboard</i> Dashboard</a></li>
                <li><a href="#assessment" class="nav-link"><i class="material-symbols-rounded">quiz</i> Knowledge Gap Assessment</a></li>
                <li><a href="#modules" class="nav-link"><i class="material-symbols-rounded">menu_book</i> Targeted Learning Modules</a></li>
                <li><a href="#progress" class="nav-link"><i class="material-symbols-rounded">timeline</i> Progress Tracking</a></li>
                <li><a href="#certification" class="nav-link"><i class="material-symbols-rounded">school</i> Certification Management</a></li>
                <li><a href="#scenarios" class="nav-link"><i class="material-symbols-rounded">interactive_space</i> Practice Scenarios</a></li>
                <li><a href="#library" class="nav-link"><i class="material-symbols-rounded">library_books</i> Content Library</a></li>
                <li><a href="#profile" class="nav-link"><i class="material-symbols-rounded">account_circle</i> Profile & Preferences</a></li>
                <li><a href="#credentialing" class="nav-link"><i class="material-symbols-rounded">description</i> Credentialing Docs</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <section id="dashboard" class="section active" role="region" aria-labelledby="dashboard-heading">
            <h1 id="dashboard-heading">Dashboard</h1>
            <p>Welcome back, <span id="dashboard-user-name">Dr. Jane Doe</span>!</p>

            <div class="card mb-3" role="region" aria-labelledby="progress-summary-heading">
                <h2 class="card-title" id="progress-summary-heading">Progress Summary</h2>
                <div class="progress-summary">
                    <div class="progress-card" role="status" aria-label="Modules Completed">
                        <div class="value" id="modules-completed" aria-live="polite">--</div>
                        <div class="label">Modules Completed</div>
                    </div>
                    <div class="progress-card" role="status" aria-label="Certification Progress">
                        <div class="value" id="cert-progress" aria-live="polite">--%</div>
                        <div class="label">Certification Progress</div>
                    </div>
                    <div class="progress-card" role="status" aria-label="Last Assessment Score">
                        <div class="value" id="assessment-score" aria-live="polite">--%</div>
                        <div class="label">Last Assessment Score</div>
                    </div>
                </div>
            </div>

            <div class="card recommended-modules" role="region" aria-labelledby="recommended-modules-heading">
                <h2 class="card-title" id="recommended-modules-heading">Recommended Modules</h2>
                <div class="module-list" id="recommended-modules-list">
                    <!-- Recommended modules will be loaded here by JS -->
                     <p class="text-center text-light">Loading recommendations...</p>
                </div>
            </div>
        </section>

        <section id="assessment" class="section" role="region" aria-labelledby="assessment-heading">
            <h1 id="assessment-heading">Knowledge Gap Assessment</h1>
            <div class="card" id="assessment-instructions-card">
                <h2 class="card-title">Assessment Instructions</h2>
                <p>This assessment will help identify areas where you may need further learning. Answer each question to the best of your ability. Your results will be used to tailor recommendations.</p>
                <div class="flex-end">
                    <button class="button mt-3" id="start-assessment">Start Assessment</button>
                </div>
            </div>

            <div class="card mt-3" id="assessment-question-card" style="display: none;" role="region" aria-live="polite">
                 <h2 class="card-title">Question <span id="current-question-number">1</span> of <span id="total-questions"></span></h2>
                 <div class="progress-bar-assessment mb-3" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Assessment progress">
                     <div class="progress-bar-assessment-fill" id="assessment-progress-fill" style="width: 0%;"></div>
                 </div>
                 <div class="question-area" id="question-display">
                     <!-- Question and answer options will be loaded here -->
                 </div>
                 <div class="assessment-controls mt-3">
                     <button class="button secondary" id="prev-question" disabled><i class="material-symbols-rounded">arrow_back</i> Previous</button>
                     <button class="button" id="next-question">Next <i class="material-symbols-rounded">arrow_forward</i></button>
                     <button class="button" id="submit-assessment" style="display: none;"><i class="material-symbols-rounded">check_circle</i> Submit Assessment</button>
                 </div>
            </div>
             <div class="card mt-3" id="assessment-results-card" style="display: none;" role="region" aria-labelledby="assessment-results-heading">
                 <h2 class="card-title" id="assessment-results-heading">Assessment Results</h2>
                 <div id="results-summary">
                     <!-- Results summary will be loaded here -->
                 </div>
                 <div class="flex-end mt-3">
                     <button class="button secondary" id="retake-assessment">Retake Assessment</button>
                 </div>
             </div>
        </section>

        <section id="modules" class="section" role="region" aria-labelledby="modules-heading">
            <h1 id="modules-heading">Targeted Learning Modules</h1>
            <div class="card" role="region" aria-labelledby="module-viewer-heading">
                <h2 class="card-title" id="module-viewer-heading">Module Viewer</h2>
                <div id="module-viewer-content">
                    <p class="text-center text-light">Select a module from the Content Library or Dashboard recommendations to start learning.</p>
                    <!-- Module content will be loaded here -->
                </div>
            </div>
        </section>

        <section id="progress" class="section" role="region" aria-labelledby="progress-heading">
            <h1 id="progress-heading">Progress Tracking & Reporting</h1>
            <div class="card chart-section" role="region" aria-labelledby="progress-chart-heading">
                <h2 class="card-title" id="progress-chart-heading">Overall Progress Over Time</h2>
                <div class="chart-container" role="img" aria-label="Line chart showing modules completed over time">
                    <canvas id="progressChart"></canvas>
                     <div class="floating-controls" id="progressChartControls" aria-hidden="true">
                         <p style="font-weight: bold; margin-bottom: var(--spacing-unit);">Chart Controls</p>
                        <div class="control-group">
                            <label for="progressChartLineColor">Line Color</label>
                            <input type="color" id="progressChartLineColor" value="#007bff" aria-label="Chart line color">
                        </div>
                        <div class="control-group">
                            <label for="progressChartFillColor">Fill Color</label>
                            <input type="color" id="progressChartFillColor" value="#e9ecef" aria-label="Chart fill color">
                        </div>
                        <div class="control-group">
                            <label for="progressChartType">Chart Type</label>
                            <select id="progressChartType" aria-label="Chart type">
                                <option value="line">Line</option>
                                <option value="bar">Bar</option>
                            </select>
                        </div>
                         <div class="control-group">
                            <label for="progressChartFontSize">Font Size</label>
                            <input type="number" id="progressChartFontSize" value="12" min="8" max="20" aria-label="Chart font size">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" role="region" aria-labelledby="completed-modules-heading">
                <h2 class="card-title" id="completed-modules-heading">Completed Modules</h2>
                <ul id="completed-modules-list" aria-live="polite">
                    <!-- Completed modules list -->
                     <p class="text-center text-light">Loading completed modules...</p>
                </ul>
            </div>
        </section>

        <section id="certification" class="section" role="region" aria-labelledby="certification-heading">
            <h1 id="certification-heading">Certification Requirement Management</h1>
            <div class="card" role="region" aria-labelledby="my-certifications-heading">
                <h2 class="card-title" id="my-certifications-heading">My Certifications</h2>
                <ul class="certification-list" id="certification-list" aria-live="polite">
                    <!-- Certification list will be loaded here -->
                     <p class="text-center text-light">Loading certifications...</p>
                </ul>
            </div>
        </section>

        <section id="scenarios" class="section" role="region" aria-labelledby="scenarios-heading">
            <h1 id="scenarios-heading">Interactive Practice Scenarios</h1>
            <div class="card" role="region" aria-labelledby="scenario-heading">
                <h2 class="card-title" id="scenario-heading">Scenario Viewer</h2>
                <div class="scenario-area" id="scenario-area">
                    <p class="text-center text-light">Select a scenario from the Content Library to begin.</p>
                    <!-- Simulation elements -->
                </div>
                <div class="flex-end mt-3" id="scenario-controls" style="display: none;">
                    <button class="button" id="start-scenario"><i class="material-symbols-rounded">play_arrow</i> Start Scenario</button>
                     <button class="button secondary" id="reset-scenario" style="display: none;"><i class="material-symbols-rounded">refresh</i> Reset Scenario</button>
                     <button class="button" id="simulate-scenario-completion" style="display: none;"><i class="material-symbols-rounded">check_circle</i> Simulate Completion</button>
                </div>
            </div>
        </section>

        <section id="library" class="section" role="region" aria-labelledby="library-heading">
            <h1 id="library-heading">Content Library</h1>
            <div class="card" role="region" aria-labelledby="browse-content-heading">
                <h2 class="card-title" id="browse-content-heading">Browse Content</h2>
                <div class="search-filter-bar">
                    <input type="text" id="content-search" placeholder="Search modules, topics..." aria-label="Search content library">
                    <div class="filter-buttons" role="group" aria-label="Content filters">
                        <button class="button secondary filter-button active" data-filter="all" aria-pressed="true">All</button>
                        <button class="button secondary filter-button" data-filter="Medical" aria-pressed="false">Medical</button>
                        <button class="button secondary filter-button" data-filter="Ethics" aria-pressed="false">Ethics</button>
                        <button class="button secondary filter-button" data-filter="Regulatory" aria-pressed="false">Regulatory</button>
                        <button class="button secondary filter-button" data-filter="Scenario" aria-pressed="false">Scenarios</button>
                    </div>
                </div>
                <div class="content-list" id="content-library-list" aria-live="polite">
                    <!-- Content items will be loaded here -->
                     <p class="text-center text-light">Loading content...</p>
                </div>
            </div>
        </section>

        <section id="profile" class="section" role="region" aria-labelledby="profile-heading">
            <h1 id="profile-heading">User Profile & Preferences</h1>
            <div class="card" role="region" aria-labelledby="edit-profile-heading">
                <h2 class="card-title" id="edit-profile-heading">Edit Profile</h2>
                <form class="profile-form" id="profile-form" novalidate> <!-- Add novalidate to handle validation via JS -->
                    <div class="form-group">
                        <label for="profile-name">Full Name</label>
                        <input type="text" id="profile-name" value="Dr. Jane Doe" required aria-required="true">
                        <div class="error-message" id="profile-name-error" aria-live="polite"></div>
                    </div>
                    <div class="form-group">
                        <label for="profile-email">Email</label>
                        <input type="email" id="profile-email" value="jane.doe@example.com" required aria-required="true">
                         <div class="error-message" id="profile-email-error" aria-live="polite"></div>
                    </div>
                     <div class="form-group">
                        <label for="profile-specialty">Specialty</label>
                        <input type="text" id="profile-specialty" value="Cardiology">
                    </div>
                    <div class="form-group">
                        <label for="profile-preferences">Learning Preferences</label>
                        <textarea id="profile-preferences">Prefer video content and interactive simulations.</textarea>
                    </div>
                    <div class="flex-end">
                        <button class="button" type="submit"><i class="material-symbols-rounded">save</i> Save Profile</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="credentialing" class="section" role="region" aria-labelledby="credentialing-heading">
            <h1 id="credentialing-heading">Credentialing Documentation Generation</h1>
            <div class="card" role="region" aria-labelledby="generate-doc-heading">
                <h2 class="card-title" id="generate-doc-heading">Generate Documentation</h2>
                <p>Select completed modules or assessments to include in your credentialing report.</p>
                 <div class="form-group">
                    <label for="select-items-doc">Select Items:</label>
                    <select id="select-items-doc" multiple style="min-height: 150px;" aria-label="Select items for document">
                        <!-- Options will be populated by JS -->
                    </select>
                 </div>
                <div class="flex-end">
                    <button class="button" id="generate-doc-preview"><i class="material-symbols-rounded">visibility</i> Generate Preview</button>
                </div>
                <div class="document-preview mt-3" id="document-preview" aria-live="polite">
                    Document preview will appear here.
                </div>
                <div class="flex-end mt-3">
                     <button class="button secondary" id="download-document" disabled><i class="material-symbols-rounded">download</i> Download Document</button>
                </div>
            </div>
        </section>

    </main>

    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // --- Simulated Data ---
        const userData = {
            name: "Dr. Jane Doe",
            avatar: "JD",
            specialty: "Cardiology",
            preferences: "Prefer video content and interactive simulations.",
            modulesCompleted: 18,
            totalModules: 30,
            certProgress: 75, // Percentage
            lastAssessmentScore: 88, // Percentage
            recommendedModules: [
                { id: 'mod-cardio-1', title: 'Advanced ECG Interpretation', description: 'Deep dive into complex ECG patterns.', progress: 60 },
                { id: 'mod-pharma-2', title: 'New Anticoagulants', description: 'Latest guidelines and drug interactions.', progress: 0 },
                { id: 'mod-ethics-3', title: 'Patient Confidentiality in Digital Age', description: 'Navigating HIPAA and electronic records.', progress: 0 },
                 { id: 'mod-reg-4', title: 'Understanding Medicare Part D', description: 'Coverage, eligibility, and formulary basics.', progress: 100 }, // Completed example
            ],
            certifications: [
                { id: 'cert-cardio', name: 'Board Certification in Cardiology', status: 'In Progress', progress: 75 },
                { id: 'cert-acls', name: 'Advanced Cardiovascular Life Support (ACLS)', status: 'Complete', progress: 100 },
                { id: 'cert-pals', name: 'Pediatric Advanced Life Support (PALS)', status: 'Expired', progress: 50 },
            ],
            progressData: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Modules Completed',
                    data: [2, 5, 8, 12, 15, 18], // Initial data matches modulesCompleted
                    backgroundColor: "rgba(0, 123, 255, 0.2)",
                    borderColor: "var(--primary-blue)",
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3
                }]
            },
             contentLibrary: [
                { id: 'lib-mod-1', title: 'Basic Life Support (BLS) Refresher', type: 'Module', tags: ['Medical'], description: 'Review of fundamental BLS procedures.' },
                { id: 'lib-mod-2', title: 'Opioid Prescribing Guidelines', type: 'Module', tags: ['Medical', 'Regulatory'], description: 'Current best practices for opioid prescription.' },
                { id: 'lib-scenario-1', title: 'Managing a Code Blue Simulation', type: 'Scenario', tags: ['Medical', 'Scenario'], description: 'Interactive simulation of a cardiac arrest scenario.' },
                { id: 'lib-ethics-1', title: 'Ethical Dilemmas in End-of-Life Care', type: 'Module', tags: ['Ethics'], description: 'Discussion of common ethical challenges.' },
                { id: 'lib-reg-1', title: 'HIPAA Compliance Updates 2024', type: 'Module', tags: ['Regulatory'], description: 'Overview of recent changes to HIPAA regulations.' },
                 { id: 'lib-mod-3', title: 'Pediatric Dosage Calculations', type: 'Module', tags: ['Medical'], description: 'Practice problems for calculating pediatric medication dosages.' },
                 { id: 'lib-scenario-2', title: 'Patient Communication in Difficult Situations', type: 'Scenario', tags: ['Ethics', 'Scenario'], description: 'Role-playing scenarios for challenging patient interactions.' },
            ],
             assessmentQuestions: [
                 { id: 1, text: 'What is the first line treatment for anaphylaxis?', type: 'radio', options: ['Epinephrine', 'Diphenhydramine', 'Prednisone', 'Albuterol'], answer: 'Epinephrine', feedback: 'Epinephrine is the correct first-line treatment for anaphylaxis due to its vasoconstrictive and bronchodilating effects.' },
                 { id: 2, text: 'List three common side effects of ACE inhibitors (e.g., cough, angioedema, hyperkalemia).', type: 'text', answer: ['cough', 'angioedema', 'hyperkalemia'], feedback: 'Common side effects of ACE inhibitors include cough, angioedema, and hyperkalemia. Other potential effects exist.' },
                 { id: 3, text: 'True or False: All patient information can be shared with family members.', type: 'radio', options: ['True', 'False'], answer: 'False', feedback: 'False. Patient information sharing is governed by privacy regulations (like HIPAA) and requires patient consent, except in specific circumstances.' },
                 { id: 4, text: 'Select all symptoms commonly associated with a myocardial infarction:', type: 'checkbox', options: ['Chest pain', 'Shortness of breath', 'Left arm pain', 'Headache', 'Nausea'], answer: ['Chest pain', 'Shortness of breath', 'Left arm pain', 'Nausea'], feedback: 'Common MI symptoms include chest pain (often radiating), shortness of breath, left arm pain, and nausea. Headache is less typical.' },
                  { id: 5, text: 'Which of the following is a key principle of medical ethics?', type: 'select', options: ['Autonomy', 'Efficiency', 'Profitability', 'Convenience'], answer: 'Autonomy', feedback: 'Autonomy (respecting patient decisions) is a core principle of medical ethics, alongside Beneficence, Non-maleficence, and Justice.' },
             ],
             assessmentAnswers: [], // Store user answers here
             completedModules: [
                 { id: 'mod-reg-4', title: 'Understanding Medicare Part D', completionDate: '2023-12-10' },
                 { id: 'lib-mod-1', title: 'Basic Life Support (BLS) Refresher', completionDate: '2024-01-20' },
                 { id: 'lib-ethics-1', title: 'Ethical Dilemmas in End-of-Life Care', completionDate: '2024-02-15' },
             ],
             completedScenarios: [
                 { id: 'lib-scenario-1', title: 'Managing a Code Blue Simulation', completionDate: '2024-03-01' },
             ],
             assessmentHistory: [ // Simulate some assessment history
                 { date: '2023-11-01', score: 78 },
                 { date: '2024-05-15', score: 88 }
             ]
        };

        // --- DOM Elements ---
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const header = document.querySelector('.header');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');
        const hamburgerMenu = document.querySelector('.hamburger-menu');
        const loadingIndicator = document.getElementById('loading-indicator');

        // Dashboard elements
        const dashboardUserNameEl = document.getElementById('dashboard-user-name');
        const modulesCompletedEl = document.getElementById('modules-completed');
        const certProgressEl = document.getElementById('cert-progress');
        const assessmentScoreEl = document.getElementById('assessment-score');
        const recommendedModulesListEl = document.getElementById('recommended-modules-list');
        const userAvatarEl = document.getElementById('user-avatar');
        const userNameEl = document.getElementById('user-name');


        // Assessment elements
        const assessmentInstructionsCard = document.getElementById('assessment-instructions-card');
        const startAssessmentButton = document.getElementById('start-assessment');
        const assessmentQuestionCard = document.getElementById('assessment-question-card');
        const assessmentResultsCard = document.getElementById('assessment-results-card');
        const resultsSummaryEl = document.getElementById('results-summary');
        const retakeAssessmentButton = document.getElementById('retake-assessment');
        const currentQuestionNumberEl = document.getElementById('current-question-number');
        const totalQuestionsEl = document.getElementById('total-questions');
        const assessmentProgressFillEl = document.getElementById('assessment-progress-fill');
        const questionDisplayEl = document.getElementById('question-display');
        const prevQuestionButton = document.getElementById('prev-question');
        const nextQuestionButton = document.getElementById('next-question');
        const submitAssessmentButton = document.getElementById('submit-assessment');

        // Module Viewer elements
        const moduleViewerContentEl = document.getElementById('module-viewer-content');
        const moduleViewerHeadingEl = document.getElementById('module-viewer-heading');


        // Progress Tracking elements
        let progressChart = null;
        const progressChartCanvas = document.getElementById('progressChart');
        const progressChartControls = document.getElementById('progressChartControls');
        const progressChartLineColorInput = document.getElementById('progressChartLineColor');
        const progressChartFillColorInput = document.getElementById('progressChartFillColor');
        const progressChartTypeSelect = document.getElementById('progressChartType');
        const progressChartFontSizeInput = document.getElementById('progressChartFontSize');
        const completedModulesListEl = document.getElementById('completed-modules-list');

        // Certification Management elements
        const certificationListEl = document.getElementById('certification-list');

        // Practice Scenarios elements
        const scenarioAreaEl = document.getElementById('scenario-area');
        const scenarioHeadingEl = document.getElementById('scenario-heading');
        const scenarioControlsEl = document.getElementById('scenario-controls');
        const startScenarioButton = document.getElementById('start-scenario');
        const resetScenarioButton = document.getElementById('reset-scenario');
        const simulateScenarioCompletionButton = document.getElementById('simulate-scenario-completion');


        // Content Library elements
        const contentSearchInput = document.getElementById('content-search');
        const filterButtons = document.querySelectorAll('.filter-button');
        const contentLibraryListEl = document.getElementById('content-library-list');

        // Profile elements
        const profileForm = document.getElementById('profile-form');
        const profileNameInput = document.getElementById('profile-name');
        const profileEmailInput = document.getElementById('profile-email');
        const profileSpecialtyInput = document.getElementById('profile-specialty');
        const profilePreferencesTextarea = document.getElementById('profile-preferences');
        const profileNameError = document.getElementById('profile-name-error');
        const profileEmailError = document.getElementById('profile-email-error');


        // Credentialing Documentation elements
        const credentialingSelectItems = document.getElementById('select-items-doc');
        const generateDocPreviewButton = document.getElementById('generate-doc-preview');
        const documentPreviewEl = document.getElementById('document-preview');
        const downloadDocumentButton = document.getElementById('download-document');


        // --- State Variables ---
        let currentAssessmentQuestionIndex = 0;
        let currentFilter = 'all';
        let currentSearchTerm = '';
        let currentScenario = null; // To hold the currently viewed scenario data


        // --- Functions ---

        // Loading Indicator
        function showLoading() {
            loadingIndicator.classList.add('active');
             loadingIndicator.setAttribute('aria-hidden', 'false');
        }

        function hideLoading() {
            loadingIndicator.classList.remove('active');
             loadingIndicator.setAttribute('aria-hidden', 'true');
        }


        // Navigation
        function navigateTo(sectionId) {
            showLoading();
            // Simulate loading time
            setTimeout(() => {
                sections.forEach(section => {
                    section.classList.remove('active');
                });
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                     // Announce page change for screen readers
                    const mainHeading = targetSection.querySelector('h1');
                    if(mainHeading) {
                        mainHeading.setAttribute('tabindex', '-1'); // Make heading focusable
                        mainHeading.focus(); // Focus the main heading of the new section
                    }
                }


                navLinks.forEach(link => {
                    if (link.getAttribute('href') === `#${sectionId}`) {
                        link.classList.add('active');
                         link.setAttribute('aria-current', 'page');
                    } else {
                        link.classList.remove('active');
                         link.removeAttribute('aria-current');
                    }
                });

                // Close sidebar on mobile after navigation
                if (window.innerWidth <= 768) {
                     document.body.classList.remove('sidebar-open');
                }

                // Initialize section content if needed
                initializeSection(sectionId);
                hideLoading();

            }, 300); // Simulate a short load time
        }

        function initializeSection(sectionId) {
             switch (sectionId) {
                 case 'dashboard':
                     renderDashboard();
                     break;
                 case 'assessment':
                     // State managed by buttons, ensure initial state is correct
                     if (!assessmentQuestionCard.classList.contains('active') && !assessmentResultsCard.classList.contains('active')) {
                          assessmentInstructionsCard.style.display = 'block';
                          assessmentQuestionCard.style.display = 'none';
                          assessmentResultsCard.style.display = 'none';
                     }
                     break;
                 case 'modules':
                     // Content loaded via clicks from dashboard/library
                     // Ensure default message is shown if no module is loaded
                     if (!moduleViewerContentEl.dataset.loaded) {
                          moduleViewerContentEl.innerHTML = '<p class="text-center text-light">Select a module from the Content Library or Dashboard recommendations to start learning.</p>';
                          moduleViewerHeadingEl.textContent = 'Module Viewer';
                     }
                     break;
                 case 'progress':
                     renderProgressChart();
                     renderCompletedModulesList();
                     break;
                 case 'certification':
                     renderCertificationList();
                     break;
                 case 'scenarios':
                     // Content loaded via clicks from library
                      if (!scenarioAreaEl.dataset.loaded) {
                         scenarioHeadingEl.textContent = 'Scenario Viewer';
                         scenarioAreaEl.innerHTML = '<p class="text-center text-light">Select a scenario from the Content Library to begin.</p>';
                         scenarioControlsEl.style.display = 'none';
                      }
                     break;
                 case 'library':
                      renderContentLibrary();
                      break;
                 case 'profile':
                     renderProfileForm();
                     break;
                 case 'credentialing':
                      populateCredentialingSelect();
                      break;
             }
        }

        // Dashboard
        function renderDashboard() {
            dashboardUserNameEl.textContent = userData.name;
            modulesCompletedEl.textContent = `${userData.modulesCompleted}/${userData.totalModules}`;
            certProgressEl.textContent = `${userData.certProgress}%`;
            assessmentScoreEl.textContent = userData.lastAssessmentScore > 0 ? `${userData.lastAssessmentScore}%` : '--%';

            recommendedModulesListEl.innerHTML = userData.recommendedModules.map(module => `
                <button class="module-item" data-item-id="${module.id}" data-item-type="Module" aria-label="View module: ${module.title}">
                    <h4>${module.title}</h4>
                    <p>${module.description}</p>
                    <div class="progress-bar-container" role="progressbar" aria-valuenow="${module.progress}" aria-valuemin="0" aria-valuemax="100" aria-label="Module progress">
                        <div class="progress-bar" style="width: ${module.progress}%;"></div>
                    </div>
                </button>
            `).join('');

             // Add click listeners to recommended modules (delegated)
             if (userData.recommendedModules.length === 0) {
                  recommendedModulesListEl.innerHTML = '<p class="text-center text-light">No recommendations at this time.</p>';
             }
        }

        // Assessment
        function startAssessment() {
            currentAssessmentQuestionIndex = 0;
            userData.assessmentAnswers = new Array(userData.assessmentQuestions.length).fill(null); // Reset answers
            assessmentInstructionsCard.style.display = 'none';
            assessmentResultsCard.style.display = 'none';
            assessmentQuestionCard.style.display = 'block';
            totalQuestionsEl.textContent = userData.assessmentQuestions.length;
            renderAssessmentQuestion();
             // Focus the question card heading for accessibility
             assessmentQuestionCard.querySelector('.card-title').focus();
        }

        function renderAssessmentQuestion() {
            const question = userData.assessmentQuestions[currentAssessmentQuestionIndex];
            let optionsHtml = '';

            if (question.type === 'radio') {
                optionsHtml = question.options.map(option => `
                    <div class="form-group">
                        <input type="radio" id="q${question.id}-opt-${option.replace(/\s+/g, '-')}" name="question-${question.id}" value="${option}" ${userData.assessmentAnswers[currentAssessmentQuestionIndex] === option ? 'checked' : ''}>
                        <label for="q${question.id}-opt-${option.replace(/\s+/g, '-')}" style="display: inline-block; margin-left: 5px;">${option}</label>
                    </div>
                `).join('');
            } else if (question.type === 'text') {
                 optionsHtml = `
                     <div class="form-group">
                         <label for="q${question.id}-answer" class="sr-only">Your Answer:</label>
                         <input type="text" id="q${question.id}-answer" value="${userData.assessmentAnswers[currentAssessmentQuestionIndex] || ''}" aria-label="Answer to question ${currentAssessmentQuestionIndex + 1}">
                     </div>
                 `;
            } else if (question.type === 'checkbox') {
                 optionsHtml = question.options.map(option => `
                     <div class="form-group">
                         <input type="checkbox" id="q${question.id}-opt-${option.replace(/\s+/g, '-')}" name="question-${question.id}" value="${option}" ${userData.assessmentAnswers[currentAssessmentQuestionIndex]?.includes(option) ? 'checked' : ''}>
                         <label for="q${question.id}-opt-${option.replace(/\s+/g, '-')}" style="display: inline-block; margin-left: 5px;">${option}</label>
                     </div>
                 `).join('');
            } else if (question.type === 'select') {
                 optionsHtml = `
                     <div class="form-group">
                         <label for="q${question.id}-answer" class="sr-only">Select your answer:</label>
                         <select id="q${question.id}-answer" aria-label="Answer to question ${currentAssessmentQuestionIndex + 1}">
                             <option value="">-- Select an option --</option>
                             ${question.options.map(option => `
                                 <option value="${option}" ${userData.assessmentAnswers[currentAssessmentQuestionIndex] === option ? 'selected' : ''}>${option}</option>
                             `).join('')}
                         </select>
                     </div>
                 `;
            }


            questionDisplayEl.innerHTML = `
                <p>${question.text}</p>
                <div>${optionsHtml}</div>
            `;

            // Update progress bar
            const progress = ((currentAssessmentQuestionIndex + 1) / userData.assessmentQuestions.length) * 100;
            assessmentProgressFillEl.style.width = `${progress}%`;
            assessmentProgressFillEl.parentElement.setAttribute('aria-valuenow', progress.toFixed(0));
            currentQuestionNumberEl.textContent = currentAssessmentQuestionIndex + 1;

            // Update navigation buttons
            prevQuestionButton.disabled = currentAssessmentQuestionIndex === 0;
            nextQuestionButton.style.display = currentAssessmentQuestionIndex === userData.assessmentQuestions.length - 1 ? 'none' : 'inline-flex';
            submitAssessmentButton.style.display = currentAssessmentQuestionIndex === userData.assessmentQuestions.length - 1 ? 'inline-flex' : 'none';

             // Add event listeners for answer input (delegated or re-attached)
            // Using event delegation on questionDisplayEl is more robust
            questionDisplayEl.onchange = (e) => {
                 const target = e.target;
                 const question = userData.assessmentQuestions[currentAssessmentQuestionIndex];
                 if (!question) return;

                 if (question.type === 'radio' && target.type === 'radio' && target.name === `question-${question.id}`) {
                      userData.assessmentAnswers[currentAssessmentQuestionIndex] = target.value;
                 } else if (question.type === 'checkbox' && target.type === 'checkbox' && target.name === `question-${question.id}`) {
                      const checkedOptions = Array.from(questionDisplayEl.querySelectorAll(`input[name="question-${question.id}"]:checked`)).map(cb => cb.value);
                      userData.assessmentAnswers[currentAssessmentQuestionIndex] = checkedOptions;
                 } else if (question.type === 'select' && target.tagName === 'SELECT' && target.id === `q${question.id}-answer`) {
                      userData.assessmentAnswers[currentAssessmentQuestionIndex] = target.value;
                 }
            };
             questionDisplayEl.oninput = (e) => {
                 const target = e.target;
                 const question = userData.assessmentQuestions[currentAssessmentQuestionIndex];
                 if (!question) return;

                 if (question.type === 'text' && target.type === 'text' && target.id === `q${question.id}-answer`) {
                      userData.assessmentAnswers[currentAssessmentQuestionIndex] = target.value;
                 }
             };


             // Focus the first interactive element in the question area for accessibility
             const firstInput = questionDisplayEl.querySelector('input, select, textarea');
             if(firstInput) {
                 firstInput.focus();
             }
        }

        function saveCurrentAnswer() {
             const question = userData.assessmentQuestions[currentAssessmentQuestionIndex];
             if (!question) return; // Should not happen if index is valid

             if (question.type === 'radio') {
                 const selected = questionDisplayEl.querySelector(`input[name="question-${question.id}"]:checked`);
                 userData.assessmentAnswers[currentAssessmentQuestionIndex] = selected ? selected.value : null;
             } else if (question.type === 'text') {
                 userData.assessmentAnswers[currentAssessmentQuestionIndex] = questionDisplayEl.querySelector(`input[type="text"]`).value;
             } else if (question.type === 'checkbox') {
                 const checkedOptions = Array.from(questionDisplayEl.querySelectorAll(`input[name="question-${question.id}"]:checked`)).map(cb => cb.value);
                 userData.assessmentAnswers[currentAssessmentQuestionIndex] = checkedOptions;
             } else if (question.type === 'select') {
                  userData.assessmentAnswers[currentAssessmentQuestionIndex] = questionDisplayEl.querySelector(`select`).value;
             }
        }

        function nextAssessmentQuestion() {
             saveCurrentAnswer();
            if (currentAssessmentQuestionIndex < userData.assessmentQuestions.length - 1) {
                currentAssessmentQuestionIndex++;
                renderAssessmentQuestion();
            }
        }

        function prevAssessmentQuestion() {
             saveCurrentAnswer();
            if (currentAssessmentQuestionIndex > 0) {
                currentAssessmentQuestionIndex--;
                renderAssessmentQuestion();
            }
        }

        function submitAssessment() {
             saveCurrentAnswer();
            showLoading();

            // Simulate scoring
            let correctCount = 0;
            const detailedResults = userData.assessmentQuestions.map((q, index) => {
                const userAnswer = userData.assessmentAnswers[index];
                let isCorrect = false;
                if (q.type === 'radio' || q.type === 'select') {
                    isCorrect = userAnswer === q.answer;
                } else if (q.type === 'text') {
                    // Simple text matching (case insensitive, trim whitespace)
                     if (userAnswer) {
                        isCorrect = q.answer.some(ans => ans.toLowerCase().trim() === userAnswer.toLowerCase().trim());
                     } else {
                         isCorrect = false; // No answer is incorrect
                     }
                } else if (q.type === 'checkbox') {
                     // Check if user answer array matches correct answer array (order doesn't matter)
                     if (userAnswer && Array.isArray(userAnswer) && userAnswer.length === q.answer.length) {
                         isCorrect = q.answer.every(ans => userAnswer.includes(ans));
                     } else {
                         isCorrect = false;
                     }
                }

                if (isCorrect) {
                    correctCount++;
                }
                return {
                    question: q.text,
                    userAnswer: Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer,
                    correctAnswer: Array.isArray(q.answer) ? q.answer.join(', ') : q.answer,
                    isCorrect: isCorrect,
                    feedback: q.feedback
                };
            });


            const score = (correctCount / userData.assessmentQuestions.length) * 100;
            userData.lastAssessmentScore = Math.round(score); // Update simulated data
             // Add to history (simulate)
             userData.assessmentHistory.push({
                 date: new Date().toISOString().slice(0, 10),
                 score: userData.lastAssessmentScore
             });


            // Simulate backend processing/saving
            setTimeout(() => {
                 hideLoading();
                 // Display results
                 assessmentQuestionCard.style.display = 'none';
                 assessmentResultsCard.style.display = 'block';

                 resultsSummaryEl.innerHTML = `
                     <h3>Your Score: ${userData.lastAssessmentScore}%</h3>
                     <p>You answered ${correctCount} out of ${userData.assessmentQuestions.length} questions correctly.</p>
                     <h4>Review:</h4>
                     <ul>
                         ${detailedResults.map(result => `
                             <li>
                                 <p><strong>Q:</strong> ${result.question}</p>
                                 <p><strong>Your Answer:</strong> ${result.userAnswer || 'No Answer'}</p>
                                 <p><strong>Correct Answer:</strong> ${result.correctAnswer}</p>
                                 <p><strong style="color: ${result.isCorrect ? 'var(--secondary-green)' : '#dc3545'};">${result.isCorrect ? 'Correct' : 'Incorrect'}</strong></p>
                                 ${result.feedback ? `<p style="font-size:0.9em; color: var(--text-light); margin-top: ${getComputedStyle(document.documentElement).getPropertyValue('--spacing-unit')}px;"><em>Feedback:</em> ${result.feedback}</p>` : ''}
                             </li>
                         `).join('')}
                     </ul>
                 `;

                 // Update dashboard score display
                 assessmentScoreEl.textContent = `${userData.lastAssessmentScore}%`;

                 // Announce results for screen readers
                 assessmentResultsCard.querySelector('.card-title').focus();

            }, 1000); // Simulate processing time
        }

        function retakeAssessment() {
             assessmentResultsCard.style.display = 'none';
             assessmentInstructionsCard.style.display = 'block';
             // Reset state variables will happen when 'Start Assessment' is clicked again
             assessmentInstructionsCard.querySelector('.card-title').focus();
        }


        // Module Viewer
        function renderModuleViewer(title, description, id) {
             moduleViewerHeadingEl.textContent = `Module: ${title}`;
             moduleViewerContentEl.innerHTML = `
                 <p>${description}</p>
                 <p>Module content for "${title}" goes here. This could include text, images, videos, interactive elements, etc.</p>
                 <p>Simulating completion for module ID: ${id}</p>
                 <div class="flex-end mt-3">
                     <button class="button" onclick="simulateModuleCompletion('${id}', '${title}')"><i class="material-symbols-rounded">check_circle</i> Mark as Complete (Simulated)</button>
                 </div>
             `;
             moduleViewerContentEl.dataset.loaded = 'true'; // Mark as loaded
             moduleViewerHeadingEl.focus(); // Focus heading for accessibility
        }

        function simulateModuleCompletion(moduleId, moduleTitle) {
             if (!userData.completedModules.find(m => m.id === moduleId)) {
                 userData.completedModules.push({
                     id: moduleId,
                     title: moduleTitle,
                     completionDate: new Date().toISOString().slice(0, 10) // YYYY-MM-DD
                 });
                 userData.modulesCompleted++; // Update dashboard count
                 modulesCompletedEl.textContent = `${userData.modulesCompleted}/${userData.totalModules}`;
                 console.log(`Module "${moduleTitle}" marked as complete.`);
                 // Re-render completed modules list if currently on progress page
                 if (document.getElementById('progress').classList.contains('active')) {
                      renderCompletedModulesList();
                 }
                  // Update progress chart data (simulating data change)
                  // Find the last data point and increment it
                  if (userData.progressData.datasets[0].data.length > 0) {
                      userData.progressData.datasets[0].data[userData.progressData.datasets[0].data.length - 1] = userData.modulesCompleted;
                  } else {
                       // If no data points yet, add the first one
                       userData.progressData.labels.push(new Date().toLocaleDateString('en-US', { month: 'short' })); // Add current month
                       userData.progressData.datasets[0].data.push(userData.modulesCompleted);
                  }
                  if (progressChart) {
                      progressChart.update();
                  }
             } else {
                 console.log(`Module "${moduleTitle}" was already marked complete.`);
             }
             // Simple feedback
             alert(`"${moduleTitle}" marked as complete (simulated).`);
        }


        // Progress Tracking
        function renderProgressChart() {
             if (progressChart) {
                 progressChart.destroy(); // Destroy existing chart before creating a new one
             }

            const ctx = progressChartCanvas.getContext('2d');
            const config = {
                type: progressChartTypeSelect.value, // Use selected type
                data: {
                     labels: userData.progressData.labels,
                     datasets: [{
                         label: userData.progressData.datasets[0].label,
                         data: userData.progressData.datasets[0].data,
                         backgroundColor: progressChartFillColorInput.value, // Use input value
                         borderColor: progressChartLineColorInput.value, // Use input value
                         borderWidth: 2,
                         fill: true,
                         tension: 0.3,
                         pointBackgroundColor: progressChartLineColorInput.value,
                         pointBorderColor: "var(--bg-white)",
                         pointHoverBackgroundColor: "var(--bg-white)",
                         pointHoverBorderColor: progressChartLineColorInput.value,
                     }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: parseInt(progressChartFontSizeInput.value), // Use selected font size
                                    family: 'Inter, sans-serif'
                                },
                                color: "var(--text-color)"
                            }
                        },
                         tooltip: {
                             bodyFont: {
                                 family: 'Inter, sans-serif'
                             },
                             titleFont: {
                                 family: 'Inter, sans-serif',
                                 weight: 'bold'
                             }
                         }
                    },
                     scales: {
                        y: {
                            beginAtZero: true,
                             title: {
                                 display: true,
                                 text: 'Number of Modules',
                                 font: {
                                     size: parseInt(progressChartFontSizeInput.value) + 2,
                                     family: 'Inter, sans-serif',
                                     weight: 'bold'
                                 },
                                 color: "var(--text-color)"
                             },
                            ticks: {
                                font: {
                                    size: parseInt(progressChartFontSizeInput.value),
                                     family: 'Inter, sans-serif'
                                },
                                color: "var(--text-color)",
                                precision: 0 // Display whole numbers
                            },
                             grid: {
                                 color: "rgba(0, 0, 0, 0.05)"
                             }
                        },
                        x: {
                             title: {
                                 display: true,
                                 text: 'Month',
                                  font: {
                                     size: parseInt(progressChartFontSizeInput.value) + 2,
                                     family: 'Inter, sans-serif',
                                     weight: 'bold'
                                 },
                                 color: "var(--text-color)"
                             },
                            ticks: {
                                font: {
                                    size: parseInt(progressChartFontSizeInput.value),
                                     family: 'Inter, sans-serif'
                                },
                                color: "var(--text-color)"
                            },
                             grid: {
                                 color: "rgba(0, 0, 0, 0.05)"
                             }
                        }
                    }
                }
            };

            progressChart = new Chart(ctx, config);

            // Add event listeners for controls if not already added
            if (!progressChartLineColorInput.dataset.listenerAdded) {
                progressChartLineColorInput.addEventListener('input', updateProgressChart);
                progressChartFillColorInput.addEventListener('input', updateProgressChart);
                progressChartTypeSelect.addEventListener('change', updateProgressChart);
                progressChartFontSizeInput.addEventListener('input', updateProgressChart);
                progressChartLineColorInput.dataset.listenerAdded = 'true'; // Mark as added
            }


             // Toggle controls when clicking the chart container
             // Use event delegation on the container
            progressChartCanvas.parentElement.addEventListener('click', (e) => {
                 // Only toggle if click is directly on canvas or container, not controls
                 if (e.target === progressChartCanvas || e.target === progressChartCanvas.parentElement) {
                     progressChartControls.classList.toggle('active');
                      progressChartControls.setAttribute('aria-hidden', !progressChartControls.classList.contains('active'));
                 }
            });


             // Close controls when clicking outside
            document.addEventListener('click', (e) => {
                const isClickInsideChartOrControls = e.target.closest('.chart-container') || e.target.closest('.floating-controls');
                if (!isClickInsideChartOrControls && progressChartControls.classList.contains('active')) {
                    progressChartControls.classList.remove('active');
                     progressChartControls.setAttribute('aria-hidden', 'true');
                }
            });
        }

        function updateProgressChart() {
            if (!progressChart) return;

            const newStrokeColor = progressChartLineColorInput.value;
            const newFillColor = progressChartFillColorInput.value;
            const newChartType = progressChartTypeSelect.value;
            const newFontSize = parseInt(progressChartFontSizeInput.value);

            progressChart.config.type = newChartType;
            progressChart.config.data.datasets[0].borderColor = newStrokeColor;
            progressChart.config.data.datasets[0].backgroundColor = newFillColor;
             progressChart.config.data.datasets[0].pointBackgroundColor = newStrokeColor;
             progressChart.config.data.datasets[0].pointHoverBorderColor = newStrokeColor;


            // Update font size in options
            const updateFont = (obj) => obj?.font && (obj.font.size = newFontSize);
            updateFont(progressChart.options.plugins.legend.labels);
             updateFont(progressChart.options.scales?.y?.title);
            updateFont(progressChart.options.scales?.y?.ticks);
             updateFont(progressChart.options.scales?.x?.title);
            updateFont(progressChart.options.scales?.x?.ticks);


            progressChart.update();
        }

        function renderCompletedModulesList() {
             if (userData.completedModules.length === 0) {
                 completedModulesListEl.innerHTML = '<p class="text-center text-light">No modules completed yet.</p>';
                 return;
             }
             completedModulesListEl.innerHTML = userData.completedModules.map(module => `
                 <li>
                     <span>${module.title}</span>
                     <span class="completion-date">Completed: ${module.completionDate}</span>
                 </li>
             `).join('');
        }


        // Certification Management
        function renderCertificationList() {
             if (userData.certifications.length === 0) {
                 certificationListEl.innerHTML = '<p class="text-center text-light">No certifications added to your profile.</p>';
                 return;
             }
            certificationListEl.innerHTML = userData.certifications.map(cert => `
                <button class="certification-item" data-cert-id="${cert.id}" aria-label="View details for certification: ${cert.name}">
                    <span>${cert.name}</span>
                    <span class="status ${cert.status.toLowerCase().replace(/\s/g, '-')}">${cert.status} (${cert.progress}%)</span>
                </button>
            `).join('');

             // Add click listeners (simulated detail view) - using delegation
            certificationListEl.addEventListener('click', (e) => {
                 const targetButton = e.target.closest('.certification-item');
                 if (targetButton) {
                     const certId = targetButton.dataset.certId;
                     const certName = targetButton.querySelector('span:first-child').textContent;
                     console.log('Clicked certification:', certId);
                     // Simulate showing a modal or navigating to a detail page
                     alert(`Simulating detail view for "${certName}". Progress: ${targetButton.querySelector('.status').textContent}`);
                 }
            });
        }

        // Practice Scenarios
        function renderScenarioViewer(title, id) {
            currentScenario = { id: id, title: title }; // Store current scenario
            scenarioHeadingEl.textContent = `Scenario: ${title}`;
            scenarioAreaEl.innerHTML = `
                <p>Interactive simulation elements for "${title}" go here. This could involve clicking on patient diagrams, selecting treatment options, interpreting data, etc.</p>
                <p>Simulating scenario ID: ${id}</p>
                <p class="text-center text-light mt-3">Click "Start Scenario" below to begin.</p>
            `;
             scenarioAreaEl.dataset.loaded = 'true'; // Mark as loaded
             scenarioControlsEl.style.display = 'flex';
             startScenarioButton.style.display = 'inline-flex';
             resetScenarioButton.style.display = 'none';
             simulateScenarioCompletionButton.style.display = 'none';
             scenarioHeadingEl.focus(); // Focus heading for accessibility
        }

        function startScenario() {
             if (!currentScenario) return;
             console.log('Starting scenario:', currentScenario.id);
             scenarioAreaEl.innerHTML = `
                 <p>Scenario "${currentScenario.title}" is now active. Interact with the elements below.</p>
                 <div class="simulation-placeholder">
                     Interactive Simulation Area Placeholder
                     <p style="font-size: 0.9em; color: var(--text-light); margin-top: ${getComputedStyle(document.documentElement).getPropertyValue('--spacing-unit')}px;">(Click "Simulate Completion" when done)</p>
                 </div>
             `;
             startScenarioButton.style.display = 'none';
             resetScenarioButton.style.display = 'inline-flex';
             simulateScenarioCompletionButton.style.display = 'inline-flex';
             // Focus the simulation area or first interactive element
             scenarioAreaEl.querySelector('.simulation-placeholder').focus();
        }

         function resetScenario() {
             if (!currentScenario) return;
             console.log('Resetting scenario:', currentScenario.id);
             renderScenarioViewer(currentScenario.title, currentScenario.id); // Go back to initial state
         }

         function simulateScenarioCompletion() {
              if (!currentScenario) return;

              if (!userData.completedScenarios.find(s => s.id === currentScenario.id)) {
                 userData.completedScenarios.push({
                     id: currentScenario.id,
                     title: currentScenario.title,
                     completionDate: new Date().toISOString().slice(0, 10) // YYYY-MM-DD
                 });
                 console.log(`Scenario "${currentScenario.title}" marked as complete.`);
             } else {
                 console.log(`Scenario "${currentScenario.title}" was already marked complete.`);
             }
             alert(`Scenario "${currentScenario.title}" completed (simulated).`);
             // Optionally navigate back or show results
             scenarioAreaEl.innerHTML = `
                 <h3>Scenario Complete!</h3>
                 <p>You have completed the "${currentScenario.title}" scenario (simulated).</p>
                 <p>Review your performance summary here (simulated).</p>
             `;
             scenarioControlsEl.style.display = 'flex';
             startScenarioButton.style.display = 'inline-flex'; // Allow retake
             resetScenarioButton.style.display = 'none';
             simulateScenarioCompletionButton.style.display = 'none';
              // Focus the completion message heading
             scenarioAreaEl.querySelector('h3').focus();
         }


        // Content Library
        function renderContentLibrary(filter = currentFilter, searchTerm = currentSearchTerm) {
            currentFilter = filter;
            currentSearchTerm = searchTerm.toLowerCase();

            const filteredItems = userData.contentLibrary.filter(item => {
                const matchesFilter = filter === 'all' || item.tags.includes(filter) || item.type === filter;
                const matchesSearch = searchTerm === '' ||
                                      item.title.toLowerCase().includes(searchTerm) ||
                                      (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                                      item.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                                      item.type.toLowerCase().includes(searchTerm);
                return matchesFilter && matchesSearch;
            });

             // Update filter button active state
             filterButtons.forEach(button => {
                 if (button.dataset.filter === filter) {
                     button.classList.add('active');
                      button.setAttribute('aria-pressed', 'true');
                 } else {
                     button.classList.remove('active');
                      button.setAttribute('aria-pressed', 'false');
                 }
             });


             if (filteredItems.length === 0) {
                 contentLibraryListEl.innerHTML = '<p class="text-center text-light">No content found matching your criteria.</p>';
                 return;
             }

            contentLibraryListEl.innerHTML = filteredItems.map(item => `
                <button class="content-item" data-item-id="${item.id}" data-item-type="${item.type}" aria-label="View ${item.type}: ${item.title}">
                    <h4>${item.title}</h4>
                    <p>Type: ${item.type} | Tags: ${item.tags.join(', ')}</p>
                </button>
            `).join('');

             // Add click listeners to content items (delegated)
            contentLibraryListEl.addEventListener('click', (e) => {
                 const targetButton = e.target.closest('.content-item');
                 if (targetButton) {
                     const itemId = targetButton.dataset.itemId;
                     const itemType = targetButton.dataset.itemType;
                     const itemTitle = targetButton.querySelector('h4').textContent;

                     console.log('Clicked content item:', itemId, itemType);
                      if (itemType === 'Module') {
                          // Find the full module data to get description
                          const moduleData = userData.contentLibrary.find(m => m.id === itemId);
                          renderModuleViewer(itemTitle, moduleData.description || 'Generic module description.', itemId);
                          navigateTo('modules');
                      } else if (itemType === 'Scenario') {
                          renderScenarioViewer(itemTitle, itemId);
                          navigateTo('scenarios');
                      }
                 }
            });
        }

        // Profile & Preferences
        function renderProfileForm() {
             profileNameInput.value = userData.name;
             profileEmailInput.value = userData.email || ''; // Add email to data if needed
             profileSpecialtyInput.value = userData.specialty || '';
             profilePreferencesTextarea.value = userData.preferences || '';
             // Clear any previous validation messages
             profileNameInput.classList.remove('error');
             profileNameError.textContent = '';
             profileNameInput.setAttribute('aria-invalid', 'false');
             profileEmailInput.classList.remove('error');
             profileEmailError.textContent = '';
             profileEmailInput.setAttribute('aria-invalid', 'false');
        }

        function validateProfileForm() {
             let isValid = true;

             // Name validation (basic: not empty)
             if (profileNameInput.value.trim() === '') {
                 profileNameInput.classList.add('error');
                 profileNameError.textContent = 'Full Name is required.';
                 profileNameInput.setAttribute('aria-invalid', 'true');
                 isValid = false;
             } else {
                 profileNameInput.classList.remove('error');
                 profileNameError.textContent = '';
                 profileNameInput.setAttribute('aria-invalid', 'false');
             }

             // Email validation (basic: not empty and contains @)
             const emailValue = profileEmailInput.value.trim();
             // Simple regex for email format check
             const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
             if (emailValue === '') {
                 profileEmailInput.classList.add('error');
                 profileEmailError.textContent = 'Email is required.';
                 profileEmailInput.setAttribute('aria-invalid', 'true');
                 isValid = false;
             } else if (!emailRegex.test(emailValue)) {
                  profileEmailInput.classList.add('error');
                 profileEmailError.textContent = 'Please enter a valid email address.';
                 profileEmailInput.setAttribute('aria-invalid', 'true');
                 isValid = false;
             }
             else {
                 profileEmailInput.classList.remove('error');
                 profileEmailError.textContent = '';
                 profileEmailInput.setAttribute('aria-invalid', 'false');
             }

             return isValid;
        }

        function saveProfile(event) {
             event.preventDefault();
             if (validateProfileForm()) {
                 showLoading();
                 // Simulate saving data
                 setTimeout(() => {
                     userData.name = profileNameInput.value.trim();
                     userData.email = profileEmailInput.value.trim();
                     userData.specialty = profileSpecialtyInput.value.trim();
                     userData.preferences = profilePreferencesTextarea.value.trim();
                     userData.avatar = userData.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                     // Update header user info
                     userAvatarEl.textContent = userData.avatar;
                     userNameEl.textContent = userData.name;
                     dashboardUserNameEl.textContent = userData.name;


                     // Simulate successful save feedback
                     alert('Profile saved successfully!');
                     hideLoading();
                 }, 500); // Simulate save time
             } else {
                 // Form validation failed, focus the first error field
                 const firstErrorField = profileForm.querySelector('.form-group input.error, .form-group textarea.error, .form-group select.error');
                 if (firstErrorField) {
                     firstErrorField.focus();
                 }
             }
        }

        // Credentialing Documentation
        function populateCredentialingSelect() {
             const selectElement = credentialingSelectItems;
             selectElement.innerHTML = ''; // Clear existing options

             const items = [];

             // Add completed modules
             userData.completedModules.forEach(mod => {
                 items.push({
                     value: `module-${mod.id}`,
                     text: `Module: ${mod.title} (Completed: ${mod.completionDate})`
                 });
             });

              // Add completed scenarios
             userData.completedScenarios.forEach(scenario => {
                 items.push({
                     value: `scenario-${scenario.id}`,
                     text: `Scenario: ${scenario.title} (Completed: ${scenario.completionDate})`
                 });
             });

             // Add assessment results (most recent)
             if (userData.assessmentHistory && userData.assessmentHistory.length > 0) {
                 // Sort history by date descending to get the latest
                 const sortedHistory = [...userData.assessmentHistory].sort((a, b) => new Date(b.date) - new Date(a.date));
                 items.push({
                     value: `assessment-${sortedHistory[0].date}`, // Use date as identifier
                     text: `Latest Assessment Result (${sortedHistory[0].score}%) - ${sortedHistory[0].date}`
                 });
                 // Could add more history items here if needed
             }


             if (items.length === 0) {
                 const option = document.createElement('option');
                 option.value = '';
                 option.textContent = 'No completed items available.';
                 option.disabled = true;
                 selectElement.appendChild(option);
                 generateDocPreviewButton.disabled = true;
             } else {
                 items.forEach(item => {
                     const option = document.createElement('option');
                     option.value = item.value;
                     option.textContent = item.text;
                     selectElement.appendChild(option);
                 });
                 generateDocPreviewButton.disabled = false;
             }
             documentPreviewEl.innerHTML = '<p class="text-center text-light">Select items and click "Generate Preview".</p>';
             downloadDocumentButton.disabled = true;
        }

        function generateDocumentPreview() {
             const selectedOptions = Array.from(credentialingSelectItems.selectedOptions);

             if (selectedOptions.length === 0) {
                 documentPreviewEl.innerHTML = '<p class="text-center text-light">Please select items to include.</p>';
                 downloadDocumentButton.disabled = true;
                 return;
             }

             showLoading();
             // Simulate document generation
             setTimeout(() => {
                 let previewContent = `<h3>Credentialing Documentation for ${userData.name}</h3>`;
                 previewContent += `<p>Generated on: ${new Date().toLocaleDateString()}</p>`;
                 previewContent += `<h4>Selected Items:</h4><ul>`;

                 selectedOptions.forEach(option => {
                     previewContent += `<li>${option.textContent}</li>`;
                 });

                 previewContent += `</ul>`;
                 previewContent += `<p>This is a simulated preview. A real document would contain more detailed information like course outlines, assessment breakdown, etc.</p>`;

                 documentPreviewEl.innerHTML = previewContent;
                 downloadDocumentButton.disabled = false;
                 hideLoading();
                 // Focus the preview heading for accessibility
                 documentPreviewEl.querySelector('h3').focus();
             }, 800); // Simulate generation time
        }

        function downloadDocument() {
             // Simulate document download
             alert('Simulating document download...');
             console.log('Simulating download of credentialing document.');
             // In a real app, this would trigger a file download via backend or client-side generation (e.g., PDF)
        }


        // --- Event Listeners ---

        // Navigation clicks
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = e.target.getAttribute('href').substring(1);
                navigateTo(sectionId);
            });
        });

        // Hamburger menu toggle (for mobile)
        hamburgerMenu.addEventListener('click', () => {
             document.body.classList.toggle('sidebar-open');
             // Manage aria-expanded for accessibility
             const isSidebarOpen = document.body.classList.contains('sidebar-open');
             hamburgerMenu.setAttribute('aria-expanded', isSidebarOpen);
             sidebar.setAttribute('aria-hidden', !isSidebarOpen);
             // Focus the first link in the sidebar when opened
             if (isSidebarOpen) {
                 sidebar.querySelector('nav a').focus();
             } else {
                 // Return focus to the hamburger button when sidebar is closed
                 hamburgerMenu.focus();
             }
        });

        // Close sidebar when clicking outside on mobile/tablet
        mainContent.addEventListener('click', () => {
             if (window.innerWidth <= 768 && document.body.classList.contains('sidebar-open')) {
                 document.body.classList.remove('sidebar-open');
                 hamburgerMenu.setAttribute('aria-expanded', 'false');
                 sidebar.setAttribute('aria-hidden', 'true');
                 hamburgerMenu.focus(); // Return focus
             }
        });


        // Assessment buttons
        startAssessmentButton.addEventListener('click', startAssessment);
        nextQuestionButton.addEventListener('click', nextAssessmentQuestion);
        prevQuestionButton.addEventListener('click', prevAssessmentQuestion);
        submitAssessmentButton.addEventListener('click', submitAssessment);
        retakeAssessmentButton.addEventListener('click', retakeAssessment);

        // Content Library Search and Filter
        contentSearchInput.addEventListener('input', (e) => {
             // Debounce search input slightly
             if (this.searchTimeout) {
                 clearTimeout(this.searchTimeout);
             }
             this.searchTimeout = setTimeout(() => {
                 renderContentLibrary(currentFilter, e.target.value);
             }, 200); // 200ms debounce
        });
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                const filter = button.dataset.filter;
                renderContentLibrary(filter, contentSearchInput.value);
            });
        });

        // Event delegation for Content Library and Recommended Modules clicks
        document.addEventListener('click', (e) => {
             const targetButton = e.target.closest('.content-item, .module-item');
             if (targetButton) {
                 const itemId = targetButton.dataset.itemId;
                 const itemType = targetButton.dataset.itemType;
                 const itemTitle = targetButton.querySelector('h4').textContent;

                 console.log('Clicked content item:', itemId, itemType);
                 showLoading(); // Show loading for navigation
                 setTimeout(() => { // Simulate load time
                     if (itemType === 'Module') {
                         // Find the full module data to get description
                         const moduleData = userData.contentLibrary.find(m => m.id === itemId) || userData.recommendedModules.find(m => m.id === itemId);
                         renderModuleViewer(itemTitle, moduleData?.description || 'Generic module description.', itemId);
                         navigateTo('modules');
                     } else if (itemType === 'Scenario') {
                         const scenarioData = userData.contentLibrary.find(s => s.id === itemId);
                         renderScenarioViewer(itemTitle, itemId);
                         navigateTo('scenarios');
                     }
                     hideLoading();
                 }, 300); // Simulate load time
             }
        });


        // Profile Form Submission
        profileForm.addEventListener('submit', saveProfile);

        // Credentialing Document Generation
        generateDocPreviewButton.addEventListener('click', generateDocumentPreview);
        downloadDocumentButton.addEventListener('click', downloadDocument);

        // Scenario Controls (Delegated listeners as content changes)
        scenarioControlsEl.addEventListener('click', (e) => {
             const targetButton = e.target.closest('button');
             if (!targetButton || !currentScenario) return; // Ensure a scenario is loaded

             if (targetButton.id === 'start-scenario') {
                 startScenario();
             } else if (targetButton.id === 'reset-scenario') {
                 resetScenario(currentScenario.id, currentScenario.title);
             } else if (targetButton.id === 'simulate-scenario-completion') {
                 simulateScenarioCompletion();
             }
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial state based on body class (for desktop default)
             if (window.innerWidth > 768) {
                 document.body.classList.add('sidebar-open');
                 hamburgerMenu.setAttribute('aria-expanded', 'true');
                 sidebar.setAttribute('aria-hidden', 'false');
             } else {
                 document.body.classList.remove('sidebar-open');
                 hamburgerMenu.setAttribute('aria-expanded', 'false');
                 sidebar.setAttribute('aria-hidden', 'true');
             }

             // Update header user info
             userAvatarEl.textContent = userData.avatar;
             userNameEl.textContent = userData.name;

            // Navigate to the default section (dashboard)
            navigateTo('dashboard');
        });

        // Adjust main content margin and header width on window resize (for sidebar toggle)
        window.addEventListener('resize', () => {
             if (window.innerWidth > 768) {
                 document.body.classList.add('sidebar-open'); // Ensure sidebar is open on desktop
                 hamburgerMenu.setAttribute('aria-expanded', 'true');
                 sidebar.setAttribute('aria-hidden', 'false');
             } else {
                 // On resize to mobile/tablet, if sidebar was open (because it was desktop), close it.
                 // If it was already closed on tablet/mobile, leave it.
                 // The hamburger click/navigateTo handles closing on interaction.
                 if (document.body.classList.contains('sidebar-open') && window.innerWidth <= 768) {
                      document.body.classList.remove('sidebar-open');
                      hamburgerMenu.setAttribute('aria-expanded', 'false');
                      sidebar.setAttribute('aria-hidden', 'true');
                 }
             }
             // Re-render active section to apply potential layout changes (especially charts)
             const activeSection = document.querySelector('.section.active');
             if (activeSection) {
                 initializeSection(activeSection.id);
             }
        });

    </script>

</body>
</html>
