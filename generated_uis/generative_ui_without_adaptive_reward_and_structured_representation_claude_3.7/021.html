<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Modernization & Cloud Migration Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <style>
        :root {
            --color-primary: #007acc; /* Professional Blue */
            --color-primary-dark: #005f99;
            --color-primary-light: rgba(0, 122, 204, 0.1);
            --color-primary-light-alt: rgba(0, 122, 204, 0.2);
            --color-accent: #4CAF50; /* Success Green */
            --color-accent-dark: #388E3C;
            --color-accent-light: rgba(76, 175, 80, 0.1);
            --color-background: #f4f4f4; /* Light Gray Background */
            --color-surface: #ffffff; /* White Surface */
            --color-text-primary: #333; /* Dark Gray Text */
            --color-text-secondary: #666; /* Medium Gray Text */
            --color-border: #e0e0e0; /* Light Gray Border */
            --color-danger: #f44336; /* Red for errors */
            --color-warning: #ff9800; /* Orange for warnings */
            --color-info: #2196f3; /* Blue for info */

            --spacing-unit: 8px;
            --border-radius: 8px;
            --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-background);
            color: var(--color-text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
            overflow: hidden; /* Prevent body scroll */
        }

        .sidebar {
            width: 250px;
            background-color: var(--color-surface);
            box-shadow: var(--shadow-subtle);
            padding: calc(var(--spacing-unit) * 2) 0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow-y: auto; /* Enable sidebar scrolling if needed */
        }

        .sidebar-header {
            padding: 0 calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 3);
            font-size: 1.4em;
            font-weight: 700;
            color: var(--color-primary);
            text-align: center;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin-bottom: var(--spacing-unit);
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-left: 4px solid transparent;
            font-weight: 600;
            cursor: pointer;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a:focus {
            background-color: var(--color-primary-light);
            color: var(--color-primary);
            outline: none; /* Remove default focus outline */
        }

        .sidebar-nav a.active {
            background-color: var(--color-primary-light-alt);
            color: var(--color-primary);
            font-weight: 700;
            border-left-color: var(--color-primary);
        }

        .sidebar-nav a i {
            margin-right: var(--spacing-unit);
            font-size: 20px; /* Adjusted icon size */
        }

        .main-content {
            flex-grow: 1;
            padding: calc(var(--spacing-unit) * 3);
            overflow-y: auto; /* Enable main content scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        .page-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }


        .page-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) * 3);
            color: var(--color-text-primary);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--spacing-unit) * 2;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: calc(var(--spacing-unit) * 3);
        }

        .card {
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            padding: calc(var(--spacing-unit) * 2.5);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
             transform: translateY(-2px);
             box-shadow: var(--shadow-medium);
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: var(--spacing-unit) * 1.5;
            color: var(--color-text-primary);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--spacing-unit);
        }

        .card-content {
            flex-grow: 1;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--spacing-unit);
        }

        .metric-label {
            font-size: 1em;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-unit) * 1.5;
        }

        .progress-bar-container {
            width: 100%;
            background-color: var(--color-border);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-top: var(--spacing-unit);
            height: calc(var(--spacing-unit) * 2.5);
        }

        .progress-bar {
            height: 100%;
            background-color: var(--color-accent);
            width: 0%; /* Controlled by JS */
            transition: width 0.5s ease-in-out, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: var(--spacing-unit);
            font-size: 0.9em;
            color: var(--color-surface);
            font-weight: 600;
            text-shadow: 0 0 2px rgba(0,0,0,0.2);
            box-sizing: border-box;
        }

         .progress-bar.low { background-color: var(--color-danger); }
         .progress-bar.medium { background-color: var(--color-warning); }
         .progress-bar.high { background-color: var(--color-accent); }


        .chart-container {
            position: relative;
            height: 350px; /* Increased height for charts */
            margin-top: calc(var(--spacing-unit) * 2);
            cursor: pointer;
            background-color: var(--color-surface); /* Ensure chart background is white */
            padding: var(--spacing-unit); /* Add some padding inside container */
            border-radius: var(--border-radius);
        }

        .floating-controls {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            background: rgba(255, 255, 255, 0.98);
            padding: var(--spacing-unit) * 1.5;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
            min-width: 200px;
            border: 1px solid var(--color-border);
        }

        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .control-group {
            margin-bottom: var(--spacing-unit) * 1.5;
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-unit) / 2);
        }

        .control-group label {
            font-size: 0.9em;
            color: var(--color-text-secondary);
            font-weight: 600;
        }

        .control-group input[type="color"],
        .control-group input[type="number"],
        .control-group select {
            padding: var(--spacing-unit);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius) / 2;
            font-size: 0.9em;
            color: var(--color-text-primary);
            background-color: var(--color-surface);
            box-sizing: border-box;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: calc(var(--spacing-unit) * 2);
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            overflow: hidden; /* Ensures rounded corners apply to content */
            box-shadow: var(--shadow-subtle);
        }

        th, td {
            text-align: left;
            padding: var(--spacing-unit) * 1.5;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background-color: var(--color-background);
            font-weight: 700;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        th:hover {
            background-color: #e9e9e9;
        }

        tbody tr:hover {
            background-color: var(--color-primary-light);
        }

        /* Responsive table */
        @media (max-width: 768px) {
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            tr {
                border: 1px solid var(--color-border);
                margin-bottom: var(--spacing-unit) * 2;
                border-radius: var(--border-radius);
                overflow: hidden;
            }
            td {
                border: none;
                border-bottom: 1px solid var(--color-border);
                position: relative;
                padding-left: 50%;
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 0;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                content: attr(data-label); /* Use data-label for column header */
                font-weight: 700;
                color: var(--color-text-primary);
                text-align: left;
            }
             td:last-child {
                 border-bottom: none;
             }
        }

        .table-controls {
            display: flex;
            gap: var(--spacing-unit) * 2;
            margin-bottom: var(--spacing-unit) * 2;
            align-items: center;
            flex-wrap: wrap;
        }

        .table-controls .form-group {
            margin-bottom: 0;
            flex-grow: 1;
            min-width: 150px;
        }

        .table-controls .form-group label {
            margin-bottom: var(--spacing-unit) / 2;
            font-size: 0.9em;
        }

        .checklist {
            list-style: none;
            padding: 0;
            margin-top: calc(var(--spacing-unit) * 2);
        }

        .checklist li {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-unit) * 1.5;
            margin-bottom: var(--spacing-unit);
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .checklist li:hover {
            background-color: var(--color-primary-light);
        }

        .checklist li input[type="checkbox"] {
            margin-right: var(--spacing-unit);
            width: 20px;
            height: 20px;
            accent-color: var(--color-accent);
            cursor: pointer;
            flex-shrink: 0;
        }

        .checklist li label {
            flex-grow: 1;
            cursor: pointer;
            font-size: 1.1em;
        }

        .checklist li.completed {
            background-color: var(--color-accent-light);
            border-color: var(--color-accent);
            text-decoration: line-through;
            color: var(--color-text-secondary);
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 600;
            color: var(--color-text-primary);
            font-size: 1em;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--spacing-unit) * 1.5;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1em;
            color: var(--color-text-primary);
            background-color: var(--color-surface);
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);
        }

        button {
            padding: var(--spacing-unit) * 1.5 calc(var(--spacing-unit) * 3);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s ease, opacity 0.2s ease, transform 0.1s ease;
            font-weight: 600;
            min-width: 100px;
            text-align: center;
        }

        button:active {
            transform: scale(0.98);
        }

        button.primary {
            background-color: var(--color-primary);
            color: var(--color-surface);
        }

        button.primary:hover,
        button.primary:focus {
            background-color: var(--color-primary-dark);
            outline: none;
        }

        button.secondary {
            background-color: var(--color-background);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
        }

        button.secondary:hover,
        button.secondary:focus {
            background-color: #e0e0e0;
            outline: none;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .button-group {
            margin-top: calc(var(--spacing-unit) * 3);
            display: flex;
            gap: var(--spacing-unit) * 2;
            flex-wrap: wrap;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* High z-index */
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.open {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--color-surface);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            max-width: 600px;
            width: 90%;
            transform: translateY(-30px);
            transition: transform 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            max-height: 90vh; /* Limit modal height */
            overflow-y: auto; /* Enable modal content scrolling */
        }

        .modal.open .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--color-border);
        }

        .modal-title {
            font-size: 1.6em;
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8em;
            cursor: pointer;
            color: var(--color-text-secondary);
            transition: color 0.2s ease;
        }

        .modal-close:hover,
        .modal-close:focus {
            color: var(--color-text-primary);
            outline: none;
        }

        .notification {
            position: fixed;
            bottom: calc(var(--spacing-unit) * 3);
            right: calc(var(--spacing-unit) * 3);
            padding: var(--spacing-unit) * 2;
            border-radius: var(--border-radius);
            color: var(--color-surface);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1001; /* Higher than modal */
            min-width: 250px;
            text-align: center;
            font-weight: 600;
            box-shadow: var(--shadow-medium);
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.success {
            background-color: var(--color-accent);
        }

        .notification.error {
            background-color: var(--color-danger);
        }

        .notification.warning {
            background-color: var(--color-warning);
        }

        .notification.info {
            background-color: var(--color-info);
        }

        /* Wizard Step Indicators (Placeholder) */
        .wizard-steps {
            display: flex;
            justify-content: space-around;
            margin-bottom: calc(var(--spacing-unit) * 3);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--color-border);
        }

        .wizard-step {
            text-align: center;
            color: var(--color-text-secondary);
            font-weight: 600;
            position: relative;
        }

        .wizard-step.active {
            color: var(--color-primary);
        }

        .wizard-step span {
            display: block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background-color: var(--color-border);
            color: var(--color-text-secondary);
            margin: 0 auto var(--spacing-unit);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .wizard-step.active span {
            background-color: var(--color-primary);
            color: var(--color-surface);
        }

        .wizard-step.completed span {
            background-color: var(--color-accent);
            color: var(--color-surface);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                padding: var(--spacing-unit) 0;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                overflow-y: visible; /* Allow horizontal scroll for nav */
            }

            .sidebar-header {
                display: none; /* Hide header on small screens */
            }

            .sidebar-nav ul {
                display: flex;
                overflow-x: auto;
                padding: 0 var(--spacing-unit) * 2;
                scrollbar-width: none; /* Hide scrollbar for Firefox */
                -ms-overflow-style: none;  /* Hide scrollbar for IE and Edge */
            }

            .sidebar-nav ul::-webkit-scrollbar {
                display: none; /* Hide scrollbar for Chrome, Safari, and Opera */
            }

            .sidebar-nav li {
                flex: 0 0 auto;
                margin-right: var(--spacing-unit) * 2;
                margin-bottom: 0;
            }

            .sidebar-nav a {
                padding: var(--spacing-unit);
                border-left: none;
                border-bottom: 4px solid transparent;
                flex-direction: column;
                align-items: center;
                font-size: 0.9em;
            }

             .sidebar-nav a.active {
                border-left-color: transparent;
                border-bottom-color: var(--color-primary);
            }

            .sidebar-nav a i {
                margin-right: 0;
                margin-bottom: var(--spacing-unit) / 2;
            }

            .main-content {
                padding: calc(var(--spacing-unit) * 2);
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .card {
                padding: calc(var(--spacing-unit) * 2);
            }

            .card-title {
                 font-size: 1.2em;
            }

            .modal-content {
                width: 95%;
                padding: calc(var(--spacing-unit) * 2);
            }

            .modal-title {
                 font-size: 1.3em;
            }

            .notification {
                bottom: var(--spacing-unit) * 2;
                right: var(--spacing-unit) * 2;
                left: var(--spacing-unit) * 2;
                width: auto;
                min-width: auto;
            }

            .table-controls {
                flex-direction: column;
                gap: var(--spacing-unit) * 1.5;
            }

             .table-controls .form-group {
                width: 100%;
                min-width: auto;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
             .sidebar {
                 width: 200px;
             }
             .main-content {
                 padding: calc(var(--spacing-unit) * 2);
             }
             .dashboard-grid {
                 gap: calc(var(--spacing-unit) * 2);
             }
             .card {
                padding: calc(var(--spacing-unit) * 2);
             }
             .card-title {
                 font-size: 1.2em;
             }
        }

    </style>
</head>
<body>

    <div class="sidebar" role="navigation" aria-label="Main Navigation">
        <div class="sidebar-header">IT Modernization</div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#dashboard" class="nav-link active" data-section="dashboard" aria-current="page"><i class="material-symbols-rounded" aria-hidden="true">dashboard</i> Dashboard</a></li>
                <li><a href="#assessment" class="nav-link" data-section="assessment"><i class="material-symbols-rounded" aria-hidden="true">assessment</i> Assessment</a></li>
                <li><a href="#planning" class="nav-link" data-section="planning"><i class="material-symbols-rounded" aria-hidden="true">event_note</i> Planning</a></li>
                <li><a href="#migration" class="nav-link" data-section="migration"><i class="material-symbols-rounded" aria-hidden="true">cloud_upload</i> Migration</a></li>
                <li><a href="#optimization" class="nav-link" data-section="optimization"><i class="material-symbols-rounded" aria-hidden="true">tune</i> Optimization</a></li>
                <li><a href="#security" class="nav-link" data-section="security"><i class="material-symbols-rounded" aria-hidden="true">security</i> Security</a></li>
                <li><a href="#bcdr" class="nav-link" data-section="bcdr"><i class="material-symbols-rounded" aria-hidden="true">sync_alt</i> BCDR</a></li>
                <li><a href="#compliance" class="nav-link" data-section="compliance"><i class="material-symbols-rounded" aria-hidden="true">check_circle</i> Compliance</a></li>
                <li><a href="#risk" class="nav-link" data-section="risk"><i class="material-symbols-rounded" aria-hidden="true">warning</i> Risk Management</a></li>
                <li><a href="#resources" class="nav-link" data-section="resources"><i class="material-symbols-rounded" aria-hidden="true">library_books</i> Resources</a></li>
            </ul>
        </nav>
    </div>

    <div class="main-content" role="main">
        <section id="dashboard" class="page-section active" aria-labelledby="dashboard-title">
            <h1 id="dashboard-title" class="page-title">Dashboard</h1>
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-title">Overall Project Progress</div>
                    <div class="card-content">
                        <div class="metric-value" id="overall-progress-pct">0%</div>
                        <div class="metric-label">Completion</div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="overall-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div>
                        </div>
                    </div>
                </div>
                 <div class="card">
                    <div class="card-title">Tasks Completed</div>
                    <div class="card-content">
                        <div class="metric-value" id="tasks-completed">0/0</div>
                        <div class="metric-label">Total Tasks</div>
                         <div class="progress-bar-container">
                            <div class="progress-bar" id="tasks-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Identified Risks</div>
                     <div class="card-content">
                        <div class="metric-value" id="identified-risks">0</div>
                        <div class="metric-label">Open Risks</div>
                    </div>
                </div>
                 <div class="card">
                    <div class="card-title">Compliance Status</div>
                     <div class="card-content">
                        <div class="metric-value" id="compliance-status">0%</div>
                        <div class="metric-label">Requirements Met</div>
                         <div class="progress-bar-container">
                            <div class="progress-bar" id="compliance-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div>
                        </div>
                    </div>
                </div>
                <div class="card" style="grid-column: 1 / -1;">
                     <div class="card-title">Project Phase Completion</div>
                     <div class="chart-container" role="img" aria-label="Project Phase Completion Chart">
                        <canvas id="phaseCompletionChart"></canvas>
                        <div class="floating-controls" id="phaseCompletionChart-controls" aria-hidden="true">
                            <div class="control-group">
                                <label for="phaseCompletionChart-type">Chart Type</label>
                                <select id="phaseCompletionChart-type" aria-controls="phaseCompletionChart">
                                    <option value="bar">Bar</option>
                                    <option value="line">Line</option>
                                    <option value="pie">Pie</option>
                                    <option value="doughnut">Doughnut</option>
                                </select>
                            </div>
                             <div class="control-group">
                                <label for="phaseCompletionChart-color">Bar Color</label>
                                <input type="color" id="phaseCompletionChart-color" value="#007acc" aria-controls="phaseCompletionChart">
                            </div>
                             <!-- Add more controls as needed -->
                        </div>
                    </div>
                </div>
                 <div class="card" style="grid-column: 1 / -1;">
                     <div class="card-title">Inventory Breakdown (Servers)</div>
                     <div class="chart-container" role="img" aria-label="Inventory Breakdown Chart by Type">
                        <canvas id="inventoryChart"></canvas>
                         <div class="floating-controls" id="inventoryChart-controls" aria-hidden="true">
                            <div class="control-group">
                                <label for="inventoryChart-type">Chart Type</label>
                                <select id="inventoryChart-type" aria-controls="inventoryChart">
                                    <option value="pie">Pie</option>
                                    <option value="bar">Bar</option>
                                    <option value="doughnut">Doughnut</option>
                                </select>
                            </div>
                             <!-- Add more controls as needed -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="assessment" class="page-section" aria-labelledby="assessment-title">
            <h1 id="assessment-title" class="page-title">Assessment</h1>
            <div class="card">
                <div class="card-title">Infrastructure Inventory</div>
                <div class="card-content">
                    <div class="table-controls">
                         <div class="form-group">
                            <label for="inventory-filter-type">Filter by Type:</label>
                            <select id="inventory-filter-type" aria-controls="inventory-table">
                                <option value="">All Types</option>
                                <option value="server">Server</option>
                                <option value="application">Application</option>
                                <option value="data">Data Store</option>
                                <option value="network">Network Device</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label for="inventory-filter-status">Filter by Status:</label>
                            <select id="inventory-filter-status" aria-controls="inventory-table">
                                <option value="">All Statuses</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="decommissioned">Decommissioned</option>
                            </select>
                        </div>
                         <div class="form-group">
                             <label for="inventory-search">Search:</label>
                             <input type="text" id="inventory-search" placeholder="Search name, OS, apps..." aria-controls="inventory-table">
                         </div>
                    </div>
                    <div class="table-container">
                        <table id="inventory-table">
                            <thead>
                                <tr>
                                    <th data-sort="type" aria-sort="none">Type <i class="material-symbols-rounded" style="vertical-align: middle; font-size: 1em;">sort</i></th>
                                    <th data-sort="name" aria-sort="none">Name <i class="material-symbols-rounded" style="vertical-align: middle; font-size: 1em;">sort</i></th>
                                    <th data-sort="os" aria-sort="none">OS/Version <i class="material-symbols-rounded" style="vertical-align: middle; font-size: 1em;">sort</i></th>
                                    <th data-sort="apps" aria-sort="none">Applications <i class="material-symbols-rounded" style="vertical-align: middle; font-size: 1em;">sort</i></th>
                                    <th data-sort="status" aria-sort="none">Status <i class="material-symbols-rounded" style="vertical-align: middle; font-size: 1em;">sort</i></th>
                                </tr>
                            </thead>
                            <tbody id="inventory-table-body">
                                <!-- Inventory items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                     <button class="primary" style="margin-top: var(--spacing-unit)*2;" onclick="openModal('addInventoryModal')">Add Inventory Item</button>
                </div>
            </div>
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Assessment Checklist</div>
                 <ul class="checklist" id="assessment-checklist">
                     <!-- Checklist items will be loaded here -->
                 </ul>
             </div>
        </section>

        <section id="planning" class="page-section" aria-labelledby="planning-title">
            <h1 id="planning-title" class="page-title">Planning</h1>
             <div class="card">
                <div class="card-title">Project Setup Wizard</div>
                <div class="card-content">
                    <div class="wizard-steps" id="planning-wizard-steps">
                        <div class="wizard-step active" data-step="1"><span>1</span> Project Details</div>
                        <div class="wizard-step" data-step="2"><span>2</span> Scope & Goals</div>
                        <div class="wizard-step" data-step="3"><span>3</span> Team & Timeline</div>
                    </div>

                    <div id="wizard-step-1" class="wizard-step-content active">
                        <div class="form-group">
                            <label for="project-name">Project Name</label>
                            <input type="text" id="project-name" placeholder="e.g., Accounting Firm Cloud Migration">
                        </div>
                         <div class="form-group">
                            <label for="project-goal">Project Goal</label>
                            <textarea id="project-goal" rows="4" placeholder="Describe the primary goals of the modernization..."></textarea>
                        </div>
                    </div>

                    <div id="wizard-step-2" class="wizard-step-content">
                         <div class="form-group">
                            <label for="project-scope">Scope Definition</label>
                            <textarea id="project-scope" rows="4" placeholder="Define what is included and excluded from the project..."></textarea>
                        </div>
                         <div class="form-group">
                            <label for="project-objectives">Key Objectives</label>
                            <textarea id="project-objectives" rows="4" placeholder="List specific, measurable objectives..."></textarea>
                        </div>
                    </div>

                    <div id="wizard-step-3" class="wizard-step-content">
                         <div class="form-group">
                            <label for="project-team">Project Team Members</label>
                            <textarea id="project-team" rows="4" placeholder="List team members and roles..."></textarea>
                        </div>
                         <div class="form-group">
                            <label for="project-timeline">Estimated Timeline</label>
                            <input type="date" id="project-timeline">
                        </div>
                    </div>

                    <div class="button-group" style="justify-content: flex-end;">
                         <button class="secondary" id="wizard-prev" onclick="prevWizardStep()" disabled>Previous</button>
                         <button class="primary" id="wizard-next" onclick="nextWizardStep()">Next Step</button>
                         <button class="primary" id="wizard-finish" onclick="finishWizard()" style="display: none;">Finish Setup</button>
                    </div>
                </div>
            </div>
            <!-- More planning sections/cards here -->
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Migration Strategy</div>
                 <div class="card-content">
                     <p>Define your cloud migration strategy (e.g., Rehost, Refactor, Replatform, Repurchase, Retain, Retire).</p>
                     <!-- Placeholder for strategy selection/documentation -->
                 </div>
             </div>
        </section>

         <section id="migration" class="page-section" aria-labelledby="migration-title">
            <h1 id="migration-title" class="page-title">Migration</h1>
             <div class="card">
                 <div class="card-title">Migration Workload Assessment</div>
                 <div class="card-content">
                     <p>Categorize applications and data based on migration complexity and dependencies.</p>
                     <!-- Placeholder for workload assessment tool/form -->
                     <div class="form-group" style="margin-top: var(--spacing-unit)*2;">
                         <label for="workload-app1">Accounting Software Workload:</label>
                         <select id="workload-app1">
                             <option value="rehost">Rehost (Lift and Shift)</option>
                             <option value="refactor">Refactor (Rearchitect)</option>
                             <option value="replatform">Replatform (Lift and Reshape)</option>
                             <option value="repurchase">Repurchase (Drop and Shop)</option>
                             <option value="retain">Retain (Do Nothing)</option>
                             <option value="retire">Retire (Decommission)</option>
                         </select>
                     </div>
                     <div class="form-group">
                         <label for="workload-data1">Client Database Workload:</label>
                         <select id="workload-data1">
                             <option value="rehost">Rehost (Lift and Shift)</option>
                             <option value="refactor">Refactor (Rearchitect)</option>
                             <option value="replatform">Replatform (Lift and Reshape)</option>
                             <option value="repurchase">Repurchase (Drop and Shop)</option>
                             <option value="retain">Retain (Do Nothing)</option>
                             <option value="retire">Retire (Decommission)</option>
                         </select>
                     </div>
                 </div>
             </div>
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Cost Estimation</div>
                  <div class="card-content">
                     <p>Estimate the costs associated with cloud resources and migration efforts.</p>
                     <!-- Placeholder for cost estimation tool/form -->
                     <div class="form-group" style="margin-top: var(--spacing-unit)*2;">
                         <label for="cost-compute">Estimated Compute Costs (Monthly):</label>
                         <input type="number" id="cost-compute" placeholder="$">
                     </div>
                      <div class="form-group">
                         <label for="cost-storage">Estimated Storage Costs (Monthly):</label>
                         <input type="number" id="cost-storage" placeholder="$">
                     </div>
                      <div class="form-group">
                         <label for="cost-migration">Estimated Migration Effort Costs:</label>
                         <input type="number" id="cost-migration" placeholder="$">
                     </div>
                      <p style="font-weight: 600;">Total Estimated Monthly Cost: $<span id="total-estimated-cost">0</span></p>
                 </div>
             </div>
        </section>

         <section id="optimization" class="page-section" aria-labelledby="optimization-title">
            <h1 id="optimization-title" class="page-title">Optimization</h1>
             <div class="card">
                 <div class="card-title">Automated Scaling Configuration Guidance</div>
                 <div class="card-content">
                     <p>Configure auto-scaling rules for critical workloads to handle peak loads efficiently.</p>
                     <!-- Placeholder for scaling guidance/form -->
                      <div class="form-group" style="margin-top: var(--spacing-unit)*2;">
                         <label for="scaling-metric">Scaling Metric:</label>
                         <select id="scaling-metric">
                             <option value="cpu">CPU Utilization</option>
                             <option value="network-in">Network In</option>
                             <option value="queue-length">Queue Length</option>
                         </select>
                     </div>
                      <div class="form-group">
                         <label for="scaling-threshold">Threshold (%):</label>
                         <input type="number" id="scaling-threshold" placeholder="e.g., 70">
                     </div>
                      <div class="form-group">
                         <label for="scaling-min">Minimum Instances:</label>
                         <input type="number" id="scaling-min" placeholder="e.g., 1">
                     </div>
                      <div class="form-group">
                         <label for="scaling-max">Maximum Instances:</label>
                         <input type="number" id="scaling-max" placeholder="e.g., 5">
                     </div>
                 </div>
             </div>
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Performance Monitoring Setup</div>
                 <div class="card-content">
                     <p>Steps to configure monitoring and alerting for migrated resources.</p>
                     <!-- Placeholder for monitoring setup -->
                     <ul class="checklist">
                         <li><input type="checkbox" id="monitor-setup-1"><label for="monitor-setup-1">Integrate cloud provider monitoring agents.</label></li>
                         <li><input type="checkbox" id="monitor-setup-2"><label for="monitor-setup-2">Configure dashboards for key metrics (CPU, Memory, Network, Disk I/O).</label></li>
                         <li><input type="checkbox" id="monitor-setup-3"><label for="monitor-setup-3">Set up alerts for critical thresholds.</label></li>
                         <li><input type="checkbox" id="monitor-setup-4"><label for="monitor-setup-4">Establish logging and log analysis.</label></li>
                     </ul>
                 </div>
             </div>
        </section>

         <section id="security" class="page-section" aria-labelledby="security-title">
            <h1 id="security-title" class="page-title">Security</h1>
             <div class="card">
                 <div class="card-title">Security Controls Planning</div>
                 <div class="card-content">
                     <p>Plan and track the implementation of security controls in the cloud environment.</p>
                     <!-- Placeholder for security controls checklist/table -->
                      <ul class="checklist">
                         <li><input type="checkbox" id="security-control-1"><label for="security-control-1">Implement Multi-Factor Authentication (MFA) for all administrative access.</label></li>
                         <li><input type="checkbox" id="security-control-2"><label for="security-control-2">Encrypt sensitive data at rest and in transit.</label></li>
                         <li><input type="checkbox" id="security-control-3"><label for="security-control-3">Configure network security groups/firewalls.</label></li>
                         <li><input type="checkbox" id="security-control-4"><label for="security-control-4">Set up intrusion detection/prevention systems.</label></li>
                         <li><input type="checkbox" id="security-control-5"><label for="security-control-5">Establish regular vulnerability scanning.</label></li>
                         <li><input type="checkbox" id="security-control-6"><label for="security-control-6">Define and enforce access control policies (RBAC).</label></li>
                     </ul>
                 </div>
             </div>
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Identity and Access Management (IAM)</div>
                 <div class="card-content">
                     <p>Plan user and group access, roles, and permissions.</p>
                     <!-- Placeholder for IAM planning -->
                 </div>
             </div>
        </section>

         <section id="bcdr" class="page-section" aria-labelledby="bcdr-title">
            <h1 id="bcdr-title" class="page-title">Business Continuity & Disaster Recovery</h1>
             <div class="card">
                 <div class="card-title">BCDR Plan Builder</div>
                 <div class="card-content">
                     <p>Build your business continuity and disaster recovery plans for cloud workloads.</p>
                     <!-- Placeholder for BCDR plan builder -->
                     <div class="form-group" style="margin-top: var(--spacing-unit)*2;">
                         <label for="rpo">Recovery Point Objective (RPO):</label>
                         <input type="text" id="rpo" placeholder="e.g., 1 hour">
                     </div>
                      <div class="form-group">
                         <label for="rto">Recovery Time Objective (RTO):</label>
                         <input type="text" id="rto" placeholder="e.g., 4 hours">
                     </div>
                      <div class="form-group">
                         <label for="dr-strategy">Disaster Recovery Strategy:</label>
                         <select id="dr-strategy">
                             <option value="backup-restore">Backup and Restore</option>
                             <option value="pilot-light">Pilot Light</option>
                             <option value="warm-standby">Warm Standby</option>
                             <option value="hot-site">Hot Site (Multi-site Active/Active)</option>
                         </select>
                     </div>
                      <div class="form-group">
                         <label for="bcdr-testing">Testing Plan:</label>
                         <textarea id="bcdr-testing" rows="4" placeholder="Describe the plan for testing the BCDR strategy..."></textarea>
                     </div>
                 </div>
             </div>
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Backup and Restore Configuration</div>
                 <div class="card-content">
                     <p>Configure backup policies and procedures.</p>
                     <!-- Placeholder for backup configuration -->
                 </div>
             </div>
        </section>

         <section id="compliance" class="page-section" aria-labelledby="compliance-title">
            <h1 id="compliance-title" class="page-title">Compliance</h1>
             <div class="card">
                 <div class="card-title">Regulatory Compliance Checklist</div>
                 <ul class="checklist" id="compliance-checklist">
                     <!-- Compliance checklist items will be loaded here -->
                 </ul>
             </div>
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Compliance Reporting</div>
                 <div class="card-content">
                     <p>Generate reports on compliance status.</p>
                     <!-- Placeholder for reporting features -->
                 </div>
             </div>
        </section>

         <section id="risk" class="page-section" aria-labelledby="risk-title">
            <h1 id="risk-title" class="page-title">Risk Management</h1>
             <div class="card">
                 <div class="card-title">Risk Assessment & Mitigation</div>
                 <div class="card-content">
                     <p>Identify, assess, and plan mitigation strategies for project risks.</p>
                     <!-- Placeholder for risk matrix/table -->
                     <table>
                         <thead>
                             <tr>
                                 <th>Risk</th>
                                 <th>Likelihood</th>
                                 <th>Impact</th>
                                 <th>Score</th>
                                 <th>Mitigation Strategy</th>
                                 <th>Status</th>
                             </tr>
                         </thead>
                         <tbody id="risk-table-body">
                             <!-- Risk items will be loaded here -->
                         </tbody>
                     </table>
                      <button class="primary" style="margin-top: var(--spacing-unit)*2;" onclick="openModal('addRiskModal')">Add Risk</button>
                 </div>
             </div>
             <div class="card" style="margin-top: var(--spacing-unit)*3;">
                 <div class="card-title">Risk Matrix Visualization</div>
                 <div class="chart-container" role="img" aria-label="Risk Matrix Visualization">
                     <canvas id="riskMatrixChart"></canvas>
                      <div class="floating-controls" id="riskMatrixChart-controls" aria-hidden="true">
                         <div class="control-group">
                             <label for="riskMatrixChart-type">Chart Type</label>
                             <select id="riskMatrixChart-type" aria-controls="riskMatrixChart">
                                 <option value="scatter">Scatter Plot</option>
                                 <!-- Add other relevant types like bubble if data supports -->
                             </select>
                         </div>
                          <!-- Add more controls as needed -->
                     </div>
                 </div>
             </div>
        </section>

        <section id="resources" class="page-section" aria-labelledby="resources-title">
            <h1 id="resources-title" class="page-title">Resources</h1>
             <div class="card">
                 <div class="card-title">Resource Library</div>
                 <div class="card-content">
                     <p>Access training materials, best practices, and documentation.</p>
                     <!-- Placeholder for resource list -->
                     <ul>
                         <li><a href="#" onclick="showNotification('Opening link (simulation)', 'info'); return false;">Cloud Migration Best Practices Guide</a></li>
                         <li><a href="#" onclick="showNotification('Opening link (simulation)', 'info'); return false;">Security Checklist for Cloud Environments</a></li>
                         <li><a href="#" onclick="showNotification('Opening link (simulation)', 'info'); return false;">Staff Training: Introduction to Cloud Concepts</a></li>
                     </ul>
                 </div>
             </div>
        </section>

    </div>

    <!-- Modals -->
    <div id="addInventoryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="addInventoryModal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addInventoryModal-title" class="modal-title">Add Inventory Item</h3>
                <button class="modal-close" onclick="closeModal('addInventoryModal')" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="inventory-type">Type <span aria-hidden="true">*</span></label>
                    <select id="inventory-type" required>
                        <option value="">-- Select Type --</option>
                        <option value="server">Server</option>
                        <option value="application">Application</option>
                        <option value="data">Data Store</option>
                        <option value="network">Network Device</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="inventory-name">Name <span aria-hidden="true">*</span></label>
                    <input type="text" id="inventory-name" required>
                </div>
                 <div class="form-group">
                    <label for="inventory-os">OS/Version (if applicable)</label>
                    <input type="text" id="inventory-os">
                </div>
                 <div class="form-group">
                    <label for="inventory-apps">Applications (comma-separated)</label>
                    <input type="text" id="inventory-apps">
                </div>
                 <div class="form-group">
                    <label for="inventory-status">Status <span aria-hidden="true">*</span></label>
                    <select id="inventory-status" required>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="decommissioned">Decommissioned</option>
                    </select>
                </div>
            </div>
            <div class="button-group" style="justify-content: flex-end;">
                <button class="secondary" onclick="closeModal('addInventoryModal')">Cancel</button>
                <button class="primary" onclick="saveInventoryItem()">Save Item</button>
            </div>
        </div>
    </div>

     <div id="addRiskModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="addRiskModal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addRiskModal-title" class="modal-title">Add Risk Item</h3>
                <button class="modal-close" onclick="closeModal('addRiskModal')" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="risk-description">Risk Description <span aria-hidden="true">*</span></label>
                    <textarea id="risk-description" rows="3" required></textarea>
                </div>
                 <div class="form-group">
                    <label for="risk-likelihood">Likelihood <span aria-hidden="true">*</span></label>
                    <select id="risk-likelihood" required>
                        <option value="">-- Select --</option>
                        <option value="low">Low (1)</option>
                        <option value="medium">Medium (2)</option>
                        <option value="high">High (3)</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="risk-impact">Impact <span aria-hidden="true">*</span></label>
                    <select id="risk-impact" required>
                        <option value="">-- Select --</option>
                        <option value="low">Low (1)</option>
                        <option value="medium">Medium (2)</option>
                        <option value="high">High (3)</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="risk-mitigation">Mitigation Strategy</label>
                    <textarea id="risk-mitigation" rows="3"></textarea>
                </div>
                 <div class="form-group">
                    <label for="risk-status">Status <span aria-hidden="true">*</span></label>
                    <select id="risk-status" required>
                        <option value="open">Open</option>
                        <option value="mitigated">Mitigated</option>
                        <option value="closed">Closed</option>
                    </select>
                </div>
            </div>
            <div class="button-group" style="justify-content: flex-end;">
                <button class="secondary" onclick="closeModal('addRiskModal')">Cancel</button>
                <button class="primary" onclick="saveRiskItem()">Save Risk</button>
            </div>
        </div>
    </div>


     <!-- Notifications -->
     <div id="notification" class="notification" role="status" aria-live="polite"></div>


    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // --- Data (Mock Data) ---
        const projectData = {
            phases: [
                { name: "Assessment", progress: 75 },
                { name: "Planning", progress: 50 },
                { name: "Migration", progress: 10 },
                { name: "Optimization", progress: 0 },
                { name: "Security", progress: 20 },
                { name: "BCDR", progress: 5 },
                { name: "Compliance", progress: 60 },
                { name: "Risk Management", progress: 30 },
                { name: "Resources", progress: 100 } // Resource library is always available
            ],
            tasks: [
                { id: 1, text: "Inventory Servers", completed: true, phase: "Assessment" },
                { id: 2, text: "Document Applications", completed: true, phase: "Assessment" },
                { id: 3, text: "Assess Network Capacity", completed: false, phase: "Assessment" },
                { id: 4, text: "Define Cloud Strategy", completed: true, phase: "Planning" },
                { id: 5, text: "Create Migration Plan", completed: false, phase: "Planning" },
                { id: 6, text: "Setup Cloud Environment", completed: false, phase: "Migration" },
                { id: 7, text: "Configure IAM Policies", completed: false, phase: "Security" },
                { id: 8, text: "Implement MFA", completed: false, phase: "Security" },
            ],
            inventory: [
                { id: 1, type: "server", name: "SRV-FILE01", os: "Windows Server 2012 R2", apps: "File Services, Print Services", status: "active" },
                { id: 2, type: "server", name: "SRV-AD01", os: "Windows Server 2016", apps: "Active Directory, DNS, DHCP", status: "active" },
                { id: 3, type: "application", name: "AccountingApp v1.0", os: "N/A", apps: "Runs on SRV-APP01", status: "active" },
                { id: 4, type: "data", name: "ClientDB", os: "SQL Server 2014", apps: "Used by AccountingApp", status: "active" },
                 { id: 5, type: "server", name: "SRV-APP01", os: "Windows Server 2019", apps: "AccountingApp v1.0", status: "active" },
                 { id: 6, type: "network", name: "Firewall-01", os: "OS v1.2", apps: "N/A", status: "active" },
                 { id: 7, type: "server", name: "Old-Webserver", os: "Ubuntu 14.04", apps: "Legacy Website", status: "inactive" },
            ],
            compliance: [
                 { id: 101, text: "Implement MFA for all cloud access", completed: false },
                 { id: 102, text: "Encrypt sensitive data at rest", completed: true },
                 { id: 103, text: "Establish data retention policies", completed: false },
                 { id: 104, text: "Perform annual security awareness training", completed: true },
                 { id: 105, text: "Maintain audit logs for critical systems", completed: false },
            ],
            risks: [
                 { id: 201, description: "Data breach due to weak access controls", likelihood: "high", impact: "high", score: 9, mitigation: "Implement strict RBAC and MFA", status: "open" },
                 { id: 202, description: "Downtime during migration phase", likelihood: "medium", impact: "high", score: 6, mitigation: "Plan phased migration, use pilot group", status: "open" },
                 { id: 203, description: "Cost overrun in cloud spend", likelihood: "medium", impact: "medium", score: 4, mitigation: "Implement budget alerts, optimize resources", status: "open" },
                 { id: 204, description: "Staff resistance to new tools", likelihood: "low", impact: "medium", score: 2, mitigation: "Provide adequate training and support", status: "mitigated" },
            ]
        };

        let currentSection = 'dashboard';
        const sections = document.querySelectorAll('.page-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const notificationEl = document.getElementById('notification');

        // --- Navigation ---
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetSection = link.dataset.section;
                showSection(targetSection);
            });
             // Add keyboard support for navigation
            link.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const targetSection = link.dataset.section;
                    showSection(targetSection);
                }
            });
        });

        function showSection(sectionId) {
            sections.forEach(section => {
                section.classList.remove('active');
                 section.setAttribute('aria-hidden', 'true');
            });

            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                 activeSection.classList.add('active');
                 activeSection.setAttribute('aria-hidden', 'false');
                 activeSection.focus(); // Move focus to the section title
            }


            navLinks.forEach(link => {
                link.classList.remove('active');
                 link.removeAttribute('aria-current');
            });

            const activeNavLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
            if (activeNavLink) {
                 activeNavLink.classList.add('active');
                 activeNavLink.setAttribute('aria-current', 'page');
            }

            currentSection = sectionId;
             // Update content based on section
            updateSectionContent(sectionId);
        }

        function updateSectionContent(sectionId) {
             switch(sectionId) {
                 case 'dashboard':
                     updateDashboardMetrics();
                     renderCharts();
                     break;
                 case 'assessment':
                     renderInventoryTable(projectData.inventory); // Render initial table
                     renderAssessmentChecklist();
                     break;
                 case 'compliance':
                     renderComplianceChecklist();
                     break;
                 case 'risk':
                     renderRiskTable(projectData.risks);
                     renderRiskMatrixChart();
                     break;
                 case 'planning':
                     // Wizard state is managed separately
                     break;
                 // Add cases for other sections if they need dynamic content on load
             }
        }


        // --- Dashboard ---
        function updateDashboardMetrics() {
            const totalPhases = projectData.phases.length;
            const completedPhases = projectData.phases.filter(p => p.progress >= 100).length;
            const overallProgress = totalPhases > 0 ? Math.round((completedPhases / totalPhases) * 100) : 0;
            document.getElementById('overall-progress-pct').textContent = `${overallProgress}%`;
            const overallProgressBar = document.getElementById('overall-progress-bar');
            overallProgressBar.style.width = `${overallProgress}%`;
            overallProgressBar.textContent = overallProgress > 10 ? `${overallProgress}%` : ''; // Only show text if enough space
            overallProgressBar.setAttribute('aria-valuenow', overallProgress);
             updateProgressBarColor(overallProgressBar, overallProgress);


            const totalTasks = projectData.tasks.length;
            const completedTasks = projectData.tasks.filter(task => task.completed).length;
            const tasksProgress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
             document.getElementById('tasks-completed').textContent = `${completedTasks}/${totalTasks}`;
             const tasksProgressBar = document.getElementById('tasks-progress-bar');
             tasksProgressBar.style.width = `${tasksProgress}%`;
             tasksProgressBar.textContent = tasksProgress > 10 ? `${tasksProgress}%` : '';
             tasksProgressBar.setAttribute('aria-valuenow', tasksProgress);
             updateProgressBarColor(tasksProgressBar, tasksProgress);


            const openRisks = projectData.risks.filter(r => r.status === 'open').length;
            document.getElementById('identified-risks').textContent = openRisks;

             const totalCompliance = projectData.compliance.length;
             const completedCompliance = projectData.compliance.filter(item => item.completed).length;
             const complianceProgress = totalCompliance > 0 ? Math.round((completedCompliance / totalCompliance) * 100) : 0;
             document.getElementById('compliance-status').textContent = `${complianceProgress}%`;
             const complianceProgressBar = document.getElementById('compliance-progress-bar');
             complianceProgressBar.style.width = `${complianceProgress}%`;
             complianceProgressBar.textContent = complianceProgress > 10 ? `${complianceProgress}%` : '';
             complianceProgressBar.setAttribute('aria-valuenow', complianceProgress);
             updateProgressBarColor(complianceProgressBar, complianceProgress);

        }

        function updateProgressBarColor(progressBarElement, progress) {
            progressBarElement.classList.remove('low', 'medium', 'high');
            if (progress < 30) {
                progressBarElement.classList.add('low');
            } else if (progress < 70) {
                progressBarElement.classList.add('medium');
            } else {
                progressBarElement.classList.add('high');
            }
        }

        let phaseCompletionChart = null;
        let inventoryChart = null;
        let riskMatrixChart = null;

        function renderCharts() {
            // Phase Completion Chart
            const phaseCompletionCtx = document.getElementById('phaseCompletionChart')?.getContext('2d');
            if (phaseCompletionCtx) {
                if (phaseCompletionChart) phaseCompletionChart.destroy();
                 const phaseLabels = projectData.phases.map(p => p.name);
                 const phaseProgress = projectData.phases.map(p => p.progress);
                phaseCompletionChart = new Chart(phaseCompletionCtx, {
                    type: 'bar',
                    data: {
                        labels: phaseLabels,
                        datasets: [{
                            label: 'Progress %',
                            data: phaseProgress,
                            backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim(),
                            borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim(),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        onClick: (e) => toggleControls('phaseCompletionChart-controls'),
                        plugins: {
                            legend: {
                                display: false,
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += context.parsed.y + '%';
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Completion (%)'
                                }
                            },
                             x: {
                                 title: {
                                     display: true,
                                     text: 'Project Phase'
                                 }
                             }
                        }
                    }
                });
                 setupChartControls('phaseCompletionChart', phaseCompletionChart);
            }


             // Inventory Breakdown Chart
            const inventoryCtx = document.getElementById('inventoryChart')?.getContext('2d');
             if (inventoryCtx) {
                if (inventoryChart) inventoryChart.destroy();

                const inventoryCounts = projectData.inventory.reduce((acc, item) => {
                    acc[item.type] = (acc[item.type] || 0) + 1;
                    return acc;
                }, {});

                const inventoryLabels = Object.keys(inventoryCounts);
                const inventoryData = Object.values(inventoryCounts);

                inventoryChart = new Chart(inventoryCtx, {
                    type: 'pie',
                    data: {
                        labels: inventoryLabels,
                        datasets: [{
                            label: 'Count',
                            data: inventoryData,
                            backgroundColor: [
                                'rgba(0, 122, 204, 0.8)', // Blue
                                'rgba(76, 175, 80, 0.8)', // Green
                                'rgba(255, 152, 0, 0.8)', // Orange
                                'rgba(156, 39, 176, 0.8)', // Purple
                                'rgba(0, 188, 212, 0.8)', // Cyan
                                'rgba(255, 87, 34, 0.8)', // Deep Orange
                            ],
                            borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-surface').trim(),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                         onClick: (e) => toggleControls('inventoryChart-controls'),
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                 callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) + '%' : '0%';
                                        return `${label}: ${value} (${percentage})`;
                                    }
                                }
                            }
                        }
                    }
                });
                 setupChartControls('inventoryChart', inventoryChart);
            }
        }

         function renderRiskMatrixChart() {
             const riskMatrixCtx = document.getElementById('riskMatrixChart')?.getContext('2d');
             if (riskMatrixCtx) {
                 if (riskMatrixChart) riskMatrixChart.destroy();

                 const likelihoodMap = { 'low': 1, 'medium': 2, 'high': 3 };
                 const impactMap = { 'low': 1, 'medium': 2, 'high': 3 };

                 const riskData = projectData.risks.map(risk => ({
                     x: likelihoodMap[risk.likelihood] || 0,
                     y: impactMap[risk.impact] || 0,
                     description: risk.description,
                     status: risk.status
                 }));

                 riskMatrixChart = new Chart(riskMatrixCtx, {
                     type: 'scatter',
                     data: {
                         datasets: [{
                             label: 'Risks',
                             data: riskData,
                             backgroundColor: riskData.map(d => {
                                 if (d.status === 'mitigated') return 'rgba(76, 175, 80, 0.8)'; // Green for mitigated
                                 if (d.status === 'closed') return 'rgba(158, 158, 158, 0.8)'; // Gray for closed
                                 // Color based on score (likelihood * impact) for open risks
                                 const score = d.x * d.y;
                                 if (score <= 2) return 'rgba(76, 175, 80, 0.8)'; // Green (Low)
                                 if (score <= 4) return 'rgba(255, 152, 0, 0.8)'; // Orange (Medium)
                                 return 'rgba(244, 67, 54, 0.8)'; // Red (High)
                             }),
                             borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-surface').trim(),
                             borderWidth: 2,
                             pointRadius: 8,
                             pointHoverRadius: 10,
                         }]
                     },
                     options: {
                         responsive: true,
                         maintainAspectRatio: false,
                          onClick: (e) => toggleControls('riskMatrixChart-controls'),
                         plugins: {
                             legend: {
                                 display: false, // Hide default legend
                             },
                             tooltip: {
                                 callbacks: {
                                     label: function(context) {
                                         const item = context.raw;
                                         const likelihoodLabel = Object.keys(likelihoodMap).find(key => likelihoodMap[key] === item.x) || 'N/A';
                                         const impactLabel = Object.keys(impactMap).find(key => impactMap[key] === item.y) || 'N/A';
                                         return [
                                             `Description: ${item.description}`,
                                             `Likelihood: ${likelihoodLabel.charAt(0).toUpperCase() + likelihoodLabel.slice(1)}`,
                                             `Impact: ${impactLabel.charAt(0).toUpperCase() + impactLabel.slice(1)}`,
                                             `Status: ${item.status.charAt(0).toUpperCase() + item.status.slice(1)}`
                                         ];
                                     }
                                 }
                             }
                         },
                         scales: {
                             x: {
                                 type: 'linear',
                                 position: 'bottom',
                                 min: 0.5,
                                 max: 3.5,
                                 ticks: {
                                     stepSize: 1,
                                     callback: function(value) {
                                         return Object.keys(likelihoodMap).find(key => likelihoodMap[key] === value) || '';
                                     }
                                 },
                                 title: {
                                     display: true,
                                     text: 'Likelihood'
                                 },
                                 grid: {
                                     drawOnChartArea: false // Hide grid lines for cleaner look
                                 }
                             },
                             y: {
                                 type: 'linear',
                                 min: 0.5,
                                 max: 3.5,
                                 ticks: {
                                     stepSize: 1,
                                     callback: function(value) {
                                         return Object.keys(impactMap).find(key => impactMap[key] === value) || '';
                                     }
                                 },
                                 title: {
                                     display: true,
                                     text: 'Impact'
                                 },
                                  grid: {
                                     drawOnChartArea: false
                                 }
                             }
                         }
                     }
                 });
                 setupChartControls('riskMatrixChart', riskMatrixChart);
             }
         }


        function setupChartControls(chartId, chartInstance) {
            const controls = document.getElementById(`${chartId}-controls`);
            if (!controls) return;

            // Remove existing listeners
            controls.querySelectorAll('input, select').forEach(element => {
                 const clone = element.cloneNode(true);
                 element.parentNode.replaceChild(clone, element);
            });

            // Add new listeners
            controls.querySelectorAll('input, select').forEach(element => {
                element.addEventListener('change', () => updateChartFromControls(chartId, chartInstance));
            });
        }

        function updateChartFromControls(chartId, chartInstance) {
            const controls = document.getElementById(`${chartId}-controls`);
            if (!controls) return;

            const chartTypeSelect = controls.querySelector(`#${chartId}-type`);
            if (chartTypeSelect) {
                 chartInstance.config.type = chartTypeSelect.value;
            }

            const colorInput = controls.querySelector(`#${chartId}-color`);
            if (colorInput && chartInstance.config.data.datasets.length > 0) {
                // Assuming the first dataset's color is controlled
                chartInstance.config.data.datasets[0].backgroundColor = colorInput.value;
                chartInstance.config.data.datasets[0].borderColor = colorInput.value; // Update border color too
            }

            chartInstance.update();
        }

        function toggleControls(controlsId) {
             const controls = document.getElementById(controlsId);
             if (controls) {
                // Close all other controls first
                document.querySelectorAll('.floating-controls.active').forEach(ctrl => {
                    if (ctrl.id !== controlsId) {
                        ctrl.classList.remove('active');
                         ctrl.setAttribute('aria-hidden', 'true');
                    }
                });
                const isActive = controls.classList.toggle('active');
                 controls.setAttribute('aria-hidden', !isActive);
             }
        }

         // Close controls when clicking outside
        document.addEventListener('click', (e) => {
            // Check if the click is inside any .chart-container or .floating-controls
            const isInsideChartOrControls = e.target.closest('.chart-container') || e.target.closest('.floating-controls');

            // If the click is outside both, close all active controls
            if (!isInsideChartOrControls) {
                document.querySelectorAll('.floating-controls.active').forEach(ctrl => {
                    ctrl.classList.remove('active');
                     ctrl.setAttribute('aria-hidden', 'true');
                });
            }
        });


        // --- Assessment (Inventory Table) ---
        let currentInventorySort = { column: 'name', direction: 'asc' };
        let inventoryFilter = { type: '', status: '', search: '' };

        function renderInventoryTable(inventoryData) {
            const tbody = document.getElementById('inventory-table-body');
            if (!tbody) return;
            tbody.innerHTML = ''; // Clear existing rows

            // Apply filters
            let filteredData = inventoryData.filter(item => {
                 const typeMatch = inventoryFilter.type === '' || item.type === inventoryFilter.type;
                 const statusMatch = inventoryFilter.status === '' || item.status === inventoryFilter.status;
                 const searchTerm = inventoryFilter.search.toLowerCase();
                 const searchMatch = searchTerm === '' ||
                                     item.name.toLowerCase().includes(searchTerm) ||
                                     (item.os || '').toLowerCase().includes(searchTerm) ||
                                     (item.apps || '').toLowerCase().includes(searchTerm);
                 return typeMatch && statusMatch && searchMatch;
            });

            // Apply sorting
            const { column, direction } = currentInventorySort;
            filteredData.sort((a, b) => {
                 const aValue = a[column] || '';
                 const bValue = b[column] || '';
                 if (aValue < bValue) return direction === 'asc' ? -1 : 1;
                 if (aValue > bValue) return direction === 'asc' ? 1 : -1;
                 return 0;
            });

            filteredData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td data-label="Type">${item.type.charAt(0).toUpperCase() + item.type.slice(1)}</td>
                    <td data-label="Name">${item.name}</td>
                    <td data-label="OS/Version">${item.os || 'N/A'}</td>
                    <td data-label="Applications">${item.apps || 'N/A'}</td>
                    <td data-label="Status">${item.status.charAt(0).toUpperCase() + item.status.slice(1)}</td>
                `;
                tbody.appendChild(row);
            });

             // Update ARIA sort attributes on headers
            document.querySelectorAll('#inventory-table th').forEach(th => {
                const sortKey = th.dataset.sort;
                if (sortKey === column) {
                    th.setAttribute('aria-sort', direction + 'ending');
                } else {
                    th.setAttribute('aria-sort', 'none');
                }
            });
        }

         function setupInventoryTableControls() {
             const typeFilter = document.getElementById('inventory-filter-type');
             const statusFilter = document.getElementById('inventory-filter-status');
             const searchInput = document.getElementById('inventory-search');
             const tableHeaders = document.querySelectorAll('#inventory-table th');

             if (typeFilter) {
                 typeFilter.addEventListener('change', (e) => {
                     inventoryFilter.type = e.target.value;
                     renderInventoryTable(projectData.inventory);
                 });
             }
              if (statusFilter) {
                 statusFilter.addEventListener('change', (e) => {
                     inventoryFilter.status = e.target.value;
                     renderInventoryTable(projectData.inventory);
                 });
             }
             if (searchInput) {
                 searchInput.addEventListener('input', (e) => {
                     inventoryFilter.search = e.target.value;
                     renderInventoryTable(projectData.inventory);
                 });
             }

             tableHeaders.forEach(header => {
                 header.addEventListener('click', () => {
                     const column = header.dataset.sort;
                     if (!column) return;

                     let direction = 'asc';
                     if (currentInventorySort.column === column) {
                         direction = currentInventorySort.direction === 'asc' ? 'desc' : 'asc';
                     }
                     currentInventorySort = { column, direction };
                     renderInventoryTable(projectData.inventory);
                 });
             });
         }


        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('open');
                 modal.setAttribute('aria-hidden', 'false');
                 // Find the first focusable element in the modal and focus it
                 const focusableElements = modal.querySelectorAll('input, select, textarea, button:not(.modal-close)');
                 if (focusableElements.length > 0) {
                     focusableElements[0].focus();
                 }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('open');
                 modal.setAttribute('aria-hidden', 'true');
                // Clear form fields in the modal
                 const form = modal.querySelector('.modal-body');
                 if(form) form.querySelectorAll('input, select, textarea').forEach(input => input.value = '');
                 // Return focus to the element that opened the modal (if possible)
                 // Simple implementation: return focus to the active section title
                 document.getElementById(currentSection + '-title')?.focus();
            }
        }

        function saveInventoryItem() {
            const type = document.getElementById('inventory-type').value;
            const name = document.getElementById('inventory-name').value;
            const os = document.getElementById('inventory-os').value;
            const apps = document.getElementById('inventory-apps').value;
            const status = document.getElementById('inventory-status').value;

            if (!name || !type || !status) {
                 showNotification('Item Name, Type, and Status are required.', 'error');
                 return;
            }

            const newItem = {
                 id: projectData.inventory.length + 1, // Simple unique ID
                 type,
                 name,
                 os,
                 apps,
                 status
             };
            projectData.inventory.push(newItem);
            renderInventoryTable(projectData.inventory); // Re-render with new item
            closeModal('addInventoryModal');
            showNotification('Inventory item added successfully!', 'success');

             // Update dashboard inventory chart if on dashboard
             if (currentSection === 'dashboard') {
                 renderCharts();
             }
        }

         function saveRiskItem() {
             const description = document.getElementById('risk-description').value;
             const likelihood = document.getElementById('risk-likelihood').value;
             const impact = document.getElementById('risk-impact').value;
             const mitigation = document.getElementById('risk-mitigation').value;
             const status = document.getElementById('risk-status').value;

             if (!description || !likelihood || !impact || !status) {
                 showNotification('Risk Description, Likelihood, Impact, and Status are required.', 'error');
                 return;
             }

             const likelihoodValue = { 'low': 1, 'medium': 2, 'high': 3 }[likelihood] || 0;
             const impactValue = { 'low': 1, 'medium': 2, 'high': 3 }[impact] || 0;
             const score = likelihoodValue * impactValue;

             const newItem = {
                 id: projectData.risks.length + 1, // Simple unique ID
                 description,
                 likelihood,
                 impact,
                 score,
                 mitigation,
                 status
             };
             projectData.risks.push(newItem);
             renderRiskTable(projectData.risks); // Re-render with new item
             renderRiskMatrixChart(); // Update risk chart
             closeModal('addRiskModal');
             showNotification('Risk item added successfully!', 'success');

             // Update dashboard risk count if on dashboard
             if (currentSection === 'dashboard') {
                 updateDashboardMetrics();
             }
         }


        // --- Assessment (Checklist) ---
        function renderAssessmentChecklist() {
             const checklistUl = document.getElementById('assessment-checklist');
             if (!checklistUl) return;
             checklistUl.innerHTML = ''; // Clear existing items

             const assessmentTasks = projectData.tasks.filter(task => task.phase === "Assessment");

             assessmentTasks.forEach(task => {
                 const li = document.createElement('li');
                 li.classList.toggle('completed', task.completed);
                 li.innerHTML = `
                     <input type="checkbox" id="task-${task.id}" ${task.completed ? 'checked' : ''} data-task-id="${task.id}" aria-label="Mark task ${task.text} as complete">
                     <label for="task-${task.id}">${task.text}</label>
                 `;
                 checklistUl.appendChild(li);
             });

             checklistUl.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                 checkbox.addEventListener('change', handleTaskCompletion);
             });
        }

         // --- Compliance (Checklist) ---
        function renderComplianceChecklist() {
             const checklistUl = document.getElementById('compliance-checklist');
             if (!checklistUl) return;
             checklistUl.innerHTML = ''; // Clear existing items

             projectData.compliance.forEach(item => {
                 const li = document.createElement('li');
                 li.classList.toggle('completed', item.completed);
                 li.innerHTML = `
                     <input type="checkbox" id="compliance-${item.id}" ${item.completed ? 'checked' : ''} data-compliance-id="${item.id}" aria-label="Mark compliance requirement ${item.text} as met">
                     <label for="compliance-${item.id}">${item.text}</label>
                 `;
                 checklistUl.appendChild(li);
             });

             checklistUl.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                 checkbox.addEventListener('change', handleComplianceCompletion);
             });
        }

        function handleTaskCompletion(event) {
             const checkbox = event.target;
             const taskId = parseInt(checkbox.dataset.taskId, 10);
             const task = projectData.tasks.find(t => t.id === taskId);

             if (task) {
                 task.completed = checkbox.checked;
                 const listItem = checkbox.closest('li');
                 listItem.classList.toggle('completed', task.completed);
                 updateDashboardMetrics(); // Update metrics on dashboard
                 showNotification(`Task "${task.text}" marked as ${task.completed ? 'completed' : 'incomplete'}.`, 'info');
             }
        }

         function handleComplianceCompletion(event) {
             const checkbox = event.target;
             const complianceId = parseInt(checkbox.dataset.complianceId, 10);
             const complianceItem = projectData.compliance.find(item => item.id === complianceId);

             if (complianceItem) {
                 complianceItem.completed = checkbox.checked;
                 const listItem = checkbox.closest('li');
                 listItem.classList.toggle('completed', complianceItem.completed);
                 updateDashboardMetrics(); // Update metrics on dashboard
                 showNotification(`Compliance item "${complianceItem.text}" marked as ${complianceItem.completed ? 'met' : 'not met'}.`, 'info');
             }
        }

        // --- Risk Management (Table) ---
        let currentRiskSort = { column: 'score', direction: 'desc' }; // Default sort by score
         function renderRiskTable(riskData) {
             const tbody = document.getElementById('risk-table-body');
             if (!tbody) return;
             tbody.innerHTML = ''; // Clear existing rows

             // Apply sorting
            const { column, direction } = currentRiskSort;
            riskData.sort((a, b) => {
                 const aValue = a[column] || '';
                 const bValue = b[column] || '';

                 // Handle numeric sort for score
                 if (column === 'score') {
                      const scoreA = typeof aValue === 'number' ? aValue : 0;
                      const scoreB = typeof bValue === 'number' ? bValue : 0;
                      return direction === 'asc' ? scoreA - scoreB : scoreB - scoreA;
                 }

                 // Handle string sort for others
                 if (aValue < bValue) return direction === 'asc' ? -1 : 1;
                 if (aValue > bValue) return direction === 'asc' ? 1 : -1;
                 return 0;
            });

             riskData.forEach(item => {
                 const row = document.createElement('tr');
                 row.innerHTML = `
                     <td data-label="Risk">${item.description}</td>
                     <td data-label="Likelihood">${item.likelihood.charAt(0).toUpperCase() + item.likelihood.slice(1)}</td>
                     <td data-label="Impact">${item.impact.charAt(0).toUpperCase() + item.impact.slice(1)}</td>
                     <td data-label="Score">${item.score}</td>
                     <td data-label="Mitigation">${item.mitigation || 'N/A'}</td>
                     <td data-label="Status">${item.status.charAt(0).toUpperCase() + item.status.slice(1)}</td>
                 `;
                 tbody.appendChild(row);
             });

              // Update ARIA sort attributes on headers
            document.querySelectorAll('#risk-table-body').forEach(th => {
                 const sortKey = th.dataset.sort;
                 if (sortKey === column) {
                     th.setAttribute('aria-sort', direction + 'ending');
                 } else {
                     th.setAttribute('aria-sort', 'none');
                 }
             });
         }

         function setupRiskTableControls() {
             const tableHeaders = document.querySelectorAll('#risk table th');
              tableHeaders.forEach(header => {
                 header.addEventListener('click', () => {
                     const column = header.dataset.sort;
                     if (!column) return;

                     let direction = 'asc';
                     if (currentRiskSort.column === column) {
                         direction = currentRiskSort.direction === 'asc' ? 'desc' : 'asc';
                     }
                     currentRiskSort = { column, direction };
                     renderRiskTable(projectData.risks);
                 });
             });
         }


        // --- Wizard (Basic Simulation) ---
        let currentWizardStep = 1;
        const totalWizardSteps = 3;
        const wizardStepsContainer = document.getElementById('planning-wizard-steps');
        const wizardStepContents = document.querySelectorAll('.wizard-step-content');
        const wizardPrevBtn = document.getElementById('wizard-prev');
        const wizardNextBtn = document.getElementById('wizard-next');
        const wizardFinishBtn = document.getElementById('wizard-finish');

        function updateWizardUI() {
            // Update step indicators
            wizardStepsContainer.querySelectorAll('.wizard-step').forEach(stepEl => {
                const step = parseInt(stepEl.dataset.step, 10);
                stepEl.classList.remove('active', 'completed');
                if (step < currentWizardStep) {
                    stepEl.classList.add('completed');
                } else if (step === currentWizardStep) {
                    stepEl.classList.add('active');
                }
            });

            // Update step content visibility
            wizardStepContents.forEach(contentEl => {
                const step = parseInt(contentEl.id.replace('wizard-step-', ''), 10);
                contentEl.style.display = step === currentWizardStep ? 'block' : 'none';
            });

            // Update button states
            wizardPrevBtn.disabled = currentWizardStep === 1;
            wizardNextBtn.style.display = currentWizardStep < totalWizardSteps ? 'inline-block' : 'none';
            wizardFinishBtn.style.display = currentWizardStep === totalWizardSteps ? 'inline-block' : 'none';

             // Update overall project progress for Planning phase (mock)
             const planningPhase = projectData.phases.find(p => p.name === "Planning");
             if (planningPhase) {
                 planningPhase.progress = Math.round(((currentWizardStep - 1) / totalWizardSteps) * 100);
                 if (currentWizardStep === totalWizardSteps) planningPhase.progress = 90; // Almost done, needs final step
                 if (currentWizardStep > totalWizardSteps) planningPhase.progress = 100; // Finished
                 updateDashboardMetrics(); // Update dashboard
             }
        }

        function nextWizardStep() {
            if (currentWizardStep < totalWizardSteps) {
                currentWizardStep++;
                updateWizardUI();
                showNotification(`Proceeding to Wizard Step ${currentWizardStep}/${totalWizardSteps}.`, 'info');
            }
        }

        function prevWizardStep() {
            if (currentWizardStep > 1) {
                currentWizardStep--;
                updateWizardUI();
                showNotification(`Returning to Wizard Step ${currentWizardStep}/${totalWizardSteps}.`, 'info');
            }
        }

        function finishWizard() {
             currentWizardStep++; // Mark as finished
             updateWizardUI();
             showNotification('Project setup wizard completed!', 'success');
             // In a real app, this would save the project details and potentially move to the next phase
             // For simulation, just reset the wizard after a delay
             setTimeout(() => {
                 currentWizardStep = 1;
                 updateWizardUI();
                 // Clear form fields (basic example)
                 document.getElementById('project-name').value = '';
                 document.getElementById('project-goal').value = '';
                 document.getElementById('project-scope').value = '';
                 document.getElementById('project-objectives').value = '';
                 document.getElementById('project-team').value = '';
                 document.getElementById('project-timeline').value = '';
             }, 5000); // Reset after 5 seconds
        }


        // --- Cost Estimation (Basic Calculation) ---
        function setupCostEstimation() {
            const computeInput = document.getElementById('cost-compute');
            const storageInput = document.getElementById('cost-storage');
            const migrationInput = document.getElementById('cost-migration');
            const totalSpan = document.getElementById('total-estimated-cost');

            const updateCost = () => {
                const compute = parseFloat(computeInput.value) || 0;
                const storage = parseFloat(storageInput.value) || 0;
                const migration = parseFloat(migrationInput.value) || 0;
                const total = compute + storage + migration;
                totalSpan.textContent = total.toFixed(2);
            };

            if (computeInput) computeInput.addEventListener('input', updateCost);
            if (storageInput) storageInput.addEventListener('input', updateCost);
            if (migrationInput) migrationInput.addEventListener('input', updateCost);

            // Initial calculation
            updateCost();
        }


        // --- Notifications ---
        let notificationTimeout;
        function showNotification(message, type = 'info', duration = 3000) {
            notificationEl.textContent = message;
            notificationEl.className = `notification show ${type}`; // Reset classes and add new ones
            notificationEl.setAttribute('aria-live', 'polite'); // Announce to screen readers

            clearTimeout(notificationTimeout);
            notificationTimeout = setTimeout(() => {
                notificationEl.classList.remove('show');
                 notificationEl.setAttribute('aria-live', 'off');
            }, duration);
        }


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load default section (Dashboard)
            showSection('dashboard');

             // Setup table controls after initial render
             setupInventoryTableControls();
             setupRiskTableControls();
             setupCostEstimation(); // Setup cost calculation

             // Initial wizard UI state
             updateWizardUI();

             // Setup modal closing on escape key
             document.addEventListener('keydown', (event) => {
                 if (event.key === 'Escape') {
                     document.querySelectorAll('.modal.open').forEach(modal => {
                         closeModal(modal.id);
                     });
                 }
             });
        });

         // Close modal on outside click
         window.addEventListener('click', (event) => {
            document.querySelectorAll('.modal.open').forEach(modal => {
                if (event.target === modal) {
                    closeModal(modal.id);
                }
            });
         });

    </script>

</body>
</html>
