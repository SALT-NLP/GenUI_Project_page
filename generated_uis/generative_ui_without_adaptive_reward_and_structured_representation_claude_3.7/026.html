<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Feedback Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        :root {
            --primary-color: #007bff;
            --primary-color-dark: #0056b3;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --text-color-dark: #333;
            --text-color-light: #fff;
            --border-color: #ced4da;
            --background-color-light: #f8f9fa;
            --background-color-white: #fff;
            --shadow-subtle: 0 4px 8px rgba(0, 0, 0, 0.08); /* Slightly stronger shadow */
            --spacing-unit: 8px;
            --border-radius: 8px; /* Slightly larger radius */
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-color-dark);
            background-color: var(--background-color-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: calc(var(--spacing-unit) * 3);
            margin: 0;
            box-sizing: border-box;
        }

        .form-container {
            background-color: var(--background-color-white);
            padding: calc(var(--spacing-unit) * 5); /* Increased padding */
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            width: 100%;
            max-width: 550px; /* Increased max-width */
            border: 1px solid #e9ecef;
            box-sizing: border-box;
        }

        .form-header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 5); /* Increased margin */
            color: var(--primary-color);
            font-weight: 700;
            font-size: 2em; /* Increased font size */
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 600;
            color: var(--text-color-dark);
            font-size: 1em; /* Adjusted font size */
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group textarea {
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1em;
            color: var(--text-color-dark);
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-sizing: border-box;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="email"]:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25); /* Adjusted shadow */
            outline: none;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 150px; /* Increased min-height */
        }

        .rating-group .rating-stars {
            display: flex;
            gap: var(--spacing-unit); /* Increased gap */
            cursor: pointer;
            font-size: 2em; /* Increased star size */
            color: var(--border-color); /* Default star color */
        }

        .rating-group .rating-stars .star {
            transition: color 0.2s ease-in-out, transform 0.1s ease-in-out;
            fill: currentColor;
            outline: none; /* Remove default outline */
        }

        .rating-group .rating-stars .star:hover,
        .rating-group .rating-stars .star.hovered,
        .rating-group .rating-stars .star:focus { /* Add focus state */
            color: var(--warning-color);
            transform: scale(1.1);
        }

        .rating-group .rating-stars .star.selected {
            color: var(--warning-color);
        }

        .validation-message {
            color: var(--error-color);
            font-size: 0.85em;
            margin-top: var(--spacing-unit);
            min-height: 1.2em; /* Reserve space */
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.3s ease-in-out, max-height 0.3s ease-in-out;
        }

        .validation-message.show {
            opacity: 1;
            max-height: 2em;
        }

        .submit-button {
            display: block;
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.75); /* Increased padding */
            background-color: var(--primary-color);
            color: var(--text-color-light);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, opacity 0.2s ease-in-out;
            outline: none; /* Remove default outline */
        }

        .submit-button:hover {
            background-color: var(--primary-color-dark);
        }

        .submit-button:active {
            transform: scale(0.98);
        }

        .submit-button:focus { /* Add focus state */
             box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.5);
        }

        .submit-button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .message-area {
            margin-top: calc(var(--spacing-unit) * 4);
            padding: calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.4s ease-in-out, max-height 0.4s ease-in-out, padding 0.4s ease-in-out; /* Transition padding */
        }

        .message-area.show {
            opacity: 1;
            max-height: 100px; /* Sufficient height for message */
            padding: calc(var(--spacing-unit) * 2); /* Restore padding when shown */
        }
         .message-area:not(.show) {
             padding-top: 0; /* Remove vertical padding when hidden */
             padding-bottom: 0;
         }


        .message-area.success {
            background-color: #d4edda;
            color: var(--success-color);
            border: 1px solid #c3e6cb;
        }

        .message-area.error {
            background-color: #f8d7da;
            color: var(--error-color);
            border: 1px solid #f5c6cb;
        }

        /* Accessibility */
        [aria-invalid="true"] {
            border-color: var(--error-color) !important;
        }

        [aria-invalid="true"]:focus {
             box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25) !important;
        }

        /* Star SVG Icon */
        .star-icon {
            width: 1em;
            height: 1em;
            vertical-align: middle;
            pointer-events: none; /* Prevent SVG from interfering with mouse events on span */
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .form-container {
                padding: calc(var(--spacing-unit) * 3);
            }

            .form-header {
                font-size: 1.6em;
                margin-bottom: calc(var(--spacing-unit) * 3);
            }

            .form-group {
                 margin-bottom: calc(var(--spacing-unit) * 2.5);
            }

            .form-group input[type="text"],
            .form-group input[type="email"],
            .form-group textarea,
            .submit-button {
                 padding: calc(var(--spacing-unit) * 1.25);
                 font-size: 0.95em;
            }

            .rating-group .rating-stars {
                font-size: 1.6em;
                gap: calc(var(--spacing-unit) / 2);
            }

             .message-area.show {
                 padding: calc(var(--spacing-unit) * 1.5);
             }
        }

    </style>
</head>
<body>
    <div class="form-container">
        <h2 class="form-header">Share Your Feedback</h2>
        <form id="feedbackForm" novalidate>
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required aria-required="true">
                <div id="nameValidation" class="validation-message" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required aria-required="true">
                <div id="emailValidation" class="validation-message" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label for="feedback">Feedback Message:</label>
                <textarea id="feedback" name="feedback" required aria-required="true"></textarea>
                <div id="feedbackValidation" class="validation-message" aria-live="polite"></div>
            </div>

            <div class="form-group rating-group">
                <label>Rating:</label>
                <div class="rating-stars" id="ratingStars" role="radiogroup" aria-label="Customer Rating">
                    <span class="star" data-value="1" role="radio" aria-checked="false" tabindex="0">
                         <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 .587l3.668 7.425 8.262 1.197-5.972 5.818 1.416 8.23-7.374-3.871-7.373 3.871 1.416-8.23-5.973-5.818 8.262-1.197z"/>
                        </svg>
                    </span>
                    <span class="star" data-value="2" role="radio" aria-checked="false" tabindex="0">
                         <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 .587l3.668 7.425 8.262 1.197-5.972 5.818 1.416 8.23-7.374-3.871-7.373 3.871 1.416-8.23-5.973-5.818 8.262-1.197z"/>
                        </svg>
                    </span>
                    <span class="star" data-value="3" role="radio" aria-checked="false" tabindex="0">
                         <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 .587l3.668 7.425 8.262 1.197-5.972 5.818 1.416 8.23-7.374-3.871-7.373 3.871 1.416-8.23-5.973-5.818 8.262-1.197z"/>
                        </svg>
                    </span>
                    <span class="star" data-value="4" role="radio" aria-checked="false" tabindex="0">
                         <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 .587l3.668 7.425 8.262 1.197-5.972 5.818 1.416 8.23-7.374-3.871-7.373 3.871 1.416-8.23-5.973-5.818 8.262-1.197z"/>
                        </svg>
                    </span>
                    <span class="star" data-value="5" role="radio" aria-checked="false" tabindex="0">
                         <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 .587l3.668 7.425 8.262 1.197-5.972 5.818 1.416 8.23-7.374-3.871-7.373 3.871 1.416-8.23-5.973-5.818 8.262-1.197z"/>
                        </svg>
                    </span>
                </div>
                 <div id="ratingValidation" class="validation-message" aria-live="polite"></div>
            </div>

            <button type="submit" class="submit-button">Submit Feedback</button>
        </form>

        <div id="formMessage" class="message-area" aria-live="polite">
            <!-- Success or error message will be displayed here -->
        </div>
    </div>

    <script>
        const form = document.getElementById('feedbackForm');
        const nameInput = document.getElementById('name');
        const emailInput = document.getElementById('email');
        const feedbackTextarea = document.getElementById('feedback');
        const ratingStarsContainer = document.getElementById('ratingStars');
        const stars = ratingStarsContainer.querySelectorAll('.star');
        const nameValidation = document.getElementById('nameValidation');
        const emailValidation = document.getElementById('emailValidation');
        const feedbackValidation = document.getElementById('feedbackValidation');
        const ratingValidation = document.getElementById('ratingValidation');
        const formMessage = document.getElementById('formMessage');
        const submitButton = form.querySelector('.submit-button');

        let selectedRating = 0;

        // --- Validation Functions ---
        function showValidationMessage(element, message) {
            let validationElement;
            if (element === ratingStarsContainer) {
                validationElement = ratingValidation;
            } else {
                validationElement = document.getElementById(element.id + 'Validation');
            }

            if (validationElement) {
                validationElement.textContent = message;
                validationElement.classList.add('show');
                 // Set aria-invalid on the input/container itself
                element.setAttribute('aria-invalid', 'true');
            }
        }

        function hideValidationMessage(element) {
             let validationElement;
            if (element === ratingStarsContainer) {
                validationElement = ratingValidation;
            } else {
                validationElement = document.getElementById(element.id + 'Validation');
            }

            if (validationElement) {
                validationElement.textContent = '';
                validationElement.classList.remove('show');
                 // Set aria-invalid on the input/container itself
                element.setAttribute('aria-invalid', 'false');
            }
        }

        function validateField(element) {
            if (element.validity.valid) {
                hideValidationMessage(element);
                return true;
            } else {
                let message = '';
                if (element.validity.valueMissing) {
                    message = 'This field is required.';
                } else if (element.validity.typeMismatch) {
                    message = 'Please enter a valid email address.';
                } else {
                    message = 'Invalid value.'; // Generic fallback
                }
                showValidationMessage(element, message);
                return false;
            }
        }

        function validateRating() {
             if (selectedRating === 0) {
                 showValidationMessage(ratingStarsContainer, 'Please select a rating.');
                 return false;
             } else {
                 hideValidationMessage(ratingStarsContainer);
                 return true;
             }
        }

        function validateForm() {
            const isNameValid = validateField(nameInput);
            const isEmailValid = validateField(emailInput);
            const isFeedbackValid = validateField(feedbackTextarea);
            const isRatingValid = validateRating();

            // Return true only if ALL are valid
            return isNameValid && isEmailValid && isFeedbackValid && isRatingValid;
        }

        // --- Rating Stars Logic ---
        function updateStarAppearance(ratingValue) {
            stars.forEach(star => {
                const starValue = parseInt(star.dataset.value);
                if (starValue <= ratingValue) {
                    star.classList.add('selected');
                    star.setAttribute('aria-checked', 'true');
                } else {
                    star.classList.remove('selected');
                    star.setAttribute('aria-checked', 'false');
                }
                 star.classList.remove('hovered'); // Remove hover class when clicking
            });
             // Ensure focus state is handled correctly after click/selection
             const focusedStar = ratingStarsContainer.querySelector('.star:focus');
             if(focusedStar) {
                 const focusValue = parseInt(focusedStar.dataset.value);
                 stars.forEach(s => {
                    const sValue = parseInt(s.dataset.value);
                    if (sValue <= focusValue) {
                        s.classList.add('hovered');
                    } else {
                        s.classList.remove('hovered');
                    }
                });
             }
        }

        stars.forEach(star => {
            star.addEventListener('mouseover', () => {
                const hoverValue = parseInt(star.dataset.value);
                stars.forEach(s => {
                    const sValue = parseInt(s.dataset.value);
                    if (sValue <= hoverValue) {
                        s.classList.add('hovered');
                    } else {
                        s.classList.remove('hovered');
                    }
                });
            });

            star.addEventListener('mouseout', () => {
                // Revert to selected state on mouseout
                updateStarAppearance(selectedRating);
            });

            star.addEventListener('click', () => {
                selectedRating = parseInt(star.dataset.value);
                updateStarAppearance(selectedRating);
                validateRating(); // Validate rating on click
            });

             // Keyboard navigation for rating
            star.addEventListener('keydown', (event) => {
                const currentValue = parseInt(star.dataset.value);
                let nextStar = null;
                let targetValue = currentValue;

                if (event.key === 'ArrowRight' || event.key === 'ArrowDown') {
                    targetValue = Math.min(5, currentValue + 1);
                    nextStar = ratingStarsContainer.querySelector(`[data-value="${targetValue}"]`);
                } else if (event.key === 'ArrowLeft' || event.key === 'ArrowUp') {
                    targetValue = Math.max(1, currentValue - 1);
                    nextStar = ratingStarsContainer.querySelector(`[data-value="${targetValue}"]`);
                } else if (event.key === ' ') { // Space key to select
                    event.preventDefault(); // Prevent default space action (scrolling)
                    selectedRating = currentValue;
                    updateStarAppearance(selectedRating);
                    validateRating();
                } else if (event.key === 'Enter') { // Enter key to select
                     event.preventDefault();
                     selectedRating = currentValue;
                     updateStarAppearance(selectedRating);
                     validateRating();
                } else if (event.key === 'Home') { // Home key to select 1 star
                     event.preventDefault();
                     targetValue = 1;
                     nextStar = ratingStarsContainer.querySelector(`[data-value="${targetValue}"]`);
                } else if (event.key === 'End') { // End key to select 5 stars
                     event.preventDefault();
                     targetValue = 5;
                     nextStar = ratingStarsContainer.querySelector(`[data-value="${targetValue}"]`);
                }


                if (nextStar) {
                    event.preventDefault();
                    nextStar.focus();
                     // Highlight stars up to the focused one
                    stars.forEach(s => {
                        const sValue = parseInt(s.dataset.value);
                        if (sValue <= targetValue) {
                            s.classList.add('hovered');
                        } else {
                            s.classList.remove('hovered');
                        }
                    });
                }
            });

             star.addEventListener('focus', () => {
                 const focusValue = parseInt(star.dataset.value);
                 stars.forEach(s => {
                    const sValue = parseInt(s.dataset.value);
                    if (sValue <= focusValue) {
                        s.classList.add('hovered');
                    } else {
                        s.classList.remove('hovered');
                    }
                });
             });

             star.addEventListener('blur', () => {
                 // Revert to selected state on blur
                 stars.forEach(s => s.classList.remove('hovered'));
                 updateStarAppearance(selectedRating);
             });
        });


        // --- Form Submission Handling ---
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent actual form submission

            hideFormMessage(); // Hide previous message

            // Disable button and add loading state if needed (optional)
            submitButton.disabled = true;

            if (validateForm()) {
                // Form is valid, collect data
                const formData = {
                    name: nameInput.value.trim(),
                    email: emailInput.value.trim(),
                    feedback: feedbackTextarea.value.trim(),
                    rating: selectedRating
                };

                console.log('Form Data Submitted:', formData);

                // Simulate successful submission
                setTimeout(() => {
                    showFormMessage('Thank you for your feedback!', 'success');
                    form.reset(); // Clear the form
                    selectedRating = 0; // Reset rating state
                    updateStarAppearance(selectedRating); // Reset star appearance
                    // Reset aria-invalid states for all fields
                    nameInput.setAttribute('aria-invalid', 'false');
                    emailInput.setAttribute('aria-invalid', 'false');
                    feedbackTextarea.setAttribute('aria-invalid', 'false');
                    ratingStarsContainer.setAttribute('aria-invalid', 'false');

                    // Re-enable button
                    submitButton.disabled = false;

                }, 1000); // Simulate network delay
            } else {
                // Form is invalid, validation messages are already shown
                 showFormMessage('Please correct the errors in the form.', 'error');
                 // Re-enable button
                 submitButton.disabled = false;
            }
        });

        // --- Real-time Validation on Input/Blur ---
        nameInput.addEventListener('blur', () => validateField(nameInput));
        nameInput.addEventListener('input', () => hideValidationMessage(nameInput)); // Clear message on input

        emailInput.addEventListener('blur', () => validateField(emailInput));
        emailInput.addEventListener('input', () => hideValidationMessage(emailInput)); // Clear message on input

        feedbackTextarea.addEventListener('blur', () => validateField(feedbackTextarea));
        feedbackTextarea.addEventListener('input', () => hideValidationMessage(feedbackTextarea)); // Clear message on input

        // Rating validation is handled in the click/keydown/blur handlers for stars


        // --- Submission Message Handling ---
        function showFormMessage(message, type) {
            formMessage.textContent = message;
            // Use a timeout to allow the max-height/padding transition to work after adding 'show'
            requestAnimationFrame(() => {
                 formMessage.className = 'message-area show ' + type; // Reset classes and add new ones
            });
        }

        function hideFormMessage() {
            // Remove 'show' first to trigger max-height/padding transition
            formMessage.classList.remove('show');
            // Clear content and type classes after transition (optional, but good practice)
            setTimeout(() => {
                 formMessage.textContent = '';
                 formMessage.classList.remove('success', 'error');
            }, 400); // Match CSS transition duration
        }

         // Initial state: ensure aria-invalid is false initially
         nameInput.setAttribute('aria-invalid', 'false');
         emailInput.setAttribute('aria-invalid', 'false');
         feedbackTextarea.setAttribute('aria-invalid', 'false');
         ratingStarsContainer.setAttribute('aria-invalid', 'false');

         // Set initial rating appearance (none selected)
         updateStarAppearance(selectedRating);

    </script>
</body>
</html>
