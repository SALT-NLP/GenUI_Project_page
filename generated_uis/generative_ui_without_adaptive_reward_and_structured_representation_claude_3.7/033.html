<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychology Experiment Data Organizer</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <style>
        :root {
            --primary-color: #007bff;
            --primary-dark: #0056b3;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-color: #212529;
            --border-color: #ced4da;
            --hover-color: #e9ecef;
            --focus-color: rgba(0, 123, 255, 0.25);
            --spacing-unit: 1rem;
            --border-radius: 0.25rem;
            --box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            font-display: swap; /* Optimize font loading */
        }

        .app-container {
            width: 95%;
            max-width: 1200px;
            margin: var(--spacing-unit) auto;
            padding: calc(var(--spacing-unit) * 2); /* Desktop padding */
            background-color: var(--surface-color);
            border-radius: calc(var(--border-radius) * 2);
            box-shadow: var(--box-shadow);
            display: grid;
            grid-template-columns: 1fr; /* Single column layout */
            gap: calc(var(--spacing-unit) * 2);
        }

        header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--border-color);
        }

        header h1 {
            margin: 0;
            color: var(--primary-color);
            font-size: 2em;
            font-weight: 700;
        }

        section {
            padding: calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #fefefe;
        }

        h2 {
            margin-top: 0;
            color: var(--primary-dark);
            font-size: 1.5em;
            margin-bottom: var(--spacing-unit);
        }

        /* Desktop-first form layout */
        .form-section form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-unit);
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 var(--border-radius) var(--focus-color);
        }

        button {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, opacity 0.2s ease-in-out;
            outline: none;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        button:active {
            background-color: #004085;
        }

        button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .form-actions {
            grid-column: 1 / -1; /* Span across all columns */
            display: flex;
            justify-content: flex-end; /* Align button to the right on desktop */
            margin-top: var(--spacing-unit);
        }

        .data-table-section {
            margin-top: calc(var(--spacing-unit) * 2);
        }

        /* Desktop-first controls layout */
        .controls {
            display: flex;
            gap: var(--spacing-unit);
            margin-bottom: var(--spacing-unit);
            flex-wrap: wrap;
        }

        .controls .form-group {
            flex-direction: row; /* Align label and input/select horizontally */
            align-items: center;
            gap: 0.5rem;
        }

        .controls .form-group label {
            margin-bottom: 0;
            white-space: nowrap;
        }

        .controls .form-group input,
        .controls .form-group select {
             padding: 0.5rem;
             font-size: 0.9rem;
             width: auto; /* Allow inputs/selects to size based on content/flex */
        }

        .table-container {
            width: 100%;
            overflow-x: auto; /* Enable horizontal scrolling for table on small screens */
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-unit);
            min-width: 600px; /* Ensure table has a minimum width for scrolling */
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            position: relative; /* Needed for sort indicator */
            padding-right: 1.5rem; /* Add space for indicator */
        }

        .data-table th:hover {
            background-color: var(--primary-dark);
        }

        .data-table tbody tr:nth-child(even) {
            background-color: var(--background-color);
        }

        .data-table tbody tr:hover {
            background-color: var(--hover-color);
        }

        .sort-indicator {
            display: inline-block;
            margin-left: 0.5rem;
            width: 0;
            height: 0;
            vertical-align: middle;
            border-left: 5px solid transparent; /* Slightly larger indicator */
            border-right: 5px solid transparent;
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
        }

        .sort-asc .sort-indicator {
            border-bottom: 8px solid white; /* White triangle pointing up */
        }

        .sort-desc .sort-indicator {
            border-top: 8px solid white; /* White triangle pointing down */
        }

        .feedback-area {
            margin-top: var(--spacing-unit);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            min-height: 1.2em; /* Reserve space to prevent layout shifts */
        }

        .feedback-area.show {
            opacity: 1;
        }

        .feedback-area.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .feedback-area.error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .app-container {
                padding: var(--spacing-unit); /* Reduce padding on smaller screens */
            }

            .form-section form {
                grid-template-columns: 1fr; /* Stack form fields */
            }

            .form-actions {
                justify-content: center; /* Center button on mobile */
            }

            .controls {
                flex-direction: column; /* Stack controls */
                align-items: stretch;
            }

            .controls .form-group {
                flex-direction: column; /* Stack label and input/select */
                align-items: flex-start;
                gap: 0.25rem;
            }

            .controls .form-group input,
            .controls .form-group select {
                width: 100%; /* Make inputs/selects full width */
            }

             .data-table th,
             .data-table td {
                 padding: 0.5rem; /* Reduce padding on smaller screens */
                 font-size: 0.9em;
             }

             .sort-indicator {
                 right: 0.25rem; /* Adjust indicator position */
             }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Psychology Experiment Data</h1>
        </header>

        <section class="form-section">
            <h2>Add New Entry</h2>
            <form id="experiment-form" aria-labelledby="form-heading">
                 <h2 id="form-heading" class="visually-hidden">Add New Experiment Entry</h2> <!-- Hidden heading for ARIA -->
                <div class="form-group">
                    <label for="participant-id">Participant ID:</label>
                    <input type="text" id="participant-id" required aria-required="true">
                </div>
                <div class="form-group">
                    <label for="condition">Condition:</label>
                    <select id="condition" required aria-required="true">
                        <option value="">--Select Condition--</option>
                        <option value="control">Control</option>
                        <option value="experimental-a">Experimental A</option>
                        <option value="experimental-b">Experimental B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="response-time">Response Time (ms):</label>
                    <input type="number" id="response-time" step="1" min="0" required aria-required="true">
                </div>
                <div class="form-group">
                    <label for="accuracy">Accuracy (%):</label>
                    <input type="number" id="accuracy" step="0.1" min="0" max="100" required aria-required="true">
                </div>
                 <div class="form-group">
                    <label for="trial-date">Trial Date:</label>
                    <input type="date" id="trial-date" required aria-required="true">
                </div>
                <div class="form-actions">
                    <button type="submit">Add Entry</button>
                </div>
            </form>
             <div id="form-feedback" class="feedback-area" aria-live="polite"></div>
        </section>

        <section class="data-table-section" aria-labelledby="table-heading">
             <h2 id="table-heading" class="visually-hidden">Experiment Data Table</h2> <!-- Hidden heading for ARIA -->
            <h2>Experiment Data</h2>

            <div class="controls">
                 <div class="form-group">
                    <label for="filter-condition">Filter by Condition:</label>
                    <select id="filter-condition" aria-label="Filter data by condition">
                        <option value="">All Conditions</option>
                        <option value="control">Control</option>
                        <option value="experimental-a">Experimental A</option>
                        <option value="experimental-b">Experimental B</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="filter-participant">Filter by Participant ID:</label>
                    <input type="text" id="filter-participant" placeholder="Enter ID" aria-label="Filter data by participant ID">
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="data-table">
                    <thead>
                        <tr>
                            <th data-sort-key="participantId" aria-sort="none" scope="col">Participant ID <span class="sort-indicator"></span></th>
                            <th data-sort-key="condition" aria-sort="none" scope="col">Condition <span class="sort-indicator"></span></th>
                            <th data-sort-key="responseTime" aria-sort="none" scope="col">Response Time (ms) <span class="sort-indicator"></span></th>
                            <th data-sort-key="accuracy" aria-sort="none" scope="col">Accuracy (%) <span class="sort-indicator"></span></th>
                            <th data-sort-key="trialDate" aria-sort="none" scope="col">Trial Date <span class="sort-indicator"></span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
             <div id="table-feedback" class="feedback-area" aria-live="polite"></div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('experiment-form');
            const dataTableBody = document.querySelector('#data-table tbody');
            const formFeedback = document.getElementById('form-feedback');
            const tableFeedback = document.getElementById('table-feedback');
            const filterConditionSelect = document.getElementById('filter-condition');
            const filterParticipantInput = document.getElementById('filter-participant');
            const tableHeaders = document.querySelectorAll('#data-table th[data-sort-key]'); // Select only sortable headers

            let experimentData = []; // Array to hold all experiment data
            let currentSort = { key: null, direction: 'none' }; // State for current sort

            // Load data from localStorage on initial load
            loadData();

            // --- Form Submission ---
            form.addEventListener('submit', (event) => {
                event.preventDefault();

                const participantIdInput = document.getElementById('participant-id');
                const conditionSelect = document.getElementById('condition');
                const responseTimeInput = document.getElementById('response-time');
                const accuracyInput = document.getElementById('accuracy');
                const trialDateInput = document.getElementById('trial-date');

                const participantId = participantIdInput.value.trim();
                const condition = conditionSelect.value;
                const responseTime = parseFloat(responseTimeInput.value);
                const accuracy = parseFloat(accuracyInput.value);
                const trialDate = trialDateInput.value;

                // Basic validation and visual feedback
                let isValid = true;
                if (!participantId) { participantIdInput.classList.add('invalid'); isValid = false; } else { participantIdInput.classList.remove('invalid'); }
                if (!condition) { conditionSelect.classList.add('invalid'); isValid = false; } else { conditionSelect.classList.remove('invalid'); }
                if (isNaN(responseTime) || responseTime < 0) { responseTimeInput.classList.add('invalid'); isValid = false; } else { responseTimeInput.classList.remove('invalid'); }
                if (isNaN(accuracy) || accuracy < 0 || accuracy > 100) { accuracyInput.classList.add('invalid'); isValid = false; } else { accuracyInput.classList.remove('invalid'); }
                if (!trialDate) { trialDateInput.classList.add('invalid'); isValid = false; } else { trialDateInput.classList.remove('invalid'); }


                if (!isValid) {
                    showFeedback(formFeedback, 'Please fill in all fields correctly.', 'error');
                    return;
                }

                const newEntry = {
                    id: Date.now(), // Simple unique ID
                    participantId,
                    condition,
                    responseTime,
                    accuracy,
                    trialDate: new Date(trialDate).toISOString().split('T')[0] // Format date consistently YYYY-MM-DD
                };

                experimentData.push(newEntry);
                saveData(); // Save to localStorage
                renderTable(); // Re-render table with new data
                form.reset(); // Clear the form
                 // Remove invalid classes after successful submission
                document.querySelectorAll('.form-group input, .form-group select').forEach(el => el.classList.remove('invalid'));
                showFeedback(formFeedback, 'Entry added successfully!', 'success');
            });

            // --- Data Management (Save/Load) ---
            function saveData() {
                try {
                    localStorage.setItem('experimentData', JSON.stringify(experimentData));
                } catch (e) {
                    console.error('Failed to save data to localStorage:', e);
                    showFeedback(tableFeedback, 'Failed to save data. Local storage might be full or unavailable.', 'error');
                }
            }

            function loadData() {
                try {
                    const storedData = localStorage.getItem('experimentData');
                    if (storedData) {
                        experimentData = JSON.parse(storedData);
                        // Ensure data types are correct after parsing from string
                        experimentData.forEach(entry => {
                            entry.responseTime = parseFloat(entry.responseTime);
                            entry.accuracy = parseFloat(entry.accuracy);
                            // trialDate is kept as YYYY-MM-DD string for sorting consistency
                        });
                        renderTable();
                    }
                } catch (e) {
                     console.error('Failed to load data from localStorage:', e);
                     showFeedback(tableFeedback, 'Failed to load data from local storage. Data might be corrupted.', 'error');
                }
            }

            // --- Table Rendering ---
            function renderTable() {
                const filteredData = applyFilters(experimentData);
                const sortedData = applySort(filteredData);

                dataTableBody.innerHTML = ''; // Clear existing rows

                if (sortedData.length === 0) {
                    const noDataRow = dataTableBody.insertRow();
                    const cell = noDataRow.insertCell(0);
                    cell.colSpan = tableHeaders.length;
                    cell.textContent = 'No data available.';
                    cell.style.textAlign = 'center';
                    cell.style.fontStyle = 'italic';
                     cell.style.padding = '1rem';
                    return;
                }

                sortedData.forEach(entry => {
                    const row = dataTableBody.insertRow();
                    row.innerHTML = `
                        <td>${escapeHTML(entry.participantId)}</td>
                        <td>${escapeHTML(entry.condition)}</td>
                        <td>${entry.responseTime.toFixed(2)}</td>
                        <td>${entry.accuracy.toFixed(2)}</td>
                        <td>${entry.trialDate}</td>
                    `;
                });
            }

             // Basic HTML escaping for safety
            function escapeHTML(str) {
                const div = document.createElement('div');
                div.appendChild(document.createTextNode(str));
                return div.innerHTML;
            }


            // --- Sorting ---
            tableHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const sortKey = header.getAttribute('data-sort-key');
                    if (!sortKey) return; // Should not happen with the selector

                    let direction = 'asc';
                    if (currentSort.key === sortKey) {
                        direction = currentSort.direction === 'asc' ? 'desc' : 'none'; // Cycle: asc -> desc -> none
                    }

                    currentSort = { key: sortKey, direction: direction };
                    updateSortIndicators();
                    renderTable();
                });
            });

            function applySort(data) {
                 const { key, direction } = currentSort;

                 if (direction === 'none' || !key) {
                     // If no sort or reset, return a copy of the current filtered data
                     return [...data];
                 }

                 const sortedData = [...data].sort((a, b) => {
                     const valueA = a[key];
                     const valueB = b[key];

                     let comparison = 0;
                     // Type-aware comparison
                     if (typeof valueA === 'string' && typeof valueB === 'string') {
                         comparison = valueA.localeCompare(valueB);
                     } else if (typeof valueA === 'number' && typeof valueB === 'number') {
                         if (valueA > valueB) comparison = 1;
                         else if (valueA < valueB) comparison = -1;
                     } else {
                         // Fallback for mixed types or dates (ISO strings compare correctly)
                         if (valueA > valueB) comparison = 1;
                         else if (valueA < valueB) comparison = -1;
                     }


                     return direction === 'asc' ? comparison : -comparison;
                 });

                 return sortedData;
             }

            function updateSortIndicators() {
                tableHeaders.forEach(header => {
                    header.classList.remove('sort-asc', 'sort-desc');
                    header.setAttribute('aria-sort', 'none');
                    const sortIndicator = header.querySelector('.sort-indicator');
                    // Clear any previous indicator styling if using text/symbols

                    if (header.getAttribute('data-sort-key') === currentSort.key) {
                        if (currentSort.direction === 'asc') {
                            header.classList.add('sort-asc');
                            header.setAttribute('aria-sort', 'ascending');
                        } else if (currentSort.direction === 'desc') {
                            header.classList.add('sort-desc');
                            header.setAttribute('aria-sort', 'descending');
                        }
                    }
                });
            }


            // --- Filtering ---
            filterConditionSelect.addEventListener('change', renderTable);
            filterParticipantInput.addEventListener('input', renderTable); // Use 'input' for real-time filtering

            function applyFilters(data) {
                const conditionFilter = filterConditionSelect.value;
                const participantFilter = filterParticipantInput.value.trim().toLowerCase();

                return data.filter(entry => {
                    const conditionMatch = conditionFilter === '' || entry.condition === conditionFilter;
                    const participantMatch = participantFilter === '' || entry.participantId.toLowerCase().includes(participantFilter);
                    return conditionMatch && participantMatch;
                });
            }

            // --- Feedback Messages ---
            function showFeedback(element, message, type) {
                // Clear previous timeout if any
                if (element.timeoutId) {
                    clearTimeout(element.timeoutId);
                }

                element.textContent = message;
                element.className = `feedback-area show ${type}`; // Reset classes

                // Hide after 3 seconds
                element.timeoutId = setTimeout(() => {
                    element.classList.remove('show');
                     element.textContent = ''; // Clear text after hiding
                }, 3000);
            }

            // Add invalid class for visual feedback on form inputs
            const formInputs = form.querySelectorAll('input, select');
            formInputs.forEach(input => {
                input.addEventListener('invalid', (event) => {
                    event.preventDefault(); // Prevent default browser validation bubble
                    input.classList.add('invalid');
                });
                 input.addEventListener('input', () => {
                     // Remove invalid class as user types/changes value
                     if (input.validity.valid) {
                         input.classList.remove('invalid');
                     }
                 });
            });

            // Add CSS for invalid state
            const styleSheet = document.styleSheets[0];
            styleSheet.insertRule(`
                .form-group input.invalid,
                .form-group select.invalid {
                    border-color: var(--danger-color);
                    box-shadow: 0 0 0 var(--border-radius) rgba(220, 53, 69, 0.25); /* Red focus shadow */
                }
            `, styleSheet.cssRules.length);

             // Add CSS for visually hidden class
             styleSheet.insertRule(`
                 .visually-hidden {
                     position: absolute;
                     width: 1px;
                     height: 1px;
                     margin: -1px;
                     padding: 0;
                     overflow: hidden;
                     clip: rect(0, 0, 0, 0);
                     border: 0;
                 }
             `, styleSheet.cssRules.length);


            // Initial render
            renderTable();
        });
    </script>
</body>
</html>
