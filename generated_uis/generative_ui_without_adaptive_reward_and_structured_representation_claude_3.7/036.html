<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Connect</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400,0,0" />
    <style>
        :root {
            --color-primary: #4CAF50; /* Market Green */
            --color-primary-dark: #388E3C;
            --color-primary-light: #C8E6C9;
            --color-accent: #FFC107; /* Sunny Yellow */
            --color-accent-dark: #FFA000;
            --color-text-dark: #212121;
            --color-text-light: #757575;
            --color-background: #FFFFFF;
            --color-surface: #F5F5F5; /* Light grey for cards/sections */
            --color-error: #F44336; /* Red */
            --color-success: #8BC34A; /* Light Green */
            --color-status-attending: var(--color-primary);
            --color-status-not-attending: var(--color-text-light);

            --spacing-unit: 8px;
            --border-radius: 8px;
            --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --transition-duration: 0.2s;
            --sidebar-width: 250px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-background);
            color: var(--color-text-dark);
            line-height: 1.6;
            overflow-y: hidden; /* Prevent body scroll when main content scrolls */
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--color-text-dark);
            margin-top: 0;
            margin-bottom: var(--spacing-unit);
        }

        a {
            text-decoration: none;
            color: var(--color-primary-dark);
            transition: color var(--transition-duration) ease;
        }
        a:hover {
            color: var(--color-primary-dark);
            text-decoration: underline;
        }
        a:focus-visible {
             outline: 2px solid var(--color-accent);
             outline-offset: 2px;
        }


        button {
            font-family: 'Roboto', sans-serif;
            cursor: pointer;
            border: none;
            border-radius: var(--border-radius);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            transition: background-color var(--transition-duration) ease, opacity var(--transition-duration) ease, transform var(--transition-duration) ease;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-unit);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        button:focus-visible {
            outline: 2px solid var(--color-accent);
            outline-offset: 2px;
        }

        .btn--primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn--primary:hover:not(:disabled) {
            background-color: var(--color-primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--box-shadow);
        }
         .btn--primary:active:not(:disabled) {
             transform: translateY(0);
             box-shadow: none;
         }

        .btn--secondary {
            background-color: var(--color-surface);
            color: var(--color-text-dark);
            border: 1px solid var(--color-text-light);
        }

        .btn--secondary:hover:not(:disabled) {
            background-color: #E0E0E0;
            transform: translateY(-1px);
            box-shadow: var(--box-shadow);
        }
         .btn--secondary:active:not(:disabled) {
             transform: translateY(0);
             box-shadow: none;
         }

        .btn--icon {
            background: none;
            border: none;
            padding: var(--spacing-unit);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color var(--transition-duration) ease;
        }

        .btn--icon .material-symbols-rounded {
            font-size: 24px;
            color: var(--color-text-dark);
        }
         .btn--icon.btn--light .material-symbols-rounded {
             color: white;
         }

        .btn--icon:hover:not(:disabled) {
            background-color: rgba(0, 0, 0, 0.08);
        }
         .btn--icon.btn--light:hover:not(:disabled) {
             background-color: rgba(255, 255, 255, 0.2);
         }
         .btn--icon:focus-visible {
             outline: 2px solid var(--color-accent);
             outline-offset: 2px;
             background-color: rgba(0, 0, 0, 0.12);
         }
         .btn--icon.btn--light:focus-visible {
              background-color: rgba(255, 255, 255, 0.25);
         }


        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        textarea,
        select {
            font-family: 'Roboto', sans-serif;
            width: 100%;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            margin-bottom: var(--spacing-unit);
            border: 1px solid var(--color-text-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-sizing: border-box; /* Include padding and border in element's total width and height */
            transition: border-color var(--transition-duration) ease, outline-color var(--transition-duration) ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        textarea:focus,
        select:focus {
            outline: 2px solid var(--color-primary);
            border-color: transparent; /* Hide default border when outline is visible */
        }

        label {
            display: block;
            margin-bottom: calc(var(--spacing-unit) / 2);
            font-weight: 500;
            color: var(--color-text-dark);
        }

        .form-group {
            margin-bottom: var(--spacing-unit) * 2;
        }

        .form-group--error input,
        .form-group--error textarea,
        .form-group--error select {
             border-color: var(--color-error);
        }
         .form-group--error input:focus,
         .form-group--error textarea:focus,
         .form-group--error select:focus {
              outline-color: var(--color-error);
         }
        .form-group--error .error-message {
             color: var(--color-error);
             font-size: 0.85rem;
             margin-top: var(--spacing-unit) / 2;
        }

        /* Layout - Desktop First */
        .app-container {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            grid-template-rows: auto 1fr;
            grid-template-areas:
                "header main"
                "sidebar main";
            min-height: 100vh;
        }

        .header {
            grid-area: header;
            display: flex;
            align-items: center;
            padding: var(--spacing-unit) * 1.5;
            background-color: var(--color-primary);
            color: white;
            box-shadow: var(--box-shadow);
            z-index: 100;
        }
         .header__title {
             margin: 0;
             font-size: 1.5rem;
             font-weight: 500;
             color: white; /* Ensure title is white */
         }
        .header__menu-button {
            display: none; /* Hide hamburger on desktop */
        }


        .nav-sidebar {
            grid-area: sidebar;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-unit) * 2;
            padding: var(--spacing-unit) * 3;
            background-color: var(--color-primary-dark);
            color: white;
            box-shadow: var(--box-shadow);
             overflow-y: auto; /* Allow sidebar to scroll if content is long */
        }

        .nav-sidebar__link {
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            transition: background-color var(--transition-duration) ease, color var(--transition-duration) ease;
        }

        .nav-sidebar__link:hover,
        .nav-sidebar__link:focus-visible {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            outline: none; /* Outline handled by background change */
        }

        .nav-sidebar__link--active {
            background-color: rgba(0, 0, 0, 0.2);
            color: white;
            font-weight: 500;
        }

        .nav-sidebar__link .material-symbols-rounded {
            font-size: 28px;
        }

        .main-content {
            grid-area: main;
            padding: var(--spacing-unit) * 3;
            overflow-y: auto; /* Enable scrolling for main content */
            height: 100%; /* Ensure main content takes full height */
        }

        .bottom-nav {
            display: none; /* Hide bottom nav on desktop */
        }

        /* Mobile Layout */
        @media (max-width: 767px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                grid-template-areas:
                    "header"
                    "main"
                    "bottom-nav";
                padding-bottom: 60px; /* Space for bottom nav */
            }

            .header {
                grid-area: header;
                position: sticky;
                top: 0;
                justify-content: space-between;
                padding: var(--spacing-unit) * 1.5;
            }
            .header__title {
                 font-size: 1.2rem;
            }
            .header__menu-button {
                display: flex; /* Show hamburger on mobile */
                 color: white;
            }
             .header__menu-button .material-symbols-rounded {
                 color: white;
             }
             .header__menu-button:hover:not(:disabled) {
                 background-color: rgba(255, 255, 255, 0.2);
             }


            .nav-sidebar {
                display: none; /* Hide sidebar on mobile */
            }

            .main-content {
                grid-area: main;
                padding: var(--spacing-unit) * 2;
                height: auto; /* Allow height to be determined by content */
                overflow-y: auto; /* Keep scrolling */
            }

            .bottom-nav {
                grid-area: bottom-nav;
                display: flex;
                justify-content: space-around;
                align-items: center;
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 60px;
                background-color: var(--color-background);
                box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
                z-index: 100;
            }

            .bottom-nav__link {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                flex-grow: 1;
                color: var(--color-text-light);
                font-size: 0.75rem;
                transition: color var(--transition-duration) ease;
                padding: var(--spacing-unit) 0;
            }

            .bottom-nav__link .material-symbols-rounded {
                font-size: 24px;
                margin-bottom: 2px;
            }

            .bottom-nav__link--active {
                color: var(--color-primary);
                font-weight: 500;
            }
        }


        /* Page Specific Styles */
        .page {
            display: none; /* Hide pages by default */
        }

        .page--active {
            display: block;
        }

        /* Home Page (Vendors/Products) */
        .search-controls {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: var(--spacing-unit);
            margin-bottom: var(--spacing-unit) * 2;
            align-items: flex-start;
        }

        .search-bar {
            flex-grow: 1;
            display: flex;
            gap: var(--spacing-unit);
        }
         .search-bar input {
             flex-grow: 1;
             margin-bottom: 0;
         }

        .filter-sort-controls {
            display: flex;
            gap: var(--spacing-unit);
        }
         .filter-sort-controls select,
         .filter-sort-controls button {
             margin-bottom: 0; /* Override default input/button margin */
         }
         .filter-sort-controls select {
             width: auto; /* Don't force full width */
             min-width: 120px;
         }


        .section-title {
            font-size: 1.3rem;
            margin-bottom: var(--spacing-unit) * 1.5;
            border-bottom: 1px solid var(--color-surface);
            padding-bottom: var(--spacing-unit);
        }

        .vendor-list,
        .product-grid {
            display: grid;
            gap: var(--spacing-unit) * 2;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Desktop default */
        }
         @media (max-width: 767px) {
             .vendor-list,
             .product-grid {
                 grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Mobile adjustment */
             }
         }


        .vendor-card,
        .product-card {
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
            cursor: pointer;
        }

        .vendor-card:hover,
        .product-card:hover {
             transform: translateY(-2px);
             box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
         .vendor-card:focus-visible,
         .product-card:focus-visible {
              outline: 2px solid var(--color-accent);
              outline-offset: 2px;
         }


        .vendor-card__image,
        .product-card__image {
            width: 100%;
            height: 120px; /* Desktop default */
            object-fit: cover;
            background-color: #eee; /* Placeholder background */
            display: block; /* Remove extra space below image */
        }
         @media (max-width: 767px) {
              .vendor-card__image,
              .product-card__image {
                  height: 100px; /* Mobile adjustment */
              }
         }


        .vendor-card__content,
        .product-card__content {
            padding: var(--spacing-unit) * 1.5;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .vendor-card__name,
        .product-card__name {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: var(--spacing-unit) / 2;
        }

        .vendor-card__status {
            font-size: 0.9rem;
            color: var(--color-status-not-attending);
            margin-bottom: var(--spacing-unit);
        }

        .vendor-card__status--attending {
            color: var(--color-status-attending);
            font-weight: 500;
        }

        .vendor-card__description {
            font-size: 0.9rem;
            color: var(--color-text-light);
            margin-bottom: var(--spacing-unit);
            flex-grow: 1; /* Push button to bottom */
        }

        .vendor-card .btn--secondary {
            width: 100%;
            text-align: center;
            margin-top: auto; /* Align button at the bottom */
        }

        .product-card__vendor {
            font-size: 0.8rem;
            color: var(--color-text-light);
            margin-bottom: var(--spacing-unit) / 2;
        }

        .product-card__price {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary-dark);
            margin-bottom: var(--spacing-unit);
            margin-top: auto; /* Push price and button to bottom */
        }

        .product-card .btn--primary {
             width: 100%;
             text-align: center;
        }

        .seasonal-highlights {
            margin-bottom: var(--spacing-unit) * 3;
        }

        .seasonal-highlights__list {
            display: flex;
            overflow-x: auto; /* Enable horizontal scrolling */
            gap: var(--spacing-unit) * 2;
            padding-bottom: var(--spacing-unit); /* Space for scrollbar */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            scrollbar-width: none; /* Hide scrollbar for Firefox */
        }

        .seasonal-highlights__list::-webkit-scrollbar {
            display: none; /* Hide scrollbar for Chrome, Safari, Edge */
        }

        .seasonal-highlight-card {
            flex: 0 0 220px; /* Desktop default */
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
            cursor: pointer;
        }
         @media (max-width: 767px) {
              .seasonal-highlight-card {
                  flex: 0 0 180px; /* Mobile adjustment */
              }
         }

        .seasonal-highlight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
         .seasonal-highlight-card:focus-visible {
              outline: 2px solid var(--color-accent);
              outline-offset: 2px;
         }

        .seasonal-highlight-card__image {
            width: 100%;
            height: 150px; /* Desktop default */
            object-fit: cover;
            background-color: #eee;
        }
         @media (max-width: 767px) {
              .seasonal-highlight-card__image {
                  height: 120px; /* Mobile adjustment */
              }
         }


        .seasonal-highlight-card__content {
            padding: var(--spacing-unit) * 1.5;
            flex-grow: 1;
        }

        .seasonal-highlight-card__name {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: var(--spacing-unit) / 2;
        }

        .seasonal-highlight-card__vendor {
             font-size: 0.8rem;
             color: var(--color-text-light);
             margin-bottom: var(--spacing-unit);
        }

        .seasonal-highlight-card__price {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-primary-dark);
        }


        /* Modals */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 200; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.6); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            animation: fadeIn var(--transition-duration) ease-out;
        }

        .modal--active {
            display: flex;
        }

        .modal-content {
            background-color: var(--color-background);
            margin: auto;
            padding: var(--spacing-unit) * 4; /* Desktop default */
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: slideInFromTop var(--transition-duration) ease-out;
            max-height: 90vh; /* Limit height */
            overflow-y: auto; /* Scroll content if needed */
        }
         @media (max-width: 767px) {
              .modal-content {
                  padding: var(--spacing-unit) * 3; /* Mobile adjustment */
              }
         }


        .modal-close {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            font-size: 24px;
            font-weight: bold;
            color: var(--color-text-light);
            cursor: pointer;
            transition: color var(--transition-duration) ease;
            padding: var(--spacing-unit); /* Increase tap target */
            border-radius: 50%;
        }

        .modal-close:hover,
        .modal-close:focus-visible {
            color: var(--color-text-dark);
            background-color: rgba(0, 0, 0, 0.08);
            outline: none;
        }

        .product-detail__image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-unit) * 2;
            background-color: #eee;
        }

        .product-detail__name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing-unit);
        }

        .product-detail__vendor {
            font-size: 1rem;
            color: var(--color-text-light);
            margin-bottom: var(--spacing-unit);
        }

        .product-detail__description {
            margin-bottom: var(--spacing-unit) * 2;
            color: var(--color-text-dark);
        }

        .product-detail__price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--color-primary-dark);
            margin-bottom: var(--spacing-unit) * 2;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
            margin-bottom: var(--spacing-unit) * 2;
        }

        .quantity-selector label {
            margin-bottom: 0;
            flex-shrink: 0;
        }

        .quantity-selector input[type="number"] {
            width: 80px; /* Wider input for desktop */
            text-align: center;
            padding: var(--spacing-unit);
            margin-bottom: 0;
        }
         @media (max-width: 767px) {
              .quantity-selector input[type="number"] {
                  width: 60px; /* Mobile adjustment */
              }
         }


        .quantity-selector button {
            padding: var(--spacing-unit);
            min-width: 40px; /* Larger tap target */
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-detail__actions {
            display: flex;
            gap: var(--spacing-unit);
            margin-top: var(--spacing-unit) * 2;
             flex-wrap: wrap; /* Allow buttons to wrap */
        }

        .product-detail__actions .btn--primary,
        .product-detail__actions .btn--secondary {
            flex-grow: 1;
             min-width: 120px; /* Ensure buttons don't get too small */
        }


        /* Cart Page */
        .cart-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-unit) * 2;
        }

        .cart-item {
            display: flex;
            gap: var(--spacing-unit) * 2;
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-unit) * 1.5;
            align-items: center;
             flex-wrap: wrap; /* Allow item details/controls to wrap */
        }

        .cart-item__image {
            width: 80px; /* Larger image on desktop */
            height: 80px; /* Larger image on desktop */
            object-fit: cover;
            border-radius: var(--border-radius);
            background-color: #eee;
            flex-shrink: 0; /* Prevent image from shrinking */
        }
         @media (max-width: 767px) {
              .cart-item__image {
                  width: 60px; /* Mobile adjustment */
                  height: 60px; /* Mobile adjustment */
              }
         }


        .cart-item__details {
            flex-grow: 1;
        }

        .cart-item__name {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: var(--spacing-unit) / 2;
        }

        .cart-item__vendor {
            font-size: 0.8rem;
            color: var(--color-text-light);
            margin-bottom: var(--spacing-unit);
        }

        .cart-item__price {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-primary-dark);
        }

        .cart-item__controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
            flex-shrink: 0; /* Prevent controls from shrinking */
        }
         @media (max-width: 767px) {
              .cart-item__controls {
                  margin-top: var(--spacing-unit); /* Add space when wrapped */
                  width: 100%; /* Take full width when wrapped */
                  justify-content: flex-end; /* Align controls to the right */
              }
         }


        .cart-item__controls input[type="number"] {
            width: 60px; /* Wider input on desktop */
            padding: var(--spacing-unit);
            margin-bottom: 0;
        }
         @media (max-width: 767px) {
              .cart-item__controls input[type="number"] {
                  width: 50px; /* Mobile adjustment */
              }
         }


         .cart-item__controls button {
            padding: var(--spacing-unit);
            min-width: 40px; /* Larger tap target */
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
         }

         .cart-item__remove {
            background: none;
            border: none;
            color: var(--color-error);
            padding: var(--spacing-unit);
            border-radius: 50%;
            transition: background-color var(--transition-duration) ease;
         }

         .cart-item__remove:hover,
         .cart-item__remove:focus-visible {
            background-color: rgba(244, 67, 54, 0.1);
            outline: none;
         }

        .cart-summary {
            margin-top: var(--spacing-unit) * 3;
            padding-top: var(--spacing-unit) * 2;
            border-top: 1px solid var(--color-surface);
            font-size: 1.2rem;
            font-weight: 700;
            text-align: right;
            color: var(--color-text-dark);
        }

        .cart-summary span {
            color: var(--color-primary-dark);
        }

        .checkout-button {
            width: 100%;
            margin-top: var(--spacing-unit) * 3;
        }

        /* Notifications Page */
        .notification-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-unit);
        }

        .notification-item {
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-unit) * 1.5;
            display: flex;
            flex-direction: column;
        }

        .notification-item__text {
            font-size: 1rem;
            margin-bottom: var(--spacing-unit) / 2;
        }

        .notification-item__timestamp {
            font-size: 0.8rem;
            color: var(--color-text-light);
            align-self: flex-end;
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .mb-2 { margin-bottom: var(--spacing-unit) * 2; }
        .mt-3 { margin-top: var(--spacing-unit) * 3; }
         .visually-hidden {
             position: absolute;
             width: 1px;
             height: 1px;
             margin: -1px;
             padding: 0;
             overflow: hidden;
             clip: rect(0, 0, 0, 0);
             border: 0;
         }
         .loading-spinner {
             display: inline-block;
             width: 24px;
             height: 24px;
             border: 3px solid rgba(0, 0, 0, 0.1);
             border-radius: 50%;
             border-top-color: var(--color-primary);
             animation: spin 0.8s ease-in-out infinite;
             margin: auto; /* Center spinner */
             display: none; /* Hidden by default */
         }
         .loading-spinner--active {
             display: block;
         }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInFromTop {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
         @keyframes spin {
             to { transform: rotate(360deg); }
         }

    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1 class="header__title" id="app-header-title">Market Connect</h1>
            <!-- Hamburger menu for mobile -->
             <button class="btn--icon btn--light header__menu-button" aria-label="Open menu">
                <span class="material-symbols-rounded">menu</span>
            </button>
        </header>

        <!-- Sidebar Navigation for Tablet/Desktop -->
        <nav class="nav-sidebar" aria-label="Main navigation">
             <a href="#home" class="nav-sidebar__link nav-sidebar__link--active" data-page="home" aria-current="page">
                <span class="material-symbols-rounded">storefront</span>
                Market
            </a>
             <a href="#cart" class="nav-sidebar__link" data-page="cart">
                <span class="material-symbols-rounded">shopping_cart</span>
                Cart
            </a>
             <a href="#notifications" class="nav-sidebar__link" data-page="notifications">
                <span class="material-symbols-rounded">notifications</span>
                Notifications
            </a>
             <!-- Add profile link if implemented -->
             <!-- <a href="#profile" class="nav-sidebar__link" data-page="profile">
                <span class="material-symbols-rounded">person</span>
                Profile
            </a> -->
        </nav>

        <main class="main-content" id="main-content">
            <!-- Home Page (Vendors & Products) -->
            <section id="home" class="page page--active" role="region" aria-labelledby="home-title">
                <h2 id="home-title" class="section-title">Weekly Market</h2>

                <div class="search-controls">
                    <div class="search-bar">
                        <label for="search-input" class="visually-hidden">Search vendors or products</label>
                        <input type="text" id="search-input" placeholder="Search vendors or products..." aria-label="Search vendors or products">
                        <button class="btn--primary" id="search-button" aria-label="Perform search">Search</button>
                    </div>
                    <div class="filter-sort-controls">
                        <label for="filter-select" class="visually-hidden">Filter by category</label>
                        <select id="filter-select" aria-label="Filter by category">
                            <option value="">All Categories</option>
                            <option value="produce">Produce</option>
                            <option value="prepared">Prepared Foods</option>
                            <option value="crafts">Crafts</option>
                             <option value="seasonal">Seasonal</option>
                        </select>
                         <label for="sort-select" class="visually-hidden">Sort products</label>
                        <select id="sort-select" aria-label="Sort products">
                            <option value="name-asc">Name (A-Z)</option>
                            <option value="name-desc">Name (Z-A)</option>
                            <option value="price-asc">Price (Low to High)</option>
                            <option value="price-desc">Price (High to Low)</option>
                        </select>
                    </div>
                </div>

                <h3 class="section-title">Seasonal Highlights</h3>
                <div class="seasonal-highlights">
                    <div class="seasonal-highlights__list" role="region" aria-label="Seasonal product highlights" id="seasonal-highlights-list">
                        <!-- Seasonal Highlight Cards will be loaded here by JS -->
                         <div class="loading-spinner loading-spinner--active" id="seasonal-loading"></div>
                    </div>
                     <p class="text-center" id="empty-seasonal-message" style="display: none;">No seasonal highlights available.</p>
                </div>

                <h3 class="section-title mt-3">Attending Vendors</h3>
                <div class="vendor-list" role="region" aria-label="List of attending vendors" id="vendor-list">
                    <!-- Vendor Cards will be loaded here by JS -->
                     <div class="loading-spinner loading-spinner--active" id="vendors-loading"></div>
                </div>
                 <p class="text-center" id="empty-vendors-message" style="display: none;">No vendors attending this week.</p>


                <h3 class="section-title mt-3">All Products</h3>
                 <div class="product-grid" role="region" aria-label="List of all available products" id="product-grid">
                     <!-- Product Cards will be loaded here by JS -->
                      <div class="loading-spinner loading-spinner--active" id="products-loading"></div>
                 </div>
                 <p class="text-center" id="empty-products-message" style="display: none;">No products available.</p>

            </section>

            <!-- Cart Page -->
            <section id="cart" class="page" role="region" aria-labelledby="cart-title">
                <h2 id="cart-title" class="section-title">Your Cart</h2>
                <div class="cart-list" role="list" id="cart-list">
                    <!-- Cart Items will be loaded here by JS -->
                    <p class="text-center" id="empty-cart-message">Your cart is empty.</p>
                </div>

                <div class="cart-summary">
                    Total: <span id="cart-total">$0.00</span>
                </div>

                <button class="btn--primary checkout-button" id="checkout-button">Proceed to Checkout</button>

                <!-- Checkout Form (could be a separate page or modal) -->
                 <div id="checkout-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="checkout-modal-title">
                    <div class="modal-content">
                        <button class="modal-close" aria-label="Close checkout form">&times;</button>
                        <h3 id="checkout-modal-title">Checkout</h3>
                        <form id="checkout-form" novalidate> <!-- Add novalidate to handle validation with JS -->
                            <div class="form-group" id="form-group-name">
                                <label for="customer-name">Name <span aria-hidden="true">*</span></label>
                                <input type="text" id="customer-name" required aria-required="true">
                                <p class="error-message" aria-live="polite"></p>
                            </div>
                            <div class="form-group" id="form-group-email">
                                <label for="customer-email">Email <span aria-hidden="true">*</span></label>
                                <input type="email" id="customer-email" required aria-required="true">
                                <p class="error-message" aria-live="polite"></p>
                            </div>
                            <div class="form-group" id="form-group-phone">
                                <label for="customer-phone">Phone</label>
                                <input type="tel" id="customer-phone">
                                <p class="error-message" aria-live="polite"></p>
                            </div>
                            <div class="form-group" id="form-group-pickup">
                                <label for="pickup-time">Preferred Pickup Time</label>
                                <input type="text" id="pickup-time" placeholder="e.g., 10:00 AM - 11:00 AM">
                                <p class="error-message" aria-live="polite"></p>
                            </div>
                            <!-- Payment Method Selection (Placeholder) -->
                            <div class="form-group">
                                <p>Payment will be processed at the market.</p>
                                <!-- Add radio buttons or dropdown for payment options if needed -->
                            </div>
                            <button type="submit" class="btn--primary" style="width: 100%;">Place Order</button>
                        </form>
                    </div>
                </div>

            </section>

            <!-- Notifications Page -->
            <section id="notifications" class="page" role="region" aria-labelledby="notifications-title">
                <h2 id="notifications-title" class="section-title">Notifications</h2>
                <div class="notification-list" role="list" id="notification-list">
                    <!-- Notification Items will be loaded here by JS -->
                     <div class="loading-spinner loading-spinner--active" id="notifications-loading"></div>
                    <p class="text-center" id="empty-notifications-message" style="display: none;">No new notifications.</p>
                </div>
            </section>

             <!-- Product Detail Modal -->
             <div id="product-detail-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="product-detail-modal-title">
                <div class="modal-content">
                    <button class="modal-close" aria-label="Close product details">&times;</button>
                    <img src="https://placehold.co/500x200?text=Product+Image" alt="Product Image" class="product-detail__image" id="modal-product-image">
                    <h3 id="product-detail-modal-title" class="product-detail__name">Product Name</h3>
                    <p class="product-detail__vendor" id="modal-product-vendor">Vendor Name</p>
                    <p class="product-detail__description" id="modal-product-description">Product description goes here.</p>
                    <p class="product-detail__price" id="modal-product-price">$0.00</p>

                    <div class="quantity-selector">
                        <label for="modal-product-qty">Quantity:</label>
                        <button class="btn--secondary quantity-minus" aria-label="Decrease quantity">-</button>
                        <input type="number" id="modal-product-qty" value="1" min="1" aria-live="polite" aria-label="Quantity input">
                        <button class="btn--secondary quantity-plus" aria-label="Increase quantity">+</button>
                    </div>

                    <div class="product-detail__actions">
                        <button class="btn--primary" id="modal-add-to-cart">Add to Cart</button>
                        <!-- Add Pre-order button if applicable -->
                         <!-- <button class="btn--secondary">Pre-order</button> -->
                    </div>
                </div>
            </div>

        </main>

        <!-- Bottom Navigation Bar (Mobile Only) -->
        <nav class="bottom-nav" aria-label="Main navigation">
            <a href="#home" class="bottom-nav__link bottom-nav__link--active" data-page="home" aria-current="page">
                <span class="material-symbols-rounded">storefront</span>
                Market
            </a>
            <a href="#cart" class="bottom-nav__link" data-page="cart">
                <span class="material-symbols-rounded">shopping_cart</span>
                Cart
            </a>
            <a href="#notifications" class="bottom-nav__link" data-page="notifications">
                <span class="material-symbols-rounded">notifications</span>
                Notifications
            </a>
            <!-- Add profile link if implemented -->
             <!-- <a href="#profile" class="bottom-nav__link" data-page="profile">
                <span class="material-symbols-rounded">person</span>
                Profile
            </a> -->
        </nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const pages = document.querySelectorAll('.page');
            const bottomNavLinks = document.querySelectorAll('.bottom-nav__link');
            const sidebarNavLinks = document.querySelectorAll('.nav-sidebar__link');
            const modalCloseButtons = document.querySelectorAll('.modal-close');
            const checkoutButton = document.getElementById('checkout-button');
            const checkoutModal = document.getElementById('checkout-modal');
            const productDetailModal = document.getElementById('product-detail-modal');
            const cartListElement = document.getElementById('cart-list');
            const cartTotalElement = document.getElementById('cart-total');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const notificationListElement = document.getElementById('notification-list');
            const emptyNotificationsMessage = document.getElementById('empty-notifications-message');
            const vendorListElement = document.getElementById('vendor-list');
            const productGridElement = document.getElementById('product-grid');
            const seasonalHighlightsListElement = document.getElementById('seasonal-highlights-list');
            const emptyVendorsMessage = document.getElementById('empty-vendors-message');
            const emptyProductsMessage = document.getElementById('empty-products-message');
            const emptySeasonalMessage = document.getElementById('empty-seasonal-message');
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const filterSelect = document.getElementById('filter-select');
            const sortSelect = document.getElementById('sort-select');
            const mainContent = document.getElementById('main-content');
            const headerTitle = document.getElementById('app-header-title');


            let cartItems = []; // Simple state for cart items

            // --- Simulated Data ---
            const vendors = [
                { id: 'v1', name: 'Berry Farm', description: 'Fresh berries and seasonal fruits.', image: 'https://placehold.co/200x120?text=Berry+Farm', attending: true, category: 'produce' },
                { id: 'v2', name: 'Veggie Patch', description: 'Organic vegetables and herbs.', image: 'https://placehold.co/200x120?text=Veggie+Patch', attending: true, category: 'produce' },
                { id: 'v3', name: 'Pie Heaven', description: 'Delicious homemade pies and pastries.', image: 'https://placehold.co/200x120?text=Pie+Heaven', attending: false, category: 'prepared' },
                { id: 'v4', name: 'Crafty Creations', description: 'Handmade soaps and candles.', image: 'https://placehold.co/200x120?text=Crafts', attending: true, category: 'crafts' },
                 { id: 'v5', name: 'Honey Pot', description: 'Local honey and beeswax products.', image: 'https://placehold.co/200x120?text=Honey+Pot', attending: true, category: 'prepared' },
                 { id: 'v6', name: 'Flower Stand', description: 'Fresh cut flowers and potted plants.', image: 'https://placehold.co/200x120?text=Flowers', attending: true, category: 'produce' },
            ];

            const products = [
                { id: 'p1', name: 'Strawberries', vendorId: 'v1', vendorName: 'Berry Farm', price: 4.50, unit: 'lb', image: 'https://placehold.co/150x100?text=Strawberries', category: 'produce', seasonal: true },
                { id: 'p2', name: 'Asparagus', vendorId: 'v2', vendorName: 'Veggie Patch', price: 3.00, unit: 'bunch', image: 'https://placehold.co/150x100?text=Asparagus', category: 'produce', seasonal: true },
                { id: 'p3', name: 'Rhubarb Stalks', vendorId: 'v3', vendorName: 'Pie Heaven', price: 2.75, unit: 'lb', image: 'https://placehold.co/150x100?text=Rhubarb', category: 'produce', seasonal: true },
                { id: 'p4', name: 'Heirloom Tomatoes', vendorId: 'v2', vendorName: 'Veggie Patch', price: 3.50, unit: 'lb', image: 'https://placehold.co/150x100?text=Tomatoes', category: 'produce', seasonal: false },
                 { id: 'p5', name: 'Blueberry Pie', vendorId: 'v3', vendorName: 'Pie Heaven', price: 18.00, unit: 'ea', image: 'https://placehold.co/150x100?text=Pie', category: 'prepared', seasonal: false },
                 { id: 'p6', name: 'Lavender Soap', vendorId: 'v4', vendorName: 'Crafty Creations', price: 6.00, unit: 'ea', image: 'https://placehold.co/150x100?text=Soap', category: 'crafts', seasonal: false },
                 { id: 'p7', name: 'Wildflower Honey', vendorId: 'v5', vendorName: 'Honey Pot', price: 12.00, unit: 'jar', image: 'https://placehold.co/150x100?text=Honey', category: 'prepared', seasonal: true },
                 { id: 'p8', name: 'Sunflower Bouquet', vendorId: 'v6', vendorName: 'Flower Stand', price: 15.00, unit: 'ea', image: 'https://placehold.co/150x100?text=Sunflowers', category: 'produce', seasonal: true },
            ];

            const notifications = [
                { id: 'n1', text: "Market is open today until 3 PM!", timestamp: "2 hours ago" },
                { id: 'n2', text: "Due to weather, vendor \"Pie Heaven\" will not be attending this week.", timestamp: "Yesterday" },
                 { id: 'n3', text: "New seasonal produce available from Veggie Patch!", timestamp: "3 days ago" },
            ];

            // --- Navigation ---
            function activatePage(pageId) {
                pages.forEach(page => {
                    page.classList.remove('page--active');
                    page.setAttribute('aria-hidden', 'true');
                });
                const activePage = document.getElementById(pageId);
                if (activePage) {
                    activePage.classList.add('page--active');
                    activePage.setAttribute('aria-hidden', 'false');
                    // Scroll main content to top
                    mainContent.scrollTop = 0;
                }

                // Update navigation links
                bottomNavLinks.forEach(link => {
                    link.classList.remove('bottom-nav__link--active');
                    link.removeAttribute('aria-current');
                });
                sidebarNavLinks.forEach(link => {
                    link.classList.remove('nav-sidebar__link--active');
                    link.removeAttribute('aria-current');
                });

                document.querySelectorAll(`[data-page="${pageId}"]`).forEach(link => {
                    link.classList.add('bottom-nav__link--active');
                    link.classList.add('nav-sidebar__link--active');
                    link.setAttribute('aria-current', 'page');
                });

                // Update header title based on page
                switch (pageId) {
                    case 'home':
                        headerTitle.textContent = "Market Connect";
                        break;
                    case 'cart':
                        headerTitle.textContent = "Your Cart";
                         renderCart(); // Ensure cart is rendered when navigating to the page
                        break;
                    case 'notifications':
                        headerTitle.textContent = "Notifications";
                         renderNotifications(); // Ensure notifications are rendered
                        break;
                    // case 'profile':
                    //     headerTitle.textContent = "Profile";
                    //     break;
                    default:
                        headerTitle.textContent = "Market Connect";
                }
            }

            // Handle navigation clicks (both bottom nav and sidebar)
            document.querySelectorAll('.bottom-nav__link, .nav-sidebar__link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    if (pageId) {
                        activatePage(pageId);
                         // Update URL hash for better navigation/bookmarking
                         history.pushState(null, '', `#${pageId}`);
                    }
                });
            });

             // Handle browser back/forward buttons
             window.addEventListener('popstate', () => {
                  const pageId = window.location.hash ? window.location.hash.substring(1) : 'home';
                  activatePage(pageId);
             });


            // Initial page load
            const initialPage = window.location.hash ? window.location.hash.substring(1) : 'home';
            activatePage(initialPage);


            // --- Modals ---
            let activeModal = null; // Track currently open modal

            function openModal(modalElement) {
                 if (activeModal) {
                     closeModal(activeModal); // Close any open modal first
                 }
                modalElement.classList.add('modal--active');
                modalElement.setAttribute('aria-hidden', 'false');
                activeModal = modalElement;

                 // Add inert to non-modal content for accessibility
                 document.querySelector('.app-container').setAttribute('inert', '');

                 // Focus the first interactive element in the modal or the modal itself
                 const firstInteractive = modalElement.querySelector('button, input, select, textarea, [href], [tabindex]:not([tabindex="-1"])');
                 if (firstInteractive) {
                     firstInteractive.focus();
                 } else {
                     modalElement.focus(); // Focus the modal container if no interactive elements
                 }
            }

            function closeModal(modalElement) {
                modalElement.classList.remove('modal--active');
                modalElement.setAttribute('aria-hidden', 'true');
                activeModal = null;

                 // Remove inert
                 document.querySelector('.app-container').removeAttribute('inert');

                 // Return focus to the element that opened the modal (if possible)
                 // This requires storing the triggering element, which is more complex.
                 // For now, we'll just ensure focus is somewhere reasonable, like the main content.
                 mainContent.focus();
            }

            modalCloseButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const modal = e.target.closest('.modal');
                    if (modal) {
                        closeModal(modal);
                    }
                });
            });

            // Close modal if clicking outside modal content
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal')) {
                    closeModal(event.target);
                }
            });

            // Close modal with Escape key
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    if (activeModal) {
                        closeModal(activeModal);
                    }
                }
                 // Trap focus within modal
                 if (activeModal && event.key === 'Tab') {
                     const focusableElements = activeModal.querySelectorAll('button, input, select, textarea, [href], [tabindex]:not([tabindex="-1"])');
                     const firstElement = focusableElements[0];
                     const lastElement = focusableElements[focusableElements.length - 1];

                     if (event.shiftKey) { // Shift + Tab
                         if (document.activeElement === firstElement) {
                             lastElement.focus();
                             event.preventDefault();
                         }
                     } else { // Tab
                         if (document.activeElement === lastElement) {
                             firstElement.focus();
                             event.preventDefault();
                         }
                     }
                 }
            });

            // --- Data Rendering Functions ---

            function renderVendors(vendorData) {
                vendorListElement.innerHTML = ''; // Clear current list
                document.getElementById('vendors-loading').classList.remove('loading-spinner--active');

                const attendingVendors = vendorData.filter(v => v.attending);

                if (attendingVendors.length === 0) {
                    emptyVendorsMessage.style.display = 'block';
                    return;
                }
                emptyVendorsMessage.style.display = 'none';

                attendingVendors.forEach(vendor => {
                    const vendorCard = document.createElement('article');
                    vendorCard.classList.add('vendor-card');
                    vendorCard.setAttribute('data-vendor-id', vendor.id);
                    vendorCard.setAttribute('tabindex', '0'); // Make card focusable
                    vendorCard.setAttribute('role', 'region'); // Or 'article' depending on context
                    vendorCard.setAttribute('aria-label', `${vendor.name}. ${vendor.description}`); // Provide accessible label

                    vendorCard.innerHTML = `
                        <img src="${vendor.image}" alt="${vendor.name} Logo" class="vendor-card__image">
                        <div class="vendor-card__content">
                            <h4 class="vendor-card__name">${vendor.name}</h4>
                            <p class="vendor-card__status vendor-card__status--attending">Attending this week</p>
                            <p class="vendor-card__description">${vendor.description}</p>
                            <button class="btn--secondary">View Products</button>
                        </div>
                    `;
                    vendorListElement.appendChild(vendorCard);

                     // Add click/keyboard event listener to the card (or button inside)
                     const viewButton = vendorCard.querySelector('.btn--secondary');
                     viewButton.addEventListener('click', () => {
                         // Simulate navigating to a vendor detail page or filtering products by vendor
                         alert(`Viewing products for ${vendor.name}... (Functionality not fully implemented)`);
                         // In a real app: filter products list or navigate
                     });
                     // Optional: Add click listener to the card itself if clicking anywhere should trigger view
                     vendorCard.addEventListener('click', (e) => {
                         if (!e.target.closest('button')) { // Don't trigger if clicking the button
                             alert(`Viewing products for ${vendor.name}... (Functionality not fully implemented)`);
                         }
                     });
                     vendorCard.addEventListener('keydown', (e) => {
                          if (e.key === 'Enter' || e.key === ' ') {
                              e.preventDefault(); // Prevent default scroll/space action
                              alert(`Viewing products for ${vendor.name}... (Functionality not fully implemented)`);
                          }
                     });
                });
            }

            function renderProducts(productData) {
                productGridElement.innerHTML = ''; // Clear current grid
                 document.getElementById('products-loading').classList.remove('loading-spinner--active');

                 if (productData.length === 0) {
                    emptyProductsMessage.style.display = 'block';
                    return;
                }
                emptyProductsMessage.style.display = 'none';

                productData.forEach(product => {
                    const productCard = document.createElement('article');
                    productCard.classList.add('product-card');
                    productCard.setAttribute('data-product-id', product.id);
                     productCard.setAttribute('tabindex', '0'); // Make card focusable
                     productCard.setAttribute('role', 'region');
                     productCard.setAttribute('aria-label', `${product.name} by ${product.vendorName}. Price: $${product.price.toFixed(2)} per ${product.unit}`);

                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="product-card__image">
                        <div class="product-card__content">
                             <p class="product-card__vendor">${product.vendorName}</p>
                            <h4 class="product-card__name">${product.name}</h4>
                            <p class="product-card__price">$${product.price.toFixed(2)} / ${product.unit}</p>
                            <button class="btn--primary add-to-cart-btn" data-product-id="${product.id}">Add to Cart</button>
                        </div>
                    `;
                    productGridElement.appendChild(productCard);

                     // Add click/keyboard listener to the card to open modal
                     productCard.addEventListener('click', (e) => {
                         // Prevent opening modal if clicking the 'Add to Cart' button inside the card
                         if (e.target.classList.contains('add-to-cart-btn')) {
                             return;
                         }
                         openProductDetailModal(product);
                     });
                     productCard.addEventListener('keydown', (e) => {
                          if (e.key === 'Enter' || e.key === ' ') {
                              e.preventDefault(); // Prevent default scroll/space action
                              openProductDetailModal(product);
                          }
                     });
                });

                 // Add event listeners to the 'Add to Cart' buttons within the rendered products
                 productGridElement.querySelectorAll('.add-to-cart-btn').forEach(button => {
                     button.addEventListener('click', handleAddToCartClick);
                 });
            }

             function renderSeasonalHighlights(productData) {
                 seasonalHighlightsListElement.innerHTML = ''; // Clear current list
                  document.getElementById('seasonal-loading').classList.remove('loading-spinner--active');

                 const seasonalProducts = productData.filter(p => p.seasonal);

                 if (seasonalProducts.length === 0) {
                     emptySeasonalMessage.style.display = 'block';
                     return;
                 }
                 emptySeasonalMessage.style.display = 'none';


                 seasonalProducts.forEach(product => {
                     const highlightCard = document.createElement('article');
                     highlightCard.classList.add('seasonal-highlight-card');
                     highlightCard.setAttribute('data-product-id', product.id);
                      highlightCard.setAttribute('tabindex', '0'); // Make card focusable
                      highlightCard.setAttribute('role', 'region');
                     highlightCard.setAttribute('aria-label', `Seasonal highlight: ${product.name} by ${product.vendorName}. Price: $${product.price.toFixed(2)} per ${product.unit}`);

                     highlightCard.innerHTML = `
                         <img src="${product.image}" alt="${product.name}" class="seasonal-highlight-card__image">
                         <div class="seasonal-highlight-card__content">
                             <h4 class="seasonal-highlight-card__name">${product.name}</h4>
                             <p class="seasonal-highlight-card__vendor">by ${product.vendorName}</p>
                             <p class="seasonal-highlight-card__price">$${product.price.toFixed(2)} / ${product.unit}</p>
                         </div>
                     `;
                     seasonalHighlightsListElement.appendChild(highlightCard);

                      // Add click/keyboard listener to the card to open modal
                      highlightCard.addEventListener('click', () => {
                          openProductDetailModal(product);
                      });
                      highlightCard.addEventListener('keydown', (e) => {
                           if (e.key === 'Enter' || e.key === ' ') {
                               e.preventDefault(); // Prevent default scroll/space action
                               openProductDetailModal(product);
                           }
                      });
                 });
             }

            function renderNotifications(notificationData) {
                 notificationListElement.innerHTML = ''; // Clear current notifications
                  document.getElementById('notifications-loading').classList.remove('loading-spinner--active');

                 if (notificationData.length === 0) {
                     emptyNotificationsMessage.style.display = 'block';
                     return;
                 }
                 emptyNotificationsMessage.style.display = 'none';

                 notificationData.forEach(notification => {
                     const notificationElement = document.createElement('article');
                     notificationElement.classList.add('notification-item');
                     notificationElement.setAttribute('role', 'listitem');
                      notificationElement.setAttribute('aria-label', `Notification: ${notification.text}. Received ${notification.timestamp}`);
                     notificationElement.innerHTML = `
                         <p class="notification-item__text">${notification.text}</p>
                         <p class="notification-item__timestamp">${notification.timestamp}</p>
                     `;
                     notificationListElement.appendChild(notificationElement);
                 });
            }

            // --- Initial Data Load (Simulated) ---
            function loadInitialData() {
                 document.getElementById('seasonal-loading').classList.add('loading-spinner--active');
                 document.getElementById('vendors-loading').classList.add('loading-spinner--active');
                 document.getElementById('products-loading').classList.add('loading-spinner--active');
                 document.getElementById('notifications-loading').classList.add('loading-spinner--active');

                 // Simulate network delay
                 setTimeout(() => {
                     renderSeasonalHighlights(products);
                     renderVendors(vendors);
                     renderProducts(products);
                     renderNotifications(notifications);
                 }, 500); // Short delay
            }


            // --- Search, Filter, Sort ---
            function applyFiltersAndSort() {
                const searchTerm = searchInput.value.toLowerCase();
                const filterCategory = filterSelect.value;
                const sortValue = sortSelect.value;

                let filteredProducts = products.filter(product => {
                    const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                                          product.vendorName.toLowerCase().includes(searchTerm) ||
                                          (product.description && product.description.toLowerCase().includes(searchTerm));
                    const matchesCategory = filterCategory === '' || product.category === filterCategory || (filterCategory === 'seasonal' && product.seasonal);
                    return matchesSearch && matchesCategory;
                });

                 // Apply sorting
                 filteredProducts.sort((a, b) => {
                     switch (sortValue) {
                         case 'name-asc': return a.name.localeCompare(b.name);
                         case 'name-desc': return b.name.localeCompare(a.name);
                         case 'price-asc': return a.price - b.price;
                         case 'price-desc': return b.price - a.price;
                         default: return 0;
                     }
                 });

                // For vendors, just filter by search term for simplicity
                const filteredVendors = vendors.filter(vendor => {
                     const matchesSearch = vendor.name.toLowerCase().includes(searchTerm) ||
                                           vendor.description.toLowerCase().includes(searchTerm);
                     return matchesSearch;
                });


                renderProducts(filteredProducts);
                renderVendors(filteredVendors); // Re-render vendors based on search too
                 // Seasonal highlights are not filtered by search/filter/sort in this implementation
                 // renderSeasonalHighlights(products); // Keep seasonal highlights static or update if needed
            }

            searchButton.addEventListener('click', applyFiltersAndSort);
            searchInput.addEventListener('input', applyFiltersAndSort); // Optional: live search
            filterSelect.addEventListener('change', applyFiltersAndSort);
            sortSelect.addEventListener('change', applyFiltersAndSort);


            // --- Product Detail Modal Logic ---
            function openProductDetailModal(product) {
                document.getElementById('modal-product-image').src = product.image;
                document.getElementById('modal-product-image').alt = product.name;
                document.getElementById('product-detail-modal-title').textContent = product.name;
                document.getElementById('modal-product-vendor').textContent = `by ${product.vendorName}`;
                document.getElementById('modal-product-description').textContent = product.description || "No description available."; // Use placeholder if no description
                document.getElementById('modal-product-price').textContent = `$${product.price.toFixed(2)} / ${product.unit}`;
                document.getElementById('modal-product-qty').value = 1; // Reset quantity
                document.getElementById('modal-add-to-cart').setAttribute('data-product-id', product.id); // Store product ID on button

                openModal(productDetailModal);
            }

            // Quantity Selector Logic for Modal
            productDetailModal.querySelectorAll('.quantity-selector button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const input = button.closest('.quantity-selector').querySelector('input[type="number"]');
                    let currentValue = parseInt(input.value, 10);
                    if (isNaN(currentValue)) currentValue = 1; // Handle non-numeric input

                    if (button.classList.contains('quantity-minus')) {
                        currentValue = Math.max(1, currentValue - 1); // Don't go below 1
                    } else if (button.classList.contains('quantity-plus')) {
                        currentValue += 1;
                    }
                    input.value = currentValue;
                    input.setAttribute('aria-valuenow', currentValue); // Update ARIA value
                });
            });
             // Ensure quantity input in modal updates ARIA value on manual input
             productDetailModal.querySelector('.quantity-selector input[type="number"]').addEventListener('input', (e) => {
                 let currentValue = parseInt(e.target.value, 10);
                 if (isNaN(currentValue) || currentValue < 1) {
                      e.target.value = 1; // Reset to 1 if invalid
                      currentValue = 1;
                 }
                 e.target.setAttribute('aria-valuenow', currentValue);
             });


            // Add to Cart from Modal
            document.getElementById('modal-add-to-cart').addEventListener('click', (e) => {
                 const productId = e.target.getAttribute('data-product-id');
                 const quantity = parseInt(document.getElementById('modal-product-qty').value, 10);

                 if (isNaN(quantity) || quantity < 1) {
                      alert("Please enter a valid quantity.");
                      return;
                 }

                 const productToAdd = products.find(p => p.id === productId);

                 if (productToAdd) {
                     addToCart(productToAdd, quantity);
                     closeModal(productDetailModal);
                     // Optionally show a confirmation message or update cart icon
                     alert(`${quantity} x ${productToAdd.name} added to cart!`); // Simple feedback
                 } else {
                     console.error("Product not found:", productId);
                     alert("Error adding product to cart.");
                 }
            });


            // --- Cart Logic ---
            function renderCart() {
                cartListElement.innerHTML = ''; // Clear current cart display

                if (cartItems.length === 0) {
                    emptyCartMessage.style.display = 'block';
                    cartTotalElement.textContent = '$0.00';
                    checkoutButton.disabled = true;
                    checkoutButton.setAttribute('aria-disabled', 'true');
                    return;
                }

                emptyCartMessage.style.display = 'none';
                checkoutButton.disabled = false;
                checkoutButton.setAttribute('aria-disabled', 'false');

                let total = 0;

                cartItems.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    const cartItemElement = document.createElement('article');
                    cartItemElement.classList.add('cart-item');
                    cartItemElement.setAttribute('role', 'listitem');
                    cartItemElement.setAttribute('data-product-id', item.id);
                     cartItemElement.setAttribute('aria-label', `${item.quantity} of ${item.name} by ${item.vendorName}. Price: $${item.price.toFixed(2)} each.`);

                    cartItemElement.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="cart-item__image">
                        <div class="cart-item__details">
                            <h4 class="cart-item__name">${item.name}</h4>
                            <p class="cart-item__vendor">${item.vendorName}</p>
                            <p class="cart-item__price">$${item.price.toFixed(2)} / ${item.unit}</p>
                        </div>
                        <div class="cart-item__controls">
                             <button class="btn--secondary quantity-minus" aria-label="Decrease quantity for ${item.name}">-</button>
                             <label for="qty-${item.id}" class="visually-hidden">Quantity for ${item.name}</label>
                             <input type="number" id="qty-${item.id}" value="${item.quantity}" min="1" aria-live="polite" aria-label="Quantity input for ${item.name}">
                             <button class="btn--secondary quantity-plus" aria-label="Increase quantity for ${item.name}">+</button>
                             <button class="cart-item__remove" aria-label="Remove ${item.name} from cart">
                                <span class="material-symbols-rounded">delete</span>
                             </button>
                        </div>
                    `;
                    cartListElement.appendChild(cartItemElement);
                });

                cartTotalElement.textContent = `$${total.toFixed(2)}`;

                // Add event listeners for quantity controls and remove buttons in the rendered cart
                cartListElement.querySelectorAll('.cart-item__controls .quantity-minus').forEach(button => {
                    button.addEventListener('click', handleCartQuantityChange);
                });
                 cartListElement.querySelectorAll('.cart-item__controls .quantity-plus').forEach(button => {
                    button.addEventListener('click', handleCartQuantityChange);
                });
                cartListElement.querySelectorAll('.cart-item__remove').forEach(button => {
                    button.addEventListener('click', handleRemoveItem);
                });
                 cartListElement.querySelectorAll('.cart-item__controls input[type="number"]').forEach(input => {
                     input.addEventListener('change', handleCartQuantityInput);
                 });
            }

             function addToCart(product, quantity) {
                 const existingItemIndex = cartItems.findIndex(item => item.id === product.id);

                 if (existingItemIndex > -1) {
                     // Item already in cart, update quantity
                     cartItems[existingItemIndex].quantity += quantity;
                 } else {
                     // Add new item to cart
                     cartItems.push({ ...product, quantity: quantity });
                 }
                 renderCart(); // Re-render the cart display
             }

             // Add to Cart from Product Card (Directly)
             function handleAddToCartClick(e) {
                 const button = e.target.closest('.add-to-cart-btn');
                 if (!button) return;

                 const productId = button.getAttribute('data-product-id');
                 const productToAdd = products.find(p => p.id === productId);

                 if (productToAdd) {
                     addToCart(productToAdd, 1); // Add 1 item by default
                     // Optionally show feedback
                     button.textContent = 'Added!'; // Simple temporary feedback
                     button.disabled = true;
                     setTimeout(() => {
                         button.innerHTML = 'Add to Cart'; // Restore original text/icon if any
                         button.disabled = false;
                     }, 1000); // Show feedback for 1 second
                 } else {
                     console.error("Product not found for Add to Cart:", productId);
                     alert("Error adding product to cart.");
                 }
             }


            function handleCartQuantityChange(e) {
                const itemElement = e.target.closest('.cart-item');
                const productId = itemElement.getAttribute('data-product-id');
                const input = itemElement.querySelector('input[type="number"]');
                let currentValue = parseInt(input.value, 10);
                 if (isNaN(currentValue)) currentValue = 1;

                if (e.target.classList.contains('quantity-minus')) {
                    currentValue = Math.max(1, currentValue - 1);
                } else if (e.target.classList.contains('quantity-plus')) {
                    currentValue += 1;
                }
                input.value = currentValue;
                input.setAttribute('aria-valuenow', currentValue);
                updateCartItemQuantity(productId, currentValue);
            }

             function handleCartQuantityInput(e) {
                 const itemElement = e.target.closest('.cart-item');
                 const productId = itemElement.getAttribute('data-product-id');
                 let currentValue = parseInt(e.target.value, 10);

                 if (isNaN(currentValue) || currentValue < 1) {
                     currentValue = 1; // Default to 1 if invalid
                     e.target.value = 1;
                 }
                 e.target.setAttribute('aria-valuenow', currentValue);
                 updateCartItemQuantity(productId, currentValue);
             }

            function updateCartItemQuantity(productId, quantity) {
                const itemIndex = cartItems.findIndex(item => item.id === productId);
                if (itemIndex > -1) {
                    cartItems[itemIndex].quantity = quantity;
                    renderCart(); // Re-render to update total
                }
            }

            function handleRemoveItem(e) {
                const itemElement = e.target.closest('.cart-item');
                const productId = itemElement.getAttribute('data-product-id');
                cartItems = cartItems.filter(item => item.id !== productId);
                renderCart(); // Re-render the cart display
            }

            // --- Checkout Logic ---
            checkoutButton.addEventListener('click', () => {
                 if (cartItems.length === 0) {
                      alert("Your cart is empty!");
                      return;
                 }
                openModal(checkoutModal);
            });

             // Basic Form Validation Feedback
             const checkoutForm = document.getElementById('checkout-form');
             const formInputs = checkoutForm.querySelectorAll('input, select, textarea');

             formInputs.forEach(input => {
                 input.addEventListener('input', () => {
                     validateInput(input);
                 });
                 input.addEventListener('blur', () => {
                     validateInput(input);
                 });
             });

             function validateInput(input) {
                 const formGroup = input.closest('.form-group');
                 const errorMessageElement = formGroup.querySelector('.error-message');

                 if (input.validity.valid) {
                     formGroup.classList.remove('form-group--error');
                     errorMessageElement.textContent = '';
                     errorMessageElement.setAttribute('aria-hidden', 'true');
                 } else {
                     formGroup.classList.add('form-group--error');
                     errorMessageElement.textContent = getValidationMessage(input);
                     errorMessageElement.setAttribute('aria-hidden', 'false');
                 }
             }

             function getValidationMessage(input) {
                 if (input.validity.valueMissing) {
                     return 'This field is required.';
                 }
                 if (input.validity.typeMismatch) {
                      if (input.type === 'email') return 'Please enter a valid email address.';
                      if (input.type === 'tel') return 'Please enter a valid phone number.';
                 }
                 // Add more specific messages for other validation types if needed
                 return input.validationMessage; // Fallback to browser default
             }

            checkoutForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Perform validation on all inputs before submitting
                let formIsValid = true;
                formInputs.forEach(input => {
                    validateInput(input);
                    if (!input.validity.valid) {
                        formIsValid = false;
                    }
                });

                if (!formIsValid) {
                    alert("Please fix the errors in the form.");
                    // Focus the first invalid input
                    const firstInvalid = checkoutForm.querySelector(':invalid');
                    if (firstInvalid) {
                         firstInvalid.focus();
                    }
                    return;
                }

                // Simulate order submission
                console.log("Order Submitted:", {
                    customer: {
                        name: document.getElementById('customer-name').value,
                        email: document.getElementById('customer-email').value,
                        phone: document.getElementById('customer-phone').value
                    },
                    pickupTime: document.getElementById('pickup-time').value,
                    items: cartItems
                });

                // Clear cart after simulated order
                cartItems = [];
                renderCart();
                closeModal(checkoutModal);
                alert("Order placed successfully! Payment at pickup."); // Confirmation

                 // Navigate to Home page after placing order
                 activatePage('home');
                 history.pushState(null, '', `#home`);
            });

            // --- Initial Load ---
            loadInitialData();

        });
    </script>
</body>
</html>
