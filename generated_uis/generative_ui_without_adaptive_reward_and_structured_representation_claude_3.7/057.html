<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environmental Data Analysis Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --primary-color: #4A90E2; /* Vibrant Blue */
            --secondary-color: #50E3C2; /* Teal */
            --accent-color: #F5A623; /* Orange */
            --background-color: #FFFFFF; /* Pure White */
            --surface-color: #F8F9FA; /* Light Grey */
            --text-color-primary: #333333; /* Dark Grey */
            --text-color-secondary: #666666; /* Medium Grey */
            --border-color: #E0E0E0; /* Light Grey */
            --error-color: #D0021B; /* Red */
            --success-color: #7ED321; /* Green */
            --warning-color: #F8E71C; /* Yellow */

            --spacing-unit: 8px;
            --border-radius: 8px;
            --transition-duration: 0.2s;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--surface-color);
            color: var(--text-color-primary);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--background-color);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        header h1 {
            margin: 0;
            font-size: 1.5em;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        header h1 .material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 1.2em;
        }

        .container {
            display: flex;
            flex: 1;
            padding: calc(var(--spacing-unit) * 3);
            gap: calc(var(--spacing-unit) * 3);
        }

        .sidebar {
            width: 250px;
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 2);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }

        .sidebar h2 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            font-size: 1.2em;
            color: var(--text-color-secondary);
        }

        .workflow-steps {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .workflow-steps li {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            margin-bottom: var(--spacing-unit);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-duration) ease;
            color: var(--text-color-secondary);
            display: flex;
            align-items: center;
        }

        .workflow-steps li .material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 1.1em;
        }

        .workflow-steps li:hover:not(.active) {
            background-color: var(--surface-color);
        }

        .workflow-steps li.active {
            background-color: var(--primary-color);
            color: var(--background-color);
            font-weight: 500;
        }

        .workflow-steps li.active .material-symbols-rounded {
             fill: 1; /* Filled icon for active state */
        }

        .main-content {
            flex: 1;
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 3);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow-y: auto; /* Enable scrolling for content */
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        /* --- Step: Data Load --- */
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 4);
            text-align: center;
            cursor: pointer;
            transition: border-color var(--transition-duration) ease;
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .upload-area:hover {
            border-color: var(--primary-color);
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .upload-area .upload-icon {
            font-size: 3em;
            color: var(--text-color-secondary);
            margin-bottom: var(--spacing-unit);
        }

        .upload-area p {
            margin: 0 0 var(--spacing-unit) 0;
            color: var(--text-color-secondary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: var(--background-color);
            font-size: 1em;
            cursor: pointer;
            transition: background-color var(--transition-duration) ease, opacity var(--transition-duration) ease;
            text-decoration: none;
        }

        .btn:hover {
            background-color: #357ABD; /* Darker primary */
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-bar-container {
            width: 100%;
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-top: calc(var(--spacing-unit) * 2);
            height: calc(var(--spacing-unit) * 2);
            display: none; /* Hide initially */
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--secondary-color);
            transition: width var(--transition-duration) ease;
        }

        /* --- Step: Data Clean --- */
        .cleaning-panel {
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .cleaning-section {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-unit) * 2;
            overflow: hidden;
        }

        .cleaning-section-header {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            background-color: var(--surface-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .cleaning-section-header .material-symbols-rounded {
            transition: transform var(--transition-duration) ease;
        }

        .cleaning-section-content {
            padding: calc(var(--spacing-unit) * 2);
            border-top: 1px solid var(--border-color);
            display: none; /* Hidden by default */
        }

        .cleaning-section.open .cleaning-section-header .material-symbols-rounded {
            transform: rotate(180deg);
        }

        .cleaning-section.open .cleaning-section-content {
            display: block;
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
        }

        .form-group select,
        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: 100%;
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1em;
        }

        .form-group input[type="checkbox"] {
            margin-right: var(--spacing-unit);
        }

        .btn-group {
            display: flex;
            gap: var(--spacing-unit);
            margin-top: calc(var(--spacing-unit) * 2);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background-color: var(--primary-color);
            color: var(--background-color);
        }

        /* --- Data Table --- */
        .data-table-container {
             margin-top: calc(var(--spacing-unit) * 3);
             overflow-x: auto; /* Make table horizontally scrollable on smaller screens */
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .data-table th,
        .data-table td {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            text-align: left;
            white-space: nowrap; /* Prevent text wrapping in cells */
        }

        .data-table th {
            background-color: var(--surface-color);
            font-weight: 600;
            cursor: pointer; /* Indicate sortable */
        }

        .data-table th:hover {
            background-color: #E9ECEF;
        }

        .data-table td.missing {
            background-color: rgba(var(--error-color), 0.1); /* Highlight missing values */
            color: var(--error-color);
        }

        .data-table td.outlier {
            background-color: rgba(var(--warning-color), 0.1); /* Highlight outliers */
            color: var(--accent-color);
        }

        /* --- Step: Analyze & Model --- */
        .analysis-config,
        .modeling-interface {
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        /* --- Step: Visualize --- */
        .visualization-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Responsive grid */
            gap: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .chart-card {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 2);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            position: relative; /* For floating controls */
        }

        .chart-card h3 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            font-size: 1.1em;
            color: var(--text-color-secondary);
        }

        .chart-container {
            position: relative;
            height: 300px; /* Fixed height for charts */
        }

        .floating-controls {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            background: rgba(255, 255, 255, 0.95);
            padding: var(--spacing-unit) * 1.5;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-duration) ease;
            pointer-events: none;
            z-index: 10; /* Ensure controls are on top */
        }

        .chart-card:hover .floating-controls.chart-controls-visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .control-group {
            margin-bottom: var(--spacing-unit) * 1.5;
        }

        .control-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-size: 0.9em;
            color: var(--text-color-secondary);
        }

         .control-group input[type="color"],
         .control-group input[type="number"],
         .control-group select {
            width: 100%;
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9em;
         }


        /* --- Feedback Messages --- */
        .feedback-message {
            padding: var(--spacing-unit) * 1.5;
            margin-bottom: calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
        }

        .feedback-message.success {
            background-color: rgba(var(--success-color), 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .feedback-message.warning {
            background-color: rgba(var(--warning-color), 0.1);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }

        .feedback-message.error {
            background-color: rgba(var(--error-color), 0.1);
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }

         .feedback-message .material-symbols-rounded {
            font-size: 1.2em;
         }

        /* --- Report Step --- */
        .report-generation {
            text-align: center;
        }

        /* --- Utility Classes --- */
        .mb-3 { margin-bottom: calc(var(--spacing-unit) * 3); }
        .mt-3 { margin-top: calc(var(--spacing-unit) * 3); }
        .text-center { text-align: center; }
        .hidden { display: none; }

        /* --- Responsive Adjustments --- */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                padding: calc(var(--spacing-unit) * 2);
                gap: calc(var(--spacing-unit) * 2);
            }

            .sidebar {
                width: 100%;
                order: -1; /* Move sidebar above main content */
                padding: var(--spacing-unit) * 1.5;
            }

            .workflow-steps {
                display: flex;
                overflow-x: auto; /* Enable horizontal scrolling for steps */
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* Hide scrollbar */
                 -ms-overflow-style: none; /* Hide scrollbar */
            }

            .workflow-steps::-webkit-scrollbar {
                display: none; /* Hide scrollbar */
            }

            .workflow-steps li {
                flex: 0 0 auto; /* Prevent list items from shrinking */
                margin-right: var(--spacing-unit);
                margin-bottom: 0;
            }

             .main-content {
                padding: calc(var(--spacing-unit) * 2);
             }

             .visualization-dashboard {
                grid-template-columns: 1fr; /* Stack charts */
             }
        }

         @media (max-width: 768px) {
             header {
                 padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
             }
         }

    </style>
</head>
<body>

    <header>
        <h1>
            <span class="material-symbols-rounded">analytics</span>
            EnviroData Analyzer
        </h1>
        <!-- Navigation/Help Toggle could go here -->
    </header>

    <div class="container">
        <aside class="sidebar">
            <h2>Workflow</h2>
            <ul class="workflow-steps" id="workflowSteps">
                <li data-step="load" class="active">
                    <span class="material-symbols-rounded">upload_file</span>
                    Data Load
                </li>
                <li data-step="clean">
                    <span class="material-symbols-rounded">cleaning_services</span>
                    Data Clean
                </li>
                <li data-step="analyze">
                    <span class="material-symbols-rounded">science</span>
                    Analyze
                </li>
                <li data-step="model">
                    <span class="material-symbols-rounded">model_training</span>
                    Model
                </li>
                <li data-step="visualize">
                    <span class="material-symbols-rounded">bar_chart</span>
                    Visualize
                </li>
                <li data-step="report">
                    <span class="material-symbols-rounded">description</span>
                    Report
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <!-- Step 1: Data Load -->
            <section id="step-load" class="step-content active">
                <h2>Load Your Data</h2>
                <p class="mb-3">Upload your environmental monitoring dataset. Accepted formats: CSV, Excel.</p>

                <div class="upload-area" id="uploadArea">
                    <span class="material-symbols-rounded upload-icon">cloud_upload</span>
                    <p>Drag and drop your file here, or</p>
                    <input type="file" id="fileInput" accept=".csv, .xlsx, .xls">
                    <button class="btn" onclick="document.getElementById('fileInput').click()">Browse Files</button>
                    <div class="progress-bar-container" id="uploadProgressBarContainer">
                        <div class="progress-bar" id="uploadProgressBar"></div>
                    </div>
                </div>

                <div id="uploadFeedback" class="feedback-message hidden"></div>

                <h3>Loaded Data Preview</h3>
                <div class="data-table-container">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th>Column 1</th>
                                <th>Column 2</th>
                                <th>Column 3</th>
                                <!-- Add more headers dynamically -->
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Data 1A</td>
                                <td class="missing">Missing</td>
                                <td>Data 1C</td>
                            </tr>
                             <tr>
                                <td>Data 2A</td>
                                <td>Data 2B</td>
                                <td class="outlier">Outlier</td>
                            </tr>
                            <!-- Add more rows dynamically -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Step 2: Data Clean -->
            <section id="step-clean" class="step-content">
                <h2>Clean Your Data</h2>
                <p class="mb-3">Apply cleaning operations to handle missing values, outliers, and standardize data.</p>

                <div class="cleaning-panel">
                    <div class="cleaning-section" id="missingValueSection">
                        <div class="cleaning-section-header">
                            Missing Value Handling
                            <span class="material-symbols-rounded">expand_more</span>
                        </div>
                        <div class="cleaning-section-content">
                            <div class="form-group">
                                <label for="missingMethod">Method:</label>
                                <select id="missingMethod">
                                    <option value="drop_row">Drop Rows with Missing Values</option>
                                    <option value="drop_col">Drop Columns with Missing Values</option>
                                    <option value="impute_mean">Impute with Mean</option>
                                    <option value="impute_median">Impute with Median</option>
                                    <option value="impute_mode">Impute with Mode</option>
                                    <option value="impute_value">Impute with Specific Value</option>
                                </select>
                            </div>
                             <div class="form-group hidden" id="imputeValueInput">
                                <label for="specificValue">Specific Value:</label>
                                <input type="text" id="specificValue" placeholder="Enter value">
                            </div>
                            <div class="form-group">
                                <label for="missingColumns">Apply to Columns:</label>
                                <select id="missingColumns" multiple>
                                    <option value="all">All Numeric Columns</option>
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                             <div class="btn-group">
                                <button class="btn btn-secondary">Preview Changes</button>
                                <button class="btn">Apply</button>
                            </div>
                        </div>
                    </div>

                    <div class="cleaning-section" id="outlierSection">
                        <div class="cleaning-section-header">
                            Outlier Detection & Handling
                            <span class="material-symbols-rounded">expand_more</span>
                        </div>
                        <div class="cleaning-section-content">
                             <div class="form-group">
                                <label for="outlierMethod">Detection Method:</label>
                                <select id="outlierMethod">
                                    <option value="iqr">IQR (Interquartile Range)</option>
                                    <option value="zscore">Z-score</option>
                                </select>
                            </div>
                             <div class="form-group">
                                <label for="iqrMultiplier">IQR Multiplier:</label>
                                <input type="number" id="iqrMultiplier" value="1.5" step="0.1">
                            </div>
                             <div class="form-group">
                                <label for="outlierHandling">Handling Method:</label>
                                <select id="outlierHandling">
                                    <option value="remove">Remove Outliers</option>
                                    <option value="cap">Cap Outliers</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="outlierColumns">Apply to Columns:</label>
                                <select id="outlierColumns" multiple>
                                     <option value="all">All Numeric Columns</option>
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                             <div class="btn-group">
                                <button class="btn btn-secondary">Preview Changes</button>
                                <button class="btn">Apply</button>
                            </div>
                        </div>
                    </div>

                     <div class="cleaning-section" id="standardizeSection">
                        <div class="cleaning-section-header">
                            Standardization / Normalization
                            <span class="material-symbols-rounded">expand_more</span>
                        </div>
                        <div class="cleaning-section-content">
                             <div class="form-group">
                                <label for="standardizeMethod">Method:</label>
                                <select id="standardizeMethod">
                                    <option value="zscore">Z-score Standardization</option>
                                    <option value="minmax">Min-Max Scaling</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="standardizeColumns">Apply to Columns:</label>
                                <select id="standardizeColumns" multiple>
                                     <option value="all">All Numeric Columns</option>
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                             <div class="btn-group">
                                <button class="btn btn-secondary">Preview Changes</button>
                                <button class="btn">Apply</button>
                            </div>
                        </div>
                    </div>

                     <div class="cleaning-section" id="typeConversionSection">
                        <div class="cleaning-section-header">
                            Data Type Conversion
                            <span class="material-symbols-rounded">expand_more</span>
                        </div>
                        <div class="cleaning-section-content">
                             <p>Select a column and choose the desired data type.</p>
                              <div class="form-group">
                                <label for="typeConvertColumn">Column:</label>
                                <select id="typeConvertColumn">
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                             <div class="form-group">
                                <label for="typeConvertType">Convert To:</label>
                                <select id="typeConvertType">
                                    <option value="numeric">Numeric</option>
                                    <option value="string">Text</option>
                                    <option value="date">Date/Time</option>
                                    <option value="category">Categorical</option>
                                </select>
                            </div>
                             <div class="btn-group">
                                <button class="btn">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="cleaningFeedback" class="feedback-message hidden"></div>

                 <h3>Cleaned Data Preview</h3>
                 <div class="data-table-container">
                    <table class="data-table" id="cleanedDataTable">
                        <thead>
                            <tr>
                                <th>Column 1</th>
                                <th>Column 2</th>
                                <th>Column 3</th>
                                <!-- Add more headers dynamically -->
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cleaned Data 1A</td>
                                <td>Cleaned Data 1B</td>
                                <td>Cleaned Data 1C</td>
                            </tr>
                            <!-- Add more rows dynamically -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Step 3: Analyze -->
            <section id="step-analyze" class="step-content">
                <h2>Analyze Your Data</h2>
                <p class="mb-3">Configure and run statistical analyses to identify key relationships.</p>

                <div class="analysis-config">
                    <div class="form-group">
                        <label for="analysisType">Analysis Type:</label>
                        <select id="analysisType">
                            <option value="correlation">Correlation Matrix</option>
                            <option value="anova">ANOVA</option>
                            <option value="regression">Simple Regression</option>
                            <!-- Add more analysis types -->
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="analysisVariables">Select Variables:</label>
                        <select id="analysisVariables" multiple>
                            <!-- Options populated dynamically -->
                        </select>
                    </div>
                    <!-- Add more analysis-specific parameters here -->
                    <div class="btn-group">
                        <button class="btn" id="runAnalysisBtn">Run Analysis</button>
                    </div>
                </div>

                 <div id="analysisFeedback" class="feedback-message hidden"></div>

                <h3>Analysis Results</h3>
                <div id="analysisResults">
                    <p>Analysis results will appear here after running.</p>
                    <!-- Results like tables, summary statistics -->
                </div>
            </section>

            <!-- Step 4: Model -->
            <section id="step-model" class="step-content">
                <h2>Model Policy Impacts</h2>
                <p class="mb-3">Define hypothetical policy interventions and simulate their potential impact.</p>

                 <div class="modeling-interface">
                    <div class="form-group">
                        <label for="modelType">Model Type:</label>
                        <select id="modelType">
                            <option value="linear_regression">Linear Regression Model</option>
                            <option value="time_series">Time Series Model</option>
                            <!-- Add more model types -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dependentVariable">Dependent Variable (e.g., Air Quality Index):</label>
                        <select id="dependentVariable">
                            <!-- Options populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="independentVariables">Independent Variables (e.g., Traffic, Construction):</label>
                        <select id="independentVariables" multiple>
                            <!-- Options populated dynamically -->
                        </select>
                    </div>

                    <h4>Define Policy Intervention</h4>
                    <p>Example: Reduce Traffic by 20%</p>
                    <div class="form-group">
                        <label for="interventionVariable">Variable to Change:</label>
                         <select id="interventionVariable">
                            <!-- Options populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="interventionChange">Change (% or absolute):</label>
                        <input type="text" id="interventionChange" placeholder="e.g., -20% or -100">
                    </div>

                    <div class="btn-group">
                        <button class="btn" id="runSimulationBtn">Run Simulation</button>
                    </div>
                </div>

                <div id="modelingFeedback" class="feedback-message hidden"></div>

                <h3>Simulation Results</h3>
                <div id="simulationResults">
                    <p>Simulation results and predicted impacts will appear here.</p>
                    <!-- Results like predicted AQI changes -->
                </div>
            </section>

            <!-- Step 5: Visualize -->
            <section id="step-visualize" class="step-content">
                <h2>Visualize Your Findings</h2>
                <p class="mb-3">Create interactive charts to explore your data and analysis results.</p>

                <div class="btn-group mb-3">
                     <button class="btn" id="addChartBtn">Add Chart</button>
                     <!-- Add button to toggle visualization control panel -->
                </div>


                <div class="visualization-dashboard" id="visualizationDashboard">
                    <!-- Chart Cards will be added here -->
                    <div class="chart-card">
                        <h3>Sample Time Series Chart</h3>
                        <div class="chart-container">
                             <canvas id="sampleTimeSeriesChart"></canvas>
                             <div class="floating-controls" id="sampleTimeSeriesChartControls">
                                 <div class="control-group">
                                    <label>Chart Type</label>
                                    <select id="sampleTimeSeriesChartType">
                                        <option value="line">Line</option>
                                        <option value="bar">Bar</option>
                                        <option value="scatter">Scatter</option>
                                    </select>
                                 </div>
                                  <div class="control-group">
                                    <label>Line Color</label>
                                    <input type="color" id="sampleTimeSeriesChartColor" value="#4A90E2">
                                 </div>
                                 <!-- More controls -->
                             </div>
                        </div>
                    </div>

                     <div class="chart-card">
                        <h3>Sample Scatter Plot</h3>
                        <div class="chart-container">
                             <canvas id="sampleScatterPlot"></canvas>
                             <div class="floating-controls" id="sampleScatterPlotControls">
                                 <div class="control-group">
                                    <label>Chart Type</label>
                                    <select id="sampleScatterPlotType">
                                        <option value="scatter">Scatter</option>
                                        <option value="line">Line</option>
                                    </select>
                                 </div>
                                  <div class="control-group">
                                    <label>Point Color</label>
                                    <input type="color" id="sampleScatterPlotColor" value="#F5A623">
                                 </div>
                                 <!-- More controls -->
                             </div>
                        </div>
                    </div>
                </div>

                 <div id="visualizationFeedback" class="feedback-message hidden"></div>

            </section>

            <!-- Step 6: Report -->
            <section id="step-report" class="step-content">
                <h2>Generate Report</h2>
                <p class="mb-3">Compile your analysis findings, visualizations, and policy simulation results into a comprehensive report.</p>

                <div class="report-generation text-center">
                    <button class="btn" id="generateReportBtn">
                        <span class="material-symbols-rounded">download</span>
                        Generate Report (PDF/HTML)
                    </button>
                </div>

                 <div id="reportFeedback" class="feedback-message hidden"></div>
            </section>
        </main>
    </div>

    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        const workflowSteps = document.querySelectorAll('#workflowSteps li');
        const stepContents = document.querySelectorAll('.step-content');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadProgressBarContainer = document.getElementById('uploadProgressBarContainer');
        const uploadProgressBar = document.getElementById('uploadProgressBar');
        const uploadFeedback = document.getElementById('uploadFeedback');
        const cleaningSections = document.querySelectorAll('.cleaning-section-header');
        const imputeValueInput = document.getElementById('imputeValueInput');
        const missingMethodSelect = document.getElementById('missingMethod');
        const dataTable = document.getElementById('dataTable'); // Placeholder table
        const cleanedDataTable = document.getElementById('cleanedDataTable'); // Placeholder table
        const sampleTimeSeriesChartCanvas = document.getElementById('sampleTimeSeriesChart');
        const sampleScatterPlotCanvas = document.getElementById('sampleScatterPlot');
        const sampleTimeSeriesChartControls = document.getElementById('sampleTimeSeriesChartControls');
        const sampleScatterPlotControls = document.getElementById('sampleScatterPlotControls');


        // --- Step Navigation ---
        workflowSteps.forEach(step => {
            step.addEventListener('click', () => {
                const targetStep = step.dataset.step;
                activateStep(targetStep);
            });
        });

        function activateStep(stepId) {
            workflowSteps.forEach(step => {
                if (step.dataset.step === stepId) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });

            stepContents.forEach(content => {
                if (content.id === `step-${stepId}`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
             // Scroll main content to top when changing step
             document.querySelector('.main-content').scrollTop = 0;
        }

        // --- Data Load ---
        // Handle file drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = "var(--primary-color)";
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = "var(--border-color)";
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = "var(--border-color)";
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFiles(files);
            }
        });

        // Handle file input change
        fileInput.addEventListener('change', (e) => {
            const files = e.target.files;
            if (files.length > 0) {
                handleFiles(files);
            }
        });

        function handleFiles(files) {
            const file = files[0];
            if (file) {
                console.log("Selected file:", file.name);
                // Simulate upload progress
                uploadProgressBarContainer.style.display = 'block';
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    uploadProgressBar.style.width = `${progress}%`;
                    if (progress >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            uploadProgressBarContainer.style.display = 'none';
                            showFeedback("File uploaded successfully! Processing data...", 'success');
                            // Simulate data loading and displaying preview
                            setTimeout(() => {
                                populateDataTable(dataTable, [{col1: 'Value A', col2: '', col3: 'Value C'}, {col1: 'Value D', col2: 'Value E', col3: ''}]); // Example data
                                // In a real app, parse the file and populate the table
                                activateStep('clean'); // Auto-advance to cleaning step
                            }, 1000); // Simulate processing time
                        }, 500);
                    }
                }, 100);
            }
        }

        function showFeedback(message, type) {
            uploadFeedback.textContent = message;
            uploadFeedback.className = `feedback-message ${type}`;
            uploadFeedback.classList.remove('hidden');
             // Hide after a few seconds
             setTimeout(() => {
                 uploadFeedback.classList.add('hidden');
             }, 5000);
        }

        function populateDataTable(tableElement, data) {
            // This is a simplified placeholder. Real implementation needs proper parsing and rendering.
            const tbody = tableElement.querySelector('tbody');
            tbody.innerHTML = ''; // Clear existing rows

            if (data.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="100%">No data available.</td></tr>';
                 return;
            }

            // Assume data is an array of objects
            const headers = Object.keys(data[0]);
             const thead = tableElement.querySelector('thead tr');
             thead.innerHTML = ''; // Clear existing headers
             headers.forEach(header => {
                 const th = document.createElement('th');
                 th.textContent = header;
                 th.dataset.column = header; // For sorting
                 thead.appendChild(th);
             });


            data.forEach(rowData => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    const value = rowData[header];
                    td.textContent = value === '' ? 'N/A' : value; // Display empty string as N/A or similar
                     if (value === '') { // Simple check for missing
                         td.classList.add('missing');
                     }
                    // Add outlier class based on real detection logic
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            // Add sort listeners (placeholder)
            tableElement.querySelectorAll('th').forEach(header => {
                 header.addEventListener('click', () => {
                     console.log(`Sorting by ${header.dataset.column}`);
                     // Implement sorting logic here
                 });
            });

             // Populate dropdowns in cleaning/analysis/model steps (placeholder)
             populateColumnSelects(headers);
        }

        function populateColumnSelects(columns) {
             const selects = document.querySelectorAll('#missingColumns, #outlierColumns, #standardizeColumns, #typeConvertColumn, #analysisVariables, #dependentVariable, #independentVariables, #interventionVariable');

             selects.forEach(select => {
                 // Keep 'All Numeric Columns' option if it exists
                 const optionsToKeep = select.querySelectorAll('option[value="all"]');
                 select.innerHTML = ''; // Clear existing options
                 optionsToKeep.forEach(opt => select.appendChild(opt));

                 columns.forEach(col => {
                     const option = document.createElement('option');
                     option.value = col;
                     option.textContent = col;
                     select.appendChild(option);
                 });
             });
        }


        // --- Data Clean ---
        cleaningSections.forEach(header => {
            header.addEventListener('click', () => {
                header.parentElement.classList.toggle('open');
            });
        });

        missingMethodSelect.addEventListener('change', (e) => {
            if (e.target.value === 'impute_value') {
                imputeValueInput.classList.remove('hidden');
            } else {
                imputeValueInput.classList.add('hidden');
            }
        });

         // Placeholder for Apply/Preview buttons
         document.querySelectorAll('.cleaning-section .btn').forEach(button => {
             button.addEventListener('click', (e) => {
                 console.log(`${e.target.textContent} clicked in cleaning step`);
                 // Implement cleaning logic and update cleanedDataTable
                 // Example: Simulate applying changes and showing feedback
                 if (e.target.textContent === 'Apply') {
                      showFeedback("Cleaning operation applied successfully!", 'success');
                      // Update cleanedDataTable with processed data
                      populateDataTable(cleanedDataTable, [{col1: 'Cleaned A', col2: 'Cleaned B', col3: 'Cleaned C'}]); // Example cleaned data
                 } else if (e.target.textContent === 'Preview Changes') {
                      showFeedback("Previewing changes...", 'warning');
                      // Simulate showing preview data (maybe in a modal or separate area)
                 }
             });
         });


        // --- Analyze ---
        document.getElementById('runAnalysisBtn').addEventListener('click', () => {
             console.log("Run Analysis clicked");
             showFeedback("Running analysis...", 'warning');
             // Simulate analysis run
             setTimeout(() => {
                 document.getElementById('analysisResults').innerHTML = '<p>Correlation Matrix:</p><pre>{ "Variable A": { "Variable B": 0.75, "Variable C": -0.3 }, ... }</pre>';
                 showFeedback("Analysis complete!", 'success');
             }, 2000);
        });

        // --- Model ---
         document.getElementById('runSimulationBtn').addEventListener('click', () => {
             console.log("Run Simulation clicked");
             showFeedback("Running simulation...", 'warning');
             // Simulate model run
             setTimeout(() => {
                 document.getElementById('simulationResults').innerHTML = '<p>Predicted AQI Change: -15%</p><p>Details: ...</p>';
                 showFeedback("Simulation complete!", 'success');
             }, 2000);
         });

        // --- Visualize ---
        let chartCount = 0;
        document.getElementById('addChartBtn').addEventListener('click', () => {
            chartCount++;
            const dashboard = document.getElementById('visualizationDashboard');
            const newChartCard = document.createElement('div');
            newChartCard.classList.add('chart-card');
            newChartCard.innerHTML = `
                <h3>New Chart ${chartCount}</h3>
                <div class="chart-container">
                    <canvas id="chart${chartCount}"></canvas>
                    <div class="floating-controls" id="chart${chartCount}Controls">
                        <div class="control-group">
                           <label>Chart Type</label>
                           <select id="chart${chartCount}Type">
                               <option value="line">Line</option>
                               <option value="bar">Bar</option>
                               <option value="scatter">Scatter</option>
                               <option value="pie">Pie</option>
                               <!-- Add more types -->
                           </select>
                        </div>
                         <div class="control-group">
                           <label>Color</label>
                           <input type="color" id="chart${chartCount}Color" value="#4A90E2">
                        </div>
                        <!-- More controls -->
                    </div>
                </div>
            `;
            dashboard.appendChild(newChartCard);

             // Initialize the new chart (placeholder)
             const newChartCanvas = document.getElementById(`chart${chartCount}`);
             const newChartControls = document.getElementById(`chart${chartCount}Controls`);
             initSampleChart(newChartCanvas, newChartControls, `chart${chartCount}`);
        });

         // Initialize sample charts
         let sampleTimeSeriesChart, sampleScatterPlot;

         function initSampleChart(canvas, controls, chartId) {
             const ctx = canvas.getContext('2d');
             let chartInstance;

             // Sample data (replace with actual data)
             const sampleData = {
                 labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                 datasets: [{
                     label: chartId === 'sampleTimeSeriesChart' ? 'Air Quality Index' : 'Traffic vs AQI',
                     data: chartId === 'sampleTimeSeriesChart' ? [65, 59, 80, 81, 56, 55] : [{x: 10, y: 65}, {x: 15, y: 59}, {x: 20, y: 80}, {x: 12, y: 81}, {x: 18, y: 56}, {x: 25, y: 55}],
                     backgroundColor: chartId === 'sampleTimeSeriesChart' ? "var(--primary-color)" : "var(--accent-color)",
                     borderColor: chartId === 'sampleTimeSeriesChart' ? "var(--primary-color)" : "var(--accent-color)",
                     borderWidth: 2,
                     tension: chartId === 'sampleTimeSeriesChart' ? 0.3 : 0, // Add tension for line chart
                     showLine: chartId !== 'sampleScatterPlot' // Show line for time series
                 }]
             };

             const config = {
                 type: chartId === 'sampleTimeSeriesChart' ? 'line' : 'scatter',
                 data: sampleData,
                 options: {
                     responsive: true,
                     maintainAspectRatio: false,
                     plugins: {
                         legend: { display: true },
                         tooltip: {
                             callbacks: {
                                 label: function(context) {
                                     let label = context.dataset.label || '';
                                     if (label) {
                                         label += ': ';
                                     }
                                     if (context.parsed.y !== null) {
                                         label += new Intl.NumberFormat('en-US', { style: 'decimal' }).format(context.parsed.y);
                                     }
                                     if (chartId !== 'sampleTimeSeriesChart' && context.parsed.x !== null) {
                                          label = `(${context.parsed.x}, ${context.parsed.y})`; // For scatter
                                     }
                                     return label;
                                 }
                             }
                         }
                     },
                     scales: {
                         y: { beginAtZero: true },
                         x: {
                            type: chartId === 'sampleTimeSeriesChart' ? 'category' : 'linear', // Time series uses category for labels
                            title: {
                                display: chartId !== 'sampleTimeSeriesChart',
                                text: 'Traffic Patterns' // Example label for scatter X
                            }
                         }
                     },
                     onClick: (e) => {
                         // Toggle controls visibility on chart click
                         controls.classList.toggle('chart-controls-visible');
                     }
                 }
             };

             chartInstance = new Chart(ctx, config);

             // Store chart instance
             if (chartId === 'sampleTimeSeriesChart') sampleTimeSeriesChart = chartInstance;
             else if (chartId === 'sampleScatterPlot') sampleScatterPlot = chartInstance;

             // Add event listeners for controls
             const chartTypeSelect = controls.querySelector(`#${chartId}Type`);
             const colorInput = controls.querySelector(`#${chartId}Color`);

             if (chartTypeSelect) {
                 chartTypeSelect.addEventListener('change', (e) => {
                     chartInstance.config.type = e.target.value;
                     chartInstance.update();
                 });
             }

             if (colorInput) {
                 colorInput.addEventListener('input', (e) => { // Use input for live update
                     chartInstance.config.data.datasets[0].backgroundColor = e.target.value;
                      chartInstance.config.data.datasets[0].borderColor = e.target.value; // Keep border color same
                     chartInstance.update();
                 });
             }

             // Close controls when clicking outside (simplified)
             document.addEventListener('click', (e) => {
                 if (!e.target.closest(`#${chartId}Controls`) && !e.target.closest(`#${chartId}`)) {
                     controls.classList.remove('chart-controls-visible');
                 }
             });
         }

        // Initialize the sample charts on page load
        initSampleChart(sampleTimeSeriesChartCanvas, sampleTimeSeriesChartControls, 'sampleTimeSeriesChart');
        initSampleChart(sampleScatterPlotCanvas, sampleScatterPlotControls, 'sampleScatterPlot');


        // --- Report ---
         document.getElementById('generateReportBtn').addEventListener('click', () => {
             console.log("Generate Report clicked");
             showFeedback("Generating report...", 'warning');
             // Simulate report generation
             setTimeout(() => {
                 showFeedback("Report generated successfully!", 'success');
                 // In a real app, trigger report generation and provide a download link
             }, 3000);
         });


        // Initial step activation
        activateStep('load');

    </script>

</body>
</html>
