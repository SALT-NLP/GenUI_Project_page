<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Handbook</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --primary-color: #0056b3; /* A professional blue */
            --secondary-color: #f8f9fa; /* Light grey for background */
            --text-color: #333;
            --link-color: var(--primary-color);
            --hover-color: #003d82;
            --border-color: #dee2e6;
            --highlight-color: #ffc107; /* Yellow for highlighted terms */
            --tooltip-bg: #333;
            --tooltip-text: #fff;
            --spacing-unit: 1rem; /* 16px */
            --nav-width: 250px;
            --header-height: 60px;
        }

        body {
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            background-color: var(--secondary-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-y: scroll; /* Ensure body is scrollable */
        }

        header {
            background-color: #fff;
            color: var(--text-color);
            padding: 0 var(--spacing-unit);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: var(--header-height);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .language-selector {
            position: relative;
            display: inline-block;
        }

        .language-selector button {
            background-color: #fff;
            border: 1px solid var(--border-color);
            padding: calc(var(--spacing-unit) * 0.5) var(--spacing-unit);
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s ease;
        }

        .language-selector button:hover,
        .language-selector button:focus {
            background-color: var(--secondary-color);
            outline: 2px solid var(--primary-color); /* Added focus outline */
            outline-offset: 2px;
        }

        .language-selector .dropdown-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 120px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            border-radius: 4px;
            overflow: hidden;
            top: 100%;
            right: 0;
            margin-top: 5px;
        }

        .language-selector .dropdown-content button {
            color: var(--text-color);
            padding: calc(var(--spacing-unit) * 0.75) var(--spacing-unit);
            text-decoration: none;
            display: block;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 1rem;
        }

        .language-selector .dropdown-content button:hover,
        .language-selector .dropdown-content button:focus { /* Added focus state */
            background-color: var(--secondary-color);
            outline: none; /* Outline handled by parent button if needed */
        }

        .language-selector.open .dropdown-content {
            display: block;
        }

        .container {
            display: grid;
            grid-template-columns: var(--nav-width) 1fr;
            flex-grow: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: var(--spacing-unit);
            gap: var(--spacing-unit);
        }

        nav {
            background-color: #fff;
            padding: var(--spacing-unit);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            position: sticky;
            top: calc(var(--header-height) + var(--spacing-unit));
            align-self: start;
            max-height: calc(100vh - var(--header-height) - (var(--spacing-unit) * 2));
        }

        nav h2 {
            margin-top: 0;
            font-size: 1.2rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: calc(var(--spacing-unit) * 0.5);
            margin-bottom: var(--spacing-unit);
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        nav li {
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        nav a {
            text-decoration: none;
            color: var(--text-color);
            display: block;
            padding: calc(var(--spacing-unit) * 0.5) 0;
            transition: color 0.2s ease;
            border-radius: 4px;
        }

        nav a:hover,
        nav a:focus { /* Added focus state */
            color: var(--primary-color);
            outline: none; /* Prevent default outline */
        }

        nav a.active {
            font-weight: bold;
            color: var(--primary-color);
            background-color: var(--secondary-color);
            padding: calc(var(--spacing-unit) * 0.5);
            margin: 0 calc(var(--spacing-unit) * -0.5); /* Offset padding */
        }
         nav a.active:focus {
             outline: 2px solid var(--primary-color); /* Add focus outline to active link */
             outline-offset: 2px;
         }


        main {
            background-color: #fff;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow-x: hidden; /* Prevent horizontal scroll issues with tooltips */
        }

        .search-bar {
            margin-bottom: var(--spacing-unit);
            display: flex;
            gap: var(--spacing-unit);
        }

        .search-bar input[type="search"] {
            flex-grow: 1;
            padding: calc(var(--spacing-unit) * 0.75);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }
         .search-bar input[type="search"]:focus {
             outline: none;
             border-color: var(--primary-color);
             box-shadow: 0 0 0 0.2rem rgba(0, 86, 179, 0.25); /* Add focus ring */
         }


        .search-results {
            margin-top: var(--spacing-unit);
            border-top: 1px solid var(--border-color);
            padding-top: var(--spacing-unit);
        }

        .search-results h3 {
            margin-top: 0;
            font-size: 1.1rem;
        }

        .search-results ul {
            list-style: none;
            padding: 0;
        }

        .search-results li {
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .search-results a {
            text-decoration: none;
            color: var(--link-color);
            transition: color 0.2s ease;
        }

        .search-results a:hover,
        .search-results a:focus { /* Added focus state */
            color: var(--hover-color);
            text-decoration: underline;
            outline: none;
        }


        article h1,
        article h2,
        article h3 {
            color: var(--primary-color);
            margin-top: var(--spacing-unit);
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        article p {
            margin-bottom: var(--spacing-unit);
        }

        .highlighted-term {
            text-decoration: underline dotted var(--highlight-color);
            cursor: help;
            position: relative; /* Needed for tooltip positioning */
            outline: none; /* Remove default focus outline */
        }
         .highlighted-term:focus { /* Add custom focus outline */
             outline: 2px dotted var(--primary-color);
             outline-offset: 2px;
         }


        .tooltip {
            display: none;
            position: absolute;
            background-color: var(--tooltip-bg);
            color: var(--tooltip-text);
            padding: calc(var(--spacing-unit) * 0.75);
            border-radius: 4px;
            font-size: 0.9rem;
            max-width: 300px;
            z-index: 1001;
            pointer-events: none; /* Allow clicks to pass through to elements below */
            opacity: 0;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; /* Added transform transition */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            top: 100%; /* Position below the term */
            left: 50%;
            transform: translateX(-50%) translateY(10px); /* Center and add slight offset */
        }

        .highlighted-term:hover .tooltip,
        .highlighted-term:focus .tooltip { /* Show tooltip on hover or focus */
            display: block;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%; /* Arrow points up */
            left: 50%;
            transform: translateX(-50%);
            border-width: 8px;
            border-style: solid;
            border-color: transparent transparent var(--tooltip-bg) transparent;
        }


        .visual-aid {
            display: block;
            max-width: 100%;
            height: auto;
            margin: var(--spacing-unit) auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: zoom-in;
            transition: transform 0.2s ease;
            outline: none; /* Remove default focus outline */
        }

        .visual-aid:hover {
            transform: scale(1.02);
        }
         .visual-aid:focus { /* Add custom focus outline */
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
             transform: scale(1.02); /* Apply scale on focus too */
         }


        /* Modal for visual aids */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
        }

        .modal-content img,
        .modal-content svg {
            display: block;
            max-width: 100%;
            max-height: 100%;
            margin: auto;
        }

        .modal-close {
            position: absolute;
            top: var(--spacing-unit);
            right: calc(var(--spacing-unit) * 2);
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            background: none; /* Ensure no background */
            border: none; /* Ensure no border */
            padding: 0; /* Remove padding */
        }

        .modal-close:hover,
        .modal-close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
            outline: 2px solid #bbb; /* Add focus outline */
            outline-offset: 2px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0
            }
            to {
                opacity: 1
            }
        }

        footer {
            background-color: var(--primary-color);
            color: #fff;
            text-align: center;
            padding: var(--spacing-unit);
            margin-top: var(--spacing-unit);
        }

        .scroll-to-top {
            display: none;
            position: fixed;
            bottom: calc(var(--spacing-unit) * 2);
            right: calc(var(--spacing-unit) * 2);
            z-index: 99;
            border: none;
            outline: none;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            padding: calc(var(--spacing-unit) * 0.75);
            border-radius: 50%;
            font-size: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
        }

        .scroll-to-top.show {
            display: block;
            opacity: 1;
        }

        .scroll-to-top:hover,
        .scroll-to-top:focus { /* Add focus state */
            background-color: var(--hover-color);
            outline: 2px solid white; /* Add focus outline */
            outline-offset: 2px;
        }

         /* Visually hidden class for accessibility */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: calc(var(--spacing-unit) * 0.5);
                gap: calc(var(--spacing-unit) * 0.5);
            }

            nav {
                position: static;
                max-height: none;
                margin-bottom: var(--spacing-unit);
            }

            main {
                padding: var(--spacing-unit);
            }

            header {
                padding: 0 calc(var(--spacing-unit) * 0.5);
            }

            .language-selector .dropdown-content {
                right: 0;
                left: auto;
            }

            .scroll-to-top {
                bottom: var(--spacing-unit);
                right: var(--spacing-unit);
                padding: calc(var(--spacing-unit) * 0.5);
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">Company Handbook</div>
        <div class="language-selector" id="languageSelector">
            <button aria-haspopup="true" aria-expanded="false" aria-controls="languageDropdown">
                <span class="material-symbols-rounded" aria-hidden="true">language</span>
                <span id="currentLanguageText">English</span>
                <span class="material-symbols-rounded" aria-hidden="true">arrow_drop_down</span>
            </button>
            <div class="dropdown-content" id="languageDropdown">
                <button data-lang="en" aria-label="Switch to English">English</button>
                <button data-lang="es" aria-label="Cambiar a Español">Español</button>
                <button data-lang="vi" aria-label="Chuyển sang Tiếng Việt">Tiếng Việt</button>
            </div>
        </div>
    </header>

    <div class="container">
        <nav aria-label="Handbook Sections">
            <h2>Sections</h2>
            <ul id="navLinks" role="menu"> <!-- Added role="menu" -->
                <!-- Nav links will be populated by JS -->
            </ul>
        </nav>

        <main id="mainContent">
            <div class="search-bar" role="search"> <!-- Added role="search" -->
                <input type="search" id="searchInput" placeholder="Search handbook..." aria-label="Search handbook content">
            </div>
            <div id="searchResults" class="search-results" style="display: none;">
                <h3>Search Results</h3>
                <ul id="searchResultsList" role="listbox" aria-label="Search results"> <!-- Added ARIA roles -->
                    <!-- Results will be populated here -->
                </ul>
            </div>
            <article id="handbookContent">
                <!-- Handbook content will be loaded here -->
            </article>
        </main>
    </div>

    <footer>
        <p>&copy; 2023 Your Company. All rights reserved.</p>
    </footer>

    <button id="scrollToTopBtn" class="scroll-to-top" aria-label="Scroll to top">
        <span class="material-symbols-rounded" aria-hidden="true">arrow_upward</span>
    </button>

    <!-- Modal for Visual Aids -->
    <div id="visualAidModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true"> <!-- Added aria-modal="true" -->
        <button class="modal-close" aria-label="Close modal">&times;</button> <!-- Changed span to button for accessibility -->
        <div class="modal-content">
            <!-- Image or SVG will be loaded here -->
        </div>
    </div>

    <script>
        // --- Content Data (Simulated) ---
        const handbookContent = {
            en: {
                title: "Employee Handbook",
                sections: [{
                    id: "safety",
                    title: "Safety Procedures",
                    content: `
                        <h2>Safety Procedures</h2>
                        <p>Safety is our top priority. All employees must follow these procedures.</p>
                        <h3>Emergency Evacuation</h3>
                        <p>In case of fire or other emergencies, follow the designated <span class="highlighted-term" data-term-id="evacuation-route">evacuation routes</span>. Assemble at the <span class="highlighted-term" data-term-id="assembly-point">assembly point</span> outside the building.</p>
                        <img src="https://placehold.co/600x300?text=Evacuation+Plan" alt="Example evacuation plan diagram" class="visual-aid">
                        <h3>Handling Hazardous Materials</h3>
                        <p>Always wear appropriate <span class="highlighted-term" data-term-id="ppe">Personal Protective Equipment (PPE)</span> when working with hazardous materials. Refer to the <span class="highlighted-term" data-term-id="msds">Material Safety Data Sheets (MSDS)</span> for specific handling instructions.</p>
                        <img src="https://placehold.co/400x200?text=PPE+Examples" alt="Examples of Personal Protective Equipment" class="visual-aid">
                    `
                }, {
                    id: "policies",
                    title: "Company Policies",
                    content: `
                        <h2>Company Policies</h2>
                        <p>Understanding company policies is essential for a productive work environment.</p>
                        <h3>Code of Conduct</h3>
                        <p>All employees are expected to adhere to the company's <span class="highlighted-term" data-term-id="code-of-conduct">Code of Conduct</span>, promoting respect and professionalism.</p>
                        <h3>Attendance Policy</h3>
                        <p>Regular and punctual attendance is required. Report absences according to the <span class="highlighted-term" data-term-id="attendance-policy">Attendance Policy</span> guidelines.</p>
                    `
                }, {
                    id: "benefits",
                    title: "Employee Benefits",
                    content: `
                        <h2>Employee Benefits</h2>
                        <p>We offer a comprehensive benefits package to our employees.</p>
                        <h3>Health Insurance</h3>
                        <p>Details about health insurance plans, coverage, and enrollment periods are available. Contact HR for information on the <span class="highlighted-term" data-term-id="hmo-ppo">HMO/PPO options</span>.</p>
                        <h3>Paid Time Off (PTO)</h3>
                        <p>Learn about your accrual rate and how to request <span class="highlighted-term" data-term-id="pto">Paid Time Off (PTO)</span>.</p>
                    `
                }]
            },
            es: {
                title: "Manual del Empleado",
                sections: [{
                    id: "safety",
                    title: "Procedimientos de Seguridad",
                    content: `
                        <h2>Procedimientos de Seguridad</h2>
                        <p>La seguridad es nuestra máxima prioridad. Todos los empleados deben seguir estos procedimientos.</p>
                        <h3>Evacuación de Emergencia</h3>
                        <p>En caso de incendio u otras emergencias, siga las <span class="highlighted-term" data-term-id="evacuation-route">rutas de evacuación</span> designadas. Reúnase en el <span class="highlighted-term" data-term-id="assembly-point">punto de reunión</span> fuera del edificio.</p>
                        <img src="https://placehold.co/600x300?text=Plan+de+Evacuacion" alt="Diagrama de ejemplo de plan de evacuación" class="visual-aid">
                        <h3>Manejo de Materiales Peligrosos</h3>
                        <p>Siempre use el <span class="highlighted-term" data-term-id="ppe">Equipo de Protección Personal (EPP)</span> adecuado cuando trabaje con materiales peligrosos. Consulte las <span class="highlighted-term" data-term-id="msds">Hojas de Datos de Seguridad de Materiales (HDSM)</span> para instrucciones de manejo específicas.</p>
                        <img src="https://placehold.co/400x200?text=Ejemplos+de+EPP" alt="Ejemplos de Equipo de Protección Personal" class="visual-aid">
                    `
                }, {
                    id: "policies",
                    title: "Políticas de la Empresa",
                    content: `
                        <h2>Políticas de la Empresa</h2>
                        <p>Comprender las políticas de la empresa es esencial para un entorno de trabajo productivo.</p>
                        <h3>Código de Conducta</h3>
                        <p>Se espera que todos los empleados se adhieran al <span class="highlighted-term" data-term-id="code-of-conduct">Código de Conducta</span> de la empresa, promoviendo el respeto y la profesionalidad.</p>
                        <h3>Política de Asistencia</h3>
                        <p>Se requiere asistencia regular y puntual. Reporte las ausencias de acuerdo con las pautas de la <span class="highlighted-term" data-term-id="attendance-policy">Política de Asistencia</span>.</p>
                    `
                }, {
                    id: "benefits",
                    title: "Beneficios para Empleados",
                    content: `
                        <h2>Beneficios para Empleados</h2>
                        <p>Ofrecemos un paquete completo de beneficios a nuestros empleados.</p>
                        <h3>Seguro de Salud</h3>
                        <p>Los detalles sobre los planes de seguro de salud, cobertura y períodos de inscripción están disponibles. Contacte a RRHH para obtener información sobre las <span class="highlighted-term" data-term-id="hmo-ppo">opciones de HMO/PPO</span>.</p>
                        <h3>Tiempo Libre Pagado (PTO)</h3>
                        <p>Conozca su tasa de acumulación y cómo solicitar <span class="highlighted-term" data-term-id="pto">Tiempo Libre Pagado (PTO)</span>.</p>
                    `
                }]
            },
            vi: {
                title: "Sổ Tay Nhân Viên",
                sections: [{
                    id: "safety",
                    title: "Quy Trình An Toàn",
                    content: `
                        <h2>Quy Trình An Toàn</h2>
                        <p>An toàn là ưu tiên hàng đầu của chúng tôi. Tất cả nhân viên phải tuân thủ các quy trình này.</p>
                        <h3>Sơ Tán Khẩn Cấp</h3>
                        <p>Trong trường hợp hỏa hoạn hoặc các trường hợp khẩn cấp khác, hãy đi theo <span class="highlighted-term" data-term-id="evacuation-route">lộ trình sơ tán</span> đã được chỉ định. Tập trung tại <span class="highlighted-term" data-term-id="assembly-point">điểm tập kết</span> bên ngoài tòa nhà.</p>
                        <img src="https://placehold.co/600x300?text=Ke+Hoach+So+Tan" alt="Sơ đồ kế hoạch sơ tán mẫu" class="visual-aid">
                        <h3>Xử Lý Vật Liệu Nguy Hiểm</h3>
                        <p>Luôn đeo <span class="highlighted-term" data-term-id="ppe">Thiết Bị Bảo Hộ Cá Nhân (PPE)</span> phù hợp khi làm việc với vật liệu nguy hiểm. Tham khảo <span class="highlighted-term" data-term-id="msds">Phiếu Dữ Liệu An Toàn Vật Liệu (MSDS)</span> để biết hướng dẫn xử lý cụ thể.</p>
                        <img src="https://placehold.co/400x200?text=Vi+Du+ve+PPE" alt="Ví dụ về Thiết Bị Bảo Hộ Cá Nhân" class="visual-aid">
                    `
                }, {
                    id: "policies",
                    title: "Chính Sách Công Ty",
                    content: `
                        <h2>Chính Sách Công Ty</h2>
                        <p>Hiểu rõ các chính sách của công ty là điều cần thiết để có một môi trường làm việc hiệu quả.</p>
                        <h3>Quy Tắc Ứng Xử</h3>
                        <p>Tất cả nhân viên được yêu cầu tuân thủ <span class="highlighted-term" data-term-id="code-of-conduct">Quy Tắc Ứng Xử</span> của công ty, thúc đẩy sự tôn trọng và chuyên nghiệp.</p>
                        <h3>Chính Sách Đi Làm</h3>
                        <p>Yêu cầu đi làm đều đặn và đúng giờ. Báo cáo vắng mặt theo hướng dẫn của <span class="highlighted-term" data-term-id="attendance-policy">Chính Sách Đi Làm</span>.</p>
                    `
                }, {
                    id: "benefits",
                    title: "Phúc Lợi Nhân Viên",
                    content: `
                        <h2>Phúc Lợi Nhân Viên</h2>
                        <p>Chúng tôi cung cấp gói phúc lợi toàn diện cho nhân viên của mình.</p>
                        <h3>Bảo Hiểm Y Tế</h3>
                        <p>Thông tin chi tiết về các gói bảo hiểm y tế, phạm vi bảo hiểm và thời gian đăng ký đều có sẵn. Liên hệ với phòng Nhân sự để biết thông tin về các <span class="highlighted-term" data-term-id="hmo-ppo">tùy chọn HMO/PPO</span>.</p>
                        <h3>Thời Gian Nghỉ Có Lương (PTO)</h3>
                        <p>Tìm hiểu về tỷ lệ tích lũy của bạn và cách yêu cầu <span class="highlighted-term" data-term-id="pto">Thời Gian Nghỉ Có Lương (PTO)</span>.</p>
                    `
                }]
            },
            // --- Technical Term Explanations ---
            terms: {
                "evacuation-route": {
                    en: "A designated path to follow to exit a building safely during an emergency.",
                    es: "Una ruta designada a seguir para salir de un edificio de manera segura durante una emergencia.",
                    vi: "Lối đi được chỉ định để đi theo nhằm thoát ra khỏi tòa nhà một cách an toàn trong trường hợp khẩn cấp."
                },
                "assembly-point": {
                    en: "A pre-determined safe location outside a building where people should gather after evacuating.",
                    es: "Un lugar seguro predeterminado fuera de un edificio donde las personas deben reunirse después de evacuar.",
                    vi: "Một địa điểm an toàn được xác định trước bên ngoài tòa nhà nơi mọi người nên tập trung sau khi sơ tán."
                },
                "ppe": {
                    en: "Equipment worn to minimize exposure to hazards that cause serious workplace injuries and illnesses. Examples include safety glasses, gloves, hard hats, and safety shoes.",
                    es: "Equipo usado para minimizar la exposición a peligros que causan lesiones y enfermedades graves en el lugar de trabajo. Los ejemplos incluyen gafas de seguridad, guantes, cascos y zapatos de seguridad.",
                    vi: "Thiết bị được đeo để giảm thiểu tiếp xúc với các nguy cơ gây thương tích và bệnh tật nghiêm trọng tại nơi làm việc. Ví dụ bao gồm kính bảo hộ, găng tay, mũ cứng và giày bảo hộ."
                },
                "msds": {
                    en: "A document that contains information on the potential hazards (health, fire, reactivity, and environmental) and how to work safely with a chemical product.",
                    es: "Un documento que contiene información sobre los peligros potenciales (salud, incendio, reactividad y ambientales) y cómo trabajar de manera segura con un producto químico.",
                    vi: "Tài liệu chứa thông tin về các nguy cơ tiềm ẩn (sức khỏe, hỏa hoạn, phản ứng và môi trường) và cách làm việc an toàn với sản phẩm hóa chất."
                },
                "code-of-conduct": {
                    en: "A set of rules outlining the social norms and rules and responsibilities of, or proper practices for, an individual, party or organization.",
                    es: "Un conjunto de reglas que describen las normas sociales, las reglas y responsabilidades, o las prácticas adecuadas para un individuo, parte u organización.",
                    vi: "Một bộ quy tắc phác thảo các chuẩn mực xã hội, quy tắc và trách nhiệm, hoặc các thực hành đúng đắn cho một cá nhân, một bên hoặc một tổ chức."
                },
                 "attendance-policy": {
                    en: "Company rules regarding employee presence at work, including punctuality, reporting absences, and procedures for leave.",
                    es: "Reglas de la empresa sobre la presencia de los empleados en el trabajo, incluyendo puntualidad, reporte de ausencias y procedimientos para solicitar permisos.",
                    vi: "Các quy định của công ty về sự có mặt của nhân viên tại nơi làm việc, bao gồm đúng giờ, báo cáo vắng mặt và quy trình xin nghỉ phép."
                },
                "hmo-ppo": {
                    en: "Common types of health insurance plans in the US. HMO (Health Maintenance Organization) typically requires choosing a primary care doctor and referrals for specialists. PPO (Preferred Provider Organization) offers more flexibility in choosing doctors without referrals.",
                    es: "Tipos comunes de planes de seguro de salud en EE. UU. HMO (Organización para el Mantenimiento de la Salud) generalmente requiere elegir un médico de atención primaria y referencias para especialistas. PPO (Organización de Proveedores Preferidos) ofrece más flexibilidad para elegir médicos sin referencias.",
                    vi: "Các loại kế hoạch bảo hiểm y tế phổ biến ở Mỹ. HMO (Tổ chức Bảo trì Sức khỏe) thường yêu cầu chọn bác sĩ chăm sóc chính và giới thiệu đến bác sĩ chuyên khoa. PPO (Tổ chức Nhà cung cấp Ưu tiên) linh hoạt hơn trong việc chọn bác sĩ mà không cần giới thiệu."
                },
                 "pto": {
                    en: "Paid Time Off (PTO) is a benefit that provides employees with a bank of hours that they can use for vacation, sick time, or personal time.",
                    es: "Tiempo Libre Pagado (PTO) es un beneficio que proporciona a los empleados un banco de horas que pueden usar para vacaciones, tiempo por enfermedad o tiempo personal.",
                    vi: "Thời Gian Nghỉ Có Lương (PTO) là một phúc lợi cung cấp cho nhân viên một quỹ thời gian mà họ có thể sử dụng cho kỳ nghỉ, nghỉ ốm hoặc thời gian cá nhân."
                }
            }
        };

        let currentLang = 'en';
        const htmlElement = document.documentElement;
        const languageSelector = document.getElementById('languageSelector');
        const currentLanguageText = document.getElementById('currentLanguageText');
        const navLinksContainer = document.getElementById('navLinks');
        const handbookContentArea = document.getElementById('handbookContent');
        const searchInput = document.getElementById('searchInput');
        const searchResultsDiv = document.getElementById('searchResults');
        const searchResultsList = document.getElementById('searchResultsList');
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        const visualAidModal = document.getElementById('visualAidModal');
        const modalContent = visualAidModal.querySelector('.modal-content');
        const modalClose = visualAidModal.querySelector('.modal-close');

        // Store the element that triggered the modal for focus restoration
        let modalTriggerElement = null;


        // --- Language Switching ---
        languageSelector.addEventListener('click', function(event) {
            const target = event.target;
            const isLanguageButton = target.closest('.language-selector button');

            if (isLanguageButton) {
                 if (target.closest('.dropdown-content')) {
                     // Clicked a language option inside the dropdown
                    const lang = target.dataset.lang;
                    if (lang) {
                        setLanguage(lang);
                        languageSelector.classList.remove('open');
                        languageSelector.querySelector('button[aria-haspopup="true"]').setAttribute('aria-expanded', 'false');
                    }
                 } else {
                    // Clicked the main language selector button
                     const expanded = this.classList.toggle('open');
                     this.querySelector('button[aria-haspopup="true"]').setAttribute('aria-expanded', expanded);
                 }
            }
        });

        // Close dropdown if clicked outside
        document.addEventListener('click', function(event) {
            if (!languageSelector.contains(event.target)) {
                languageSelector.classList.remove('open');
                languageSelector.querySelector('button[aria-haspopup="true"]').setAttribute('aria-expanded', 'false');
            }
        });

        function setLanguage(lang) {
            if (!handbookContent[lang]) {
                console.warn(`Language ${lang} not available.`);
                // Maybe fallback to default or show an error
                return;
            }
            currentLang = lang;
            htmlElement.lang = currentLang; // Update lang attribute for accessibility

            // Update the text next to the language icon
            const langNames = {
                en: 'English',
                es: 'Español',
                vi: 'Tiếng Việt'
            };
            currentLanguageText.textContent = langNames[currentLang] || 'Language';


            renderContent();
            updateNav();
            // Clear search results on language change
            searchInput.value = '';
            searchResultsDiv.style.display = 'none';
            searchResultsList.innerHTML = '';
            searchResultsList.removeAttribute('role'); // Remove ARIA roles when empty
            searchResultsList.removeAttribute('aria-label');


             // Announce language change for screen readers
            const statusMessage = document.createElement('div');
            statusMessage.setAttribute('role', 'status');
            statusMessage.setAttribute('aria-live', 'polite');
            statusMessage.classList.add('visually-hidden'); // Hide visually but available to screen readers
            statusMessage.textContent = `Language changed to ${langNames[currentLang]}.`;
            document.body.appendChild(statusMessage);
            // Remove after a short delay
            setTimeout(() => {
                document.body.removeChild(statusMessage);
            }, 1000);
        }

         // Helper to hide elements visually but keep them for screen readers
        const style = document.createElement('style');
        style.textContent = `
            .visually-hidden {
                position: absolute;
                width: 1px;
                height: 1px;
                margin: -1px;
                padding: 0;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                border: 0;
            }
        `;
        document.head.appendChild(style);


        // --- Content Rendering ---
        function renderContent() {
            const content = handbookContent[currentLang];
            if (!content) return;

            // Fade out current content
            handbookContentArea.style.opacity = 0;

            // Use a brief timeout to allow opacity transition to start
            setTimeout(() => {
                // Render main content HTML
                let fullContentHtml = '';
                content.sections.forEach(section => {
                     // Add an anchor ID for navigation
                    fullContentHtml += `<section id="${section.id}">`;
                    fullContentHtml += section.content;
                    fullContentHtml += `</section>`;
                });

                handbookContentArea.innerHTML = fullContentHtml;

                // Add tooltip event listeners to highlighted terms
                addTooltipListeners();

                // Add visual aid modal listeners
                addVisualAidListeners();

                // Fade in new content
                handbookContentArea.style.opacity = 1;

                // Scroll to the current section if any is active (or hash is present)
                const targetId = window.location.hash ? window.location.hash.substring(1) : null;
                const activeLink = navLinksContainer.querySelector('.nav-link.active');

                // Use requestAnimationFrame to ensure layout is stable before scrolling
                requestAnimationFrame(() => {
                    if (targetId) {
                         scrollToSection(targetId, false); // Scroll without smooth behavior initially if hash exists
                    } else if (activeLink) {
                         const sectionId = activeLink.getAttribute('href').substring(1);
                         scrollToSection(sectionId, false); // Scroll without smooth behavior initially
                    } else {
                        // Scroll to top if no section is active (e.g., on initial load without hash)
                         window.scrollTo({ top: 0, behavior: 'auto' });
                    }
                });


            }, 200); // Match CSS transition duration
        }

        // --- Navigation ---
        function updateNav() {
            const navItems = handbookContent[currentLang].sections;
            navLinksContainer.innerHTML = ''; // Clear existing nav
            navItems.forEach(item => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${item.id}`;
                a.textContent = item.title;
                a.classList.add('nav-link');
                a.setAttribute('role', 'menuitem'); // Keep menuitem role as it was present
                li.appendChild(a);
                navLinksContainer.appendChild(li);
            });
            // Add click listeners to new nav links
            navLinksContainer.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', handleNavClick);
            });
        }

        function handleNavClick(event) {
            event.preventDefault();
            const targetId = event.target.getAttribute('href').substring(1);

            // Update URL hash without page jump
            history.pushState(null, '', `#${targetId}`);

            // Update active state
            navLinksContainer.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                link.setAttribute('aria-current', 'false');
            });
            event.target.classList.add('active');
            event.target.setAttribute('aria-current', 'page');

            scrollToSection(targetId, true);
        }

        function scrollToSection(id, smooth = true) {
            const section = document.getElementById(id);
            if (section) {
                const headerOffset = document.querySelector('header').offsetHeight;
                const elementPosition = section.getBoundingClientRect().top;
                // Calculate position relative to the viewport top, then add current scroll position
                const offsetPosition = elementPosition + window.scrollY - headerOffset - 20; // Add a little extra padding

                window.scrollTo({
                    top: offsetPosition,
                    behavior: smooth ? 'smooth' : 'auto'
                });

                 // For accessibility: ensure the section is focusable and focus it
                 // Add tabindex="-1" to sections if they don't have interactive content at the start
                 // section.setAttribute('tabindex', '-1');
                 // section.focus(); // Focusing might disrupt user flow, consider carefully
            }
        }

        // --- Tooltips for Highlighted Terms ---
        function addTooltipListeners() {
            document.querySelectorAll('.highlighted-term').forEach(term => {
                // Remove existing tooltips to prevent duplicates on re-render
                const existingTooltip = term.querySelector('.tooltip');
                if (existingTooltip) {
                    existingTooltip.remove();
                }

                const tooltip = document.createElement('div');
                tooltip.classList.add('tooltip');
                const termId = term.dataset.termId;
                const explanation = handbookContent.terms[termId]?.[currentLang] || 'Explanation not available.';
                tooltip.textContent = explanation;

                // Accessibility attributes for tooltip
                const tooltipId = `tooltip-${termId}-${currentLang}`; // Make ID unique per term and lang
                tooltip.setAttribute('id', tooltipId);
                tooltip.setAttribute('role', 'tooltip');
                tooltip.setAttribute('aria-hidden', 'true'); // Initially hidden

                term.appendChild(tooltip); // Append tooltip inside the term span

                // Link the term to the tooltip explanation
                term.setAttribute('aria-describedby', tooltipId);
                term.setAttribute('tabindex', '0'); // Make focusable for keyboard users
                // Provide instruction for screen readers on how to get the explanation
                term.setAttribute('aria-label', `${term.textContent}. Explanation available.`);


                // Use mouseenter/mouseleave for hover
                term.addEventListener('mouseenter', function() {
                    tooltip.setAttribute('aria-hidden', 'false');
                });

                term.addEventListener('mouseleave', function() {
                     // Add a small delay on mouseleave to allow moving mouse to tooltip if needed
                     // Note: CSS pointer-events: none on tooltip makes this less critical,
                     // but a small delay can still be helpful.
                     setTimeout(() => {
                         if (!term.matches(':hover') && document.activeElement !== term) {
                             tooltip.setAttribute('aria-hidden', 'true');
                         }
                     }, 100);
                });

                 // Add focus/blur for keyboard accessibility
                term.addEventListener('focus', function() {
                    tooltip.setAttribute('aria-hidden', 'false');
                });

                term.addEventListener('blur', function() {
                     // Add a small delay on blur in case focus moves to something else briefly
                     setTimeout(() => {
                         if (document.activeElement !== term && !term.contains(document.activeElement)) {
                             tooltip.setAttribute('aria-hidden', 'true');
                         }
                     }, 100);
                });

                // Add keydown listener for Space or Enter to explicitly show tooltip (like a popover toggle)
                // This provides an alternative interaction method besides hover/focus.
                term.addEventListener('keydown', function(event) {
                    if (event.key === ' ' || event.key === 'Enter') {
                        event.preventDefault(); // Prevent default action (e.g., space scrolls page)
                        const isHidden = tooltip.getAttribute('aria-hidden') === 'true';
                        tooltip.setAttribute('aria-hidden', !isHidden);
                        // Optional: Add a class to term to indicate tooltip is open if needed for styling
                        // term.classList.toggle('tooltip-open', !isHidden);
                    }
                });

                 // Add click listener to toggle tooltip visibility (like a popover)
                 term.addEventListener('click', function(event) {
                     event.stopPropagation(); // Prevent click from closing dropdown if open
                     const isHidden = tooltip.getAttribute('aria-hidden') === 'true';
                     // Close all other open tooltips before opening this one
                     document.querySelectorAll('.tooltip[aria-hidden="false"]').forEach(openTooltip => {
                         if (openTooltip !== tooltip) {
                             openTooltip.setAttribute('aria-hidden', 'true');
                         }
                     });
                     tooltip.setAttribute('aria-hidden', !isHidden);
                 });

                 // Close tooltip if clicking anywhere else on the document
                 document.addEventListener('click', function(event) {
                     if (!term.contains(event.target) && tooltip.getAttribute('aria-hidden') === 'false') {
                          tooltip.setAttribute('aria-hidden', 'true');
                     }
                 });
            });
        }


        // --- Visual Aid Modal ---
        function addVisualAidListeners() {
            document.querySelectorAll('.visual-aid').forEach(visualAid => {
                // Remove existing listeners - safer way is to use event delegation on mainContentArea
                // For this simple structure, we can re-add, but be mindful in complex apps.
                // A better way:
                // mainContentArea.addEventListener('click', handleMainContentClick);
                // function handleMainContentClick(event) {
                //    const visualAid = event.target.closest('.visual-aid');
                //    if (visualAid) { openModal.call(visualAid); }
                // }
                // This requires removing the specific listeners below and relying solely on delegation.
                // Sticking to direct listeners for simplicity in this artifact.

                visualAid.addEventListener('click', openModal);
                visualAid.addEventListener('keydown', function(event) {
                    // Open modal on Enter or Space key for keyboard users
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault(); // Prevent default scroll/action
                        openModal.call(this); // Call openModal with 'this' referring to the visualAid
                    }
                });
                 // Make visual aids focusable
                visualAid.setAttribute('tabindex', '0');
                visualAid.setAttribute('role', 'button'); // Indicate it's interactive
                visualAid.setAttribute('aria-label', `View larger image: ${visualAid.alt}`); // Provide accessible label
            });
        }

        function openModal() {
             modalTriggerElement = this; // Store the element that opened the modal

            const src = this.getAttribute('src') || this.getAttribute('data'); // Handle img and potential svg data
            const alt = this.getAttribute('alt') || 'Visual aid';

            modalContent.innerHTML = ''; // Clear previous content

            if (this.tagName === 'IMG') {
                const img = document.createElement('img');
                img.src = src;
                img.alt = alt;
                modalContent.appendChild(img);
            } else if (this.tagName === 'SVG') {
                // If SVG is embedded, clone it
                modalContent.appendChild(this.cloneNode(true));
            }
            // Add other types if needed (e.g., iframe for video, etc.)

            visualAidModal.style.display = 'flex';
            visualAidModal.setAttribute('aria-hidden', 'false');
            visualAidModal.setAttribute('aria-modal', 'true'); // Ensure it's treated as a modal
            modalClose.focus(); // Focus close button for accessibility

            // Trap focus inside the modal (basic implementation)
            // Find all focusable elements within the modal
            const focusableElements = visualAidModal.querySelectorAll(
                'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])'
            );
            const firstFocusableElement = focusableElements[0];
            const lastFocusableElement = focusableElements[focusableElements.length - 1];

            visualAidModal.addEventListener('keydown', function(event) {
                const isTabPressed = (event.key === 'Tab' || event.keyCode === 9);

                if (!isTabPressed) {
                    return;
                }

                if (event.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstFocusableElement) {
                        lastFocusableElement.focus();
                        event.preventDefault();
                    }
                } else { // Tab
                    if (document.activeElement === lastFocusableElement) {
                        firstFocusableElement.focus();
                        event.preventDefault();
                    }
                }
            });
        }


        modalClose.addEventListener('click', closeModal);
        visualAidModal.addEventListener('click', function(event) {
            // Close modal if clicking outside the content (but inside the modal background)
            if (event.target === visualAidModal) {
                closeModal();
            }
        });
        document.addEventListener('keydown', function(event) {
            // Close modal on Escape key
            if (event.key === 'Escape' && visualAidModal.style.display === 'flex') {
                closeModal();
            }
             // Focus trapping for modal is handled within openModal keydown listener
        });

        function closeModal() {
            visualAidModal.style.display = 'none';
            visualAidModal.setAttribute('aria-hidden', 'true');
             visualAidModal.setAttribute('aria-modal', 'false');
            modalContent.innerHTML = ''; // Clear content on close

            // Restore focus to the element that opened the modal
            if (modalTriggerElement) {
                modalTriggerElement.focus();
                modalTriggerElement = null; // Clear stored element
            }
             // Remove the keydown listener for focus trapping when modal is closed
             // This is tricky with anonymous functions. A better approach uses a named handler
             // attached to the modal element itself, which is removed here.
             // For this simple case, the listener is added inside openModal and stays,
             // but it only acts when modal.style.display === 'flex', which is acceptable.
        }

        // --- Search Functionality ---
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            searchResultsList.innerHTML = ''; // Clear previous results

            if (query.length < 2) { // Require at least 2 characters to search
                searchResultsDiv.style.display = 'none';
                 searchResultsList.removeAttribute('role'); // Remove ARIA roles when empty
                 searchResultsList.removeAttribute('aria-label');
                return;
            }

            const results = [];
            const sections = handbookContent[currentLang]?.sections || [];

            sections.forEach(section => {
                // Simple check if title or content contains the query
                // Use a temporary div to strip HTML tags from content for searching
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = section.content;
                const plainTextContent = tempDiv.textContent || tempDiv.innerText || '';

                if (section.title.toLowerCase().includes(query) || plainTextContent.toLowerCase().includes(query)) {
                    results.push({
                        id: section.id,
                        title: section.title
                        // Could add a snippet here later
                    });
                }
            });

            if (results.length > 0) {
                results.forEach(result => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = `#${result.id}`;
                    a.textContent = result.title;
                     // Add role for list item in search results if needed, but standard li/a is fine
                    li.setAttribute('role', 'option'); // Indicate options in a search context

                    a.addEventListener('click', function(event) {
                        event.preventDefault();
                        // Simulate clicking the corresponding nav link
                        const navLink = navLinksContainer.querySelector(`a[href="#${result.id}"]`);
                        if (navLink) {
                            navLink.click(); // This also handles scrolling and active state
                        } else {
                            // Fallback scroll if somehow nav link doesn't exist
                            scrollToSection(result.id, true);
                             // Manually update active state if nav link wasn't clicked
                             navLinksContainer.querySelectorAll('.nav-link').forEach(link => {
                                link.classList.remove('active');
                                link.setAttribute('aria-current', 'false');
                            });
                            const targetNavLink = navLinksContainer.querySelector(`a[href="#${result.id}"]`);
                             if(targetNavLink) {
                                targetNavLink.classList.add('active');
                                targetNavLink.setAttribute('aria-current', 'page');
                             }
                        }
                        // Hide search results after clicking
                        searchResultsDiv.style.display = 'none';
                        searchInput.value = ''; // Clear search input
                         // Optional: Return focus to search input or main content
                         searchInput.focus();
                    });
                    li.appendChild(a);
                    searchResultsList.appendChild(li);
                });
                 // Add ARIA attributes to the results list container
                searchResultsDiv.style.display = 'block';
                 searchResultsList.setAttribute('role', 'listbox'); // Indicate a list of options
                 searchResultsList.setAttribute('aria-label', 'Search results');
            } else {
                 searchResultsList.removeAttribute('role');
                 searchResultsList.removeAttribute('aria-label');
                searchResultsDiv.style.display = 'none';
            }
        });

        // --- Scroll to Top Button ---
        window.addEventListener('scroll', function() {
            if (window.scrollY > 300) { // Show button after scrolling down 300px
                scrollToTopBtn.classList.add('show');
            } else {
                scrollToTopBtn.classList.remove('show');
            }
        });

        scrollToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // --- Initial Load ---
        // Set initial language and render content
        setLanguage(currentLang);

        // Handle initial hash on load
        window.addEventListener('load', () => {
             // The setLanguage call already handles initial rendering and scrolling based on hash/active link.
             // This load listener ensures the active state is correctly set *after* the content and nav are rendered
             // and the page might have scrolled due to the initial hash.
             if (window.location.hash) {
                const targetId = window.location.hash.substring(1);
                const navLink = navLinksContainer.querySelector(`a[href="${window.location.hash}"]`);
                if (navLink) {
                    navLinksContainer.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                        link.setAttribute('aria-current', 'false');
                    });
                    navLink.classList.add('active');
                    navLink.setAttribute('aria-current', 'page');
                     // Scroll is handled by setLanguage -> renderContent -> requestAnimationFrame
                }
             } else {
                 // If no hash, activate the first nav link
                const firstNavLink = navLinksContainer.querySelector('.nav-link');
                if (firstNavLink) {
                    firstNavLink.classList.add('active');
                    firstNavLink.setAttribute('aria-current', 'page');
                }
             }
        });

         // Update active nav link on scroll
        window.addEventListener('scroll', () => {
            const sections = handbookContent[currentLang].sections.map(sec => document.getElementById(sec.id)).filter(sec => sec);
            const headerHeight = document.querySelector('header').offsetHeight;
            // Add a buffer (e.g., 100px) so the link becomes active slightly before the section reaches the very top
            const scrollPosition = window.scrollY + headerHeight + 100;

            sections.forEach(section => {
                 if (section) { // Ensure section element exists
                    // Check if the scroll position is within the bounds of the section
                    if (section.offsetTop <= scrollPosition && section.offsetTop + section.offsetHeight > scrollPosition) {
                        const id = section.getAttribute('id');
                        navLinksContainer.querySelectorAll('.nav-link').forEach(link => {
                            if (link.getAttribute('href') === `#${id}`) {
                                link.classList.add('active');
                                 link.setAttribute('aria-current', 'page');
                            } else {
                                link.classList.remove('active');
                                link.setAttribute('aria-current', 'false');
                            }
                        });
                    }
                 }
            });
        });


    </script>

</body>
</html>
