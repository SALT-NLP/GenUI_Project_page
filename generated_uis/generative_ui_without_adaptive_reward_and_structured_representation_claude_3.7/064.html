<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM PBL Teacher Program</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"> <!-- For icons -->
    <style>
        :root {
            --primary-color: #0077cc; /* A slightly softer blue */
            --primary-color-dark: #005fa3; /* Darker blue for hover */
            --secondary-color: #5a6268; /* Muted grey */
            --secondary-color-dark: #444a4e; /* Darker grey for hover */
            --accent-color: #28a745; /* Success green */
            --accent-color-dark: #218838; /* Darker green for hover */
            --background-color: #ffffff; /* Pure white */
            --surface-color: #f8f9fa; /* Light grey for cards/sections */
            --text-color: #212529; /* Dark grey for text */
            --text-light: #6c757d; /* Lighter grey text */
            --border-color: #dee2e6; /* Light border */
            --shadow-color: rgba(0, 0, 0, 0.08); /* Subtle shadow */
            --border-radius: 8px;
            --padding-base: 20px;
            --header-height: 60px;
            --transition-duration: 0.2s;
            --focus-ring-color: rgba(0, 119, 204, 0.4); /* Primary color with transparency */
            --overlay-color: rgba(0, 0, 0, 0.5); /* Dark overlay for modals */
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: var(--surface-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 1rem; /* Base font size for desktop */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-y: auto; /* Allow body scroll */
        }

        header {
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 0 var(--padding-base);
            box-shadow: 0 2px 4px var(--shadow-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: var(--header-height);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .site-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-duration) ease;
            outline: none; /* Remove default outline */
            padding: 5px; /* Add padding for larger click area */
        }

        .site-title:hover {
             color: var(--primary-color-dark);
        }
         .site-title:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
             border-radius: 4px; /* Apply focus ring with border-radius */
         }

        /* Desktop Navigation */
        .nav-menu {
            display: flex;
            align-items: center;
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        nav ul li {
            margin-left: var(--padding-base);
        }

        nav ul li a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            padding: 5px 0;
            transition: color var(--transition-duration) ease, border-bottom var(--transition-duration) ease;
            border-bottom: 2px solid transparent; /* Add transparent border for smooth transition */
            outline: none; /* Remove default outline */
            display: inline-block; /* Required for padding/margin */
        }

        nav ul li a:hover {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
         nav ul li a:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
             border-radius: 4px;
         }

        nav ul li a.active-nav {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Hamburger Menu Button */
        .hamburger {
            display: none; /* Hidden on desktop */
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px; /* Larger click area */
            z-index: 1001; /* Above nav */
            outline: none;
        }
        .hamburger .material-icons-round {
            font-size: 28px;
            color: var(--text-color);
             transition: color var(--transition-duration) ease;
        }
         .hamburger:hover .material-icons-round {
             color: var(--primary-color);
         }
         .hamburger:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
             border-radius: 4px;
         }


        main {
            flex-grow: 1;
            padding: var(--padding-base);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column; /* Default to column layout */
            position: relative; /* Needed for absolute positioning of sections */
        }

        section {
            background-color: var(--background-color);
            padding: var(--padding-base);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px var(--shadow-color);
            margin-bottom: var(--padding-base);
            width: 100%; /* Ensure sections take full width in column layout */
            opacity: 0; /* Start hidden */
            transform: translateY(10px); /* Start slightly below */
            transition: opacity var(--transition-duration) ease-out, transform var(--transition-duration) ease-out;
            position: absolute; /* Position absolutely to stack them */
            top: var(--padding-base); /* Align to top of main padding */
            left: 50%; /* Center horizontally */
            transform: translateX(-50%) translateY(10px); /* Center and offset */
            width: calc(100% - var(--padding-base) * 2); /* Account for main padding */
            max-width: 1200px; /* Match main max-width */
            pointer-events: none; /* Disable interaction when hidden */
            visibility: hidden; /* Hide from screen readers when not active */
            min-height: calc(100vh - var(--header-height) - var(--padding-base) * 2); /* Ensure sections take up space */
            box-sizing: border-box; /* Include padding in height */
            overflow-y: auto; /* Allow section content to scroll */
        }

        section.active {
            opacity: 1; /* Fade in */
            transform: translateX(-50%) translateY(0); /* Slide up */
            position: static; /* Restore normal flow */
            pointer-events: all; /* Enable interaction */
            visibility: visible; /* Make visible to screen readers */
        }

        h1, h2, h3 {
            color: var(--text-color);
            margin-top: 0;
            font-weight: 700;
        }

        h1 { font-size: 2em; margin-bottom: 0.5em; }
        h2 { font-size: 1.5em; margin-bottom: 0.75em; }
        h3 { font-size: 1.2em; margin-bottom: 0.5em; }

        p {
            margin-bottom: 1em;
        }

        .welcome-message {
            font-size: 1.1em;
            color: var(--text-light);
            margin-bottom: var(--padding-base);
        }

        .quick-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px; /* Space between buttons */
        }

        .quick-links a {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            text-decoration: none;
            transition: background-color var(--transition-duration) ease, transform 0.1s ease;
            font-weight: 500;
            border: none; /* Flat button */
            cursor: pointer;
            outline: none;
        }

        .quick-links a:hover {
            background-color: var(--primary-color-dark);
        }
         .quick-links a:active {
            transform: scale(0.98);
        }
         .quick-links a:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
         }


        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--padding-base);
        }

        .module-card {
            background-color: var(--surface-color);
            padding: var(--padding-base);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Push progress to bottom */
            outline: none;
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }
         .module-card:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
         }

        .module-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-size: 1.1em;
        }

        .module-card p {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 15px;
            flex-grow: 1; /* Allow description to take space */
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            height: 10px;
            margin-top: auto; /* Align to bottom */
        }

        .progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%; /* Will be set by JS/data */
            transition: width 0.5s ease;
            border-radius: 5px; /* Match container radius */
        }

        /* Module Detail View */
        .module-detail-layout {
            display: flex; /* Default to column on mobile */
            flex-direction: column;
            gap: var(--padding-base);
        }
        .module-detail-layout .sidebar {
            flex-shrink: 0; /* Prevent sidebar from shrinking */
            background-color: var(--surface-color);
            padding: var(--padding-base);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }
        .module-detail-layout .sidebar h3 {
            margin-top: 0;
            margin-bottom: var(--padding-base);
            color: var(--primary-color);
        }
        .module-detail-layout .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .module-detail-layout .sidebar li {
            margin-bottom: 10px;
        }
        .module-detail-layout .sidebar a {
            text-decoration: none;
            color: var(--text-color);
            transition: color var(--transition-duration) ease;
            outline: none;
            display: block; /* Make the whole list item clickable */
            padding: 5px; /* Add padding for click area */
             border-radius: 4px;
        }
         .module-detail-layout .sidebar a:hover {
             color: var(--primary-color);
         }
         .module-detail-layout .sidebar a:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
         }
         .module-detail-layout .sidebar a.active-lesson {
             font-weight: 500;
             color: var(--primary-color);
         }

        .module-detail-layout .content {
            flex-grow: 1;
             /* No specific background/padding here, handled by nested lesson content */
        }

        /* Lesson Content */
        .lesson-content {
            background-color: var(--surface-color);
            padding: var(--padding-base);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }
         .lesson-content h3 {
             margin-bottom: var(--padding-base);
             color: var(--primary-color);
         }

        .video-container {
             position: relative;
             padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
             height: 0;
             overflow: hidden;
             margin-bottom: var(--padding-base);
             border-radius: var(--border-radius);
             background-color: #000; /* Black background for video area */
        }

        .video-container iframe {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             border: none;
        }

         .interactive-element {
             margin: var(--padding-base) 0;
             padding: var(--padding-base);
             background-color: var(--background-color);
             border: 1px solid var(--border-color);
             border-radius: var(--border-radius);
             box-shadow: 0 1px 4px var(--shadow-color);
         }


        /* Resource Library */
        .resource-library .controls {
            display: flex;
            gap: 10px;
            margin-bottom: var(--padding-base);
            flex-wrap: wrap; /* Allow controls to wrap on smaller screens */
        }

         .resource-library .controls input[type="text"],
         .resource-library .controls select {
             flex-grow: 1; /* Allow search input to grow */
             min-width: 150px; /* Ensure minimum width */
             margin-bottom: 0; /* Remove default margin */
         }

        .resource-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .resource-item {
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            transition: background-color var(--transition-duration) ease;
            cursor: pointer;
            outline: none;
        }

        .resource-item:last-child {
            border-bottom: none;
        }

         .resource-item:hover {
            background-color: var(--surface-color);
         }
         .resource-item:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
             position: relative; /* Needed for focus ring on list items */
             z-index: 1; /* Ensure focus ring is visible */
         }


        .resource-item h3 {
            margin: 0 0 5px 0;
            font-size: 1em;
            color: var(--primary-color);
        }

        .resource-item p {
            font-size: 0.9em;
            color: var(--text-light);
            margin: 0;
        }

        /* Community Forum */
        .forum-threads {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .thread-item {
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
             transition: background-color var(--transition-duration) ease;
             cursor: pointer;
             outline: none;
        }

        .thread-item:last-child {
            border-bottom: none;
        }
         .thread-item:hover {
             background-color: var(--surface-color);
         }
         .thread-item:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
             position: relative;
             z-index: 1;
         }


        .thread-item h3 {
            margin: 0 0 5px 0;
            font-size: 1em;
            color: var(--primary-color);
        }

        .thread-item p {
            font-size: 0.9em;
            color: var(--text-light);
            margin: 0;
        }

        /* Progress Dashboard */
        .progress-summary {
            /* Styles for charts/progress visuals */
            min-height: 150px; /* Placeholder height */
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            padding: var(--padding-base);
            text-align: center;
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--padding-base); /* Add space before chart */
        }

        .progress-summary h3 {
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            /* Use conic gradient for visual progress */
            /* background: conic-gradient(var(--accent-color) 0% 40%, #e9ecef 40% 100%); /* Placeholder gradient 40% */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 15px;
            position: relative; /* Needed for pseudo-element text */
        }

        /* Add percentage text inside circle */
        .progress-circle::after {
            content: attr(data-progress) '%'; /* Use data attribute for percentage */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-color);
            font-size: 1em; /* Adjust size relative to circle */
            font-weight: 700;
        }


         .progress-chart-container {
             position: relative;
             background-color: var(--background-color);
             padding: var(--padding-base);
             border-radius: var(--border-radius);
             box-shadow: 0 2px 8px var(--shadow-color);
             height: 300px; /* Fixed height for chart */
             margin-bottom: var(--padding-base);
         }

         .progress-chart-container canvas {
             height: 100% !important; /* Override Chart.js inline style */
             width: 100% !important; /* Override Chart.js inline style */
         }

         .floating-controls {
             position: absolute;
             top: var(--padding-base);
             right: var(--padding-base);
             background: rgba(255, 255, 255, 0.95);
             padding: 10px;
             border-radius: var(--border-radius);
             box-shadow: 0 2px 8px var(--shadow-color);
             opacity: 0;
             transform: translateY(-10px);
             transition: all var(--transition-duration) ease;
             pointer-events: none;
             z-index: 10; /* Above chart */
             min-width: 150px;
         }
         .floating-controls.active {
             opacity: 1;
             transform: translateY(0);
             pointer-events: all;
         }
         .control-group {
             margin: 8px 0;
             display: flex;
             flex-direction: column;
             gap: 5px;
         }
         .control-group label {
             font-size: 0.9em;
             color: var(--text-light);
             font-weight: 500;
             margin-bottom: 0;
         }
         .control-group input[type="color"],
         .control-group select {
             padding: 5px;
             border: 1px solid var(--border-color);
             border-radius: var(--border-radius);
             font-size: 0.9em;
             width: 100%; /* Ensure controls take full width */
             box-sizing: border-box;
             outline: none;
             transition: border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
         }
         .control-group input[type="color"]:focus,
         .control-group select:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px var(--focus-ring-color);
         }


        /* Assessment Interface */
        .assessment-interface .question {
            margin-bottom: var(--padding-base);
            padding-bottom: var(--padding-base);
            border-bottom: 1px solid var(--border-color);
        }

        .assessment-interface .question:last-child {
            border-bottom: none;
        }

        .assessment-interface label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .assessment-interface input[type="text"],
        .assessment-interface textarea {
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
            margin-bottom: 10px;
        }

        .assessment-interface .options label {
            display: flex; /* Use flex to align checkbox/radio and text */
            align-items: center;
            font-weight: 400;
            margin-bottom: 10px; /* Space between options */
            cursor: pointer;
        }
         .assessment-interface .options input[type="radio"],
         .assessment-interface .options input[type="checkbox"] {
             margin-right: 8px; /* Space between input and label text */
             margin-bottom: 0; /* Remove default margin */
             flex-shrink: 0; /* Prevent input from shrinking */
         }


        .button-container {
            margin-top: var(--padding-base);
            text-align: right;
        }

        /* Profile Settings */
        .profile-settings .form-group {
            margin-bottom: var(--padding-base);
        }

        .profile-settings label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

         .profile-settings input[type="text"],
         .profile-settings input[type="email"] {
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
            margin-bottom: 0; /* Remove default margin */
         }


        /* Buttons */
        .button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            text-decoration: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            transition: background-color var(--transition-duration) ease, transform 0.1s ease;
            font-weight: 500;
            outline: none;
        }

        .button:hover {
            background-color: var(--primary-color-dark);
        }

        .button:active {
            transform: scale(0.98);
        }
         .button:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
         }


        .button-secondary {
            background-color: var(--secondary-color);
        }

        .button-secondary:hover {
            background-color: var(--secondary-color-dark);
        }
         .button-secondary:focus {
             box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.4); /* Secondary color with transparency */
         }

         .button:disabled,
         .button[disabled] {
             opacity: 0.6;
             cursor: not-allowed;
         }


        input[type="text"],
        input[type="email"],
        textarea,
        select {
            width: calc(100% - 20px); /* Adjust for padding */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1em;
            box-sizing: border-box; /* Include padding in width */
             outline: none;
             transition: border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--focus-ring-color);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-duration) ease, visibility var(--transition-duration) ease;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--background-color);
            padding: var(--padding-base);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 16px var(--shadow-color);
            max-width: 500px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform var(--transition-duration) ease;
            position: relative; /* Needed for close button */
        }

        .modal-overlay.visible .modal-content {
            transform: translateY(0);
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            transition: color var(--transition-duration) ease;
            outline: none;
        }
         .modal-close:hover {
             color: var(--text-color);
         }
         .modal-close:focus {
             box-shadow: 0 0 0 3px var(--focus-ring-color);
             border-radius: 4px;
         }

        /* Basic responsiveness */
        @media (max-width: 768px) {
            header {
                padding: 0 10px; /* Less padding on mobile */
            }
            .site-title {
                 font-size: 1.3em;
            }
            .nav-menu {
                 position: fixed;
                 top: 0;
                 left: 0;
                 width: 100%;
                 height: 100%;
                 background-color: var(--background-color);
                 flex-direction: column;
                 justify-content: center;
                 align-items: center;
                 transform: translateX(-100%); /* Start off-screen */
                 transition: transform 0.3s ease-in-out;
                 z-index: 999; /* Below header */
                 padding-top: var(--header-height); /* Space for header */
            }
            .nav-menu.active {
                 transform: translateX(0); /* Slide in */
            }

            nav ul {
                flex-direction: column;
                align-items: center;
                width: 100%; /* Full width for mobile nav */
            }
            nav ul li {
                margin: 10px 0; /* More vertical space */
                width: 100%;
                text-align: center;
            }
             nav ul li a {
                 padding: 10px 0; /* Add vertical padding */
                 width: 100%;
             }

            .hamburger {
                display: block; /* Show on mobile */
            }

            main {
                padding: 10px; /* Less padding on mobile */
            }
            section {
                 width: calc(100% - 10px * 2); /* Account for main padding */
                 top: 10px; /* Adjust top position for less padding */
            }
            section.active {
                 transform: translateX(-50%) translateY(0); /* Maintain centering */
            }

            .module-grid {
                grid-template-columns: 1fr;
            }

             .quick-links {
                 flex-direction: column; /* Stack buttons */
                 gap: 10px; /* Space between stacked buttons */
             }
             .quick-links a {
                 width: 100%; /* Full width buttons */
                 text-align: center;
             }

             .resource-library .controls {
                 flex-direction: column;
             }
             .resource-library .controls input[type="text"],
             .resource-library .controls select {
                 min-width: auto; /* Reset min-width */
                 width: 100%; /* Full width inputs */
             }

             input[type="text"],
             input[type="email"],
             textarea,
             select {
                 width: 100%; /* Full width inputs */
             }

             .floating-controls {
                 position: static; /* Stack controls on mobile */
                 transform: none;
                 opacity: 1;
                 pointer-events: all;
                 box-shadow: none;
                 background: transparent;
                 padding: 0;
                 margin-top: var(--padding-base);
             }

             .module-detail-layout {
                 flex-direction: column; /* Stack sidebar and content */
             }
             .module-detail-layout .sidebar {
                 width: 100%; /* Full width sidebar */
             }
        }

         /* Desktop layout for main content */
         @media (min-width: 992px) {
             .module-detail-layout {
                 display: grid;
                 grid-template-columns: 250px 1fr; /* Sidebar + Content */
                 gap: var(--padding-base);
             }
             .module-detail-layout .sidebar {
                 width: auto; /* Auto width based on grid */
             }
         }

         /* Accessibility - Focus styles */
         /* Handled by individual element styles and :focus pseudo-class */


         /* ARIA attributes for navigation */
         /* nav role="navigation" applied */
         /* a role="link" is implicit */
         /* aria-controls on nav links */
         /* aria-label on interactive elements */
         /* role="main", role="region" applied to sections */
         /* aria-labelledby on sections */
         /* role="progressbar" on progress bar */
         /* role="listitem" on resource/thread items */
         /* role="group" on question groups */
         /* role="status", aria-live="polite" on progress summary */
         /* role="dialog" on modal */
         /* aria-modal="true" on modal */


    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <a href="#dashboard" class="site-title" aria-label="STEM PBL Program Home">STEM PBL Program</a>
        <button class="hamburger" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-menu">
             <span class="material-icons-round">menu</span>
        </button>
        <div class="nav-menu" id="nav-menu">
            <nav role="navigation">
                <ul>
                    <li><a href="#dashboard" aria-controls="dashboard-section">Dashboard</a></li>
                    <li><a href="#modules" aria-controls="modules-section">Modules</a></li>
                    <li><a href="#resources" aria-controls="resources-section">Resources</a></li>
                    <li><a href="#community" aria-controls="community-section">Community</a></li>
                    <li><a href="#progress" aria-controls="progress-section">Progress</a></li>
                    <li><a href="#profile" aria-controls="profile-section">Profile</a></li>
                    <li><a href="#assessment" aria-controls="assessment-section">Assessment</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section id="dashboard-section" class="dashboard" role="main" aria-labelledby="dashboard-heading" aria-hidden="false">
            <h1 id="dashboard-heading">Welcome, [Teacher Name]!</h1>
            <p class="welcome-message">Ready to transform your STEM classroom with Project-Based Learning? Start exploring the modules or pick up where you left off.</p>
            <div class="quick-links">
                <a href="#modules" class="button" aria-label="Explore Learning Modules">Explore Modules</a>
                <a href="#progress" class="button button-secondary" aria-label="View My Progress Dashboard">View My Progress</a>
            </div>
        </section>

        <section id="modules-section" class="module-list" role="region" aria-labelledby="modules-heading" aria-hidden="true">
            <h2 id="modules-heading">Learning Modules</h2>
            <div class="module-grid">
                <article class="module-card" tabindex="0" role="link" aria-label="Module 1: Introduction to PBL, 75% complete" data-module-id="module1">
                    <h3>Module 1: Introduction to PBL</h3>
                    <p>Understand the core principles, benefits, and research behind Project-Based Learning in STEM.</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 75%;" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" aria-label="Module completion progress"></div>
                    </div>
                </article>
                <article class="module-card" tabindex="0" role="link" aria-label="Module 2: Designing Your First PBL Unit, 30% complete" data-module-id="module2">
                    <h3>Module 2: Designing Your First PBL Unit</h3>
                    <p>Learn practical steps for planning, structuring, and scaffolding a compelling PBL unit for your students.</p>
                     <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 30%;" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" aria-label="Module completion progress"></div>
                    </div>
                </article>
                 <article class="module-card" tabindex="0" role="link" aria-label="Module 3: Facilitating Student Inquiry, 0% complete" data-module-id="module3">
                    <h3>Module 3: Facilitating Student Inquiry</h3>
                    <p>Develop strategies for guiding student questions, research, and collaboration effectively.</p>
                     <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Module completion progress"></div>
                    </div>
                </article>
                <article class="module-card" tabindex="0" role="link" aria-label="Module 4: Assessment in PBL, 0% complete" data-module-id="module4">
                    <h3>Module 4: Assessment in PBL</h3>
                    <p>Explore authentic assessment methods that align with project goals and student learning outcomes.</p>
                     <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Module completion progress"></div>
                    </div>
                </article>
                 <article class="module-card" tabindex="0" role="link" aria-label="Module 5: Implementing PBL in Diverse Contexts, 0% complete" data-module-id="module5">
                    <h3>Module 5: Implementing PBL in Diverse Contexts</h3>
                    <p>Adapt PBL strategies for various grade levels, subject areas, and classroom environments.</p>
                     <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Module completion progress"></div>
                    </div>
                </article>
            </div>
        </section>

        <section id="module-detail-section" class="module-detail" role="region" aria-labelledby="module-detail-heading" aria-hidden="true">
            <h2 id="module-detail-heading">Module Title Placeholder</h2>
            <p>Module description placeholder.</p>
            <div class="module-detail-layout">
                <aside class="sidebar">
                    <h3>Lessons</h3>
                    <ul id="lesson-list">
                        <!-- Lesson links will be loaded here -->
                        <li><a href="#lesson1" data-lesson-id="lesson1" class="active-lesson">Lesson 1: Lesson Title 1</a></li>
                        <li><a href="#lesson2" data-lesson-id="lesson2">Lesson 2: Lesson Title 2</a></li>
                        <li><a href="#lesson3" data-lesson-id="lesson3">Lesson 3: Lesson Title 3</a></li>
                    </ul>
                </aside>
                <div class="content" id="lesson-content-area">
                    <!-- Lesson content will be loaded here -->
                    <div class="lesson-content">
                        <h3>Lesson Title Placeholder</h3>
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen title="Placeholder Video"></iframe>
                        </div>
                        <p>This is placeholder text for the lesson content. It will include explanations, examples, and activities.</p>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                        <div class="interactive-element">
                            <h4>Interactive Activity Placeholder</h4>
                            <p>This area could contain a quiz, a drag-and-drop exercise, or other interactive content.</p>
                            <button class="button button-secondary">Try Activity</button>
                        </div>
                         <div class="button-container" style="text-align: left;">
                             <button class="button" aria-label="Mark lesson as complete">Mark as Complete</button>
                         </div>
                    </div>
                </div>
            </div>
        </section>


        <section id="resources-section" class="resource-library" role="region" aria-labelledby="resources-heading" aria-hidden="true">
            <h2 id="resources-heading">Resource Library</h2>
            <p>Find templates, examples, articles, and tools to support your PBL implementation.</p>
            <div class="controls">
                <input type="text" id="resource-search" placeholder="Search resources..." aria-label="Search resources">
                <select id="resource-filter" aria-label="Filter resources by type">
                    <option value="">All Types</option>
                    <option value="document">Document</option>
                    <option value="collection">Collection</option>
                    <option value="link">Link</option>
                    <option value="template">Template</option>
                    <option value="video">Video</option>
                </select>
            </div>
            <div class="resource-list" role="list">
                <article class="resource-item" tabindex="0" role="listitem" aria-label="PBL Unit Planning Template, Document" data-type="document">
                    <h3>PBL Unit Planning Template (Document)</h3>
                    <p>A downloadable template to help structure your project design process.</p>
                </article>
                 <article class="resource-item" tabindex="0" role="listitem" aria-label="Example STEM PBL Projects, Collection" data-type="collection">
                    <h3>Example STEM PBL Projects (Collection)</h3>
                    <p>Browse successful project examples across different STEM subjects and grade levels.</p>
                </article>
                 <article class="resource-item" tabindex="0" role="listitem" aria-label="Article: Managing Group Work Effectively, Link" data-type="link">
                    <h3>Article: Managing Group Work Effectively (Link)</h3>
                    <p>Tips and strategies for fostering positive and productive student collaboration.</p>
                </article>
                 <article class="resource-item" tabindex="0" role="listitem" aria-label="Rubric Examples for PBL, Document" data-type="document">
                    <h3>Rubric Examples for PBL (Document)</h3>
                    <p>Downloadable examples of rubrics for assessing project work.</p>
                </article>
                 <article class="resource-item" tabindex="0" role="listitem" aria-label="Video: Student Presentations Best Practices, Video" data-type="video">
                    <h3>Video: Student Presentations Best Practices (Video)</h3>
                    <p>Watch a short video on coaching students for effective presentations.</p>
                </article>
            </div>
        </section>

        <section id="community-section" class="community-forum" role="region" aria-labelledby="community-heading" aria-hidden="true">
            <h2 id="community-heading">Community Forum</h2>
            <p>Connect with other teachers, ask questions, and share your experiences.</p>
             <div class="forum-threads" role="list">
                <article class="thread-item" tabindex="0" role="listitem" aria-label="Thread: Getting Started with PBL - Any Tips?, Posted by Teacher A">
                    <h3>Getting Started with PBL - Any Tips?</h3>
                    <p>Started my first unit, looking for advice on common challenges. (Posted by: Teacher A)</p>
                </article>
                 <article class="thread-item" tabindex="0" role="listitem" aria-label="Thread: Sharing Success: Our First STEM Fair Project, Posted by Teacher B">
                    <h3>Sharing Success: Our First STEM Fair Project</h3>
                    <p>Had a great experience with a student-led project on renewable energy! (Posted by: Teacher B)</p>
                </article>
                 <article class="thread-item" tabindex="0" role="listitem" aria-label="Thread: Question about integrating technology in PBL, Posted by Teacher C">
                    <h3>Question about integrating technology in PBL</h3>
                    <p>What are your favorite tools for collaboration and presentation in PBL? (Posted by: Teacher C)</p>
                </article>
            </div>
             <div class="button-container" style="text-align: left; margin-top: var(--padding-base);">
                 <button class="button" aria-label="Start a new discussion thread" id="open-new-thread-modal">Start New Discussion</button>
             </div>
        </section>

        <section id="progress-section" class="progress-dashboard" role="region" aria-labelledby="progress-heading" aria-hidden="true">
            <h2 id="progress-heading">My Progress</h2>
            <p>Track your completion of modules, lessons, and activities.</p>
            <div class="progress-summary" role="status" aria-live="polite">
                <h3>Overall Program Completion</h3>
                <div class="progress-circle" data-progress="40"></div>
                <p>Completed 2 of 5 modules</p>
            </div>

             <div class="progress-chart-container">
                 <h3>Module Completion Status</h3>
                 <canvas id="moduleCompletionChart" aria-label="Bar chart showing completion percentage for each module"></canvas>
                  <div class="floating-controls" id="chart-controls">
                      <div class="control-group">
                          <label for="chartType">Chart Type:</label>
                          <select id="chartType" aria-controls="moduleCompletionChart">
                              <option value="bar">Bar</option>
                              <option value="pie">Pie</option>
                              <option value="doughnut">Doughnut</option>
                          </select>
                      </div>
                       <div class="control-group">
                           <label for="chartColor">Bar Color:</label>
                           <input type="color" id="chartColor" value="#28a745" aria-controls="moduleCompletionChart">
                       </div>
                  </div>
             </div>

        </section>

         <section id="assessment-section" class="assessment-interface" role="region" aria-labelledby="assessment-heading" aria-hidden="true">
            <h2 id="assessment-heading">Assessment</h2>
            <p>Complete assessments to check your understanding.</p>
            <form id="assessment-form">
                <div class="assessment-content">
                    <div class="question" role="group" aria-labelledby="q1-heading">
                        <h3 id="q1-heading">Question 1: What is the primary goal of Project-Based Learning?</h3>
                        <div class="options">
                            <label><input type="radio" name="q1" value="a" required> To deliver content efficiently</label><br>
                            <label><input type="radio" name="q1" value="b" required> To engage students in real-world problems</label><br>
                            <label><input type="radio" name="q1" value="c" required> To prepare students for standardized tests</label><br>
                        </div>
                    </div>
                     <div class="question" role="group" aria-labelledby="q2-heading">
                        <h3 id="q2-heading">Question 2: Describe one strategy for facilitating student inquiry in a PBL unit.</h3>
                        <textarea name="q2" rows="4" placeholder="Your answer here..." aria-label="Answer for question 2" required></textarea>
                    </div>
                     <div class="button-container">
                         <button type="submit" class="button">Submit Assessment</button>
                     </div>
                </div>
            </form>
        </section>

        <section id="profile-section" class="profile-settings" role="region" aria-labelledby="profile-heading" aria-hidden="true">
            <h2 id="profile-heading">Profile & Settings</h2>
            <p>Manage your account information and preferences.</p>
            <form id="profile-form">
                <div class="form-group">
                    <label for="profile-name">Name:</label>
                    <input type="text" id="profile-name" value="[Teacher Name]" aria-label="Your name" required>
                </div>
                 <div class="form-group">
                    <label for="profile-email">Email:</label>
                    <input type="email" id="profile-email" value="[Teacher Email]" aria-label="Your email address" required>
                </div>
                 <div class="button-container" style="text-align: left;">
                     <button type="submit" class="button">Save Profile</button>
                 </div>
            </form>
        </section>

    </main>

    <!-- Modal Structure -->
    <div class="modal-overlay" id="new-thread-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="new-thread-modal-title">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">&times;</button>
            <h3 id="new-thread-modal-title">Start New Discussion</h3>
            <form id="new-thread-form">
                <div class="form-group">
                    <label for="thread-title">Title:</label>
                    <input type="text" id="thread-title" placeholder="Enter thread title" aria-label="Discussion thread title" required>
                </div>
                 <div class="form-group">
                    <label for="thread-content">Content:</label>
                    <textarea id="thread-content" rows="6" placeholder="Write your post here..." aria-label="Discussion thread content" required></textarea>
                </div>
                 <div class="button-container" style="text-align: right;">
                     <button type="submit" class="button">Post Discussion</button>
                 </div>
            </form>
        </div>
    </div>


    <script type="module">
        // Basic script for navigation and section switching
        const navLinks = document.querySelectorAll('nav a');
        const sections = document.querySelectorAll('main section');
        const mainElement = document.querySelector('main'); // Get main element for positioning
        const hamburgerButton = document.querySelector('.hamburger');
        const navMenu = document.getElementById('nav-menu');

        // Function to toggle mobile navigation menu
        function toggleNavMenu() {
            const isOpen = navMenu.classList.toggle('active');
            hamburgerButton.setAttribute('aria-expanded', isOpen);
             // Toggle body scroll lock if needed (optional)
             // document.body.style.overflow = isOpen ? 'hidden' : 'auto';
        }

        // Function to show a specific section and hide others
        function showSection(id) {
            sections.forEach(section => {
                // Hide all sections
                section.classList.remove('active');
                section.setAttribute('aria-hidden', 'true');
                // Reset position/transform for inactive sections to prepare for next activation
                section.style.position = 'absolute';
                section.style.transform = 'translateX(-50%) translateY(10px)';
                section.style.opacity = '0';
                section.style.visibility = 'hidden';
                section.style.pointerEvents = 'none';
            });

            const targetSection = document.getElementById(id);
            if (targetSection) {
                // Set initial state before activating for transition
                targetSection.style.position = 'static'; // Allow it to take up space
                targetSection.style.transform = 'translateX(-50%) translateY(10px)'; // Start position for slide-up
                targetSection.style.opacity = '0'; // Start transparent
                targetSection.style.visibility = 'visible'; // Make visible for transition
                targetSection.style.pointerEvents = 'all'; // Enable interaction

                // Force reflow to apply initial styles before transition
                void targetSection.offsetHeight;

                // Apply active styles to trigger transition
                targetSection.classList.add('active');
                targetSection.setAttribute('aria-hidden', 'false');

                // Update active state in nav
                navLinks.forEach(nav => nav.classList.remove('active-nav'));
                // Find the nav link that points to this section (remove '-section' from id)
                const activeNavLink = document.querySelector(`nav a[href="#${id.replace('-section', '')}"]`);
                 if (activeNavLink) {
                     activeNavLink.classList.add('active-nav');
                 }

                // Scroll to the top of the main content area
                // Use requestAnimationFrame to ensure scroll happens after layout updates
                requestAnimationFrame(() => {
                     mainElement.scrollTo({ top: 0, behavior: 'smooth' });
                });


                // Close mobile menu if open
                if (navMenu.classList.contains('active')) {
                    toggleNavMenu();
                }
            }
        }

        // Event listeners for navigation links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1) + '-section'; // Append -section to match IDs
                showSection(targetId);
            });
        });

        // Event listener for hamburger menu
        hamburgerButton.addEventListener('click', toggleNavMenu);

        // Close mobile menu when clicking outside (optional, handled by section click now)
        // document.addEventListener('click', (e) => {
        //     if (navMenu.classList.contains('active') && !navMenu.contains(e.target) && !hamburgerButton.contains(e.target)) {
        //         toggleNavMenu();
        //     }
        // });


        // Initial view: Show dashboard or section from hash if present
        document.addEventListener('DOMContentLoaded', () => {
            const initialHash = window.location.hash.substring(1);
            // Default to dashboard if no hash or hash doesn't match a section ID prefix
            const validSections = Array.from(sections).map(sec => sec.id.replace('-section', ''));
            const initialSectionId = validSections.includes(initialHash) ? initialHash + '-section' : 'dashboard-section';

            // Delay initial show slightly to allow CSS transitions to work
            setTimeout(() => {
                 showSection(initialSectionId);
            }, 50);


            // Add tabindex and click/keypress listeners to module cards for keyboard navigation
             document.querySelectorAll('.module-card').forEach(card => {
                 card.addEventListener('click', () => {
                     const moduleId = card.getAttribute('data-module-id');
                     console.log('Module card clicked:', card.querySelector('h3').textContent, '(ID:', moduleId, ')');
                     // Placeholder: Load module details and navigate
                     loadModuleDetail(moduleId); // Call a placeholder function
                     showSection('module-detail-section'); // Navigate to module detail section
                 });
                  card.addEventListener('keypress', (e) => {
                      if (e.key === 'Enter' || e.key === ' ') {
                          e.preventDefault();
                          card.click();
                      }
                  });
             });

             // Add tabindex and click/keypress listeners to resource items
              document.querySelectorAll('.resource-item').forEach(item => {
                 item.addEventListener('click', () => {
                     console.log('Resource item clicked:', item.querySelector('h3').textContent);
                     // Placeholder: Open resource (e.g., modal, new tab)
                     alert('Opening resource: ' + item.querySelector('h3').textContent + ' (Placeholder)');
                 });
                   item.addEventListener('keypress', (e) => {
                      if (e.key === 'Enter' || e.key === ' ') {
                          e.preventDefault();
                          item.click();
                      }
                  });
             });

             // Add tabindex and click/keypress listeners to thread items
              document.querySelectorAll('.thread-item').forEach(item => {
                 item.addEventListener('click', () => {
                     console.log('Thread item clicked:', item.querySelector('h3').textContent);
                     // Placeholder: Open thread detail view
                     alert('Opening thread: ' + item.querySelector('h3').textContent + ' (Placeholder)');
                     // showSection('thread-detail-section'); // Assuming a thread detail section exists
                 });
                   item.addEventListener('keypress', (e) => {
                      if (e.key === 'Enter' || e.key === ' ') {
                          e.preventDefault();
                          item.click();
                      }
                  });
             });

             // Placeholder for "Start New Discussion" button - Opens Modal
             const newThreadButton = document.getElementById('open-new-thread-modal');
             const newThreadModalOverlay = document.getElementById('new-thread-modal-overlay');
             const newThreadModalClose = newThreadModalOverlay.querySelector('.modal-close');

             if (newThreadButton && newThreadModalOverlay && newThreadModalClose) {
                 newThreadButton.addEventListener('click', () => {
                     newThreadModalOverlay.classList.add('visible');
                     // Focus the first interactive element in the modal for accessibility
                     newThreadModalOverlay.querySelector('input, textarea, button').focus();
                 });

                 newThreadModalClose.addEventListener('click', () => {
                     newThreadModalOverlay.classList.remove('visible');
                 });

                 // Close modal when clicking outside the content
                 newThreadModalOverlay.addEventListener('click', (e) => {
                     if (e.target === newThreadModalOverlay) {
                         newThreadModalOverlay.classList.remove('visible');
                     }
                 });

                 // Close modal with Escape key
                 document.addEventListener('keydown', (e) => {
                     if (e.key === 'Escape' && newThreadModalOverlay.classList.contains('visible')) {
                         newThreadModalOverlay.classList.remove('visible');
                     }
                 });
             }

             // Placeholder for New Thread Form Submission
             const newThreadForm = document.getElementById('new-thread-form');
             if (newThreadForm) {
                 newThreadForm.addEventListener('submit', (e) => {
                     e.preventDefault();
                     console.log('New thread form submitted');
                     // In a real app, collect form data, validate, and send to backend
                     alert('New discussion posted! (Placeholder)');
                     newThreadModalOverlay.classList.remove('visible'); // Close modal on submit
                 });
             }


             // Resource search/filter functionality
             const resourceSearchInput = document.getElementById('resource-search');
             const resourceFilterSelect = document.getElementById('resource-filter');
             const resourceItems = document.querySelectorAll('.resource-item');

             function filterResources() {
                 const searchTerm = resourceSearchInput.value.toLowerCase().trim();
                 const filterType = resourceFilterSelect.value.toLowerCase();

                 resourceItems.forEach(item => {
                     const title = item.querySelector('h3').textContent.toLowerCase();
                     const description = item.querySelector('p').textContent.toLowerCase();
                     const itemType = item.getAttribute('data-type');

                     const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
                     const matchesFilter = filterType === '' || itemType === filterType;

                     if (matchesSearch && matchesFilter) {
                         item.style.display = 'block';
                     } else {
                         item.style.display = 'none';
                     }
                 });
             }

             if (resourceSearchInput && resourceFilterSelect && resourceItems.length > 0) {
                 resourceSearchInput.addEventListener('input', filterResources);
                 resourceFilterSelect.addEventListener('change', filterResources);
             }


             // Placeholder for Assessment Form Submission
             const assessmentForm = document.getElementById('assessment-form');
             if (assessmentForm) {
                 assessmentForm.addEventListener('submit', (e) => {
                     e.preventDefault();
                     console.log('Assessment form submitted');
                     // In a real app, collect form data, validate, and send to backend
                     alert('Assessment submitted! (This is a placeholder)');
                 });
             }

              // Placeholder for Profile Form Submission
             const profileForm = document.getElementById('profile-form');
             if (profileForm) {
                 profileForm.addEventListener('submit', (e) => {
                     e.preventDefault();
                     console.log('Profile form submitted');
                     // In a real app, collect form data, validate, and send to backend
                     alert('Profile saved! (This is a placeholder)');
                 });
             }


             // --- Chart.js Integration for Progress Dashboard ---
             const ctx = document.getElementById('moduleCompletionChart');
             const chartControls = document.getElementById('chart-controls');
             const chartTypeSelect = document.getElementById('chartType');
             const chartColorInput = document.getElementById('chartColor');
             const progressCircle = document.querySelector('.progress-circle');


             // Sample data (replace with actual user data)
             const moduleData = {
                 labels: ['Module 1', 'Module 2', 'Module 3', 'Module 4', 'Module 5'],
                 completion: [75, 30, 0, 0, 0] // Percentages
             };

             // Calculate overall progress for the circle
             const totalModules = moduleData.completion.length;
             const completedModules = moduleData.completion.filter(c => c >= 100).length; // Assuming 100% is complete
             const overallProgress = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;
             if (progressCircle) {
                  progressCircle.setAttribute('data-progress', overallProgress);
                  // Update conic gradient based on overall progress
                  progressCircle.style.background = `conic-gradient(var(--accent-color) 0% ${overallProgress}%, #e9ecef ${overallProgress}% 100%)`;
             }


             let moduleChart; // Declare chart variable

             if (ctx) {
                  const chartConfig = {
                      type: 'bar', // Initial chart type
                      data: {
                          labels: moduleData.labels,
                          datasets: [{
                              label: 'Completion (%)',
                              data: moduleData.completion,
                              backgroundColor: chartColorInput.value, // Use initial color
                              borderColor: chartColorInput.value.replace('rgb', 'rgba').replace(')', ', 0.8)'), // Slightly transparent border
                              borderWidth: 1
                          }]
                      },
                      options: {
                          responsive: true,
                          maintainAspectRatio: false,
                          plugins: {
                              legend: {
                                  display: false, // Hide legend for single dataset
                              },
                              title: {
                                  display: false, // Title handled by H3
                              },
                              tooltip: {
                                  callbacks: {
                                      label: function(context) {
                                          let label = context.dataset.label || '';
                                          if (label) {
                                              label += ': ';
                                          }
                                          if (context.parsed.y !== null) {
                                              label += context.parsed.y + '%';
                                          }
                                          return label;
                                      }
                                  }
                              }
                          },
                          scales: {
                              y: {
                                  beginAtZero: true,
                                  max: 100,
                                  ticks: {
                                      callback: function(value) {
                                          return value + '%'; // Add % to y-axis labels
                                      }
                                  }
                              },
                              x: {
                                  // x-axis configuration
                              }
                          }
                      }
                  };

                  moduleChart = new Chart(ctx, chartConfig);

                  // Function to update chart based on controls
                  function updateChart() {
                      if (!moduleChart) return; // Ensure chart exists

                      const newType = chartTypeSelect.value;
                      const newColor = chartColorInput.value;

                      // Update chart type
                      moduleChart.config.type = newType;

                      // Update colors (handle different types)
                      if (newType === 'bar') {
                           moduleChart.config.data.datasets[0].backgroundColor = newColor;
                           moduleChart.config.data.datasets[0].borderColor = newColor.replace('rgb', 'rgba').replace(')', ', 0.8)');
                           moduleChart.config.data.datasets[0].borderWidth = 1;
                           moduleChart.options.scales.y.display = true; // Show Y axis for bar
                           moduleChart.options.scales.x.display = true; // Show X axis for bar
                           // Restore default tooltip callback for bar chart if it was changed for pie/doughnut
                           moduleChart.options.plugins.tooltip.callbacks.label = function(context) {
                               let label = context.dataset.label || '';
                               if (label) {
                                   label += ': ';
                               }
                               if (context.parsed.y !== null) {
                                   label += context.parsed.y + '%';
                               }
                               return label;
                           };

                      } else { // Pie or Doughnut
                          // For pie/doughnut, we need colors for each segment
                          const segmentColors = moduleData.completion.map((comp, index) => {
                              // Example: use a base color with variations or fixed colors
                              // Using HSL for variations based on the chosen color
                              const baseHSL = hexToHsl(newColor); // Convert hex to HSL
                              const hue = (baseHSL.h + (index * 60)) % 360; // Shift hue
                              const lightness = Math.max(20, Math.min(80, baseHSL.l + (index % 2 === 0 ? 10 : -10))); // Vary lightness
                              return `hsl(${hue}, ${baseHSL.s}%, ${lightness}%)`;
                          });

                          moduleChart.config.data.datasets[0].backgroundColor = segmentColors;
                          moduleChart.config.data.datasets[0].borderColor = '#ffffff'; // White border between segments
                          moduleChart.config.data.datasets[0].borderWidth = 2;
                          moduleChart.options.scales.y.display = false; // Hide axes for pie/doughnut
                          moduleChart.options.scales.x.display = false;
                           // Add tooltips that show label and percentage
                           moduleChart.options.plugins.tooltip.callbacks.label = function(context) {
                                const label = moduleChart.data.labels[context.dataIndex];
                                const value = moduleChart.data.datasets[0].data[context.dataIndex];
                                return `${label}: ${value}%`;
                            };
                      }

                      moduleChart.update();
                  }

                 // Helper function to convert hex color to HSL
                 function hexToHsl(hex) {
                     // Remove # if it exists
                     hex = hex.replace(/^#/, '');

                     // Parse r, g, b values
                     const r = parseInt(hex.substring(0, 2), 16) / 255;
                     const g = parseInt(hex.substring(2, 4), 16) / 255;
                     const b = parseInt(hex.substring(4, 6), 16) / 255;

                     // Find the maximum and minimum values
                     const max = Math.max(r, g, b);
                     const min = Math.min(r, g, b);

                     let h, s, l = (max + min) / 2;

                     if (max === min) {
                         // achromatic
                         h = s = 0;
                     } else {
                         const d = max - min;
                         s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                         switch (max) {
                             case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                             case g: h = (b - r) / d + 2; break;
                             case b: h = (r - g) / d + 4; break;
                         }
                         h /= 6;
                     }

                     return {
                         h: Math.round(h * 360),
                         s: Math.round(s * 100),
                         l: Math.round(l * 100)
                     };
                 }


                  // Add event listeners for chart controls
                  if (chartTypeSelect && chartColorInput) {
                      chartTypeSelect.addEventListener('change', updateChart);
                      chartColorInput.addEventListener('input', updateChart); // Use input for real-time color change
                  }


                  // Show/hide chart controls on click (optional)
                  ctx.addEventListener('click', (e) => {
                      // Check if the click was inside the chart container but not on controls
                      if (chartControls && !chartControls.contains(e.target)) {
                          chartControls.classList.toggle('active');
                      }
                  });

                  // Hide controls when clicking outside chart and controls
                  document.addEventListener('click', (e) => {
                      const chartContainer = ctx.parentElement;
                      if (chartControls && chartContainer && !chartContainer.contains(e.target) && !chartControls.contains(e.target)) {
                          chartControls.classList.remove('active');
                      }
                  });

                  // Initial update to set correct colors based on default input value
                  updateChart();
             }


             // --- Placeholder functions for Module/Lesson Detail ---
             function loadModuleDetail(moduleId) {
                 console.log(`Loading details for module: ${moduleId}`);
                 const moduleDetailSection = document.getElementById('module-detail-section');
                 const moduleDetailHeading = moduleDetailSection.querySelector('#module-detail-heading');
                 const lessonList = moduleDetailSection.querySelector('#lesson-list');

                 // Simulate fetching module data
                 const moduleData = {
                     module1: {
                         title: 'Module 1: Introduction to PBL',
                         description: 'Understand the core principles...',
                         lessons: [
                             { id: 'lesson1', title: 'What is PBL?' },
                             { id: 'lesson2', title: 'Why PBL in STEM?' },
                             { id: 'lesson3', title: 'Research & Evidence' }
                         ]
                     },
                      module2: {
                         title: 'Module 2: Designing Your First PBL Unit',
                         description: 'Learn practical steps...',
                         lessons: [
                             { id: 'lesson4', title: 'Defining Project Goals' },
                             { id: 'lesson5', title: 'Crafting the Driving Question' },
                             { id: 'lesson6', title: 'Scaffolding Student Work' }
                         ]
                     }
                     // ... add data for other modules
                 };

                 const currentModule = moduleData[moduleId];

                 if (currentModule) {
                     moduleDetailHeading.textContent = currentModule.title;
                     // Update description if needed (add a p tag in HTML for it)
                     // moduleDetailSection.querySelector('p').textContent = currentModule.description;

                     // Populate lesson list
                     lessonList.innerHTML = ''; // Clear existing lessons
                     currentModule.lessons.forEach((lesson, index) => {
                         const listItem = document.createElement('li');
                         const link = document.createElement('a');
                         link.href = `#${lesson.id}`;
                         link.textContent = `Lesson ${index + 1}: ${lesson.title}`;
                         link.setAttribute('data-lesson-id', lesson.id);
                         link.setAttribute('aria-label', `Go to ${lesson.title}`);
                         link.setAttribute('tabindex', '0'); // Make lesson links focusable

                         // Add event listener to load lesson content
                         link.addEventListener('click', (e) => {
                             e.preventDefault();
                             loadLessonContent(lesson.id); // Load content for clicked lesson
                             // Update active lesson link
                             lessonList.querySelectorAll('a').forEach(a => a.classList.remove('active-lesson'));
                             link.classList.add('active-lesson');
                         });
                          link.addEventListener('keypress', (e) => {
                              if (e.key === 'Enter' || e.key === ' ') {
                                  e.preventDefault();
                                  link.click();
                              }
                          });

                         listItem.appendChild(link);
                         lessonList.appendChild(listItem);
                     });

                     // Load the first lesson by default
                     if (currentModule.lessons.length > 0) {
                         loadLessonContent(currentModule.lessons[0].id);
                         lessonList.querySelector('a').classList.add('active-lesson');
                     }
                 } else {
                     moduleDetailHeading.textContent = 'Module Not Found';
                     lessonList.innerHTML = '<li>No lessons available.</li>';
                     document.getElementById('lesson-content-area').innerHTML = '<div class="lesson-content"><p>Please select a module from the list.</p></div>';
                 }
             }

             function loadLessonContent(lessonId) {
                 console.log(`Loading content for lesson: ${lessonId}`);
                 const lessonContentArea = document.getElementById('lesson-content-area');

                 // Simulate fetching lesson content
                 const lessonContentData = {
                     lesson1: {
                         title: 'What is PBL?',
                         videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ', // Example video
                         text: '<p>This lesson introduces the fundamental concepts of Project-Based Learning...</p><p>PBL is an instructional approach...</p>',
                         interactive: '<div class="interactive-element"><h4>Quick Check</h4><p>What are the key differences between PBL and traditional projects?</p><textarea rows="3" placeholder="Your thoughts..."></textarea></div>'
                     },
                      lesson2: {
                         title: 'Why PBL in STEM?',
                         videoUrl: 'https://www.youtube.com/embed/some_other_video_id', // Another example
                         text: '<p>PBL is particularly effective in STEM education because it mirrors real-world scientific and engineering practices...</p>',
                         interactive: '' // No interactive element for this lesson
                     }
                     // ... add content for other lessons
                 };

                 const currentLesson = lessonContentData[lessonId];

                 if (currentLesson) {
                     lessonContentArea.innerHTML = `
                         <div class="lesson-content">
                             <h3>${currentLesson.title}</h3>
                             ${currentLesson.videoUrl ? `
                                 <div class="video-container">
                                     <iframe src="${currentLesson.videoUrl}" frameborder="0" allowfullscreen title="Lesson Video"></iframe>
                                 </div>
                             ` : ''}
                             ${currentLesson.text}
                             ${currentLesson.interactive}
                             <div class="button-container" style="text-align: left;">
                                <button class="button mark-complete-button" aria-label="Mark lesson as complete">Mark as Complete</button>
                             </div>
                         </div>
                     `;

                     // Add event listener for the "Mark as Complete" button
                     const markCompleteButton = lessonContentArea.querySelector('.mark-complete-button');
                     if (markCompleteButton) {
                         markCompleteButton.addEventListener('click', () => {
                             console.log(`Lesson ${lessonId} marked as complete`);
                             alert(`Lesson "${currentLesson.title}" marked as complete! (Placeholder)`);
                             // In a real app, update user progress via backend
                         });
                     }

                 } else {
                     lessonContentArea.innerHTML = '<div class="lesson-content"><p>Lesson content not found.</p></div>';
                 }
             }

        });


    </script>
</body>
</html>
