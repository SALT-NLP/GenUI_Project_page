<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curriculum Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --primary-color: #4CAF50; /* Nature-inspired green */
            --primary-dark: #388E3C;
            --primary-light: #C8E6C9;
            --secondary-color: #2196F3; /* Engaging blue */
            --secondary-dark: #1976D2;
            --secondary-light: #BBDEFB;
            --background-color: #f4f6f8; /* Light background */
            --surface-color: #ffffff; /* Card/panel background */
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --error-color: #F44336;
            --spacing-unit: 8px;
            --focus-outline-color: rgba(33, 150, 243, 0.4); /* Secondary color with transparency */
             --focus-outline-width: 3px;
             --focus-outline-offset: 2px;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
            overflow: hidden; /* Prevent body scroll when panels are open */
            font-size: 16px; /* Base font size */
        }

        /* Ensure focus states are visible */
        *:focus-visible {
             outline: var(--focus-outline-width) solid var(--focus-outline-color);
             outline-offset: var(--focus-outline-offset);
        }

        .material-symbols-rounded {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24;
            vertical-align: middle; /* Align icons nicely */
        }

        .app-container {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 240px;
            background-color: var(--surface-color);
            box-shadow: 2px 0 8px var(--shadow-color);
            padding: calc(var(--spacing-unit) * 2) 0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            z-index: 100; /* Ensure sidebar is above content */
        }

        .sidebar-header {
            padding: 0 calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 4);
            font-size: 1.3em;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin-bottom: var(--spacing-unit);
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            color: var(--text-secondary);
            text-decoration: none;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-left: 4px solid transparent;
            font-size: 1em;
            outline-offset: -4px; /* Adjust outline for border */
        }

        .sidebar-nav a .material-symbols-rounded {
             margin-right: var(--spacing-unit);
             font-size: 20px;
        }

        .sidebar-nav a:hover {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .sidebar-nav a.active {
            background-color: var(--primary-light);
            color: var(--primary-dark);
            border-left-color: var(--primary-color);
            font-weight: 500;
        }

        /* Main Content Area */
        .content-area {
            flex-grow: 1;
            padding: calc(var(--spacing-unit) * 3);
            overflow-y: auto; /* Allow scrolling within the content area */
            display: flex;
            flex-direction: column;
            position: relative; /* Needed for global actions positioning */
        }

        /* Dashboard View */
        .dashboard-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Increased min width */
            gap: calc(var(--spacing-unit) * 3);
        }

        .dashboard-card {
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 2px 6px var(--shadow-color);
            padding: calc(var(--spacing-unit) * 3);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border-color); /* Subtle border */
            outline-offset: var(--focus-outline-offset);
        }

        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        .dashboard-card h3 {
            margin-top: 0;
            margin-bottom: var(--spacing-unit);
            font-size: 1.2em;
            color: var(--primary-dark);
        }

        .dashboard-card p {
            font-size: 0.95em;
            color: var(--text-secondary);
            margin-bottom: calc(var(--spacing-unit) * 2);
            flex-grow: 1;
        }

        .dashboard-card-progress {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-unit) * 2;
        }

        .dashboard-card-progress-bar {
            height: 10px; /* Slightly thicker progress bar */
            background-color: var(--background-color);
            border-radius: 5px;
            overflow: hidden;
            margin-top: var(--spacing-unit);
        }

        .dashboard-card-progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%; /* Example: will be set by JS */
            transition: width 0.4s ease;
        }

        .dashboard-card-actions {
            display: flex;
            gap: var(--spacing-unit);
            margin-top: auto; /* Push actions to the bottom */
            flex-wrap: wrap; /* Allow wrapping */
        }

        .btn {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.2s ease, opacity 0.2s ease, box-shadow 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: calc(var(--spacing-unit) / 2);
            font-weight: 500;
            text-decoration: none; /* For anchor buttons */
            outline-offset: var(--focus-outline-offset);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 1px 4px rgba(76, 175, 80, 0.4);
        }
         .btn-primary:active {
             background-color: var(--primary-dark);
         }


        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
             box-shadow: 0 1px 4px rgba(33, 150, 243, 0.4);
        }
         .btn-secondary:active {
             background-color: var(--secondary-dark);
         }

        .btn-outline {
            background-color: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-outline:hover {
            background-color: var(--background-color);
            color: var(--text-color);
        }
         .btn-outline:active {
             background-color: var(--border-color);
         }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Editor View */
        .editor-view {
            display: flex;
            gap: calc(var(--spacing-unit) * 3);
            flex-grow: 1;
        }

        .curriculum-structure {
            flex-basis: 380px; /* Increased initial width */
            flex-shrink: 0;
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 2px 6px var(--shadow-color);
            padding: calc(var(--spacing-unit) * 2);
            overflow-y: auto;
            max-height: calc(100vh - calc(var(--spacing-unit) * 6) - 60px); /* Adjust based on global actions */
            display: flex;
            flex-direction: column;
        }

        .curriculum-structure h3 {
             margin-top: 0;
             margin-bottom: calc(var(--spacing-unit) * 2);
             color: var(--primary-dark);
             font-size: 1.2em;
             display: flex;
             align-items: center;
             gap: var(--spacing-unit);
             border-bottom: 1px solid var(--border-color);
             padding-bottom: var(--spacing-unit);
        }

        .curriculum-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1; /* Allow list to fill space */
        }

        .curriculum-item {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            margin-bottom: var(--spacing-unit);
            background-color: var(--background-color);
            border-radius: 4px;
            cursor: grab; /* Indicate draggable */
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
            position: relative;
            border: 1px solid var(--border-color);
            font-size: 1em;
            outline-offset: var(--focus-outline-offset);
        }

        .curriculum-item.dragging {
             opacity: 0.5;
             box-shadow: 0 4 errrrpx 10px var(--shadow-color);
        }

        .curriculum-item:hover {
             background-color: #e9ecef;
             box-shadow: 0 1px 3px var(--shadow-color);
        }

        .curriculum-item.active {
            background-color: var(--secondary-light);
            border-color: var(--secondary-color);
            box-shadow: 0 1px 4px rgba(33, 150, 243, 0.2);
        }

        .curriculum-item-icon {
            font-size: 20px; /* Slightly larger icons */
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .curriculum-item-title {
            flex-grow: 1;
            font-size: 1em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

         .curriculum-item-indicators {
             display: flex;
             gap: calc(var(--spacing-unit) / 2);
             flex-shrink: 0;
         }

         .curriculum-item-indicators .material-symbols-rounded {
             font-size: 16px; /* Smaller indicator icons */
             color: var(--text-secondary);
         }

        .curriculum-item-actions {
            display: flex;
            gap: calc(var(--spacing-unit) / 2);
            opacity: 0; /* Hide actions by default */
            transition: opacity 0.2s ease;
            flex-shrink: 0;
        }

        .curriculum-item:hover .curriculum-item-actions,
        .curriculum-item.active .curriculum-item-actions,
        .curriculum-item:focus-within .curriculum-item-actions { /* Show actions when item or its children are focused */
             opacity: 1; /* Show actions on hover/active/focus-within */
        }

        .curriculum-item-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: calc(var(--spacing-unit) / 2);
            border-radius: 4px;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary); /* Default icon color */
            outline-offset: 2px;
        }

        .curriculum-item-actions button:hover {
            background-color: var(--border-color);
        }

        .curriculum-item-actions button:active {
             background-color: #d0d0d0;
        }


        .curriculum-item-actions .material-symbols-rounded {
            font-size: 18px;
        }

        .curriculum-item-actions .delete-btn .material-symbols-rounded {
            color: var(--error-color);
        }


        /* Indentation for hierarchy */
        .curriculum-list .module > .curriculum-list {
            padding-left: calc(var(--spacing-unit) * 3); /* Increased indentation */
            border-left: 1px dashed var(--border-color);
            margin-left: calc(var(--spacing-unit) * 3);
            margin-top: var(--spacing-unit); /* Add space above nested list */
        }
         .curriculum-list .lesson > .curriculum-list {
            padding-left: calc(var(--spacing-unit) * 3); /* Increased indentation */
            border-left: 1px dashed var(--border-color);
            margin-left: calc(var(--spacing-unit) * 3);
            margin-top: var(--spacing-unit); /* Add space above nested list */
        }

        .add-element-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px; /* Slightly larger button */
            height: 36px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            margin-left: var(--spacing-unit);
            flex-shrink: 0;
            outline-offset: var(--focus-outline-offset);
        }

        .add-element-button:hover {
            background-color: var(--primary-dark);
             box-shadow: 0 1px 4px rgba(76, 175, 80, 0.4);
        }
         .add-element-button:active {
             background-color: var(--primary-dark);
         }

        /* Editor Panel */
        .editor-panel {
            flex-grow: 1;
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 2px 6px var(--shadow-color);
            padding: calc(var(--spacing-unit) * 3);
            overflow-y: auto;
            max-height: calc(100vh - calc(var(--spacing-unit) * 6) - 60px); /* Adjust based on global actions */
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: calc(var(--spacing-unit) * 2);
        }

        .editor-panel.visible {
            display: flex;
        }

        .editor-panel h3 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            color: var(--secondary-dark);
            font-size: 1.3em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--spacing-unit);
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 1em;
        }

        .form-group input[type="text"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: var(--spacing-unit) 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: inherit;
            font-size: 1em;
            color: var(--text-color);
            background-color: var(--background-color);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            outline-offset: var(--focus-outline-offset);
        }

        .form-group input[type="text"]:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 var(--focus-outline-width) rgba(76, 175, 80, 0.2);
        }

         .form-group input.error,
         .form-group textarea.error,
         .form-group select.error {
             border-color: var(--error-color);
         }

        .form-group textarea {
            min-height: 150px; /* Simulate rich text editor area */
            resize: vertical;
        }

        /* Simulate Rich Text Editor */
        .rich-text-editor-placeholder {
             border: 1px solid var(--border-color);
             border-radius: 4px;
             padding: var(--spacing-unit) 12px; /* Match input padding */
             background-color: var(--background-color);
             min-height: 150px;
             font-size: 1em;
             color: var(--text-color);
             cursor: text;
             transition: border-color 0.2s ease, box-shadow 0.2s ease;
             outline-offset: var(--focus-outline-offset);
        }

        .rich-text-editor-placeholder:focus {
             outline: none;
             border-color: var(--primary-color);
             box-shadow: 0 0 0 var(--focus-outline-width) rgba(76, 175, 80, 0.2);
        }

         .rich-text-editor-placeholder.error {
             border-color: var(--error-color);
         }


        /* Content Type Selector */
        .content-type-selector {
            display: flex;
            gap: var(--spacing-unit);
            margin-bottom: calc(var(--spacing-unit) * 2);
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .content-type-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--background-color);
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            min-width: 70px; /* Ensure minimum size */
            text-align: center;
            outline-offset: var(--focus-outline-offset);
        }

        .content-type-button:hover {
             background-color: #e9ecef;
        }

        .content-type-button.selected {
             background-color: var(--secondary-light);
             border-color: var(--secondary-color);
             color: var(--secondary-dark);
        }

        .content-type-button .material-symbols-rounded {
            font-size: 28px; /* Larger icons */
            margin-bottom: calc(var(--spacing-unit) / 2);
        }

        .content-type-button span {
            font-size: 0.9em;
            font-weight: 500;
        }

        /* Dynamic Content Fields Placeholder */
        .dynamic-content-fields {
            border: 1px dashed var(--border-color);
            padding: calc(var(--spacing-unit) * 2);
            background-color: var(--background-color);
            border-radius: 4px;
            margin-top: var(--spacing-unit);
            color: var(--text-secondary);
            font-size: 0.9em;
        }


        /* Standards Alignment Placeholder */
        .standards-alignment-placeholder {
            border: 1px dashed var(--border-color);
            padding: calc(var(--spacing-unit) * 2);
            background-color: var(--background-color);
            border-radius: 4px;
            text-align: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: background-color 0.2s ease;
            outline-offset: var(--focus-outline-offset);
        }

        .standards-alignment-placeholder:hover {
            background-color: #e9ecef;
        }

        /* Engagement Strategies & Accessibility/Tech Notes (Expandable sections) */
        .collapsible-section {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: calc(var(--spacing-unit) * 2);
            overflow: hidden;
        }

        .collapsible-header {
            padding: calc(var(--spacing-unit) * 1.5);
            background-color: var(--background-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            color: var(--text-color);
            transition: background-color 0.2s ease;
            outline-offset: -1px; /* Adjust outline for border */
        }

        .collapsible-header:hover {
             background-color: #e9ecef;
        }

        .collapsible-header .material-symbols-rounded {
            transition: transform 0.3s ease;
        }

        .collapsible-header.collapsed .material-symbols-rounded {
            transform: rotate(0deg);
        }

        .collapsible-header:not(.collapsed) .material-symbols-rounded {
            transform: rotate(180deg);
        }

        .collapsible-content {
            padding: calc(var(--spacing-unit) * 1.5);
            border-top: 1px solid var(--border-color);
            display: none; /* Hidden by default */
        }

        .collapsible-content.expanded {
            display: block;
        }

        .suggestion-item, .checklist-item {
            margin-bottom: var(--spacing-unit);
            font-size: 0.95em;
            color: var(--text-secondary);
        }

        .checklist-item label {
             display: flex;
             align-items: center;
             gap: var(--spacing-unit);
             cursor: pointer;
             outline-offset: var(--focus-outline-offset);
        }

        .checklist-item input[type="checkbox"] {
             margin: 0;
             width: 18px; /* Slightly larger checkbox */
             height: 18px;
             flex-shrink: 0;
        }


        /* Resource Library Placeholder */
        .resource-library-placeholder {
             border: 1px dashed var(--border-color);
             padding: calc(var(--spacing-unit) * 2);
             background-color: var(--background-color);
             border-radius: 4px;
             text-align: center;
             color: var(--text-secondary);
             margin-top: calc(var(--spacing-unit) * 2);
             cursor: pointer; /* Indicate interactivity */
             transition: background-color 0.2s ease;
             outline-offset: var(--focus-outline-offset);
        }
         .resource-library-placeholder:hover {
             background-color: #e9ecef;
         }


        /* Global Action Buttons (Simulated Header/Footer) */
        .global-actions {
            padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 3);
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: calc(var(--spacing-unit) * 2);
            flex-shrink: 0;
            position: sticky; /* Stick to bottom */
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50; /* Ensure above content, below sidebar */
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        /* Drag and Drop styles */
        .curriculum-item.drag-over {
             border-top: 2px solid var(--secondary-color); /* Indicate drop target before */
        }
         .curriculum-item.drag-over-bottom {
             border-bottom: 2px solid var(--secondary-color); /* Indicate drop target after */
         }

         .curriculum-item.drag-over-indent {
             box-shadow: inset 4px 0 0 var(--secondary-color); /* Indicate drop as child */
         }

        /* Placeholder styles for other views */
        .resources-view, .settings-view {
            padding: calc(var(--spacing-unit) * 3);
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 2px 6px var(--shadow-color);
        }
         .resources-view h2, .settings-view h2 {
             margin-top: 0;
             color: var(--primary-dark);
             font-size: 1.5em;
             border-bottom: 1px solid var(--border-color);
             padding-bottom: var(--spacing-unit);
             margin-bottom: calc(var(--spacing-unit) * 2);
         }
         .resources-view p, .settings-view p {
             color: var(--text-secondary);
         }


        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .sidebar {
                width: 60px; /* Collapse sidebar */
                padding: calc(var(--spacing-unit) * 2) 0;
            }
            .sidebar-header {
                display: none; /* Hide header */
            }
            .sidebar-nav a {
                justify-content: center;
                padding: var(--spacing-unit);
                border-left: none;
                border-bottom: 4px solid transparent; /* Use bottom border for active */
            }
            .sidebar-nav a span {
                margin-right: 0; /* Remove text margin */
            }
             .sidebar-nav a span:last-child {
                 display: none; /* Hide text labels */
             }
             .sidebar-nav a.active {
                 border-left-color: transparent;
                 border-bottom-color: var(--primary-color);
                 background-color: var(--primary-light);
             }

            .content-area {
                padding: calc(var(--spacing-unit) * 2);
            }

            .editor-view {
                flex-direction: column; /* Stack structure and panel */
                gap: calc(var(--spacing-unit) * 2);
            }

            .curriculum-structure,
            .editor-panel {
                 flex-basis: auto; /* Remove fixed basis */
                 width: 100%; /* Take full width */
                 max-height: none; /* Remove max height for stacking */
            }

            .global-actions {
                flex-direction: column; /* Stack buttons */
                gap: var(--spacing-unit);
                padding: var(--spacing-unit) * 2;
                 position: static; /* Don't stick on small screens */
            }

            .btn {
                width: 100%; /* Full width buttons */
                justify-content: center;
            }

            .dashboard-view {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjust min width */
            }

             .content-type-selector {
                 gap: calc(var(--spacing-unit) / 2); /* Reduce gap on smaller screens */
             }

             .content-type-button {
                 min-width: 50px;
                 padding: calc(var(--spacing-unit) / 2);
             }
             .content-type-button .material-symbols-rounded {
                 font-size: 24px;
             }
             .content-type-button span {
                 font-size: 0.75em;
             }
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">Curriculum Builder</div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="#" data-view="dashboard" class="active" aria-label="Dashboard">
                            <span class="material-symbols-rounded">dashboard</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-view="editor" aria-label="Curriculum Editor">
                            <span class="material-symbols-rounded">edit</span>
                            <span>Curriculum Editor</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-view="resources" aria-label="Resources Library">
                             <span class="material-symbols-rounded">folder_open</span>
                            <span>Resources</span>
                        </a>
                    </li>
                     <li>
                        <a href="#" data-view="settings" aria-label="Settings">
                            <span class="material-symbols-rounded">settings</span>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="content-area" role="main">
            <!-- Dashboard View -->
            <section class="dashboard-view" id="dashboardView" aria-labelledby="dashboardHeading">
                <h2 id="dashboardHeading" class="hidden">Dashboard</h2>
                <div class="dashboard-card" role="region" aria-label="Course: Environmental Science Fundamentals" tabindex="0">
                    <h3>Environmental Science Fundamentals</h3>
                    <p>Introduction to key ecological concepts and systems.</p>
                     <div class="dashboard-card-progress">
                        Standards Alignment: 75%
                        <div class="dashboard-card-progress-bar" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                            <div class="dashboard-card-progress-fill" style="width: 75%;"></div>
                        </div>
                    </div>
                    <div class="dashboard-card-actions">
                        <button class="btn btn-primary edit-course-btn" data-course-id="1" aria-label="Edit Environmental Science Fundamentals">
                             <span class="material-symbols-rounded" aria-hidden="true">edit</span>
                            Edit
                        </button>
                        <button class="btn btn-outline" aria-label="Preview Environmental Science Fundamentals">
                             <span class="material-symbols-rounded" aria-hidden="true">visibility</span>
                            Preview
                        </button>
                        <button class="btn btn-outline" aria-label="Export Environmental Science Fundamentals">
                             <span class="material-symbols-rounded" aria-hidden="true">download</span>
                            Export
                        </button>
                    </div>
                </div>
                 <div class="dashboard-card" role="region" aria-label="Course: Sustainable Practices in Daily Life" tabindex="0">
                    <h3>Sustainable Practices in Daily Life</h3>
                    <p>Exploring practical ways to reduce environmental impact.</p>
                     <div class="dashboard-card-progress">
                        Standards Alignment: 40%
                        <div class="dashboard-card-progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">
                            <div class="dashboard-card-progress-fill" style="width: 40%;"></div>
                        </div>
                    </div>
                    <div class="dashboard-card-actions">
                        <button class="btn btn-primary edit-course-btn" data-course-id="2" aria-label="Edit Sustainable Practices in Daily Life">
                            <span class="material-symbols-rounded" aria-hidden="true">edit</span>
                            Edit
                        </button>
                        <button class="btn btn-outline" aria-label="Preview Sustainable Practices in Daily Life">
                             <span class="material-symbols-rounded" aria-hidden="true">visibility</span>
                            Preview
                        </button>
                        <button class="btn btn-outline" aria-label="Export Sustainable Practices in Daily Life">
                             <span class="material-symbols-rounded" aria-hidden="true">download</span>
                            Export
                        </button>
                    </div>
                </div>
                 <div class="dashboard-card" role="region" aria-label="Course: Climate Change: Science & Solutions" tabindex="0">
                    <h3>Climate Change: Science & Solutions</h3>
                    <p>Understanding the causes and consequences of climate change.</p>
                     <div class="dashboard-card-progress">
                        Standards Alignment: 90%
                        <div class="dashboard-card-progress-bar" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100">
                            <div class="dashboard-card-progress-fill" style="width: 90%;"></div>
                        </div>
                    </div>
                    <div class="dashboard-card-actions">
                        <button class="btn btn-primary edit-course-btn" data-course-id="3" aria-label="Edit Climate Change: Science & Solutions">
                             <span class="material-symbols-rounded" aria-hidden="true">edit</span>
                            Edit
                        </button>
                        <button class="btn btn-outline" aria-label="Preview Climate Change: Science & Solutions">
                             <span class="material-symbols-rounded" aria-hidden="true">visibility</span>
                            Preview
                        </button>
                        <button class="btn btn-outline" aria-label="Export Climate Change: Science & Solutions">
                             <span class="material-symbols-rounded" aria-hidden="true">download</span>
                            Export
                        </button>
                    </div>
                </div>
                <!-- Add New Course Card -->
                 <div class="dashboard-card create-new-course-card" style="border: 2px dashed var(--border-color); text-align: center; display: flex; justify-content: center; align-items: center; cursor: pointer; background-color: var(--background-color);" role="button" aria-label="Create New Course" tabindex="0">
                    <button class="btn btn-primary" style="font-size: 1em; padding: calc(var(--spacing-unit) * 2);" aria-hidden="true" tabindex="-1">
                         <span class="material-symbols-rounded" aria-hidden="true">add</span>
                        Create New Course
                    </button>
                </div>
            </section>

            <!-- Editor View -->
            <section class="editor-view hidden" id="editorView" aria-labelledby="editorHeading">
                 <h2 id="editorHeading" class="hidden">Curriculum Editor</h2>
                <!-- Curriculum Structure Tree/List -->
                <div class="curriculum-structure" role="navigation" aria-label="Curriculum Structure">
                    <h3>
                         <span class="material-symbols-rounded" aria-hidden="true">account_tree</span>
                        Curriculum Structure
                         <button class="add-element-button" data-type="module" title="Add Module" aria-label="Add Module">
                             <span class="material-symbols-rounded" aria-hidden="true">add</span>
                         </button>
                    </h3>
                    <ul class="curriculum-list" id="curriculumList" role="tree">
                        <!-- Structure items will be added here -->
                    </ul>
                </div>

                <!-- Content Editor Panel -->
                <div class="editor-panel" id="editorPanel" role="form" aria-labelledby="elementDetailsHeading" aria-hidden="true">
                    <h3 id="elementDetailsHeading">
                         <span class="material-symbols-rounded" aria-hidden="true">description</span>
                        Element Details
                    </h3>

                    <div class="form-group">
                        <label for="elementType">Element Type</label>
                        <input type="text" id="elementType" value="Module" readonly aria-readonly="true">
                    </div>

                    <div class="form-group">
                        <label for="elementTitle">Title</label>
                        <input type="text" id="elementTitle" placeholder="Enter title" required aria-required="true">
                         <div class="error-message hidden" aria-live="polite">Title is required.</div>
                    </div>

                    <div class="form-group">
                        <label for="elementDescription">Description</label>
                        <!-- Simulate Rich Text Editor -->
                        <div id="elementDescription" class="rich-text-editor-placeholder" contenteditable="true" placeholder="Enter description..." role="textbox" aria-multiline="true" aria-labelledby="elementDescriptionLabel"></div>
                         <label id="elementDescriptionLabel" class="hidden" for="elementDescription">Description</label>
                         <div class="error-message hidden" aria-live="polite">Description is required.</div>
                    </div>

                    <!-- Activity-specific fields -->
                    <div class="activity-fields">
                        <div class="form-group">
                            <label>Content Type</label>
                            <div class="content-type-selector" role="radiogroup" aria-label="Select Content Type">
                                <button class="content-type-button selected" data-type="text" aria-pressed="true" role="radio" title="Text Content">
                                    <span class="material-symbols-rounded" aria-hidden="true">article</span>
                                    <span>Text</span>
                                </button>
                                <button class="content-type-button" data-type="video" aria-pressed="false" role="radio" title="Video Content">
                                     <span class="material-symbols-rounded" aria-hidden="true">videocam</span>
                                    <span>Video</span>
                                </button>
                                <button class="content-type-button" data-type="quiz" aria-pressed="false" role="radio" title="Quiz/Assessment">
                                     <span class="material-symbols-rounded" aria-hidden="true">quiz</span>
                                    <span>Quiz</span>
                                </button>
                                 <button class="content-type-button" data-type="simulation" aria-pressed="false" role="radio" title="Simulation/Interactive">
                                     <span class="material-symbols-rounded" aria-hidden="true">science</span>
                                    <span>Sim</span>
                                </button>
                                <button class="content-type-button" data-type="project" aria-pressed="false" role="radio" title="Project/Hands-on Activity">
                                     <span class="material-symbols-rounded" aria-hidden="true">build</span>
                                    <span>Project</span>
                                </button>
                                <button class="content-type-button" data-type="discussion" aria-pressed="false" role="radio" title="Discussion/Collaboration">
                                     <span class="material-symbols-rounded" aria-hidden="true">chat</span>
                                    <span>Discuss</span>
                                </button>
                            </div>
                        </div>

                         <!-- Placeholder for dynamic fields based on Content Type -->
                         <div class="dynamic-content-fields">
                             Dynamic fields for selected content type will appear here. (e.g., Video URL, Quiz questions, Simulation link, Project instructions, Discussion prompt)
                         </div>

                        <div class="form-group">
                            <label>Standards Alignment</label>
                            <div class="standards-alignment-placeholder" role="button" aria-label="Link State Standards" tabindex="0">
                                 <span class="material-symbols-rounded" aria-hidden="true">link</span>
                                Click to search and link standards
                            </div>
                             <!-- Linked standards list would go here -->
                        </div>

                        <div class="collapsible-section">
                            <div class="collapsible-header collapsed" role="button" aria-expanded="false" tabindex="0">
                                Engagement Strategies
                                 <span class="material-symbols-rounded" aria-hidden="true">expand_more</span>
                            </div>
                            <div class="collapsible-content" aria-hidden="true">
                                <p class="suggestion-item">Idea: Incorporate a local environmental case study relevant to students.</p>
                                <p class="suggestion-item">Tip: Use interactive polls or quizzes to check understanding.</p>
                                <p class="suggestion-item">Suggestion: Add a short video from a relevant expert or activist.</p>
                            </div>
                        </div>

                         <div class="collapsible-section">
                            <div class="collapsible-header collapsed" role="button" aria-expanded="false" tabindex="0">
                                Accessibility & Technology Notes
                                 <span class="material-symbols-rounded" aria-hidden="true">expand_more</span>
                            </div>
                            <div class="collapsible-content" aria-hidden="true">
                                <div class="checklist-item">
                                    <label>
                                        <input type="checkbox" data-checklist="low-bandwidth" aria-label="Low-bandwidth option available for this content?">
                                        Low-bandwidth option available for this content?
                                    </label>
                                </div>
                                <div class="checklist-item">
                                    <label>
                                        <input type="checkbox" data-checklist="captions" aria-label="Captions added to videos/audio?">
                                        Captions added to videos/audio?
                                    </label>
                                </div>
                                 <div class="checklist-item">
                                    <label>
                                        <input type="checkbox" data-checklist="alt-text" aria-label="Alternative text provided for images?">
                                        Alternative text provided for images?
                                    </label>
                                </div>
                                 <div class="checklist-item">
                                    <label>
                                        <input type="checkbox" data-checklist="screen-reader" aria-label="Content readable with screen readers?">
                                        Content readable with screen readers?
                                    </label>
                                </div>
                            </div>
                        </div>

                         <!-- Resource Library Placeholder -->
                        <div class="resource-library-placeholder" role="button" aria-label="Add Resources from Library" tabindex="0">
                             <span class="material-symbols-rounded" aria-hidden="true">library_add</span>
                            Drag resources from the library here or click to add
                        </div>
                    </div>


                    <!-- Save/Delete Actions for Element -->
                    <div class="form-group" style="margin-top: auto; display: flex; justify-content: flex-end; gap: var(--spacing-unit);">
                         <button class="btn btn-outline delete-element-btn" aria-label="Delete Element">
                            <span class="material-symbols-rounded" aria-hidden="true">delete</span>
                            Delete Element
                        </button>
                        <button class="btn btn-primary save-element-btn" aria-label="Save Element">
                             <span class="material-symbols-rounded" aria-hidden="true">save</span>
                            Save Element
                        </button>
                    </div>

                </div>
            </section>

             <!-- Placeholder for other views -->
             <section class="resources-view hidden" id="resourcesView" aria-labelledby="resourcesHeading" aria-hidden="true">
                 <h2 id="resourcesHeading">Resources Library</h2>
                 <p>Manage your external links, files, and multimedia here.</p>
                  <!-- Resource list/cards would go here -->
             </section>

             <section class="settings-view hidden" id="settingsView" aria-labelledby="settingsHeading" aria-hidden="true">
                 <h2 id="settingsHeading">Settings</h2>
                 <p>Configure application settings.</p>
                  <!-- Settings forms would go here -->
             </section>

        </main>
    </div>

    <!-- Global Actions (Simulated Footer) -->
    <footer class="global-actions" role="contentinfo">
         <button class="btn btn-outline" aria-label="Preview Curriculum">
             <span class="material-symbols-rounded" aria-hidden="true">visibility</span>
            Preview Curriculum
        </button>
        <button class="btn btn-outline" aria-label="Export Curriculum">
             <span class="material-symbols-rounded" aria-hidden="true">download</span>
            Export Curriculum
        </button>
        <button class="btn btn-primary" aria-label="Save Curriculum">
             <span class="material-symbols-rounded" aria-hidden="true">save</span>
            Save Curriculum
        </button>
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebarLinks = document.querySelectorAll('.sidebar-nav a');
            const views = document.querySelectorAll('.content-area > section');
            const editorView = document.getElementById('editorView');
            const editorPanel = document.getElementById('editorPanel');
            const curriculumList = document.getElementById('curriculumList');
            const elementTitleInput = document.getElementById('elementTitle');
            const elementTypeInput = document.getElementById('elementType');
            const elementDescriptionPlaceholder = document.getElementById('elementDescription');
            const activityFieldsContainer = document.querySelector('.activity-fields');
            const collapsibleHeaders = document.querySelectorAll('.collapsible-header');
            const contentTypeButtons = document.querySelectorAll('.content-type-button');
            const accessibilityCheckboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const saveElementBtn = document.querySelector('.save-element-btn');
            const deleteElementBtn = document.querySelector('.delete-element-btn');
            const addModuleButton = document.querySelector('.curriculum-structure .add-element-button');
            const createNewCourseCard = document.querySelector('.create-new-course-card');
            const dashboardCards = document.querySelectorAll('.dashboard-card:not(.create-new-course-card)');


            let currentView = 'dashboard';
            let selectedCurriculumElement = null; // Store the currently selected element data
            let draggingElement = null; // Store the element being dragged

            // --- Initial Data Structure (Simulated) ---
            // This would typically come from a backend or local storage
            const curriculumData = [
                {
                    id: 'mod-1', type: 'module', title: 'Module 1: Ecosystem Basics', description: 'Understanding local ecosystems.',
                    children: [
                        {
                            id: 'lesson-1-1', type: 'lesson', title: 'Lesson 1.1: What is an Ecosystem?', description: 'Key components and interactions.',
                            children: [
                                { id: 'activity-1-1-1', type: 'activity', title: 'Activity 1.1.1: Local Park Observation', description: 'Field trip or virtual tour.', contentType: 'project', standards: ['std-1.1', 'std-1.2'], engagement: ['local case study'], accessibility: ['alt-text', 'screen-reader'] },
                                { id: 'activity-1-1-2', type: 'activity', title: 'Activity 1.1.2: Food Web Simulation', description: 'Interactive simulation.', contentType: 'simulation', standards: ['std-1.3'], engagement: ['interactive'], accessibility: ['low-bandwidth'] },
                            ]
                        },
                         {
                            id: 'lesson-1-2', type: 'lesson', title: 'Lesson 1.2: Energy Flow', description: 'Producers, consumers, decomposers.',
                            children: [
                                { id: 'activity-1-2-1', type: 'activity', title: 'Activity 1.2.1: Energy Pyramid Quiz', description: 'Quick quiz on energy flow.', contentType: 'quiz', standards: ['std-1.4'], engagement: ['interactive'], accessibility: [] },
                            ]
                        }
                    ]
                },
                 {
                    id: 'mod-2', type: 'module', title: 'Module 2: Human Impact', description: 'How human activities affect the environment.',
                    children: []
                 }
            ];

             // --- Helper Functions ---
             function generateUniqueId(type) {
                 return `${type}-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;
             }

            function getElementIcon(type) {
                switch (type) {
                    case 'module': return 'folder';
                    case 'lesson': return 'menu_book';
                    case 'activity': return 'assignment';
                    default: return 'help_outline';
                }
            }

             function getIndicatorIcons(item) {
                 const icons = [];
                 if (item.type === 'activity') {
                     if (item.standards && item.standards.length > 0) {
                         icons.push('<span class="material-symbols-rounded" title="Standards Linked">rule</span>');
                     }
                     if (item.accessibility && item.accessibility.length > 0) {
                          icons.push('<span class="material-symbols-rounded" title="Accessibility Notes Added">accessible</span>');
                     }
                     // Add more indicators based on data (e.g., engagement, resources, content type)
                      switch(item.contentType) {
                          case 'video': icons.push('<span class="material-symbols-rounded" title="Content Type: Video">videocam</span>'); break;
                          case 'quiz': icons.push('<span class="material-symbols-rounded" title="Content Type: Quiz">quiz</span>'); break;
                           case 'simulation': icons.push('<span class="material-symbols-rounded" title="Content Type: Simulation">science</span>'); break;
                           case 'project': icons.push('<span class="material-symbols-rounded" title="Content Type: Project">build</span>'); break;
                           case 'discussion': icons.push('<span class="material-symbols-rounded" title="Content Type: Discussion">chat</span>'); break;
                          default: icons.push('<span class="material-symbols-rounded" title="Content Type: Text">article</span>'); break;
                      }
                 }
                 return icons.join('');
             }


            function getChildType(parentType) {
                 switch (parentType) {
                    case 'module': return 'Lesson';
                    case 'lesson': return 'Activity';
                    default: return null; // Cannot add children to Activity
                }
            }

            function findElementById(id, items) {
                for (const item of items) {
                    if (item.id === id) {
                        return item;
                    }
                    if (item.children) {
                        const found = findElementById(id, item.children);
                        if (found) {
                            return found;
                        }
                    }
                }
                return null;
            }

             function findElementAndParent(id, items, parent = null, parentList = null) {
                 for (let i = 0; i < items.length; i++) {
                     if (items[i].id === id) {
                         return { element: items[i], parent: parent, parentList: parentList, index: i };
                     }
                     if (items[i].children) {
                         const found = findElementAndParent(id, items[i].children, items[i], items[i].children);
                         if (found) {
                             return found;
                         }
                     }
                 }
                 return null;
             }


             function updateElementById(id, newData, items) {
                 for (let i = 0; i < items.length; i++) {
                     if (items[i].id === id) {
                        // Merge properties, don't replace the whole object reference
                        // This helps maintain array references if needed elsewhere
                        Object.assign(items[i], newData);
                        return true;
                    }
                    if (items[i].children && updateElementById(id, newData, items[i].children)) {
                        return true;
                    }
                 }
                 return false;
             }

             function addElement(parentId, type) {
                 const parentElementInfo = parentId ? findElementAndParent(parentId, curriculumData) : { element: { children: curriculumData }, parentList: curriculumData, index: -1 };
                 const parentElement = parentElementInfo ? parentElementInfo.element : null;
                 const parentList = parentElementInfo ? parentElementInfo.parentList : curriculumData;


                 if (!parentElement || !parentList) {
                     console.error("Cannot add element: Parent not found or invalid.");
                     return;
                 }

                 // Prevent adding invalid child types
                 if (parentId && parentElement.type === 'activity') {
                     console.warn("Cannot add children to an activity.");
                     return;
                 }
                 if (parentId && parentElement.type === 'module' && type === 'activity') {
                     console.warn("Cannot add an activity directly to a module. Add lessons first.");
                     return;
                 }
                  if (!parentId && type !== 'module') {
                      console.warn("Can only add modules at the top level.");
                      return;
                  }
                 if (parentId && parentElement.type === 'lesson' && type === 'lesson') {
                     console.warn("Cannot add a lesson directly to a lesson. Add activities.");
                     return;
                 }


                 const newId = generateUniqueId(type);
                 const newElement = {
                    id: newId,
                    type: type,
                    title: `New ${type.charAt(0).toUpperCase() + type.slice(1)}`,
                    description: '',
                    children: type !== 'activity' ? [] : undefined, // Activities don't have children
                    contentType: type === 'activity' ? 'text' : undefined, // Activities have content type
                    standards: [],
                    engagement: [],
                    accessibility: []
                 };

                 // Add to the correct children array
                 if (parentId) {
                     parentElement.children.push(newElement);
                 } else {
                     curriculumData.push(newElement); // Add to root if no parentId
                 }


                 renderCurriculumStructure(curriculumData, curriculumList); // Re-render list
                 selectCurriculumElement(newId); // Select the newly added element
             }

            function deleteElement(id, items) {
                for (let i = 0; i < items.length; i++) {
                    if (items[i].id === id) {
                        items.splice(i, 1);
                        return true;
                    }
                    if (items[i].children && deleteElement(id, items[i].children)) {
                        return true;
                    }
                }
                return false;
            }


            // --- Rendering Functions ---
            function renderCurriculumStructure(items, parentElement) {
                parentElement.innerHTML = ''; // Clear existing list
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.classList.add('curriculum-item', item.type);
                    li.dataset.id = item.id;
                    li.dataset.type = item.type;
                    li.setAttribute('role', item.children ? 'treeitem' : 'listitem'); // ARIA roles
                    li.setAttribute('draggable', true); // Make draggable
                    li.setAttribute('tabindex', 0); // Make list items focusable

                    const iconSpan = document.createElement('span');
                    iconSpan.classList.add('material-symbols-rounded', 'curriculum-item-icon');
                    iconSpan.textContent = getElementIcon(item.type);
                    iconSpan.setAttribute('aria-hidden', true);
                    li.appendChild(iconSpan);

                    const titleSpan = document.createElement('span');
                    titleSpan.classList.add('curriculum-item-title');
                    titleSpan.textContent = item.title;
                    li.appendChild(titleSpan);

                    // Indicators
                    const indicatorsDiv = document.createElement('div');
                    indicatorsDiv.classList.add('curriculum-item-indicators');
                    indicatorsDiv.innerHTML = getIndicatorIcons(item);
                    li.appendChild(indicatorsDiv);


                     // Actions (Add Child, Delete)
                    const actionsDiv = document.createElement('div');
                    actionsDiv.classList.add('curriculum-item-actions');

                    if (item.type !== 'activity') { // Cannot add children to activities
                        const addChildBtn = document.createElement('button');
                        addChildBtn.classList.add('add-child-btn');
                        addChildBtn.dataset.parentId = item.id;
                        addChildBtn.dataset.parentType = item.type;
                        const childType = getChildType(item.type);
                         if (childType) { // Only add button if child type is valid
                            addChildBtn.title = `Add ${childType}`;
                            addChildBtn.setAttribute('aria-label', `Add ${childType} to ${item.title}`);
                            addChildBtn.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">add_circle</span>';
                            actionsDiv.appendChild(addChildBtn);
                         }
                    }

                    const deleteBtn = document.createElement('button');
                    deleteBtn.classList.add('delete-element-btn');
                    deleteBtn.dataset.id = item.id;
                    deleteBtn.title = `Delete ${item.type}`;
                    deleteBtn.setAttribute('aria-label', `Delete ${item.title}`);
                    deleteBtn.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">delete</span>';
                    actionsDiv.appendChild(deleteBtn);

                    li.appendChild(actionsDiv);


                    parentElement.appendChild(li);

                    if (item.children && item.children.length > 0) {
                        const ul = document.createElement('ul');
                        ul.classList.add('curriculum-list');
                         ul.setAttribute('role', 'group'); // ARIA role for nested list
                        li.appendChild(ul);
                        renderCurriculumStructure(item.children, ul); // Recursively render children
                    }
                });
            }


            // --- View Switching ---
            function switchView(viewId) {
                views.forEach(view => {
                    if (view.id === viewId) {
                        view.classList.remove('hidden');
                         view.setAttribute('aria-hidden', 'false');
                    } else {
                        view.classList.add('hidden');
                         view.setAttribute('aria-hidden', 'true');
                    }
                });

                sidebarLinks.forEach(link => {
                    const linkView = link.dataset.view + 'View';
                    if (linkView === viewId) {
                        link.classList.add('active');
                         link.setAttribute('aria-current', 'page');
                    } else {
                        link.classList.remove('active');
                         link.removeAttribute('aria-current');
                    }
                });

                currentView = viewId.replace('View', '');

                // Hide editor panel when not in editor view
                if (currentView !== 'editor') {
                    editorPanel.classList.remove('visible');
                     editorPanel.setAttribute('aria-hidden', 'true');
                    selectedCurriculumElement = null;
                     document.querySelectorAll('.curriculum-item').forEach(item => {
                         item.classList.remove('active');
                         item.removeAttribute('aria-selected');
                     });
                } else {
                    // In editor view, if an element was previously selected, show panel
                     if(selectedCurriculumElement) {
                         editorPanel.classList.add('visible');
                          editorPanel.setAttribute('aria-hidden', 'false');
                          // Focus the first input in the panel for accessibility
                          editorPanel.querySelector('input, textarea, [contenteditable="true"], button')?.focus();
                     }
                     // Render initial structure when switching to editor
                     renderCurriculumStructure(curriculumData, curriculumList);
                }
            }

            // --- Editor Panel Logic ---
            function selectCurriculumElement(id) {
                // Find the element data
                selectedCurriculumElement = findElementById(id, curriculumData);

                if (selectedCurriculumElement) {
                    // Update form fields
                    elementTypeInput.value = selectedCurriculumElement.type.charAt(0).toUpperCase() + selectedCurriculumElement.type.slice(1);
                    elementTitleInput.value = selectedCurriculumElement.title;
                    elementDescriptionPlaceholder.innerHTML = selectedCurriculumElement.description || ''; // Use innerHTML for rich text

                    // Show the panel
                    editorPanel.classList.add('visible');
                     editorPanel.setAttribute('aria-hidden', 'false');
                     // Focus the first input in the panel for accessibility
                     // Use a timeout to ensure panel is visible before focusing
                     setTimeout(() => {
                         editorPanel.querySelector('input, textarea, [contenteditable="true"], button')?.focus();
                     }, 50);


                    // Highlight the selected item in the list
                    document.querySelectorAll('.curriculum-item').forEach(item => {
                        item.classList.remove('active');
                        item.removeAttribute('aria-selected');
                    });
                    const selectedItemEl = document.querySelector(`.curriculum-item[data-id="${id}"]`);
                    if (selectedItemEl) {
                        selectedItemEl.classList.add('active');
                         selectedItemEl.setAttribute('aria-selected', 'true');
                         // Ensure it's visible in the scrollable list
                         selectedItemEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }


                    // Show/hide fields based on element type
                    const isActivity = selectedCurriculumElement.type === 'activity';
                    activityFieldsContainer.style.display = isActivity ? 'block' : 'none';
                    deleteElementBtn.style.display = 'inline-flex'; // Always show delete for selected element
                    saveElementBtn.style.display = 'inline-flex'; // Always show save for selected element


                     // Update content type selection (only for activities)
                     if (isActivity) {
                         contentTypeButtons.forEach(btn => {
                             const isSelected = btn.dataset.type === selectedCurriculumElement.contentType;
                             btn.classList.toggle('selected', isSelected);
                             btn.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
                         });

                         // Update accessibility checklist state
                         const accessibilityChecks = selectedCurriculumElement.accessibility || [];
                         accessibilityCheckboxes.forEach(checkbox => {
                             checkbox.checked = accessibilityChecks.includes(checkbox.dataset.checklist);
                         });

                     }


                     // Reset and update collapsible sections (basic simulation)
                     collapsibleHeaders.forEach(header => {
                         header.classList.add('collapsed');
                         header.setAttribute('aria-expanded', 'false');
                         header.nextElementSibling.classList.remove('expanded');
                         header.nextElementSibling.setAttribute('aria-hidden', 'true');
                     });

                    // Clear validation errors
                    clearValidationErrors();


                } else {
                    // Hide panel if element not found or deselected
                    editorPanel.classList.remove('visible');
                     editorPanel.setAttribute('aria-hidden', 'true');
                     document.querySelectorAll('.curriculum-item').forEach(item => {
                         item.classList.remove('active');
                         item.removeAttribute('aria-selected');
                     });
                    deleteElementBtn.style.display = 'none'; // Hide delete when no element selected
                    saveElementBtn.style.display = 'none'; // Hide save when no element selected
                    clearValidationErrors();
                }
            }

            function validateEditorPanel() {
                 let isValid = true;
                 clearValidationErrors();

                 if (!elementTitleInput.value.trim()) {
                     elementTitleInput.classList.add('error');
                     elementTitleInput.nextElementSibling.classList.remove('hidden'); // Show error message
                     isValid = false;
                 }

                 // Basic validation for description if it's contenteditable
                 if (!elementDescriptionPlaceholder.innerHTML.trim()) {
                      elementDescriptionPlaceholder.classList.add('error');
                      elementDescriptionPlaceholder.nextElementSibling.classList.remove('hidden'); // Show error message
                      isValid = false;
                 }

                 // Add more specific validation for activity fields if needed

                 return isValid;
            }

            function clearValidationErrors() {
                 document.querySelectorAll('.form-group .error').forEach(el => el.classList.remove('error'));
                 document.querySelectorAll('.error-message').forEach(el => el.classList.add('hidden'));
            }


            function saveSelectedElement() {
                 if (selectedCurriculumElement) {
                     if (!validateEditorPanel()) {
                         console.warn("Validation failed. Element not saved.");
                         // Focus the first invalid element
                         editorPanel.querySelector('.error')?.focus();
                         return;
                     }

                     const updatedData = {
                        title: elementTitleInput.value.trim(),
                        description: elementDescriptionPlaceholder.innerHTML.trim(), // Get HTML content
                     };


                     // Simulate saving activity-specific data
                     if (selectedCurriculumElement.type === 'activity') {
                          updatedData.contentType = document.querySelector('.content-type-button.selected')?.dataset.type || 'text';

                          // Save accessibility checklist state
                          updatedData.accessibility = [];
                          accessibilityCheckboxes.forEach(checkbox => {
                              if (checkbox.checked) {
                                  updatedData.accessibility.push(checkbox.dataset.checklist);
                              }
                          });

                          // Add logic to save standards, engagement, resources (placeholders for now)
                          // updatedData.standards = ...;
                          // updatedData.engagement = ...;
                          // updatedData.resources = ...;
                     }


                      // Update curriculumData array with the modified object
                     updateElementById(selectedCurriculumElement.id, updatedData, curriculumData);

                     // Re-render the list to show updated title and indicators
                     renderCurriculumStructure(curriculumData, curriculumList);

                     // Re-select the element to update the highlighted state and panel data
                     selectCurriculumElement(selectedCurriculumElement.id);

                     console.log('Element saved:', selectedCurriculumElement);
                     // In a real app, you'd save this to the backend and show a success message
                     // alert('Element saved!'); // Avoid disruptive alerts
                 }
            }

             function deleteSelectedElement() {
                 if (selectedCurriculumElement) {
                     const confirmDelete = confirm(`Are you sure you want to delete "${selectedCurriculumElement.title}"? This will also delete its children.`);
                     if (confirmDelete) {
                         deleteElement(selectedCurriculumElement.id, curriculumData);
                         renderCurriculumStructure(curriculumData, curriculumList);
                         editorPanel.classList.remove('visible'); // Hide panel after deletion
                          editorPanel.setAttribute('aria-hidden', 'true');
                         selectedCurriculumElement = null;
                         console.log('Element deleted.');
                         // In a real app, you'd delete from the backend and show a success message
                          // alert('Element deleted!'); // Avoid disruptive alerts
                     }
                 }
             }

            // --- Drag and Drop Logic ---
            function handleDragStart(e) {
                 draggingElement = e.target.closest('.curriculum-item');
                 if (!draggingElement) return;

                 e.dataTransfer.effectAllowed = 'move';
                 e.dataTransfer.setData('text/plain', draggingElement.dataset.id);
                 draggingElement.classList.add('dragging');
                 // Optional: Add a drag image
                 // e.dataTransfer.setDragImage(draggingElement, e.offsetX, e.offsetY);
            }

            function handleDragOver(e) {
                e.preventDefault(); // Necessary to allow dropping
                e.dataTransfer.dropEffect = 'move';

                const targetItem = e.target.closest('.curriculum-item');
                if (!targetItem || targetItem === draggingElement || targetItem.contains(draggingElement)) {
                     // Don't allow dropping on self or its children
                     document.querySelectorAll('.curriculum-item').forEach(item => item.classList.remove('drag-over', 'drag-over-bottom', 'drag-over-indent'));
                     e.dataTransfer.dropEffect = 'none'; // Indicate cannot drop
                     return;
                }

                 const targetType = targetItem.dataset.type;
                 const draggingType = draggingElement.dataset.type;

                 // Check if dropping as a child is valid
                 const allowedAsChild = (draggingType === 'activity' && targetType === 'lesson') || (draggingType === 'lesson' && targetType === 'module');

                 // Check if dropping as a sibling is valid
                 const allowedAsSibling = (draggingType === targetType) || (draggingType === 'module' && targetItem.dataset.type === 'module' && targetItem.parentElement === curriculumList);

                 // Clear previous drag indicators
                 document.querySelectorAll('.curriculum-item').forEach(item => item.classList.remove('drag-over', 'drag-over-bottom', 'drag-over-indent'));

                 const rect = targetItem.getBoundingClientRect();
                 const offset = e.clientY - rect.top; // Vertical position within the target item

                 if (allowedAsChild && offset > rect.height * 0.25 && offset < rect.height * 0.75) {
                     // Drop as child (middle part of a valid parent item)
                     targetItem.classList.add('drag-over-indent');
                 } else if (allowedAsSibling) {
                     // Drop before or after (top/bottom parts of a valid sibling item)
                     if (offset >= rect.height * 0.5) {
                         targetItem.classList.add('drag-over-bottom');
                     } else {
                         targetItem.classList.add('drag-over');
                     }
                 } else {
                     // Not an allowed drop target or position
                     e.dataTransfer.dropEffect = 'none'; // Indicate cannot drop
                 }
            }

            function handleDragLeave(e) {
                 // Remove drag indicators when leaving an item
                 e.target.closest('.curriculum-item')?.classList.remove('drag-over', 'drag-over-bottom', 'drag-over-indent');
            }

            function handleDrop(e) {
                e.preventDefault();
                document.querySelectorAll('.curriculum-item').forEach(item => item.classList.remove('drag-over', 'drag-over-bottom', 'drag-over-indent'));
                 curriculumList.style.boxShadow = 'none'; // Remove root drop indicator


                const draggedItemId = e.dataTransfer.getData('text/plain');
                const targetItem = e.target.closest('.curriculum-item');
                const targetList = e.target.closest('.curriculum-list'); // Check if dropping directly into a list (for root modules)

                if (!draggingElement || draggedItemId !== draggingElement.dataset.id) {
                     // If draggingElement is null, dragstart didn't happen correctly or it's an invalid drag
                     draggingElement?.classList.remove('dragging');
                     draggingElement = null;
                     return;
                }

                 // Find the dragged element and its parent/list
                 const draggedInfo = findElementAndParent(draggedItemId, curriculumData);
                 if (!draggedInfo) {
                      draggingElement.classList.remove('dragging');
                      draggingElement = null;
                      return; // Should not happen if dragStart worked
                 }

                 // Determine drop target info
                 let targetInfo = null;
                 let dropList = null;
                 let insertIndex = -1;

                 if (targetItem) {
                     targetInfo = findElementAndParent(targetItem.dataset.id, curriculumData);
                     if (!targetInfo) {
                         draggingElement.classList.remove('dragging');
                         draggingElement = null;
                         return; // Target not found
                     }

                     const rect = targetItem.getBoundingClientRect();
                     const offset = e.clientY - rect.top;
                     const targetType = targetItem.dataset.type;
                     const draggingType = draggingElement.dataset.type;

                     const dropAsChild = targetType !== 'activity' && offset > rect.height * 0.25 && offset < rect.height * 0.75;
                     const allowedAsChild = (draggingType === 'activity' && targetType === 'lesson') || (draggingType === 'lesson' && targetType === 'module');
                     const allowedAsSibling = (draggingType === targetType) || (draggingType === 'module' && targetItem.dataset.type === 'module' && targetInfo.parentList === curriculumData);


                     if (dropAsChild && allowedAsChild && targetInfo.element.children) {
                         // Drop as child
                          dropList = targetInfo.element.children;
                          insertIndex = dropList.length; // Add to the end of children
                     } else if (allowedAsSibling) {
                         // Drop before or after
                          dropList = targetInfo.parentList;
                          insertIndex = offset >= rect.height * 0.5 ? targetInfo.index + 1 : targetInfo.index;
                     }

                 } else if (targetList === curriculumList && draggingElement.dataset.type === 'module') {
                     // Attempt to drop a module directly into the root list area
                     dropList = curriculumData;
                     insertIndex = curriculumData.length; // Add to the end of root modules
                 }


                 if (dropList && insertIndex !== -1) {
                     // Prevent dropping an item into its own child list
                     let isDroppingIntoOwnChild = false;
                     if (dropList !== draggedInfo.parentList) { // Only check if changing parent/list
                         let currentParent = dropList;
                         while(currentParent) {
                             if (currentParent === draggedInfo.element.children) { // Check if the target list is the dragged element's children list
                                 isDroppingIntoOwnChild = true;
                                 break;
                             }
                             // Find the parent of currentParent in the main data structure (simplified check)
                             // A more robust check would traverse up the tree from the dropList
                             const parentOfDropListInfo = findElementAndParent(targetInfo ? targetInfo.element.id : null, curriculumData); // This is a simplification; need actual parent lookup
                             currentParent = parentOfDropListInfo ? parentOfDropListInfo.parentList : null; // This logic is flawed for deep nesting
                             // A better approach would be to check if the targetItem's ID is a descendant of the draggedItemId
                             if (targetItem) {
                                 let checkParent = targetItem;
                                 while(checkParent) {
                                     if (checkParent.dataset.id === draggedItemId) {
                                         isDroppingIntoOwnChild = true;
                                         break;
                                     }
                                     checkParent = checkParent.parentElement.closest('.curriculum-item');
                                 }
                             }
                         }
                     }


                     if (!isDroppingIntoOwnChild) {
                         // Remove from old position
                         draggedInfo.parentList.splice(draggedInfo.index, 1);

                         // Insert into new position
                         dropList.splice(insertIndex, 0, draggedInfo.element);

                         // Re-render the structure
                         renderCurriculumStructure(curriculumData, curriculumList);

                         // Keep the dragged element selected if it was selected before
                          if (selectedCurriculumElement && selectedCurriculumElement.id === draggedItemId) {
                              selectCurriculumElement(draggedItemId);
                          } else {
                               // If a different element was selected, keep it selected
                               if(selectedCurriculumElement) {
                                   selectCurriculumElement(selectedCurriculumElement.id);
                               } else {
                                    // If nothing was selected, ensure panel is hidden
                                    editorPanel.classList.remove('visible');
                                    editorPanel.setAttribute('aria-hidden', 'true');
                               }
                          }

                         console.log('Curriculum data after drag:', curriculumData); // Log updated structure
                     } else {
                         console.warn('Cannot drop an item into its own child.');
                         // Optional: Provide visual or text feedback to the user
                     }


                 } else {
                     console.log('Invalid drop target or position.');
                     // Optional: Provide visual or text feedback to the user
                 }


                draggingElement.classList.remove('dragging');
                draggingElement = null;
            }

            function handleDragEnd() {
                 // Clean up drag indicators if drop didn't happen or was invalid
                 document.querySelectorAll('.curriculum-item').forEach(item => item.classList.remove('dragging', 'drag-over', 'drag-over-bottom', 'drag-over-indent'));
                 curriculumList.style.boxShadow = 'none'; // Remove root drop indicator
                 draggingElement = null;
            }


            // --- Event Listeners ---

            // Sidebar navigation clicks
            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const viewId = e.target.closest('a').dataset.view + 'View';
                    switchView(viewId);
                });
            });

            // Dashboard "Edit" button clicks
            dashboardCards.forEach(card => {
                 card.addEventListener('click', (e) => {
                     // Check if click was on a specific button within the card
                     if (!e.target.closest('.btn')) {
                          // If click was on the card itself (or not a specific button), simulate editing
                           const editBtn = card.querySelector('.edit-course-btn');
                           if (editBtn) {
                               editBtn.click(); // Trigger the edit button's action
                           }
                     }
                 });

                 const editBtn = card.querySelector('.edit-course-btn');
                 if (editBtn) {
                     editBtn.addEventListener('click', () => {
                         // Simulate loading a course into the editor
                         // In a real app, this would load curriculumData for the specific course
                         // For now, just render the default curriculumData
                         switchView('editorView');
                     });
                 }
            });

            // Dashboard "Create New Course" click
             createNewCourseCard.addEventListener('click', () => {
                 alert("Simulating 'Create New Course'. This would typically open a modal or new view.");
                 // In a real app, navigate to a course creation flow
             });
             createNewCourseCard.addEventListener('keydown', (e) => {
                 if (e.key === 'Enter' || e.key === ' ') {
                     e.preventDefault();
                     createNewCourseCard.click();
                 }
             });


            // Curriculum item clicks (to open editor panel)
            curriculumList.addEventListener('click', (e) => {
                const item = e.target.closest('.curriculum-item');
                if (item) {
                    // Check if click was on an action button inside the item
                    const actionButton = e.target.closest('.curriculum-item-actions button');
                    if (actionButton) {
                         if (actionButton.classList.contains('add-child-btn')) {
                              const parentId = actionButton.dataset.parentId;
                              const parentType = actionButton.dataset.parentType;
                              const childType = getChildType(parentType)?.toLowerCase();
                              if (childType) {
                                  addElement(parentId, childType);
                              } else {
                                   console.warn(`Cannot add child to element type: ${parentType}`);
                              }
                         } else if (actionButton.classList.contains('delete-element-btn')) {
                             const elementIdToDelete = actionButton.dataset.id;
                             // Need to find the element data first to confirm title
                             const elementToDelete = findElementById(elementIdToDelete, curriculumData);
                             if (elementToDelete) {
                                 const confirmDelete = confirm(`Are you sure you want to delete "${elementToDelete.title}"? This will also delete its children.`);
                                 if (confirmDelete) {
                                     deleteElement(elementToDelete.id, curriculumData);
                                     renderCurriculumStructure(curriculumData, curriculumList);
                                     // If the deleted element was the currently selected one, hide the panel
                                     if (selectedCurriculumElement && selectedCurriculumElement.id === elementToDelete.id) {
                                         editorPanel.classList.remove('visible');
                                         editorPanel.setAttribute('aria-hidden', 'true');
                                         selectedCurriculumElement = null;
                                         clearValidationErrors();
                                     }
                                 }
                             }
                         }
                    } else {
                         // Click was on the item itself (not an action button)
                         selectCurriculumElement(item.dataset.id);
                    }
                }
            });

             // Allow keyboard activation for curriculum items
             curriculumList.addEventListener('keydown', (e) => {
                 const item = e.target.closest('.curriculum-item');
                 if (item && (e.key === 'Enter' || e.key === ' ')) {
                     e.preventDefault();
                     // If focus is on the item, simulate click to select/open editor
                     selectCurriculumElement(item.dataset.id);
                 }
                  // Basic keyboard navigation within the tree (up/down arrows)
                 if (item && (e.key === 'ArrowUp' || e.key === 'ArrowDown')) {
                     e.preventDefault();
                     const items = Array.from(curriculumList.querySelectorAll('.curriculum-item'));
                     const currentIndex = items.indexOf(item);
                     let nextIndex = -1;

                     if (e.key === 'ArrowUp' && currentIndex > 0) {
                         nextIndex = currentIndex - 1;
                     } else if (e.key === 'ArrowDown' && currentIndex < items.length - 1) {
                         nextIndex = currentIndex + 1;
                     }

                     if (nextIndex !== -1) {
                         items[nextIndex].focus(); // Move focus
                     }
                 }
             });


            // Add Module button click (at the top level)
            addModuleButton.addEventListener('click', () => {
                 addElement(null, 'module'); // Add module at the top level
            });


            // Save Element button click
            saveElementBtn.addEventListener('click', saveSelectedElement);

             // Delete Element button click (inside panel)
            deleteElementBtn.addEventListener('click', deleteSelectedElement);


            // Collapsible sections
            collapsibleHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const isCollapsed = header.classList.toggle('collapsed');
                    header.setAttribute('aria-expanded', !isCollapsed);
                    const content = header.nextElementSibling;
                    content.classList.toggle('expanded');
                    content.setAttribute('aria-hidden', isCollapsed);
                });
                 // Allow keyboard interaction for collapsible headers
                 header.addEventListener('keydown', (e) => {
                     if (e.key === 'Enter' || e.key === ' ') {
                         e.preventDefault();
                         header.click();
                     }
                 });
            });

            // Content Type Selector clicks
            contentTypeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (selectedCurriculumElement && selectedCurriculumElement.type === 'activity') {
                        contentTypeButtons.forEach(btn => {
                             btn.classList.remove('selected');
                             btn.setAttribute('aria-pressed', 'false');
                        });
                        button.classList.add('selected');
                         button.setAttribute('aria-pressed', 'true');
                        selectedCurriculumElement.contentType = button.dataset.type; // Update data
                        console.log('Content type updated:', selectedCurriculumElement.contentType);
                        // In a real app, trigger rendering of dynamic fields here
                    }
                });
            });

             // Accessibility Checklist clicks (update data immediately)
             accessibilityCheckboxes.forEach(checkbox => {
                 checkbox.addEventListener('change', () => {
                     if (selectedCurriculumElement && selectedCurriculumElement.type === 'activity') {
                          selectedCurriculumElement.accessibility = []; // Clear existing
                          accessibilityCheckboxes.forEach(cb => {
                              if (cb.checked) {
                                  selectedCurriculumElement.accessibility.push(cb.dataset.checklist);
                              }
                          });
                          console.log('Accessibility checklist updated:', selectedCurriculumElement.accessibility);
                           // Re-render structure to update indicators
                           renderCurriculumStructure(curriculumData, curriculumList);
                            // Keep element selected
                           // selectCurriculumElement(selectedCurriculumElement.id); // Re-selecting can steal focus, maybe just update indicators visually?
                            // For now, re-render is sufficient to update indicators
                     }
                 });
             });

            // Simulate Standards Alignment Placeholder click
            document.querySelector('.standards-alignment-placeholder').addEventListener('click', () => {
                alert("Simulating Standards Alignment search. This would open a modal.");
                console.log("Standards Alignment clicked for element:", selectedCurriculumElement);
                // In a real app, open a modal to search/link standards
            });
             document.querySelector('.standards-alignment-placeholder').addEventListener('keydown', (e) => {
                 if (e.key === 'Enter' || e.key === ' ') {
                     e.preventDefault();
                     document.querySelector('.standards-alignment-placeholder').click();
                 }
             });

             // Simulate Resource Library Placeholder click
             document.querySelector('.resource-library-placeholder').addEventListener('click', () => {
                 alert("Simulating Resource Library access. This would open a panel or modal.");
                 console.log("Resource Library clicked for element:", selectedCurriculumElement);
                 // In a real app, open resource library panel/modal
             });
              document.querySelector('.resource-library-placeholder').addEventListener('keydown', (e) => {
                 if (e.key === 'Enter' || e.key === ' ') {
                     e.preventDefault();
                     document.querySelector('.resource-library-placeholder').click();
                 }
             });


            // Simulate Rich Text Editor focus/blur for styling and validation
            elementDescriptionPlaceholder.addEventListener('focus', () => {
                 elementDescriptionPlaceholder.style.borderColor = "var(--primary-color)";
                 elementDescriptionPlaceholder.style.boxShadow = `0 0 0 var(--focus-outline-width) rgba(76, 175, 80, 0.2)`;
            });
             elementDescriptionPlaceholder.addEventListener('blur', () => {
                 elementDescriptionPlaceholder.style.borderColor = "var(--border-color)";
                 elementDescriptionPlaceholder.style.boxShadow = "none";
                 // Basic validation on blur
                 if (!elementDescriptionPlaceholder.innerHTML.trim()) {
                     elementDescriptionPlaceholder.classList.add('error');
                     elementDescriptionPlaceholder.nextElementSibling.classList.remove('hidden');
                 } else {
                     elementDescriptionPlaceholder.classList.remove('error');
                     elementDescriptionPlaceholder.nextElementSibling.classList.add('hidden');
                 }
            });

             // Basic validation on input for title
             elementTitleInput.addEventListener('input', () => {
                 if (elementTitleInput.value.trim()) {
                     elementTitleInput.classList.remove('error');
                     elementTitleInput.nextElementSibling.classList.add('hidden');
                 }
             });
             elementTitleInput.addEventListener('blur', () => {
                  if (!elementTitleInput.value.trim()) {
                     elementTitleInput.classList.add('error');
                     elementTitleInput.nextElementSibling.classList.remove('hidden');
                 }
             });


            // Drag and Drop Event Listeners
            curriculumList.addEventListener('dragstart', handleDragStart);
            curriculumList.addEventListener('dragover', handleDragOver);
            curriculumList.addEventListener('dragleave', handleDragLeave);
            curriculumList.addEventListener('drop', handleDrop);
            curriculumList.addEventListener('dragend', handleDragEnd);

             // Allow dropping modules directly onto the root list area
             curriculumList.addEventListener('dragover', (e) => {
                 const draggedItemId = e.dataTransfer.getData('text/plain');
                 const draggedInfo = findElementAndParent(draggedItemId, curriculumData);
                 // Check if the drag target is the root list itself and the dragged item is a module
                 if (draggedInfo && draggedInfo.element.type === 'module' && e.target.classList.contains('curriculum-list')) {
                      e.preventDefault(); // Allow drop
                      e.dataTransfer.dropEffect = 'move';
                       // Optional: Add a visual indicator for root drop area
                       curriculumList.style.boxShadow = `inset 0 0 0 2px ${"var(--secondary-color)"}`;
                 }
             });
              curriculumList.addEventListener('dragleave', (e) => {
                   // Check if leaving the root list itself
                   if (e.target.classList.contains('curriculum-list')) {
                       curriculumList.style.boxShadow = 'none';
                   }
              });
               curriculumList.addEventListener('drop', (e) => {
                   curriculumList.style.boxShadow = 'none';
               });


            // --- Global Action Button Placeholders ---
            document.querySelector('.global-actions .btn-outline:nth-of-type(1)').addEventListener('click', () => {
                alert("Simulating 'Preview Curriculum'.");
                console.log("Previewing curriculum data:", curriculumData);
            });
             document.querySelector('.global-actions .btn-outline:nth-of-type(2)').addEventListener('click', () => {
                alert("Simulating 'Export Curriculum'.");
                console.log("Exporting curriculum data:", JSON.stringify(curriculumData, null, 2)); // Export with formatting
            });
             document.querySelector('.global-actions .btn-primary').addEventListener('click', () => {
                alert("Simulating 'Save Curriculum'.");
                console.log("Saving entire curriculum data:", curriculumData);
            });


            // --- Initial Setup ---
            switchView('dashboardView'); // Start on the dashboard

        });
    </script>
</body>
</html>
