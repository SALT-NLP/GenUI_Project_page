<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Skills Training</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400,0,0" rel="stylesheet" />
    <style>
        :root {
            --primary-color: #007bff;
            --primary-dark: #0056b3;
            --secondary-color: #28a745;
            --secondary-dark: #218838;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-color: #212529;
            --text-light: #6c757d;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --spacing-unit: 8px;
            --border-radius: 8px;
            --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.1);
            --transition-duration: 0.3s;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: grid;
            grid-template-rows: auto 1fr auto;
            min-height: 100vh;
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: calc(var(--spacing-unit) * 3);
            padding: calc(var(--spacing-unit) * 3);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 3);
            box-shadow: var(--shadow-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            grid-column: 1 / -1; /* Span across grid in main container */
        }

        .app-title {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary-color);
        }

        .language-switcher {
            position: relative;
            display: inline-block;
        }

        .language-switcher button {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
            transition: background-color var(--transition-duration);
        }

        .language-switcher button:hover,
        .language-switcher button:focus {
            background-color: #e9ecef;
            outline: none;
        }

        .language-switcher button .material-symbols-rounded {
            font-size: 1.2em;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            list-style: none;
            margin: var(--spacing-unit) 0 0 0;
            padding: var(--spacing-unit) 0;
            z-index: 100;
            min-width: 150px;
            display: none; /* Hidden by default */
        }

        .language-dropdown.active {
            display: block;
        }

        .language-dropdown li button {
            display: block;
            width: 100%;
            text-align: left;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1em;
            color: var(--text-color);
            transition: background-color var(--transition-duration);
        }

        .language-dropdown li button:hover,
        .language-dropdown li button:focus {
            background-color: #f1f3f5;
            outline: none;
        }

        nav {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-list li {
            margin-bottom: var(--spacing-unit);
        }

        .nav-list a {
            display: block;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            text-decoration: none;
            color: var(--text-color);
            border-radius: var(--border-radius);
            transition: background-color var(--transition-duration), color var(--transition-duration);
            font-weight: 600;
        }

        .nav-list a:hover,
        .nav-list a:focus {
            background-color: #e9ecef;
            color: var(--primary-dark);
            outline: none;
        }

        .nav-list a.active {
            background-color: var(--primary-color);
            color: var(--surface-color);
        }

        main {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            overflow-y: auto; /* Enable scrolling for content */
        }

        .content-section {
            display: none; /* Hidden by default */
            animation: fadeIn var(--transition-duration) ease-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        h2 {
            color: var(--primary-dark);
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 3);
            font-size: 1.5em;
        }

        /* Illustrated Guide Viewer */
        .guide-step {
            margin-bottom: calc(var(--spacing-unit) * 4);
            padding-bottom: calc(var(--spacing-unit) * 4);
            border-bottom: 1px solid var(--border-color);
        }

        .guide-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .guide-step h3 {
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            font-size: 1.2em;
        }

        .guide-illustration {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto calc(var(--spacing-unit) * 2) auto;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            cursor: zoom-in; /* Indicate zoom capability */
        }

        .guide-text {
            color: var(--text-color);
        }

        /* Patient Assessment Tool */
        .assessment-form label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 600;
        }

        .assessment-form input[type="text"],
        .assessment-form input[type="number"],
        .assessment-form textarea {
            width: 100%;
            padding: var(--spacing-unit);
            margin-bottom: calc(var(--spacing-unit) * 2);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1em;
            box-sizing: border-box; /* Include padding and border in element's total width and height */
        }

        .assessment-form .radio-group,
        .assessment-form .checkbox-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .assessment-form .radio-group label,
        .assessment-form .checkbox-group label {
            font-weight: 400;
            margin-bottom: var(--spacing-unit);
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
        }

        .assessment-form input[type="radio"],
        .assessment-form input[type="checkbox"] {
            margin: 0; /* Remove default margin */
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: var(--border-radius);
            margin-bottom: calc(var(--spacing-unit) * 3);
            overflow: hidden;
        }

        .progress-bar {
            height: 20px;
            width: 0%;
            background-color: var(--success-color);
            text-align: center;
            line-height: 20px;
            color: white;
            font-size: 0.9em;
            transition: width var(--transition-duration) ease-in-out;
        }

        .form-actions {
            margin-top: calc(var(--spacing-unit) * 3);
            display: flex;
            gap: var(--spacing-unit);
        }

        button {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color var(--transition-duration), opacity var(--transition-duration);
        }

        button.primary {
            background-color: var(--primary-color);
            color: var(--surface-color);
        }

        button.primary:hover,
        button.primary:focus {
            background-color: var(--primary-dark);
            outline: none;
        }

        button.secondary {
            background-color: #6c757d;
            color: var(--surface-color);
        }

        button.secondary:hover,
        button.secondary:focus {
            background-color: #5a6268;
            outline: none;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Decision Flowchart */
        .flowchart-container {
            width: 100%;
            overflow-x: auto; /* Allow horizontal scrolling if needed */
            padding-bottom: var(--spacing-unit); /* Space for scrollbar */
        }

        .flowchart-svg {
            display: block; /* Remove extra space below SVG */
        }

        .flowchart-node {
            cursor: pointer;
            transition: fill var(--transition-duration), stroke var(--transition-duration);
        }

        .flowchart-node:hover {
            fill: var(--primary-color);
            stroke: var(--primary-dark);
        }

        .flowchart-node.active {
            fill: var(--secondary-color);
            stroke: var(--secondary-dark);
            stroke-width: 3px;
        }

        .flowchart-text {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            fill: var(--text-color);
            pointer-events: none; /* Allow clicking through text to node */
        }

        .flowchart-line {
            stroke: var(--text-light);
            stroke-width: 2;
            fill: none;
        }

        .flowchart-info {
            margin-top: calc(var(--spacing-unit) * 3);
            padding: calc(var(--spacing-unit) * 2);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #e9ecef;
            display: none; /* Hidden by default */
        }

        .flowchart-info.active {
            display: block;
        }

        /* Glossary Tooltip/Modal */
        .glossary-term, .cultural-note-trigger {
            text-decoration: underline dotted;
            cursor: help;
            position: relative;
        }

        .tooltip {
            position: absolute;
            background-color: var(--surface-color);
            color: var(--text-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            z-index: 200;
            max-width: 300px;
            pointer-events: none; /* Don't interfere with mouse events */
            opacity: 0;
            transition: opacity var(--transition-duration);
            top: 120%; /* Position below the trigger */
            left: 50%;
            transform: translateX(-50%);
        }

        .glossary-term:hover .tooltip,
        .cultural-note-trigger:hover .tooltip {
            opacity: 1;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 300;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-duration);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 4);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(-20px);
            transition: transform var(--transition-duration) ease-out;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-close {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-light);
            transition: color var(--transition-duration);
        }

        .modal-close:hover {
            color: var(--text-color);
        }

        .modal-title {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            color: var(--primary-dark);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: calc(var(--spacing-unit) * 2);
                gap: calc(var(--spacing-unit) * 2);
            }

            header {
                flex-direction: column;
                gap: var(--spacing-unit);
                padding: calc(var(--spacing-unit) * 2);
            }

            .app-title {
                font-size: 1.5em;
            }

            nav {
                padding: calc(var(--spacing-unit) * 1.5);
            }

            main {
                padding: calc(var(--spacing-unit) * 2);
            }

            .language-switcher {
                width: 100%;
                text-align: center;
            }

            .language-switcher button {
                width: 100%;
                justify-content: center;
            }

             .language-dropdown {
                left: 50%;
                right: auto;
                transform: translateX(-50%);
                min-width: 80%;
             }
        }
    </style>
</head>
<body>

    <header>
        <div class="app-title" data-key="appTitle">Medical Skills Training</div>
        <div class="language-switcher">
            <button id="language-button" aria-haspopup="true" aria-expanded="false">
                <span class="material-symbols-rounded">language</span>
                <span id="current-language-text">English</span>
            </button>
            <ul class="language-dropdown" id="language-dropdown" role="menu">
                <li><button data-lang="en" role="menuitem">English</button></li>
                <li><button data-lang="es" role="menuitem">Español</button></li>
                <li><button data-lang="kiche" role="menuitem">K'iche'</button></li>
                <li><button data-lang="garifuna" role="menuitem">Garifuna</button></li>
            </ul>
        </div>
    </header>

    <div class="container">
        <nav>
            <ul class="nav-list" role="navigation">
                <li><a href="#guides" class="nav-link active" data-section="guides" data-key="navGuides">Illustrated Guides</a></li>
                <li><a href="#assessment" class="nav-link" data-section="assessment" data-key="navAssessment">Patient Assessment</a></li>
                <li><a href="#flowcharts" class="nav-link" data-section="flowcharts" data-key="navFlowcharts">Decision Flowcharts</a></li>
            </ul>
        </nav>

        <main>
            <section id="guides" class="content-section active">
                <h2 data-key="guidesTitle">Illustrated Guides</h2>
                <div id="guide-content">
                    <!-- Guide steps will be loaded here -->
                </div>
            </section>

            <section id="assessment" class="content-section">
                <h2 data-key="assessmentTitle">Patient Assessment Tool</h2>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="assessment-progress" style="width: 0%;">0%</div>
                </div>
                <form id="assessment-form" class="assessment-form">
                    <!-- Assessment questions will be loaded here -->
                </form>
                 <div class="form-actions">
                     <button class="primary" id="submit-assessment" data-key="submitAssessment">Submit Assessment</button>
                 </div>
            </section>

            <section id="flowcharts" class="content-section">
                <h2 data-key="flowchartsTitle">Decision Flowcharts</h2>
                <div class="flowchart-container" id="flowchart-container">
                    <!-- Flowchart SVG will be loaded here -->
                </div>
                <div class="flowchart-info" id="flowchart-info">
                    <h3 data-key="flowchartInfoTitle">Node Information</h3>
                    <p id="flowchart-info-text"></p>
                </div>
            </section>
        </main>
    </div>

    <!-- Glossary/Cultural Notes Modal -->
    <div class="modal-overlay" id="info-modal">
        <div class="modal-content">
            <button class="modal-close" id="info-modal-close" aria-label="Close modal">&times;</button>
            <h3 class="modal-title" id="info-modal-title"></h3>
            <div id="info-modal-body"></div>
        </div>
    </div>

    <script>
        // --- Data ---
        const translations = {
            en: {
                appTitle: "Medical Skills Training",
                navGuides: "Illustrated Guides",
                navAssessment: "Patient Assessment",
                navFlowcharts: "Decision Flowcharts",
                guidesTitle: "Illustrated Guides",
                assessmentTitle: "Patient Assessment Tool",
                flowchartsTitle: "Decision Flowcharts",
                submitAssessment: "Submit Assessment",
                flowchartInfoTitle: "Node Information",
                guideStep1Title: "Step 1: Handwashing",
                guideStep1Text: "Wash your hands thoroughly with soap and clean water for at least 20 seconds.",
                guideStep2Title: "Step 2: Applying Bandage",
                guideStep2Text: "Clean the wound, apply antiseptic, and cover with a sterile bandage.",
                assessmentQ1Label: "Patient's Name:",
                assessmentQ2Label: "Patient's Age:",
                assessmentQ3Label: "Main Complaint:",
                assessmentQ4Label: "Fever present?",
                assessmentQ4OptionYes: "Yes",
                assessmentQ4OptionNo: "No",
                assessmentQ5Label: "Difficulty breathing?",
                assessmentQ5OptionYes: "Yes",
                assessmentQ5OptionNo: "No",
                flowchartNode1Text: "Patient presents with symptoms.",
                flowchartNode2Text: "Assess for fever.",
                flowchartNode3Text: "Fever present?",
                flowchartNode4Text: "Assess for difficulty breathing.",
                flowchartNode5Text: "Difficulty breathing present?",
                flowchartNode6Text: "Treat for respiratory infection.",
                flowchartNode7Text: "Consider other diagnoses.",
                glossaryTermFever: "Fever: An elevated body temperature, usually above 38°C (100.4°F).",
                culturalNoteFever: "Cultural Note on Fever: In some cultures, fever is understood differently or treated with traditional remedies before seeking medical help. Be sensitive to these beliefs.",
                glossaryTermAntiseptic: "Antiseptic: A substance that stops or slows down the growth of microorganisms.",
                culturalNoteBandage: "Cultural Note on Bandages: Ensure the patient understands the importance of keeping the bandage clean and dry, as practices may vary."
            },
            es: {
                appTitle: "Entrenamiento en Habilidades Médicas",
                navGuides: "Guías Ilustradas",
                navAssessment: "Evaluación del Paciente",
                navFlowcharts: "Diagramas de Decisión",
                guidesTitle: "Guías Ilustradas",
                assessmentTitle: "Herramienta de Evaluación del Paciente",
                flowchartsTitle: "Diagramas de Decisión",
                submitAssessment: "Enviar Evaluación",
                flowchartInfoTitle: "Información del Nodo",
                guideStep1Title: "Paso 1: Lavado de Manos",
                guideStep1Text: "Lávese bien las manos con jabón y agua limpia durante al menos 20 segundos.",
                guideStep2Title: "Paso 2: Aplicación de Vendaje",
                guideStep2Text: "Limpie la herida, aplique antiséptico y cubra con un vendaje estéril.",
                assessmentQ1Label: "Nombre del Paciente:",
                assessmentQ2Label: "Edad del Paciente:",
                assessmentQ3Label: "Queja Principal:",
                assessmentQ4Label: "¿Presenta fiebre?",
                assessmentQ4OptionYes: "Sí",
                assessmentQ4OptionNo: "No",
                assessmentQ5Label: "¿Dificultad para respirar?",
                assessmentQ5OptionYes: "Sí",
                assessmentQ5OptionNo: "No",
                flowchartNode1Text: "Paciente presenta síntomas.",
                flowchartNode2Text: "Evaluar fiebre.",
                flowchartNode3Text: "¿Fiebre presente?",
                flowchartNode4Text: "Evaluar dificultad para respirar.",
                flowchartNode5Text: "¿Dificultad para respirar presente?",
                flowchartNode6Text: "Tratar infección respiratoria.",
                flowchartNode7Text: "Considerar otros diagnósticos.",
                glossaryTermFever: "Fiebre: Temperatura corporal elevada, generalmente por encima de 38°C (100.4°F).",
                culturalNoteFever: "Nota Cultural sobre la Fiebre: En algunas culturas, la fiebre se entiende de manera diferente o se trata con remedios tradicionales antes de buscar ayuda médica. Sea sensible a estas creencias.",
                glossaryTermAntiseptic: "Antiséptico: Una sustancia que detiene o ralentiza el crecimiento de microorganismos.",
                culturalNoteBandage: "Nota Cultural sobre los Vendajes: Asegúrese de que el paciente comprenda la importancia de mantener el vendaje limpio y seco, ya que las prácticas pueden variar."
            },
            kiche: {
                 appTitle: "Utzijonem rech K'acharik pa Saqil", // Approximation
                 navGuides: "K'utb'al rik'in Retal", // Approximation
                 navAssessment: "Eta'manik rech Ya'om Q'aq'", // Approximation
                 navFlowcharts: "Retal rech K'axk'ol", // Approximation
                 guidesTitle: "K'utb'al rik'in Retal",
                 assessmentTitle: "Eta'manik rech Ya'om Q'aq'",
                 flowchartsTitle: "Retal rech K'axk'ol",
                 submitAssessment: "Taqanik rech Eta'manik", // Approximation
                 flowchartInfoTitle: "Tzijol rech K'axk'ol", // Approximation
                 guideStep1Title: "Nab'e B'e: Ch'ajonik rech Q'ab'", // Approximation
                 guideStep1Text: "Ch'ajij la q'ab' chi utz rik'in ch'ipaq xuquje' saqil ya' pa juk'an 20 segundos.", // Approximation
                 guideStep2Title: "Ukab' B'e: Ya'onik rech K'am", // Approximation
                 guideStep2Text: "Ch'ajij la k'äx, ya'a antiséptico, xuquje' ch'uq la rik'in jun saqil k'am.", // Approximation
                 assessmentQ1Label: "Ub'i' la Ya'om Q'aq':", // Approximation
                 assessmentQ2Label: "Ujunab' la Ya'om Q'aq':", // Approximation
                 assessmentQ3Label: "Nimale' K'ax:", // Approximation
                 assessmentQ4Label: "¿K'o q'aq' ruma?", // Approximation
                 assessmentQ4OptionYes: "Ja'", // Yes
                 assessmentQ4OptionNo: "Manä'", // No
                 assessmentQ5Label: "¿K'o k'ax pa uxlab'il?", // Approximation
                 assessmentQ5OptionYes: "Ja'", // Yes
                 assessmentQ5OptionNo: "Manä'", // No
                 flowchartNode1Text: "Ya'om q'aq' k'o k'ax ruma.", // Approximation
                 flowchartNode2Text: "Eta'maj we k'o q'aq'.", // Approximation
                 flowchartNode3Text: "¿K'o q'aq'?", // Approximation
                 flowchartNode4Text: "Eta'maj we k'o k'ax pa uxlab'il.", // Approximation
                 flowchartNode5Text: "¿K'o k'ax pa uxlab'il?", // Approximation
                 flowchartNode6Text: "Chajij la k'ax pa uxlab'il.", // Approximation
                 flowchartNode7Text: "Ch'ob'öj nik'aj chik k'ax.", // Approximation
                 glossaryTermFever: "Q'aq': Nimale' uche'al ri tijow, pa juk'an pa ruwi' 38°C (100.4°F).", // Approximation
                 culturalNoteFever: "Nota Cultural rech Q'aq': Pa jujun tinamit, ri q'aq' k'o nik'aj chik eta'manik ruma o k'o kik'aslemal rech chajinik nab'e chuwach taqanik rech q'aq'. Chixsaqilaj la k'aslemal ri'.", // Approximation
                 glossaryTermAntiseptic: "Antiséptico: Jun k'aslemal ri kixaq'ij o kixaq'ij ta la k'iyarik rech ri man kilitaj ta.", // Approximation
                 culturalNoteBandage: "Nota Cultural rech K'am: Chi'uq'ij la ya'om q'aq' kuya' keta'maj ri nimale' rech kisaqilaj xuquje' man k'o ta ya', ruma ri k'aslemal kuya' kijalataj.", // Approximation
            },
             garifuna: {
                appTitle: "Adügaü le lánina Medisin", // Approximation
                navGuides: "Gúüdüsi le lánina Pícha", // Approximation
                navAssessment: "Líchuguni le lánina Búma", // Approximation
                navFlowcharts: "Líchuguni le lánina Ámuñegü", // Approximation
                guidesTitle: "Gúüdüsi le lánina Pícha",
                assessmentTitle: "Líchuguni le lánina Búma",
                flowchartsTitle: "Líchuguni le lánina Ámuñegü",
                submitAssessment: "Áfara Líchuguni", // Approximation
                flowchartInfoTitle: "Áfan le lánina Ámuñegü", // Approximation
                guideStep1Title: "Fúndu 1: Líchuguni le lánina Úguchu", // Approximation
                guideStep1Text: "Líchuguni le lánina úguchu lidan jabón súbuha lidan ladaüga 20 segúndu.", // Approximation
                guideStep2Title: "Fúndu 2: Líchuguni le lánina Bánda", // Approximation
                guideStep2Text: "Líchuguni le lánina ídajani, líchuguni antiséptico, súbuha líchuguni bánda le súbuha.", // Approximation
                assessmentQ1Label: "Úbina le lánina Búma:", // Approximation
                assessmentQ2Label: "Lídan le lánina Búma:", // Approximation
                assessmentQ3Label: "Nimale' Áfara:", // Approximation
                assessmentQ4Label: "¿Kóu láu láfan?", // Approximation
                assessmentQ4OptionYes: "Áu", // Yes
                assessmentQ4OptionNo: "Má", // No
                assessmentQ5Label: "¿Kóu láu láfan lidan lúxul?", // Approximation
                assessmentQ5OptionYes: "Áu", // Yes
                assessmentQ5OptionNo: "Má", // No
                flowchartNode1Text: "Búma kóu láu láfan.", // Approximation
                flowchartNode2Text: "Líchuguni láfan le lánina láfan.", // Approximation
                flowchartNode3Text: "¿Kóu láu láfan?", // Approximation
                flowchartNode4Text: "Líchuguni láfan le lánina lúxul.", // Approximation
                flowchartNode5Text: "¿Kóu láu láfan lidan lúxul?", // Approximation
                flowchartNode6Text: "Líchuguni láfan le lánina lúxul.", // Approximation
                flowchartNode7Text: "Líchuguni ámuñegü láfan.", // Approximation
                glossaryTermFever: "Láfan: Lídaüga le lánina lúguchu, lidan ladaüga 38°C (100.4°F).", // Approximation
                culturalNoteFever: "Nota Cultural le lánina Láfan: Lidan jujun tinamit, láfan líchuguni ámuñegü o líchuguni láfan le lánina k'aslemal nabúga lidan líchuguni láfan le lánina medisin. Lidan lídaüga le lánina k'aslemal.", // Approximation
                glossaryTermAntiseptic: "Antiséptico: Jun k'aslemal le kixaq'ij o kixaq'ij ta la k'iyarik rech ri man kilitaj ta.", // Approximation (Using K'iche' term as placeholder)
                culturalNoteBandage: "Nota Cultural le lánina Bánda: Líchuguni le lánina búma le lánina lídaüga le lánina líchuguni le lánina bánda súbuha lidan líchuguni le lánina ya', lidan lídaüga le lánina k'aslemal.", // Approximation
             }
        };

        const guideContent = {
            en: [
                { titleKey: "guideStep1Title", textKey: "guideStep1Text", image: "https://placehold.co/600x400?text=Handwashing+Illustration" },
                { titleKey: "guideStep2Title", textKey: "guideStep2Text", image: "https://placehold.co/600x400?text=Bandage+Illustration" }
            ],
             es: [
                { titleKey: "guideStep1Title", textKey: "guideStep1Text", image: "https://placehold.co/600x400?text=Ilustracion+Lavado+Manos" },
                { titleKey: "guideStep2Title", textKey: "guideStep2Text", image: "https://placehold.co/600x400?text=Ilustracion+Vendaje" }
            ],
             kiche: [
                { titleKey: "guideStep1Title", textKey: "guideStep1Text", image: "https://placehold.co/600x400?text=Retal+Ch'ajonik+Q'ab'" },
                { titleKey: "guideStep2Title", textKey: "guideStep2Text", image: "https://placehold.co/600x400?text=Retal+K'am" }
            ],
             garifuna: [
                { titleKey: "guideStep1Title", textKey: "guideStep1Text", image: "https://placehold.co/600x400?text=Picha+Uguchu" },
                { titleKey: "guideStep2Title", textKey: "guideStep2Text", image: "https://placehold.co/600x400?text=Picha+Banda" }
            ]
        };

        const assessmentQuestions = {
            en: [
                { type: "text", labelKey: "assessmentQ1Label", id: "patient-name", required: true },
                { type: "number", labelKey: "assessmentQ2Label", id: "patient-age", required: true, min: 0 },
                { type: "textarea", labelKey: "assessmentQ3Label", id: "main-complaint", required: true },
                { type: "radio", labelKey: "assessmentQ4Label", id: "fever-present", options: [{ value: "yes", labelKey: "assessmentQ4OptionYes" }, { value: "no", labelKey: "assessmentQ4OptionNo" }], required: true },
                { type: "radio", labelKey: "assessmentQ5Label", id: "difficulty-breathing", options: [{ value: "yes", labelKey: "assessmentQ5OptionYes" }, { value: "no", labelKey: "assessmentQ5OptionNo" }], required: true }
            ],
             es: [
                { type: "text", labelKey: "assessmentQ1Label", id: "patient-name", required: true },
                { type: "number", labelKey: "assessmentQ2Label", id: "patient-age", required: true, min: 0 },
                { type: "textarea", labelKey: "assessmentQ3Label", id: "main-complaint", required: true },
                { type: "radio", labelKey: "assessmentQ4Label", id: "fever-present", options: [{ value: "yes", labelKey: "assessmentQ4OptionYes" }, { value: "no", labelKey: "assessmentQ4OptionNo" }], required: true },
                { type: "radio", labelKey: "assessmentQ5Label", id: "difficulty-breathing", options: [{ value: "yes", labelKey: "assessmentQ5OptionYes" }, { value: "no", labelKey: "assessmentQ5OptionNo" }], required: true }
            ],
             kiche: [
                { type: "text", labelKey: "assessmentQ1Label", id: "patient-name", required: true },
                { type: "number", labelKey: "assessmentQ2Label", id: "patient-age", required: true, min: 0 },
                { type: "textarea", labelKey: "assessmentQ3Label", id: "main-complaint", required: true },
                { type: "radio", labelKey: "assessmentQ4Label", id: "fever-present", options: [{ value: "yes", labelKey: "assessmentQ4OptionYes" }, { value: "no", labelKey: "assessmentQ4OptionNo" }], required: true },
                { type: "radio", labelKey: "assessmentQ5Label", id: "difficulty-breathing", options: [{ value: "yes", labelKey: "assessmentQ5OptionYes" }, { value: "no", labelKey: "assessmentQ5OptionNo" }], required: true }
            ],
             garifuna: [
                { type: "text", labelKey: "assessmentQ1Label", id: "patient-name", required: true },
                { type: "number", labelKey: "assessmentQ2Label", id: "patient-age", required: true, min: 0 },
                { type: "textarea", labelKey: "assessmentQ3Label", id: "main-complaint", required: true },
                { type: "radio", labelKey: "assessmentQ4Label", id: "fever-present", options: [{ value: "yes", labelKey: "assessmentQ4OptionYes" }, { value: "no", labelKey: "assessmentQ4OptionNo" }], required: true },
                { type: "radio", labelKey: "assessmentQ5Label", id: "difficulty-breathing", options: [{ value: "yes", labelKey: "assessmentQ5OptionYes" }, { value: "no", labelKey: "assessmentQ5OptionNo" }], required: true }
            ]
        };

        const flowchartData = {
            nodes: [
                { id: 'node1', x: 200, y: 50, textKey: 'flowchartNode1Text' },
                { id: 'node2', x: 200, y: 150, textKey: 'flowchartNode2Text' },
                { id: 'node3', x: 200, y: 250, textKey: 'flowchartNode3Text' },
                { id: 'node4', x: 100, y: 350, textKey: 'flowchartNode4Text' }, // Yes branch
                { id: 'node5', x: 300, y: 350, textKey: 'flowchartNode5Text' }, // No branch
                { id: 'node6', x: 100, y: 450, textKey: 'flowchartNode6Text' }, // Yes branch from node 5
                { id: 'node7', x: 300, y: 450, textKey: 'flowchartNode7Text' }  // No branch from node 5
            ],
            edges: [
                { from: 'node1', to: 'node2' },
                { from: 'node2', to: 'node3' },
                { from: 'node3', to: 'node4', label: translations.en.assessmentQ4OptionYes },
                { from: 'node3', to: 'node5', label: translations.en.assessmentQ4OptionNo },
                { from: 'node5', to: 'node6', label: translations.en.assessmentQ5OptionYes },
                { from: 'node5', to: 'node7', label: translations.en.assessmentQ5OptionNo }
            ]
        };

        const glossaryData = {
            fever: { title: "Fever", textKey: "glossaryTermFever" },
            antiseptic: { title: "Antiseptic", textKey: "glossaryTermAntiseptic" }
        };

        const culturalNotesData = {
            fever: { title: "Cultural Note on Fever", textKey: "culturalNoteFever" },
            bandage: { title: "Cultural Note on Bandages", textKey: "culturalNoteBandage" }
        };


        // --- State ---
        let currentLanguage = 'en';
        let activeSection = 'guides';
        let assessmentState = {}; // To store form data
        let totalAssessmentQuestions = 0;
        let completedAssessmentQuestions = 0;

        // --- Elements ---
        const languageButton = document.getElementById('language-button');
        const languageDropdown = document.getElementById('language-dropdown');
        const currentLanguageText = document.getElementById('current-language-text');
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        const guideContentDiv = document.getElementById('guide-content');
        const assessmentForm = document.getElementById('assessment-form');
        const assessmentProgress = document.getElementById('assessment-progress');
        const submitAssessmentButton = document.getElementById('submit-assessment');
        const flowchartContainer = document.getElementById('flowchart-container');
        const flowchartInfo = document.getElementById('flowchart-info');
        const flowchartInfoText = document.getElementById('flowchart-info-text');
        const infoModal = document.getElementById('info-modal');
        const infoModalClose = document.getElementById('info-modal-close');
        const infoModalTitle = document.getElementById('info-modal-title');
        const infoModalBody = document.getElementById('info-modal-body');


        // --- Functions ---

        // Language Switching
        function updateTextContent() {
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    el.textContent = translations[currentLanguage][key];
                }
            });

             // Update language button text
            const langName = languageDropdown.querySelector(`button[data-lang="${currentLanguage}"]`).textContent;
            currentLanguageText.textContent = langName;

            // Update dynamic content
            renderGuideContent();
            renderAssessmentForm();
            renderFlowchart(); // Re-render flowchart for text updates
        }

        function switchLanguage(lang) {
            currentLanguage = lang;
            updateTextContent();
            // Close dropdown after selection
            languageDropdown.classList.remove('active');
            languageButton.setAttribute('aria-expanded', 'false');
        }

        // Navigation
        function navigateTo(sectionId) {
            activeSection = sectionId;

            navLinks.forEach(link => {
                if (link.getAttribute('data-section') === sectionId) {
                    link.classList.add('active');
                    link.setAttribute('aria-current', 'page');
                } else {
                    link.classList.remove('active');
                    link.removeAttribute('aria-current');
                }
            });

            contentSections.forEach(section => {
                if (section.id === sectionId) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });

            // Reset flowchart info when navigating away
            if (sectionId !== 'flowcharts') {
                 flowchartInfo.classList.remove('active');
                 flowchartInfoText.textContent = '';
            }
        }

        // Render Content Sections
        function renderGuideContent() {
            guideContentDiv.innerHTML = ''; // Clear current content
            const guides = guideContent[currentLanguage] || guideContent['en']; // Fallback to English

            guides.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.classList.add('guide-step');
                stepDiv.innerHTML = `
                    <h3 data-key="${step.titleKey}">${translations[currentLanguage][step.titleKey] || translations['en'][step.titleKey]}</h3>
                    <img src="${step.image}" alt="Illustration for step ${index + 1}" class="guide-illustration">
                    <p class="guide-text" data-key="${step.textKey}">${translations[currentLanguage][step.textKey] || translations['en'][step.textKey]}</p>
                `;
                guideContentDiv.appendChild(stepDiv);
            });
             // Add event listeners for potential modal view on images
            guideContentDiv.querySelectorAll('.guide-illustration').forEach(img => {
                 img.addEventListener('click', openImageModal);
            });
        }

         function openImageModal(event) {
            const imgSrc = event.target.src;
            const imgAlt = event.target.alt;

            infoModalTitle.textContent = imgAlt; // Use alt text as title
            infoModalBody.innerHTML = `<img src="${imgSrc}" alt="${imgAlt}" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">`;
            infoModal.classList.add('active');
         }


        function renderAssessmentForm() {
            assessmentForm.innerHTML = ''; // Clear current form
            const questions = assessmentQuestions[currentLanguage] || assessmentQuestions['en']; // Fallback

            totalAssessmentQuestions = questions.length;
            completedAssessmentQuestions = 0;
            updateAssessmentProgress(); // Reset progress

            questions.forEach(q => {
                const questionGroup = document.createElement('div');
                questionGroup.classList.add('form-group');

                const label = document.createElement('label');
                label.setAttribute('for', q.id);
                label.setAttribute('data-key', q.labelKey);
                label.textContent = translations[currentLanguage][q.labelKey] || translations['en'][q.labelKey];
                if (q.required) {
                    label.innerHTML += ' <span style="color: var(--danger-color);">*</span>';
                }
                questionGroup.appendChild(label);

                if (q.type === 'text' || q.type === 'number' || q.type === 'textarea') {
                    const input = document.createElement(q.type === 'textarea' ? 'textarea' : 'input');
                    input.setAttribute('type', q.type);
                    input.setAttribute('id', q.id);
                    input.setAttribute('name', q.id);
                    if (q.required) input.setAttribute('required', '');
                    if (q.type === 'number' && q.min !== undefined) input.setAttribute('min', q.min);
                     input.value = assessmentState[q.id] || ''; // Restore state
                    input.addEventListener('input', handleAssessmentInput);
                    questionGroup.appendChild(input);
                } else if (q.type === 'radio' || q.type === 'checkbox') {
                     const optionsGroup = document.createElement('div');
                     optionsGroup.classList.add(q.type === 'radio' ? 'radio-group' : 'checkbox-group');
                     q.options.forEach(opt => {
                         const optionId = `${q.id}-${opt.value}`;
                         const optionLabel = document.createElement('label');
                         optionLabel.setAttribute('for', optionId);

                         const optionInput = document.createElement('input');
                         optionInput.setAttribute('type', q.type);
                         optionInput.setAttribute('id', optionId);
                         optionInput.setAttribute('name', q.id);
                         optionInput.setAttribute('value', opt.value);
                         if (q.required && q.type === 'radio') optionInput.setAttribute('required', ''); // Required for radio groups
                         if (assessmentState[q.id] === opt.value || (Array.isArray(assessmentState[q.id]) && assessmentState[q.id].includes(opt.value))) {
                              optionInput.checked = true; // Restore state
                         }

                         const optionText = document.createElement('span');
                         optionText.setAttribute('data-key', opt.labelKey);
                         optionText.textContent = translations[currentLanguage][opt.labelKey] || translations['en'][opt.labelKey];

                         optionLabel.appendChild(optionInput);
                         optionLabel.appendChild(optionText);
                         optionsGroup.appendChild(optionLabel);

                         optionInput.addEventListener('change', handleAssessmentInput);
                     });
                     questionGroup.appendChild(optionsGroup);
                }

                assessmentForm.appendChild(questionGroup);
            });

            // Add glossary/cultural note triggers
            addInteractiveTerms(assessmentForm);
        }

        function handleAssessmentInput(event) {
             const input = event.target;
             const name = input.name;
             const type = input.type;

             if (type === 'radio') {
                 assessmentState[name] = input.value;
             } else if (type === 'checkbox') {
                  if (!assessmentState[name]) assessmentState[name] = [];
                  if (input.checked) {
                      if (!assessmentState[name].includes(input.value)) assessmentState[name].push(input.value);
                  } else {
                      assessmentState[name] = assessmentState[name].filter(val => val !== input.value);
                  }
             } else {
                 assessmentState[name] = input.value;
             }

             updateAssessmentProgress();
        }

        function updateAssessmentProgress() {
             const questions = assessmentQuestions[currentLanguage] || assessmentQuestions['en'];
             completedAssessmentQuestions = 0;

             questions.forEach(q => {
                 const value = assessmentState[q.id];
                 if (q.required) {
                     if (q.type === 'text' || q.type === 'textarea' || q.type === 'number') {
                         if (value && value.trim() !== '') {
                             completedAssessmentQuestions++;
                         }
                     } else if (q.type === 'radio') {
                         if (value !== undefined && value !== null) {
                             completedAssessmentQuestions++;
                         }
                     } else if (q.type === 'checkbox') {
                         if (Array.isArray(value) && value.length > 0) {
                             completedAssessmentQuestions++;
                         }
                     }
                 } else {
                      // Count non-required fields if they have a value
                      if (value !== undefined && value !== null && (typeof value !== 'string' || value.trim() !== '') && (!Array.isArray(value) || value.length > 0)) {
                           completedAssessmentQuestions++;
                      } else if (!q.required) {
                          // If not required and has no value, still count towards total for percentage?
                          // Or only count required fields for percentage? Let's count required fields for percentage.
                      }
                 }
             });

             // Recalculate based *only* on required questions for a more meaningful progress
             const requiredQuestions = questions.filter(q => q.required);
             const completedRequired = requiredQuestions.filter(q => {
                 const value = assessmentState[q.id];
                 if (q.type === 'text' || q.type === 'textarea' || q.type === 'number') {
                     return value && value.trim() !== '';
                 } else if (q.type === 'radio') {
                     return value !== undefined && value !== null;
                 } else if (q.type === 'checkbox') {
                     return Array.isArray(value) && value.length > 0;
                 }
                 return false;
             }).length;

             totalAssessmentQuestions = requiredQuestions.length; // Base percentage on required questions
             completedAssessmentQuestions = completedRequired;


             const percentage = totalAssessmentQuestions === 0 ? 0 : Math.round((completedAssessmentQuestions / totalAssessmentQuestions) * 100);
             assessmentProgress.style.width = `${percentage}%`;
             assessmentProgress.textContent = `${percentage}%`;

             // Enable/disable submit button based on required fields
             submitAssessmentButton.disabled = completedAssessmentQuestions < totalAssessmentQuestions;
        }


        function renderFlowchart() {
            flowchartContainer.innerHTML = ''; // Clear current flowchart

            const width = 600; // Fixed width for SVG, allow container to scroll
            const height = 600; // Fixed height
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", width);
            svg.setAttribute("height", height);
            svg.setAttribute("viewBox", `0 0 ${width} ${height}`);
            svg.classList.add('flowchart-svg');

            // Render edges first so nodes are on top
            flowchartData.edges.forEach(edge => {
                const fromNode = flowchartData.nodes.find(n => n.id === edge.from);
                const toNode = flowchartData.nodes.find(n => n.id === edge.to);
                if (!fromNode || !toNode) return;

                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", fromNode.x);
                line.setAttribute("y1", fromNode.y + 20); // Start below node
                line.setAttribute("x2", toNode.x);
                line.setAttribute("y2", toNode.y - 20); // End above node
                line.classList.add('flowchart-line');
                svg.appendChild(line);

                // Add label for edges (simple text element)
                 if (edge.label) {
                     const labelX = (fromNode.x + toNode.x) / 2;
                     const labelY = (fromNode.y + 20 + toNode.y - 20) / 2;
                     const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                     text.setAttribute("x", labelX);
                     text.setAttribute("y", labelY);
                     text.setAttribute("dominant-baseline", "middle");
                     text.setAttribute("text-anchor", "middle");
                     text.setAttribute("font-size", "12px");
                     text.setAttribute("fill", "var(--text-light)");
                     text.textContent = edge.label; // Use English label for now, or update edge data
                     svg.appendChild(text);
                 }
            });


            // Render nodes
            flowchartData.nodes.forEach(node => {
                const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
                group.classList.add('flowchart-node');
                group.setAttribute('data-node-id', node.id);
                group.setAttribute('tabindex', '0'); // Make focusable

                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("x", node.x - 50); // Center node
                rect.setAttribute("y", node.y - 20); // Center node
                rect.setAttribute("width", 100);
                rect.setAttribute("height", 40);
                rect.setAttribute("rx", 5); // Rounded corners
                rect.setAttribute("ry", 5);
                rect.setAttribute("fill", "var(--primary-color)");
                rect.setAttribute("stroke", "var(--primary-dark)");
                rect.setAttribute("stroke-width", 2);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", node.x);
                text.setAttribute("y", node.y);
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("text-anchor", "middle");
                text.classList.add('flowchart-text');
                text.setAttribute("fill", "white"); // Text color on node
                 // Add line breaks for long text
                 const translatedText = translations[currentLanguage][node.textKey] || translations['en'][node.textKey];
                 const words = translatedText.split(' ');
                 let line = '';
                 let lines = [];
                 const maxCharsPerLine = 15; // Estimate max characters per line
                 for (let n = 0; n < words.length; n++) {
                     const testLine = line + words[n] + ' ';
                     if (testLine.length > maxCharsPerLine && n > 0) {
                         lines.push(line.trim());
                         line = words[n] + ' ';
                     } else {
                         line = testLine;
                     }
                 }
                 lines.push(line.trim());

                 lines.forEach((line, i) => {
                     const tspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                     tspan.setAttribute("x", node.x);
                     tspan.setAttribute("dy", i === 0 ? (lines.length > 1 ? -8 * (lines.length - 1) / 2 : 0) : 16); // Adjust vertical position
                     tspan.textContent = line;
                     text.appendChild(tspan);
                 });


                group.appendChild(rect);
                group.appendChild(text);

                group.addEventListener('click', handleFlowchartNodeClick);
                 group.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        handleFlowchartNodeClick(e);
                    }
                 });

                svg.appendChild(group);
            });

            flowchartContainer.appendChild(svg);

             // Add glossary/cultural note triggers to flowchart info area
             addInteractiveTerms(flowchartInfo);
        }

        function handleFlowchartNodeClick(event) {
            const nodeId = event.currentTarget.getAttribute('data-node-id');
            const nodeData = flowchartData.nodes.find(n => n.id === nodeId);

            // Remove active class from all nodes
            flowchartContainer.querySelectorAll('.flowchart-node').forEach(nodeEl => {
                nodeEl.classList.remove('active');
            });

            // Add active class to clicked node
            event.currentTarget.classList.add('active');

            // Display info
            if (nodeData) {
                flowchartInfoText.setAttribute('data-key', nodeData.textKey); // Set data-key for translation
                 flowchartInfoText.textContent = translations[currentLanguage][nodeData.textKey] || translations['en'][nodeData.textKey];
                flowchartInfo.classList.add('active');
            } else {
                flowchartInfo.classList.remove('active');
                flowchartInfoText.textContent = '';
            }
        }

        // Glossary and Cultural Notes
        function addInteractiveTerms(container) {
            // Example: Find words "Fever" and "Antiseptic" in English text and wrap them
            // This is a simplistic approach. A robust solution would require more complex text parsing or pre-marked content.
            // For this example, we'll manually add spans around specific keywords in the rendered content.
            // This needs to be done *after* content is rendered and translated.

            // Example for Guide Text (Step 1 & 2)
            if (container === guideContentDiv) {
                 const step1TextEl = guideContentDiv.querySelector('.guide-step:first-child .guide-text');
                 if (step1TextEl) {
                      let text = step1TextEl.innerHTML;
                      // Replace "soap" with <span class="glossary-term" data-term="soap">soap<span class="tooltip">...</span></span>
                      // For simplicity, let's just add spans around pre-defined terms
                      // This requires knowing the exact translated word. A better way is data attributes in source.
                      // Let's simulate by adding spans to the *translated* text based on known terms.
                      // This is still fragile if translations change word order/choice.
                      // A more robust way is to have data attributes in the source content structure.
                      // Let's update the data structure approach. Terms will be marked in the base data.

                      // Re-render guide content with marked terms
                      renderGuideContentWithMarkedTerms();
                 }
                 const step2TextEl = guideContentDiv.querySelector('.guide-step:last-child .guide-text');
                 if (step2TextEl) {
                      renderGuideContentWithMarkedTerms(); // Call the updated render
                 }
            }

            // Example for Assessment Form Labels (after rendering)
            if (container === assessmentForm) {
                 const feverLabel = assessmentForm.querySelector(`label[for="fever-present"]`);
                 if (feverLabel) {
                      // This is complex because the label has child elements (span for required).
                      // A simpler approach for this example is to add a separate trigger icon/text next to the label.
                      // Or, add a class to the label itself and handle click/hover on the label.
                      // Let's add a simple info icon next to relevant labels.
                      const feverQuestionGroup = assessmentForm.querySelector(`input[name="fever-present"]`).closest('.form-group');
                      if (feverQuestionGroup && !feverQuestionGroup.querySelector('.cultural-note-icon')) {
                           const icon = document.createElement('span');
                           icon.classList.add('material-symbols-rounded', 'cultural-note-trigger');
                           icon.textContent = 'info';
                           icon.style.fontSize = '1em';
                           icon.style.marginLeft = 'var(--spacing-unit)';
                           icon.style.verticalAlign = 'middle';
                           icon.style.cursor = 'pointer';
                           icon.setAttribute('data-note', 'fever'); // Link to cultural note data
                           icon.setAttribute('aria-label', 'Cultural note on fever');
                           feverQuestionGroup.querySelector('label').appendChild(icon); // Add icon next to label
                      }
                 }
            }

             // Example for Flowchart Info Text (after update)
             if (container === flowchartInfo) {
                  // This text is updated dynamically. Add listeners to the text element itself.
                  // We need to scan the text content for known terms and wrap them.
                  // This is still fragile. Let's assume for this example, the flowchart info text might contain a glossary term like "fever".
                  // We need a way to mark these terms in the *source* flowchart data.
                  // Let's update the flowchart data structure to include marked terms.
                  // This requires re-rendering or updating the text content carefully.

                  // A simpler approach for the demo: Add event listeners to the flowchart info text area
                  // and check if the text contains known terms, then add dynamic tooltips.
                  // This is still complex. Let's revert to the modal approach for glossary/cultural notes,
                  // triggered by clicking marked terms or icons.

                  // Let's add event listeners to the flowchart info text area and dynamically wrap terms.
                  // This is still not ideal for translation updates.
                  // Best approach: Mark terms in the source data structure (e.g., `text: "Patient presents with <term data-term='fever'>fever</term>."`)
                  // Then, when rendering/updating text, process these custom tags.

                  // Let's simplify: Add a simple info icon next to the flowchart info text if it's relevant.
                  // This requires knowing which nodes have cultural notes. Let's add a `culturalNote` property to nodes.
                  // This is still complex.

                  // Let's go back to the initial plan: Tooltip/Modal triggered by hover/click on marked terms.
                  // We need to parse the text content and wrap terms.
                  // This is best done when rendering the text initially.

                  // Let's add event listeners to the main content area using event delegation
                  // to catch clicks/hovers on elements with specific classes (e.g., `glossary-term`, `cultural-note-trigger`).
             }

            // Add event listeners for glossary/cultural note triggers using delegation
            container.querySelectorAll('.glossary-term, .cultural-note-trigger').forEach(trigger => {
                trigger.removeEventListener('click', handleInfoTriggerClick); // Prevent double-binding
                trigger.addEventListener('click', handleInfoTriggerClick);
                trigger.removeEventListener('keypress', handleInfoTriggerKeypress);
                trigger.addEventListener('keypress', handleInfoTriggerKeypress);
            });
        }

         // Re-render guide content with terms marked for interactivity
         function renderGuideContentWithMarkedTerms() {
              guideContentDiv.innerHTML = ''; // Clear current content
              const guides = guideContent[currentLanguage] || guideContent['en']; // Fallback to English

              guides.forEach((step, index) => {
                  const stepDiv = document.createElement('div');
                  stepDiv.classList.add('guide-step');

                  const title = document.createElement('h3');
                  title.setAttribute('data-key', step.titleKey);
                  title.textContent = translations[currentLanguage][step.titleKey] || translations['en'][step.titleKey];
                  stepDiv.appendChild(title);

                  const img = document.createElement('img');
                  img.src = step.image;
                  img.alt = `Illustration for step ${index + 1}`;
                  img.classList.add('guide-illustration');
                  img.addEventListener('click', openImageModal); // Add click listener for modal
                  stepDiv.appendChild(img);

                  const textPara = document.createElement('p');
                  textPara.classList.add('guide-text');
                  // Manually construct text with spans for terms
                  let textHTML = translations[currentLanguage][step.textKey] || translations['en'][step.textKey];

                  // Simple replacement for known terms - fragile for different translations
                  if (currentLanguage === 'en') {
                      textHTML = textHTML.replace('soap', '<span class="glossary-term" data-term="antiseptic">soap</span>'); // Using antiseptic data for soap example
                       textHTML = textHTML.replace('bandage', '<span class="cultural-note-trigger" data-note="bandage">bandage</span>');
                  } else if (currentLanguage === 'es') {
                       textHTML = textHTML.replace('jabón', '<span class="glossary-term" data-term="antiseptic">jabón</span>');
                       textHTML = textHTML.replace('vendaje', '<span class="cultural-note-trigger" data-note="bandage">vendaje</span>');
                  } else if (currentLanguage === 'kiche') {
                       textHTML = textHTML.replace('ch\'ipaq', '<span class="glossary-term" data-term="antiseptic">ch\'ipaq</span>');
                       textHTML = textHTML.replace('k\'am', '<span class="cultural-note-trigger" data-note="bandage">k\'am</span>');
                  } else if (currentLanguage === 'garifuna') {
                        textHTML = textHTML.replace('jabón', '<span class="glossary-term" data-term="antiseptic">jabón</span>'); // Using Spanish term as placeholder
                        textHTML = textHTML.replace('bánda', '<span class="cultural-note-trigger" data-note="bandage">bánda</span>');
                  }


                  textPara.innerHTML = textHTML;
                  stepDiv.appendChild(textPara);

                  guideContentDiv.appendChild(stepDiv);
              });

               // Re-add interactive term listeners after rendering
              addInteractiveTerms(guideContentDiv);
         }


        function handleInfoTriggerClick(event) {
            const trigger = event.target.closest('.glossary-term, .cultural-note-trigger');
            if (!trigger) return;

            const isGlossary = trigger.classList.contains('glossary-term');
            const key = isGlossary ? trigger.getAttribute('data-term') : trigger.getAttribute('data-note');
            const data = isGlossary ? glossaryData[key] : culturalNotesData[key];

            if (data) {
                infoModalTitle.setAttribute('data-key', data.titleKey ? data.titleKey.replace('glossaryTerm', '').replace('culturalNote', '') + 'Title' : 'InfoTitle'); // Generic title key
                infoModalTitle.textContent = data.title; // Use English title for modal header
                infoModalBody.setAttribute('data-key', data.textKey); // Set data-key for translation
                infoModalBody.textContent = translations[currentLanguage][data.textKey] || translations['en'][data.textKey];
                infoModal.classList.add('active');
            }
        }

         function handleInfoTriggerKeypress(event) {
             if (event.key === 'Enter' || event.key === ' ') {
                 handleInfoTriggerClick(event);
             }
         }


        function closeModal() {
            infoModal.classList.remove('active');
            infoModalTitle.textContent = '';
            infoModalBody.textContent = '';
             infoModalBody.innerHTML = ''; // Clear potential image
        }


        // --- Event Listeners ---

        // Language switcher button toggle
        languageButton.addEventListener('click', () => {
            const isExpanded = languageButton.getAttribute('aria-expanded') === 'true';
            languageButton.setAttribute('aria-expanded', !isExpanded);
            languageDropdown.classList.toggle('active');
        });

        // Language selection
        languageDropdown.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', () => {
                const lang = button.getAttribute('data-lang');
                switchLanguage(lang);
            });
        });

        // Close language dropdown when clicking outside
        document.addEventListener('click', (event) => {
            if (!languageSwitcher.contains(event.target)) {
                languageDropdown.classList.remove('active');
                languageButton.setAttribute('aria-expanded', 'false');
            }
        });

        // Navigation clicks
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const sectionId = link.getAttribute('data-section');
                navigateTo(sectionId);
            });
        });

        // Assessment form submission (simulated)
        assessmentForm.addEventListener('submit', (event) => {
            event.preventDefault();
            // Basic validation check (already handled by button disabled state)
            console.log("Assessment Submitted:", assessmentState);
            alert("Assessment Submitted! (Simulated)"); // Replace with actual submission logic
             // Reset form state after submission
             assessmentState = {};
             renderAssessmentForm();
        });

         // Modal close button
         infoModalClose.addEventListener('click', closeModal);

         // Close modal when clicking outside
         infoModal.addEventListener('click', (event) => {
             if (event.target === infoModal) {
                 closeModal();
             }
         });

         // Close modal with Escape key
         document.addEventListener('keydown', (event) => {
             if (event.key === 'Escape' && infoModal.classList.contains('active')) {
                 closeModal();
             }
         });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            updateTextContent(); // Load initial language texts
            renderGuideContentWithMarkedTerms(); // Render guides with marked terms
            renderAssessmentForm(); // Render assessment form
            renderFlowchart(); // Render flowchart
            navigateTo('guides'); // Start on the guides section
            updateAssessmentProgress(); // Initial progress check
        });

    </script>

</body>
</html>
