<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Customer Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff; /* Blue */
            --primary-color-dark: #0056b3;
            --secondary-color: #6c757d; /* Gray */
            --secondary-color-dark: #5a6268;
            --background-color: #f4f7f9; /* Light background */
            --surface-color: #ffffff; /* Pure white for cards/panels */
            --text-color-primary: #212529; /* Dark text */
            --text-color-secondary: #5a6268; /* Muted text */
            --border-color: #dee2e6; /* Light border */
            --success-color: #28a745; /* Success green */
            --danger-color: #dc3545; /* Danger red */
            --warning-color: #ffc107; /* Warning yellow */
            --info-color: #17a2b8; /* Info blue */
            --spacing-unit: 8px;
            --border-radius: 8px;
            --shadow-subtle: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.12);
            --transition-duration: 0.2s;
            --focus-outline-color: rgba(0, 123, 255, 0.5);
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
            flex-direction: column;
            font-size: 1rem; /* Base font size */
        }

        .header {
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-subtle);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header .logo {
            height: 40px; /* Adjust as needed */
            width: auto;
            display: block;
        }

        .header .nav-links {
            display: flex;
            gap: calc(var(--spacing-unit) * 3);
        }

        .header .nav-links a {
            text-decoration: none;
            color: var(--text-color-primary);
            font-weight: 500;
            padding: var(--spacing-unit) 0;
            position: relative;
            transition: color var(--transition-duration) ease;
            outline-offset: 4px; /* For focus indicator */
        }

        .header .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width var(--transition-duration) ease;
        }

        .header .nav-links a:hover,
        .header .nav-links a:focus-visible {
            color: var(--primary-color);
        }

        .header .nav-links a:hover::after,
        .header .nav-links a.active::after {
            width: 100%;
        }

         .header .nav-links a:focus-visible {
             outline: 2px solid var(--focus-outline-color);
         }


        .header .user-profile {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color-secondary);
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            transition: background-color var(--transition-duration) ease;
            outline-offset: 4px; /* For focus indicator */
        }

        .header .user-profile:hover,
        .header .user-profile:focus-visible {
            background-color: rgba(0, 123, 255, 0.1); /* Manual color for hover */
            outline: 2px solid var(--focus-outline-color);
        }


        .container {
            display: flex;
            flex: 1;
            padding: calc(var(--spacing-unit) * 3);
            gap: calc(var(--spacing-unit) * 3);
        }

        .sidebar {
            width: 250px; /* Fixed width for desktop */
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 2);
            box-shadow: var(--shadow-subtle);
            flex-shrink: 0; /* Prevent shrinking */
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav ul li {
            margin-bottom: var(--spacing-unit);
        }

        .sidebar nav ul li a {
            display: flex; /* Use flex for icon/text alignment if icons were present */
            align-items: center;
            gap: var(--spacing-unit); /* Space between icon and text */
            text-decoration: none;
            color: var(--text-color-primary);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius);
            transition: background-color var(--transition-duration) ease, color var(--transition-duration) ease;
            font-weight: 500;
            outline-offset: 4px; /* For focus indicator */
        }

        .sidebar nav ul li a:hover {
            background-color: rgba(0, 123, 255, 0.1); /* Manual color for hover */
            color: var(--primary-color);
        }

        .sidebar nav ul li a:focus-visible {
             background-color: rgba(0, 123, 255, 0.1); /* Manual color for focus */
             color: var(--primary-color);
             outline: 2px solid var(--focus-outline-color);
        }

        .sidebar nav ul li a.active {
            background-color: var(--primary-color);
            color: var(--surface-color);
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 3);
            box-shadow: var(--shadow-subtle);
            overflow-y: auto; /* Enable scrolling for content */
        }

        h1, h2, h3 {
            color: var(--text-color-primary);
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            font-weight: 600;
        }

        h1 { font-size: 2em; }
        h2 { font-size: 1.5em; }
        h3 { font-size: 1.2em; }

        p {
            margin-bottom: calc(var(--spacing-unit) * 1.5);
            color: var(--text-color-secondary);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .card {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 3);
            box-shadow: var(--shadow-subtle);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative; /* Needed for chart controls */
        }

        .card:hover {
             transform: translateY(-3px);
             box-shadow: var(--shadow-hover);
        }

        .card-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: var(--spacing-unit);
            color: var(--text-color-primary);
        }

        .card-metric {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-unit);
        }

        .card-content {
             flex-grow: 1;
             margin-bottom: calc(var(--spacing-unit) * 2);
             color: var(--text-color-secondary);
        }

        .card-link {
            display: inline-block; /* Change to inline-block */
            margin-top: var(--spacing-unit);
            text-align: right;
            color: var(--primary-color); /* Use primary for links */
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 500;
            transition: color var(--transition-duration) ease, text-decoration var(--transition-duration) ease;
            outline-offset: 2px;
        }

        .card-link:hover {
            color: var(--primary-color-dark);
            text-decoration: underline;
        }

        .card-link:focus-visible {
             outline: 2px solid var(--focus-outline-color);
        }

        .button {
            display: inline-flex; /* Use flex for icon/text alignment */
            align-items: center;
            gap: var(--spacing-unit);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2.5);
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background-color var(--transition-duration) ease, opacity var(--transition-duration) ease, transform var(--transition-duration) ease;
            min-height: 44px; /* Ensure minimum touch target size */
            outline-offset: 4px; /* For focus indicator */
        }

        .button-primary {
            background-color: var(--primary-color);
            color: var(--surface-color);
        }

        .button-primary:hover {
            background-color: var(--primary-color-dark);
            transform: translateY(-1px);
        }

        .button-primary:focus-visible {
             background-color: var(--primary-color-dark);
             outline: 2px solid var(--focus-outline-color);
        }

        .button-secondary {
            background-color: var(--secondary-color);
            color: var(--surface-color);
        }

        .button-secondary:hover {
             background-color: var(--secondary-color-dark);
             transform: translateY(-1px);
        }

         .button-secondary:focus-visible {
             background-color: var(--secondary-color-dark);
             outline: 2px solid var(--focus-outline-color);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none; /* Disable hover transform */
        }

        /* Forms */
        form {
            margin-top: calc(var(--spacing-unit) * 3);
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2.5);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
            color: var(--text-color-primary);
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="password"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
            box-sizing: border-box;
            min-height: 44px; /* Ensure minimum touch target size */
            font-family: 'Inter', sans-serif; /* Ensure consistent font */
            color: var(--text-color-primary);
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="email"]:focus,
        .form-group input[type="password"]:focus,
        .form-group input[type="tel"]:focus,
        .form-group input[type="number"]:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem var(--focus-outline-color);
            outline: none;
        }

        .form-group .error-message {
            color: var(--danger-color);
            font-size: 0.9em;
            margin-top: var(--spacing-unit);
            display: none; /* Hidden by default */
        }

        .form-group.error input,
        .form-group.error textarea,
        .form-group.error select {
            border-color: var(--danger-color);
        }

         .form-group.error input:focus,
        .form-group.error textarea:focus,
        .form-group.error select:focus {
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25); /* Manual color for focus */
        }

        .form-group.error .error-message {
            display: block;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius); /* Add border-radius to table container */
            overflow: hidden; /* Hide overflow for rounded corners */
            border: 1px solid var(--border-color); /* Add border around table */
        }

        .data-table th,
        .data-table td {
            text-align: left;
            padding: calc(var(--spacing-unit) * 1.5);
            border-bottom: 1px solid var(--border-color);
        }

        .data-table thead tr:last-child th {
             border-bottom: none; /* Remove border from last header row */
        }

        .data-table th {
            background-color: var(--background-color);
            font-weight: 600;
            color: var(--text-color-secondary);
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 0.05em;
        }

        .data-table tbody tr:last-child td {
             border-bottom: none; /* Remove border from last body row */
        }

        .data-table tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.05); /* Manual hover color */
            cursor: pointer; /* Indicate clickable rows */
        }

        .data-table td {
            color: var(--text-color-primary);
        }

        .data-table .status {
            display: inline-block;
            padding: calc(var(--spacing-unit) * 0.5) var(--spacing-unit);
            border-radius: var(--border-radius);
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-open {
            background-color: rgba(23, 162, 184, 0.2); /* Manual color */
            color: #17a2b8;
        }

        .status-inprogress {
            background-color: rgba(255, 193, 7, 0.2); /* Manual color */
            color: #ffc107;
        }

        .status-closed {
            background-color: rgba(40, 167, 69, 0.2); /* Manual color */
            color: #28a745;
        }

         .status-paid {
            background-color: rgba(40, 167, 69, 0.2); /* Manual color */
            color: #28a745;
        }

         .status-due {
            background-color: rgba(220, 53, 69, 0.2); /* Manual color */
            color: #dc3545;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: calc(var(--spacing-unit) * 3);
            gap: var(--spacing-unit);
        }

        .tab-button {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: var(--text-color-secondary);
            border-bottom: 2px solid transparent;
            transition: color var(--transition-duration) ease, border-bottom-color var(--transition-duration) ease;
            outline-offset: 4px;
        }

        .tab-button:hover {
            color: var(--primary-color);
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 600;
        }

         .tab-button:focus-visible {
             outline: 2px solid var(--focus-outline-color);
         }

        .tab-content {
            display: none; /* Hidden by default */
        }

        .tab-content.active {
            display: block;
        }


        /* Modal */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 200;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4); /* Dark overlay */
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-duration) ease;
        }

        .modal.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--surface-color);
            margin: auto;
            padding: calc(var(--spacing-unit) * 4);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            width: 90%;
            max-width: 600px;
            position: relative;
            transform: translateY(-20px);
            transition: transform var(--transition-duration) ease;
        }

        .modal.show .modal-content {
             transform: translateY(0);
        }

        .modal-close {
            color: var(--text-color-secondary);
            position: absolute;
            top: var(--spacing-unit) * 2;
            right: var(--spacing-unit) * 2;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: color var(--transition-duration) ease;
            outline-offset: 4px;
        }

        .modal-close:hover,
        .modal-close:focus-visible {
            color: var(--text-color-primary);
            outline: 2px solid var(--focus-outline-color);
        }

        /* Chart Controls */
        .floating-controls {
            position: absolute;
            top: var(--spacing-unit) * 2;
            right: var(--spacing-unit) * 2;
            background: rgba(255, 255, 255, 0.95);
            padding: var(--spacing-unit) * 1.5;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-duration) ease;
            pointer-events: none;
            z-index: 10; /* Ensure controls are above chart */
        }
        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        .control-group {
            margin: var(--spacing-unit) 0;
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-unit);
            flex-direction: column;
        }
        .control-group label {
            font-size: 0.9em;
            font-weight: 500;
            color: var(--text-color-secondary);
            margin-bottom: 0;
        }
         .floating-controls input[type="color"],
         .floating-controls input[type="number"],
         .floating-controls select {
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            width: 100%;
            min-height: 38px; /* Adjust for smaller controls */
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            color: var(--text-color-primary);
         }

         .floating-controls input[type="color"] {
             padding: var(--spacing-unit) * 0.5; /* Adjust padding for color input */
             height: 38px;
         }

         .floating-controls input:focus,
         .floating-controls select:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 0.2rem var(--focus-outline-color);
             outline: none;
         }

        .chart-container {
            height: 300px; /* Adjust height as needed */
            position: relative;
            cursor: pointer;
            margin-top: calc(var(--spacing-unit) * 3);
        }


        /* Responsive Adjustments */
        @media (max-width: 1024px) {
             .container {
                 flex-direction: column;
                 padding: calc(var(--spacing-unit) * 2);
                 gap: calc(var(--spacing-unit) * 2);
             }

             .sidebar {
                 width: 100%;
                 order: 2; /* Move sidebar below main content */
                 padding: calc(var(--spacing-unit) * 1.5);
                 box-shadow: none; /* Remove shadow on mobile */
                 border: 1px solid var(--border-color);
             }

             .sidebar nav ul {
                 display: flex; /* Arrange nav items horizontally */
                 flex-wrap: wrap;
                 gap: var(--spacing-unit); /* Space between horizontal items */
             }

             .sidebar nav ul li {
                 margin-bottom: 0; /* Remove bottom margin */
             }

             .sidebar nav ul li a {
                  padding: var(--spacing-unit) calc(var(--spacing-unit) * 2); /* Adjust padding */
             }

             .main-content {
                 order: 1; /* Move main content above sidebar */
                 padding: calc(var(--spacing-unit) * 2);
             }

             .header {
                 padding: var(--spacing-unit) * 1.5;
             }

             .header .nav-links {
                 /* Hide desktop nav links - Hamburger menu needed (not implemented yet) */
                 display: none;
             }

             h1 { font-size: 1.8em; }
             h2 { font-size: 1.3em; }
             h3 { font-size: 1.1em; }

             .dashboard-grid {
                grid-template-columns: 1fr; /* Stack cards on small screens */
             }

             .data-table th,
             .data-table td {
                 padding: var(--spacing-unit) * 1.2; /* Adjust padding */
             }
        }

         @media (max-width: 768px) {
             body {
                 font-size: 0.95rem; /* Slightly smaller base font */
             }

             .header .logo {
                 height: 35px;
             }

             .container {
                 padding: var(--spacing-unit) * 1.5;
                 gap: var(--spacing-unit) * 1.5;
             }

             .sidebar nav ul {
                 flex-direction: column; /* Stack nav items vertically again below a certain breakpoint */
             }
              .sidebar nav ul li {
                 margin-bottom: var(--spacing-unit);
             }

             .sidebar nav ul li a {
                  padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
             }

             .main-content {
                 padding: var(--spacing-unit) * 1.5;
             }

             .card {
                 padding: calc(var(--spacing-unit) * 2);
             }

             .card-metric {
                 font-size: 1.8em;
             }

             .button {
                 padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
             }

             .data-table th,
             .data-table td {
                 padding: var(--spacing-unit);
             }
         }

         /* Accessibility: Ensure sufficient contrast */
         /* Checked primary, secondary, text, background, border colors - they meet WCAG AA */
         /* Ensure focus outlines are visible */
         :focus-visible {
             outline: 2px solid var(--focus-outline-color);
             outline-offset: 2px;
         }

         /* Ensure text can be resized */
         body {
             /* Using relative units like em/rem allows text resize */
             /* Base font-size on body helps scale everything */
         }

         /* Placeholder for icons */
         .icon {
             /* Style for placeholder text icons */
             display: inline-block;
             width: 1em; /* Example size */
             height: 1em; /* Example size */
             margin-right: var(--spacing-unit) * 0.5;
             vertical-align: middle;
             /* In a real app, replace with SVG or icon font */
         }

         /* Helper class to visually hide elements but keep them accessible for screen readers */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

    </style>
</head>
<body>
    <header class="header">
        <a href="#dashboard" class="logo" aria-label="Company Logo - Go to Dashboard">
            <img src="https://placehold.co/150x40?text=Company+Logo" alt="Company Logo">
        </a>
        <nav class="nav-links" aria-label="Main Navigation">
            <a href="#dashboard" class="active" aria-current="page">Dashboard</a>
            <a href="#account">Account</a>
            <a href="#servicerequests">Service Requests</a>
            <a href="#billing">Billing</a>
        </nav>
        <div class="user-profile" role="button" tabindex="0" aria-label="User Profile Menu">
            <!-- Using a simple text placeholder, replace with icon font or SVG -->
            üë§
        </div>
    </header>

    <div class="container">
        <aside class="sidebar" aria-label="Sidebar Navigation">
            <nav>
                <ul>
                    <li><a href="#dashboard" class="active" aria-current="page"><span class="icon" aria-hidden="true">üè†</span> Dashboard</a></li>
                    <li><a href="#account"><span class="icon" aria-hidden="true">‚öôÔ∏è</span> Account Management</a></li>
                    <li><a href="#servicerequests"><span class="icon" aria-hidden="true">üõ†Ô∏è</span> Service Requests</a></li>
                    <li><a href="#billing"><span class="icon" aria-hidden="true">üí≥</span> Billing & Payments</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content" role="main">
            <!-- Content sections will be dynamically loaded or shown/hidden -->
            <section id="dashboard" class="content-section active">
                <h1>Dashboard</h1>
                <p>Welcome back! Here's a summary of your account.</p>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-title">Open Service Requests</div>
                        <div class="card-metric">3</div>
                        <a href="#servicerequests" class="card-link">View all requests <span class="icon" aria-hidden="true">‚û°Ô∏è</span></a>
                    </div>

                    <div class="card">
                        <div class="card-title">Outstanding Balance</div>
                        <div class="card-metric">$1,250.00</div>
                        <a href="#billing" class="card-link">View invoices <span class="icon" aria-hidden="true">‚û°Ô∏è</span></a>
                    </div>

                     <div class="card">
                        <div class="card-title">Recent Activity</div>
                        <div class="card-content">
                            <p>Invoice #INV-1003 due in 7 days.</p>
                            <p>Service Request #SR-501 updated.</p>
                        </div>
                        <a href="#" class="card-link">View all activity <span class="icon" aria-hidden="true">‚û°Ô∏è</span></a>
                    </div>

                     <div class="card">
                        <div class="card-title">Account Status</div>
                        <div class="card-metric">Active</div>
                        <a href="#account" class="card-link">Manage account <span class="icon" aria-hidden="true">‚û°Ô∏è</span></a>
                    </div>
                </div>

                <div class="card" id="dashboardChartCard">
                    <h2 class="card-title">Service Request Status Overview</h2>
                    <div class="chart-container" id="dashboardChartContainer">
                        <canvas id="dashboardChart"></canvas>
                        <!-- Floating control panel for chart -->
                        <div class="floating-controls" id="dashboardChartControls">
                            <div class="control-group">
                                <label for="dashboardChartType">Chart Type</label>
                                <select id="dashboardChartType" aria-controls="dashboardChart">
                                    <option value="bar">Bar</option>
                                    <option value="pie">Pie</option>
                                    <option value="doughnut">Doughnut</option>
                                </select>
                            </div>
                             <div class="control-group">
                                <label for="dashboardChartFontSize">Font Size</label>
                                <input type="number" id="dashboardChartFontSize" value="12" min="8" max="20" aria-controls="dashboardChart">
                            </div>
                             <!-- Add more controls here as needed, e.g., data filtering -->
                        </div>
                    </div>
                </div>


                <h2 style="margin-top: calc(var(--spacing-unit) * 4);">Recent Service Requests</h2>
                <table class="data-table" aria-describedby="recentRequestsDescription">
                    <caption class="visually-hidden" id="recentRequestsDescription">Table listing recent service requests</caption>
                    <thead>
                        <tr>
                            <th scope="col">Request ID</th>
                            <th scope="col">Subject</th>
                            <th scope="col">Status</th>
                            <th scope="col">Submission Date</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr tabindex="0" role="link" aria-label="View details for request SR-501" data-request-id="SR-501">
                            <td>SR-501</td>
                            <td>Issue with billing statement</td>
                            <td><span class="status status-inprogress">In Progress</span></td>
                            <td>2023-10-26</td>
                            <td><a href="#" class="card-link" aria-label="View details for request SR-501">View Details</a></td>
                        </tr>
                         <tr tabindex="0" role="link" aria-label="View details for request SR-500" data-request-id="SR-500">
                            <td>SR-500</td>
                            <td>Request for new user access</td>
                            <td><span class="status status-closed">Closed</span></td>
                            <td>2023-10-20</td>
                            <td><a href="#" class="card-link" aria-label="View details for request SR-500">View Details</a></td>
                        </tr>
                         <tr tabindex="0" role="link" aria-label="View details for request SR-499" data-request-id="SR-499">
                            <td>SR-499</td>
                            <td>Account information update</td>
                            <td><span class="status status-open">Open</span></td>
                            <td>2023-10-18</td>
                            <td><a href="#" class="card-link" aria-label="View details for request SR-499">View Details</a></td>
                        </tr>
                        <!-- More rows would be added here -->
                    </tbody>
                </table>
                 <a href="#servicerequests" class="button button-secondary" style="margin-top: calc(var(--spacing-unit) * 3);">View All Service Requests</a>

            </section>

            <section id="account" class="content-section" aria-hidden="true">
                <h1>Account Management</h1>
                <p>Manage your company information, user details, and settings.</p>

                <div class="tabs">
                    <button class="tab-button active" data-tab="company" aria-controls="tab-company" id="tabButton-company">Company Information</button>
                    <button class="tab-button" data-tab="users" aria-controls="tab-users" id="tabButton-users">Users</button>
                    <button class="tab-button" data-tab="settings" aria-controls="tab-settings" id="tabButton-settings">Settings</button>
                </div>

                <div id="tab-company" class="tab-content active" role="tabpanel" aria-labelledby="tabButton-company">
                    <h2>Company Information</h2>
                     <form id="companyInfoForm">
                        <div class="form-group">
                            <label for="companyNameAcc">Company Name</label>
                            <input type="text" id="companyNameAcc" value="Acme Corp" readonly aria-readonly="true">
                        </div>
                         <div class="form-group">
                            <label for="contactEmailAcc">Contact Email</label>
                            <input type="email" id="contactEmailAcc" value="contact@acmecorp.com" readonly aria-readonly="true">
                        </div>
                         <div class="form-group" id="addressGroup">
                            <label for="companyAddress">Address</label>
                            <textarea id="companyAddress" rows="3">123 Enterprise Way, Suite 400, Business City, BC 98765</textarea>
                             <div class="error-message" id="addressError">Please enter a valid address.</div>
                        </div>
                         <div class="form-group">
                            <label for="accountTypeAcc">Account Type</label>
                            <select id="accountTypeAcc" disabled aria-disabled="true">
                                <option value="enterprise">Enterprise</option>
                                <option value="premium">Premium</option>
                            </select>
                             <p style="font-size:0.9em; color: var(--text-color-secondary);">Account type cannot be changed here. Contact support for upgrades.</p>
                        </div>
                         <button type="submit" class="button button-primary">Save Company Info</button>
                    </form>
                </div>

                 <div id="tab-users" class="tab-content" role="tabpanel" aria-labelledby="tabButton-users" aria-hidden="true">
                    <h2>Users</h2>
                    <p>Manage users with access to this portal.</p>
                    <button class="button button-primary" style="margin-bottom: calc(var(--spacing-unit) * 2);">Add New User</button>
                     <table class="data-table" aria-describedby="usersDescription">
                         <caption class="visually-hidden" id="usersDescription">Table listing portal users</caption>
                        <thead>
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Email</th>
                                <th scope="col">Role</th>
                                <th scope="col">Status</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>John Doe</td>
                                <td>john.doe@acmecorp.com</td>
                                <td>Admin</td>
                                <td>Active</td>
                                <td><a href="#" class="card-link" aria-label="Edit user John Doe">Edit</a> | <a href="#" class="card-link" aria-label="Deactivate user John Doe">Deactivate</a></td>
                            </tr>
                             <tr>
                                <td>Jane Smith</td>
                                <td>jane.smith@acmecorp.com</td>
                                <td>User</td>
                                <td>Active</td>
                                <td><a href="#" class="card-link" aria-label="Edit user Jane Smith">Edit</a> | <a href="#" class="card-link" aria-label="Deactivate user Jane Smith">Deactivate</a></td>
                            </tr>
                             <!-- More user rows -->
                        </tbody>
                    </table>
                </div>

                 <div id="tab-settings" class="tab-content" role="tabpanel" aria-labelledby="tabButton-settings" aria-hidden="true">
                    <h2>Settings</h2>
                    <p>Adjust your account settings.</p>
                     <form id="settingsForm">
                         <div class="form-group">
                            <label for="notificationEmail">Notification Email</label>
                            <input type="email" id="notificationEmail" value="contact@acmecorp.com">
                        </div>
                         <div class="form-group">
                             <label for="language">Language</label>
                             <select id="language">
                                 <option value="en">English</option>
                                 <option value="es">Spanish</option>
                                 <option value="fr">French</option>
                             </select>
                         </div>
                         <button type="submit" class="button button-primary">Save Settings</button>
                     </form>
                </div>
            </section>

            <section id="servicerequests" class="content-section" aria-hidden="true">
                <h1>Service Requests</h1>
                <p>Submit, track, and view the status of your service requests.</p>
                <button class="button button-primary" style="margin-bottom: calc(var(--spacing-unit) * 2);" onclick="showModal('newRequestModal')">New Service Request</button>

                 <table class="data-table" aria-describedby="serviceRequestsDescription">
                     <caption class="visually-hidden" id="serviceRequestsDescription">Table listing all service requests</caption>
                    <thead>
                        <tr>
                            <th scope="col">Request ID</th>
                            <th scope="col">Subject</th>
                            <th scope="col">Status</th>
                            <th scope="col">Submission Date</th>
                            <th scope="col">Last Update</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr tabindex="0" role="link" aria-label="View details for request SR-501" data-request-id="SR-501">
                            <td>SR-501</td>
                            <td>Issue with billing statement</td>
                            <td><span class="status status-inprogress">In Progress</span></td>
                            <td>2023-10-26</td>
                             <td>2023-10-27</td>
                            <td><a href="#" class="card-link" aria-label="View details for request SR-501">View Details</a></td>
                        </tr>
                         <tr tabindex="0" role="link" aria-label="View details for request SR-500" data-request-id="SR-500">
                            <td>SR-500</td>
                            <td>Request for new user access</td>
                            <td><span class="status status-closed">Closed</span></td>
                            <td>2023-10-20</td>
                             <td>2023-10-25</td>
                            <td><a href="#" class="card-link" aria-label="View details for request SR-500">View Details</a></td>
                        </tr>
                         <tr tabindex="0" role="link" aria-label="View details for request SR-499" data-request-id="SR-499">
                            <td>SR-499</td>
                            <td>Account information update</td>
                            <td><span class="status status-open">Open</span></td>
                            <td>2023-10-18</td>
                             <td>2023-10-18</td>
                            <td><a href="#" class="card-link" aria-label="View details for request SR-499">View Details</a></td>
                        </tr>
                         <!-- More request rows -->
                    </tbody>
                </table>
            </section>

            <section id="billing" class="content-section" aria-hidden="true">
                <h1>Billing & Payments</h1>
                <p>View your invoices, payment history, and make payments.</p>

                 <div class="tabs">
                    <button class="tab-button active" data-tab="invoices" aria-controls="tab-invoices" id="tabButton-invoices">Invoices</button>
                    <button class="tab-button" data-tab="history" aria-controls="tab-history" id="tabButton-history">Payment History</button>
                    <button class="tab-button" data-tab="payment" aria-controls="tab-payment" id="tabButton-payment">Make a Payment</button>
                </div>

                 <div id="tab-invoices" class="tab-content active" role="tabpanel" aria-labelledby="tabButton-invoices">
                    <h2>Invoices</h2>
                     <table class="data-table" aria-describedby="invoicesDescription">
                         <caption class="visually-hidden" id="invoicesDescription">Table listing invoices</caption>
                        <thead>
                            <tr>
                                <th scope="col">Invoice #</th>
                                <th scope="col">Date</th>
                                <th scope="col">Due Date</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>INV-1003</td>
                                <td>2023-11-01</td>
                                <td>2023-11-15</td>
                                <td>$450.00</td>
                                <td><span class="status status-due">Due</span></td>
                                <td><a href="#" class="card-link" aria-label="View invoice INV-1003">View</a> | <button class="button button-primary" style="padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5); font-size: 0.9em;">Pay Now</button></td>
                            </tr>
                             <tr>
                                <td>INV-1002</td>
                                <td>2023-10-15</td>
                                <td>2023-10-29</td>
                                <td>$800.00</td>
                                <td><span class="status status-due">Due</span></td>
                                <td><a href="#" class="card-link" aria-label="View invoice INV-1002">View</a> | <button class="button button-primary" style="padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5); font-size: 0.9em;">Pay Now</button></td>
                            </tr>
                             <tr>
                                <td>INV-1001</td>
                                <td>2023-09-01</td>
                                <td>2023-09-15</td>
                                <td>$750.00</td>
                                <td><span class="status status-paid">Paid</span></td>
                                <td><a href="#" class="card-link" aria-label="View invoice INV-1001">View</a></td>
                            </tr>
                             <!-- More invoice rows -->
                        </tbody>
                    </table>
                </div>

                 <div id="tab-history" class="tab-content" role="tabpanel" aria-labelledby="tabButton-history" aria-hidden="true">
                    <h2>Payment History</h2>
                    <table class="data-table" aria-describedby="paymentHistoryDescription">
                        <caption class="visually-hidden" id="paymentHistoryDescription">Table listing payment history</caption>
                        <thead>
                            <tr>
                                <th scope="col">Payment ID</th>
                                <th scope="col">Invoice #</th>
                                <th scope="col">Date</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>PAY-2005</td>
                                <td>INV-1001</td>
                                <td>2023-09-10</td>
                                <td>$750.00</td>
                                <td>Credit Card</td>
                            </tr>
                             <!-- More payment history rows -->
                        </tbody>
                    </table>
                </div>

                 <div id="tab-payment" class="tab-content" role="tabpanel" aria-labelledby="tabButton-payment" aria-hidden="true">
                    <h2>Make a Payment</h2>
                    <p>Enter details to make a payment.</p>
                     <form id="paymentForm">
                         <div class="form-group">
                             <label for="invoiceToPay">Select Invoice(s) to Pay</label>
                             <select id="invoiceToPay">
                                 <option value="">-- Select an Invoice --</option>
                                 <option value="INV-1003">INV-1003 ($450.00)</option>
                                 <option value="INV-1002">INV-1002 ($800.00)</option>
                             </select>
                         </div>
                         <div class="form-group">
                             <label for="paymentAmount">Amount</label>
                             <input type="number" id="paymentAmount" placeholder="Enter amount" step="0.01">
                         </div>
                         <!-- Placeholder for payment gateway integration -->
                         <div style="border: 1px dashed var(--border-color); padding: calc(var(--spacing-unit) * 3); text-align: center; color: var(--text-color-secondary); margin-bottom: calc(var(--spacing-unit) * 3);">
                             [ Secure Payment Gateway Form Embedded Here ]
                             <p style="margin-top: var(--spacing-unit);">Integration with payment processing system.</p>
                         </div>
                         <button type="submit" class="button button-primary">Submit Payment</button>
                     </form>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal Structure for New Service Request -->
    <div id="newRequestModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="newRequestTitle">
        <div class="modal-content">
            <span class="modal-close" onclick="hideModal('newRequestModal')" aria-label="Close Modal">&times;</span>
            <h3 id="newRequestTitle">Submit New Service Request</h3>
            <form id="newRequestForm">
                <div class="form-group">
                    <label for="requestSubject">Subject</label>
                    <input type="text" id="requestSubject" required aria-required="true">
                </div>
                 <div class="form-group">
                    <label for="requestDescription">Description</label>
                    <textarea id="requestDescription" rows="6" required aria-required="true"></textarea>
                </div>
                 <button type="submit" class="button button-primary">Submit Request</button>
            </form>
        </div>
    </div>

     <!-- Modal Structure for Service Request Details (Example) -->
    <div id="requestDetailModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="requestDetailTitle">
        <div class="modal-content">
            <span class="modal-close" onclick="hideModal('requestDetailModal')" aria-label="Close Modal">&times;</span>
            <h3 id="requestDetailTitle">Service Request Details: <span id="detailRequestId"></span></h3>
            <p><strong>Subject:</strong> <span id="detailRequestSubject"></span></p>
            <p><strong>Status:</strong> <span id="detailRequestStatus"></span></p>
            <p><strong>Submitted:</strong> <span id="detailRequestDate"></span></p>
            <p><strong>Last Updated:</strong> <span id="detailRequestUpdate"></span></p>
            <p><strong>Description:</strong></p>
            <p id="detailRequestDescription"></p>
             <div style="margin-top: calc(var(--spacing-unit) * 3); border-top: 1px solid var(--border-color); padding-top: calc(var(--spacing-unit) * 2);">
                <h4>Updates & Communication</h4>
                <div id="requestUpdates">
                    <!-- Updates would be loaded here -->
                    <p style="color: var(--text-color-secondary);">No updates yet.</p>
                </div>
             </div>
            <button class="button button-secondary" style="margin-top: calc(var(--spacing-unit) * 3);" onclick="hideModal('requestDetailModal')">Close</button>
        </div>
    </div>

    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.sidebar nav ul li a, .header .nav-links a');
            const contentSections = document.querySelectorAll('.content-section');
            const tabButtons = document.querySelectorAll('.tabs .tab-button');
            const modals = document.querySelectorAll('.modal');

            // --- State Management Simulation ---
            const appState = {
                activeSection: window.location.hash || '#dashboard',
                activeTabs: {
                    account: 'company',
                    billing: 'invoices'
                },
                serviceRequests: [ // Sample data
                    { id: 'SR-501', subject: 'Issue with billing statement', status: 'In Progress', submissionDate: '2023-10-26', lastUpdate: '2023-10-27', description: 'Details about billing statement issue...', updates: [] },
                    { id: 'SR-500', subject: 'Request for new user access', status: 'Closed', submissionDate: '2023-10-20', lastUpdate: '2023-10-25', description: 'Details about new user access request...', updates: [] },
                    { id: 'SR-499', subject: 'Account information update', status: 'Open', submissionDate: '2023-10-18', lastUpdate: '2023-10-18', description: 'Details about account information update...', updates: [] },
                ],
                 chartData: { // Sample data for dashboard chart
                    labels: ['Open', 'In Progress', 'Closed'],
                    counts: [1, 1, 1] // Corresponds to serviceRequests sample data
                 }
            };

            // --- Navigation & Section Handling ---
            function showSection(id) {
                contentSections.forEach(section => {
                    section.classList.remove('active');
                    section.setAttribute('aria-hidden', 'true');
                });
                const activeSection = document.getElementById(id);
                if (activeSection) {
                    activeSection.classList.add('active');
                    activeSection.removeAttribute('aria-hidden');
                    // Scroll to top of main content
                    document.querySelector('.main-content').scrollTop = 0;
                    appState.activeSection = `#${id}`;
                    // Update URL hash without triggering popstate
                    if (window.location.hash !== `#${id}`) {
                         history.pushState(null, '', `#${id}`);
                    }

                    // Re-render content specific to the section if needed
                    if (id === 'dashboard') {
                        renderDashboardChart();
                    } else if (id === 'account') {
                         // Ensure the correct tab is active on section load
                         activateTab('account', appState.activeTabs.account);
                    } else if (id === 'billing') {
                         // Ensure the correct tab is active on section load
                         activateTab('billing', appState.activeTabs.billing);
                    }
                }
            }

            function updateActiveNav(href) {
                 document.querySelectorAll('.sidebar nav ul li a, .header .nav-links a').forEach(link => {
                    link.classList.remove('active');
                    link.removeAttribute('aria-current');
                });

                const activeLink = document.querySelector(`.sidebar nav ul li a[href="${href}"], .header .nav-links a[href="${href}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                    activeLink.setAttribute('aria-current', 'page');
                }
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    showSection(targetId);
                    updateActiveNav(this.getAttribute('href'));
                });
            });

            // Handle initial load based on URL hash or default
            const initialHash = window.location.hash || '#dashboard';
            showSection(initialHash.substring(1));
            updateActiveNav(initialHash);

            // Handle browser back/forward buttons
            window.addEventListener('popstate', () => {
                const popHash = window.location.hash || '#dashboard';
                showSection(popHash.substring(1));
                updateActiveNav(popHash);
            });

            // --- Tab Handling ---
            function activateTab(sectionId, tabId) {
                 const tabContainer = document.querySelector(`#${sectionId} .tabs`);
                 const contentContainer = document.querySelector(`#${sectionId} .tabs`).nextElementSibling;

                 if (!tabContainer || !contentContainer) return;

                 // Remove active class from all buttons in this tab group
                 tabContainer.querySelectorAll('.tab-button').forEach(btn => {
                     btn.classList.remove('active');
                     btn.setAttribute('aria-selected', 'false');
                     btn.setAttribute('tabindex', '-1');
                 });

                 // Add active class to the target button
                 const targetButton = tabContainer.querySelector(`.tab-button[data-tab="${tabId}"]`);
                 if (targetButton) {
                     targetButton.classList.add('active');
                     targetButton.setAttribute('aria-selected', 'true');
                     targetButton.setAttribute('tabindex', '0');
                 }


                 // Hide all tab content panels in this container
                 contentContainer.querySelectorAll('.tab-content').forEach(content => {
                     content.classList.remove('active');
                     content.setAttribute('aria-hidden', 'true');
                 });

                 // Show the target tab content panel
                 const targetTabContent = contentContainer.querySelector(`#tab-${tabId}`);
                 if (targetTabContent) {
                     targetTabContent.classList.add('active');
                     targetTabContent.removeAttribute('aria-hidden');
                 }

                 // Update state
                 appState.activeTabs[sectionId] = tabId;
            }

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    // Find the parent section ID
                    const sectionId = this.closest('.content-section').id;
                    activateTab(sectionId, tabId);
                });
            });

            // --- Modal Handling ---
            function showModal(id) {
                const modal = document.getElementById(id);
                if (modal) {
                    modal.classList.add('show');
                    modal.setAttribute('aria-hidden', 'false');
                    // Find the first focusable element and focus it
                    const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                    const firstFocusable = focusableElements[0];
                    if (firstFocusable) {
                         firstFocusable.focus();
                    }
                }
            }

            function hideModal(id) {
                 const modal = document.getElementById(id);
                 if (modal) {
                    modal.classList.remove('show');
                    modal.setAttribute('aria-hidden', 'true');
                    // Optional: Return focus to the element that opened the modal
                    // Requires storing the triggering element reference
                 }
            }

            // Close modal if clicking outside the modal content
            window.addEventListener('click', function(event) {
                modals.forEach(modal => {
                    if (event.target === modal && modal.classList.contains('show')) {
                        hideModal(modal.id);
                    }
                });
            });

             // Close modal if pressing the Escape key
            document.addEventListener('keydown', function(event) {
                modals.forEach(modal => {
                     if (event.key === 'Escape' && modal.classList.contains('show')) {
                        hideModal(modal.id);
                    }
                });
            });

            // Expose functions to the global scope for inline onclick handlers
            window.showModal = showModal;
            window.hideModal = hideModal;


            // --- Form Validation Examples ---
            const companyInfoForm = document.getElementById('companyInfoForm');
            const companyAddressInput = document.getElementById('companyAddress');

            function validateFormGroup(inputElement, errorMessageElement) {
                const formGroup = inputElement.closest('.form-group');
                if (inputElement.value.trim() === '') {
                    formGroup.classList.add('error');
                    if (errorMessageElement) errorMessageElement.style.display = 'block';
                    inputElement.setAttribute('aria-invalid', 'true');
                    return false;
                } else {
                    formGroup.classList.remove('error');
                     if (errorMessageElement) errorMessageElement.style.display = 'none';
                     inputElement.setAttribute('aria-invalid', 'false');
                    return true;
                }
            }

            companyInfoForm.addEventListener('submit', function(event) {
                event.preventDefault();

                let isValid = true;
                isValid = validateFormGroup(companyAddressInput, document.getElementById('addressError')) && isValid;

                if (isValid) {
                    console.log('Company Info Form is valid. Submitting data:', {
                        companyAddress: companyAddressInput.value
                    });
                    alert('Company Info saved successfully (simulated)!');
                } else {
                    console.log('Company Info Form has errors.');
                    // Focus the first invalid field for accessibility
                    companyInfoForm.querySelector('.form-group.error input, .form-group.error textarea, .form-group.error select').focus();
                }
            });

             const newRequestForm = document.getElementById('newRequestForm');
             const requestSubjectInput = document.getElementById('requestSubject');
             const requestDescriptionInput = document.getElementById('requestDescription');

             newRequestForm.addEventListener('submit', function(event) {
                 event.preventDefault();

                 let isValid = true;
                 isValid = validateFormGroup(requestSubjectInput, null) && isValid; // Add error message element if needed
                 isValid = validateFormGroup(requestDescriptionInput, null) && isValid; // Add error message element if needed


                 if (isValid) {
                     console.log('New Request Form is valid. Submitting data:', {
                         subject: requestSubjectInput.value,
                         description: requestDescriptionInput.value
                     });
                     alert('Service Request submitted successfully (simulated)!');
                     hideModal('newRequestModal');
                     newRequestForm.reset();
                     // Remove error classes after successful submission
                     requestSubjectInput.closest('.form-group').classList.remove('error');
                     requestDescriptionInput.closest('.form-group').classList.remove('error');
                     requestSubjectInput.setAttribute('aria-invalid', 'false');
                     requestDescriptionInput.setAttribute('aria-invalid', 'false');
                 } else {
                     console.log('New Request Form has errors.');
                      // Focus the first invalid field
                     newRequestForm.querySelector('.form-group.error input, .form-group.error textarea').focus();
                 }
             });

            // Add blur validation for forms
            document.querySelectorAll('#companyInfoForm input, #companyInfoForm textarea, #newRequestForm input, #newRequestForm textarea').forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.required) {
                         validateFormGroup(this, this.closest('.form-group').querySelector('.error-message'));
                    }
                });
            });


            // --- Table Row Click for Details ---
            document.querySelectorAll('.data-table tbody tr').forEach(row => {
                row.addEventListener('click', function(event) {
                    // Prevent click on the action link/button inside the row
                    if (event.target.tagName === 'A' || event.target.tagName === 'BUTTON') {
                        return;
                    }

                    const requestId = this.getAttribute('data-request-id');
                    if (requestId) {
                        // Simulate fetching details
                        const requestDetails = appState.serviceRequests.find(req => req.id === requestId);

                        if (requestDetails) {
                            console.log('Viewing details for request ID:', requestId);
                            document.getElementById('detailRequestId').textContent = requestDetails.id;
                            document.getElementById('detailRequestSubject').textContent = requestDetails.subject;
                            document.getElementById('detailRequestStatus').textContent = requestDetails.status;
                            document.getElementById('detailRequestDate').textContent = requestDetails.submissionDate;
                            document.getElementById('detailRequestUpdate').textContent = requestDetails.lastUpdate;
                            document.getElementById('detailRequestDescription').textContent = requestDetails.description;

                            // Populate updates (simulated)
                            const updatesDiv = document.getElementById('requestUpdates');
                            updatesDiv.innerHTML = ''; // Clear previous updates
                            if (requestDetails.updates && requestDetails.updates.length > 0) {
                                requestDetails.updates.forEach(update => {
                                    const p = document.createElement('p');
                                    p.textContent = `${update.date}: ${update.text}`;
                                    updatesDiv.appendChild(p);
                                });
                            } else {
                                updatesDiv.innerHTML = '<p style="color: var(--text-color-secondary);">No updates yet.</p>';
                            }

                            showModal('requestDetailModal');
                        } else {
                            console.error('Request details not found for ID:', requestId);
                            // Optionally show an error message to the user
                        }
                    }
                });
                 // Also make table rows keyboard interactive
                 row.addEventListener('keypress', function(event) {
                     if (event.key === 'Enter' || event.key === ' ') {
                         event.preventDefault(); // Prevent default space/enter behavior
                         this.click(); // Trigger the click handler
                     }
                 });
            });


            // --- Chart Implementation (Dashboard) ---
            let dashboardChart = null; // Variable to hold the chart instance

            function renderDashboardChart() {
                 const ctx = document.getElementById('dashboardChart').getContext('2d');

                 // Destroy existing chart if it exists
                 if (dashboardChart) {
                     dashboardChart.destroy();
                 }

                 // Prepare data for the chart
                 const data = {
                     labels: appState.chartData.labels,
                     datasets: [{
                         label: 'Number of Requests',
                         data: appState.chartData.counts,
                         backgroundColor: [
                             "rgba(23, 162, 184, 0.7)", // Info blue (Open)
                             "rgba(255, 193, 7, 0.7)",  // Warning yellow (In Progress)
                             "rgba(40, 167, 69, 0.7)"   // Success green (Closed)
                         ],
                         borderColor: [
                             "#17a2b8",
                             "#ffc107",
                             "#28a745"
                         ],
                         borderWidth: 1
                     }]
                 };

                 // Get selected chart type and font size
                 const chartType = document.getElementById('dashboardChartType').value;
                 const fontSize = parseInt(document.getElementById('dashboardChartFontSize').value) || 12;

                 // Configuration based on chart type
                 let config = {
                     type: chartType,
                     data: data,
                     options: {
                         responsive: true,
                         maintainAspectRatio: false,
                         plugins: {
                             legend: {
                                 position: chartType === 'bar' ? 'top' : 'right',
                                 labels: {
                                     font: {
                                         size: fontSize
                                     }
                                 }
                             },
                             title: {
                                 display: false, // Title handled by card-title
                             }
                         },
                         animation: {
                             duration: 800, // Animation duration
                             easing: 'easeOutQuart' // Animation easing
                         }
                     }
                 };

                 // Add scales for bar chart
                 if (chartType === 'bar') {
                     config.options.scales = {
                         y: {
                             beginAtZero: true,
                             ticks: {
                                 font: {
                                     size: fontSize
                                 },
                                 stepSize: 1, // Ensure integer ticks for counts
                                 precision: 0
                             },
                             title: {
                                 display: true,
                                 text: 'Count',
                                 font: {
                                     size: fontSize + 2,
                                     weight: 'bold'
                                 }
                             }
                         },
                         x: {
                              ticks: {
                                 font: {
                                     size: fontSize
                                 }
                              },
                              title: {
                                 display: true,
                                 text: 'Status',
                                 font: {
                                     size: fontSize + 2,
                                     weight: 'bold'
                                 }
                             }
                         }
                     };
                 }

                 // Create the new chart instance
                 dashboardChart = new Chart(ctx, config);
            }

            // Initial chart render when dashboard is shown
            if (appState.activeSection === '#dashboard') {
                renderDashboardChart();
            }

            // Add event listeners for chart controls
            document.getElementById('dashboardChartType').addEventListener('change', renderDashboardChart);
            document.getElementById('dashboardChartFontSize').addEventListener('change', renderDashboardChart);

            // Toggle floating controls on chart click
            const dashboardChartContainer = document.getElementById('dashboardChartContainer');
            const dashboardChartControls = document.getElementById('dashboardChartControls');

            dashboardChartContainer.addEventListener('click', function(event) {
                // Prevent closing if clicking inside controls
                if (!dashboardChartControls.contains(event.target)) {
                     dashboardChartControls.classList.toggle('active');
                }
            });

            // Close controls if clicking anywhere else on the page
            document.addEventListener('click', function(event) {
                if (!dashboardChartContainer.contains(event.target) && dashboardChartControls.classList.contains('active')) {
                     dashboardChartControls.classList.remove('active');
                }
            });


        });
    </script>
</body>
</html>
