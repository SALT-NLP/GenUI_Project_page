<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Theater</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Playfair+Display:wght@700&display=swap">
    <style>
        :root {
            --primary-color: #6200ee;
            /* Vibrant purple */
            --primary-color-dark: #3700b3;
            --secondary-color: #03dac6;
            /* Teal accent */
            --background-color: #f8f8f8;
            /* Light grey background */
            --surface-color: #ffffff;
            /* White cards/surfaces */
            --text-color-primary: #212121;
            /* Dark grey for main text */
            --text-color-secondary: #757575;
            /* Medium grey for secondary text */
            --error-color: #b00020;
            /* Red for errors */
            --seat-available: #4caf50;
            /* Green */
            --seat-selected: var(--primary-color);
            /* Purple */
            --seat-sold: #e0e0e0;
            /* Light grey */
            --seat-unavailable: #ff9800;
            /* Orange */
            --focus-outline-color: rgba(98, 0, 238, 0.4);
            /* Primary color with alpha */

            --spacing-unit: 8px;
            --border-radius: 8px;
            --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 6px 12px rgba(0, 0, 0, 0.15);

            --font-body: 'Roboto', sans-serif;
            --font-heading: 'Playfair Display', serif;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.6;
            color: var(--text-color-primary);
            background-color: var(--background-color);
            margin: 0;
            padding-top: 60px;
            /* Space for fixed header */
            overflow-x: hidden;
            /* Prevent horizontal scroll */
        }

        header {
            background-color: var(--surface-color);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-sizing: border-box;
        }

        .header-logo {
            font-family: var(--font-heading);
            font-size: 1.8em;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 700;
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: calc(var(--spacing-unit) * 3);
        }

        nav a {
            text-decoration: none;
            color: var(--text-color-primary);
            font-weight: 500;
            transition: color 0.3s ease, background-color 0.3s ease;
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            outline: none;
            /* Remove default outline */
        }

        nav a:hover {
            color: var(--primary-color);
            background-color: rgba(98, 0, 238, 0.1);
        }

        nav a:focus-visible {
            outline: 2px solid var(--focus-outline-color);
            outline-offset: 2px;
        }


        .hamburger-menu {
            display: none;
            cursor: pointer;
            font-size: 2em;
            color: var(--text-color-primary);
            background: none;
            border: none;
            padding: 0;
            outline: none;
        }

        .hamburger-menu:focus-visible {
            outline: 2px solid var(--focus-outline-color);
            outline-offset: 2px;
        }


        main {
            padding: calc(var(--spacing-unit) * 3);
            max-width: 1200px;
            margin: 0 auto;
        }

        section {
            margin-bottom: calc(var(--spacing-unit) * 8);
            padding: calc(var(--spacing-unit) * 4);
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: opacity 0.5s ease;
            /* Smooth transition for section visibility */
        }

        section.hidden {
            display: none;
            opacity: 0;
        }

        section.active {
            display: block;
            opacity: 1;
        }


        h1,
        h2,
        h3 {
            font-family: var(--font-heading);
            color: var(--text-color-primary);
            margin-top: 0;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        h2 {
            font-size: 2em;
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        h3 {
            font-size: 1.5em;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .hero {
            background: url('https://placehold.co/1200x400?text=Theater+Stage') no-repeat center center/cover;
            color: white;
            text-align: center;
            padding: calc(var(--spacing-unit) * 10) calc(var(--spacing-unit) * 4);
            margin-bottom: calc(var(--spacing-unit) * 8);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero h1 {
            color: white;
            font-size: 3em;
            margin-bottom: var(--spacing-unit);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .hero p {
            font-size: 1.2em;
            margin-bottom: calc(var(--spacing-unit) * 4);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 3);
            border: none;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, opacity 0.3s ease;
            font-weight: 500;
            outline: none;
        }

        .btn:hover {
            background-color: var(--primary-color-dark);
            transform: translateY(-2px);
        }

        .btn:focus-visible {
            outline: 2px solid var(--focus-outline-color);
            outline-offset: 2px;
        }


        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color-primary);
        }

        .btn-secondary:hover {
            background-color: #018786;
            /* Darker teal */
            color: white;
        }

        .btn:disabled {
            background-color: var(--seat-sold);
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        .show-listing {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: calc(var(--spacing-unit) * 4);
        }

        .show-card {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            outline: none;
            /* Remove default outline */
        }

        .show-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }

        .show-card:focus-visible {
            outline: 2px solid var(--focus-outline-color);
            outline-offset: 4px;
        }


        .show-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .show-card-content {
            padding: calc(var(--spacing-unit) * 2);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .show-card h3 {
            margin-top: 0;
            margin-bottom: var(--spacing-unit);
            font-size: 1.3em;
        }

        .show-card p {
            font-size: 0.9em;
            color: var(--text-color-secondary);
            margin-bottom: calc(var(--spacing-unit) * 2);
            flex-grow: 1;
        }

        .show-card .btn {
            align-self: flex-start;
            margin-top: auto;
        }

        /* Show Detail Page */
        #show-detail-content img {
            max-width: 400px;
            height: auto;
            border-radius: var(--border-radius);
            margin-bottom: calc(var(--spacing-unit)*3);
            display: block;
            /* Prevent extra space below image */
        }

        #performance-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #performance-list li {
            padding: var(--spacing-unit)*1.5 0;
            border-bottom: 1px solid var(--background-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-unit);
        }

        #performance-list li:last-child {
            border-bottom: none;
        }

        #performance-list li span {
            flex-grow: 1;
            margin-right: var(--spacing-unit)*2;
            font-weight: 500;
        }


        /* Ticket Purchase Workflow */
        .ticket-workflow {
            display: flex;
            flex-direction: column;
        }

        .workflow-steps {
            display: flex;
            justify-content: space-around;
            margin-bottom: calc(var(--spacing-unit) * 4);
            position: relative;
            padding-top: var(--spacing-unit)*2;
            /* Space for line */
        }

        .workflow-steps::before {
            content: '';
            position: absolute;
            top: 30px;
            /* Align with circle center */
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--seat-sold);
            z-index: 0;
        }

        .workflow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
            cursor: pointer;
            position: relative;
            flex: 1;
            /* Distribute space evenly */
            text-align: center;
            outline: none;
            /* Remove default outline */
        }

        .workflow-step:focus-visible .step-circle {
            outline: 2px solid var(--focus-outline-color);
            outline-offset: 2px;
        }


        .step-circle {
            width: 40px;
            /* Slightly larger */
            height: 40px;
            border-radius: 50%;
            background-color: var(--seat-sold);
            color: var(--text-color-secondary);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            margin-bottom: var(--spacing-unit);
            transition: background-color 0.3s ease, color 0.3s ease;
            border: 2px solid transparent;
            /* For focus outline */
        }

        .step-circle.active {
            background-color: var(--primary-color);
            color: white;
        }

        .step-label {
            font-size: 0.9em;
            color: var(--text-color-secondary);
            transition: color 0.3s ease;
        }

        .workflow-step.active .step-label {
            color: var(--primary-color);
            font-weight: 500;
        }

        .workflow-step.completed .step-circle {
            background-color: var(--secondary-color);
            color: var(--text-color-primary);
        }

        .workflow-step.completed .step-label {
            color: var(--text-color-primary);
        }


        .workflow-content>div {
            display: none;
        }

        .workflow-content>div.active {
            display: block;
        }

        /* Seat Map */
        .seat-selection-container {
            display: flex;
            gap: calc(var(--spacing-unit) * 4);
            /* Desktop: Side-by-side */
        }

        .seat-map-area {
            flex-grow: 1;
            min-width: 400px;
            /* Ensure minimum width */
            background-color: var(--background-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
            /* Allow scrolling for wide maps */
            text-align: center;
            /* Center stage text */
        }

        .seat-map {
            display: grid;
            gap: var(--spacing-unit);
            /* Example grid, will be dynamic */
            grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
            /* Adjust based on theater layout, slightly larger touch targets */
            justify-content: center;
            /* Center the grid */
            margin-top: var(--spacing-unit)*2;
        }

        .seat {
            width: 35px;
            /* Slightly larger */
            height: 35px;
            border-radius: var(--border-radius);
            background-color: var(--seat-available);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8em;
            /* Slightly larger font */
            color: white;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease, outline 0.2s ease;
            user-select: none;
            /* Prevent text selection */
            position: relative;
            outline: none;
            /* Remove default outline */
        }

        .seat:hover {
            transform: scale(1.05);
            /* Subtle scale */
        }

        .seat:focus-visible {
            outline: 2px solid var(--focus-outline-color);
            outline-offset: 2px;
        }


        .seat.seat--selected {
            background-color: var(--seat-selected);
        }

        .seat.seat--sold {
            background-color: var(--seat-sold);
            cursor: not-allowed;
            color: var(--text-color-secondary);
            pointer-events: none;
            /* Disable click */
        }

        .seat.seat--unavailable {
            background-color: var(--seat-unavailable);
            cursor: not-allowed;
            color: white;
            pointer-events: none;
            /* Disable click */
        }

        .seat-info {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            font-size: 0.8em;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            margin-bottom: var(--spacing-unit);
            z-index: 10;
            /* Ensure tooltip is above other seats */
        }

        .seat:hover .seat-info,
        .seat:focus-visible .seat-info {
            opacity: 1;
        }


        .seat-summary {
            width: 300px;
            /* Fixed width on desktop */
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing-unit) * 2);
        }

        .seat-summary h3 {
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 2);
            border-bottom: 1px solid var(--background-color);
            padding-bottom: var(--spacing-unit);
        }

        .selected-seats-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 200px;
            /* Limit height */
            overflow-y: auto;
            /* Add scroll if many seats */
        }

        .selected-seat-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-unit) 0;
            border-bottom: 1px dashed var(--background-color);
            font-size: 0.9em;
        }

        .selected-seat-item:last-child {
            border-bottom: none;
        }

        .total-price {
            font-size: 1.2em;
            font-weight: 700;
            margin-top: calc(var(--spacing-unit) * 2);
            border-top: 1px solid var(--background-color);
            padding-top: calc(var(--spacing-unit) * 2);
            text-align: right;
        }

        /* Seat Map Legend */
        .seat-legend {
            display: flex;
            justify-content: center;
            gap: calc(var(--spacing-unit)*3);
            /* Increased gap */
            margin-top: calc(var(--spacing-unit)*3);
            /* Increased margin */
            font-size: 0.9em;
            flex-wrap: wrap;
            /* Allow wrapping on small screens */
        }

        .seat-legend-item {
            display: flex;
            align-items: center;
        }

        .seat-legend-color {
            display: inline-block;
            width: 20px;
            /* Slightly larger */
            height: 20px;
            border-radius: var(--border-radius);
            /* Match seat shape */
            margin-right: var(--spacing-unit);
        }

        .seat-legend-color--available {
            background-color: var(--seat-available);
        }

        .seat-legend-color--selected {
            background-color: var(--seat-selected);
        }

        .seat-legend-color--sold {
            background-color: var(--seat-sold);
        }

        .seat-legend-color--unavailable {
            background-color: var(--seat-unavailable);
        }


        /* Forms */
        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 3);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
            color: var(--text-color-primary);
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.5);
            border: 1px solid #ccc;
            border-radius: var(--border-radius);
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--focus-outline-color);
        }

        .form-group .error-message {
            color: var(--error-color);
            font-size: 0.8em;
            margin-top: var(--spacing-unit);
            display: none;
            /* Hide by default */
        }

        input.invalid,
        select.invalid,
        textarea.invalid {
            border-color: var(--error-color);
        }

        input.invalid:focus,
        select.invalid:focus,
        textarea.invalid:focus {
            box-shadow: 0 0 0 3px rgba(176, 0, 32, 0.2);
            /* Error color with alpha */
        }

        input.invalid+.error-message,
        select.invalid+.error-message,
        textarea.invalid+.error-message {
            display: block;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: calc(var(--spacing-unit) * 4);
            gap: var(--spacing-unit)*2;
            /* Add gap for buttons */
            flex-wrap: wrap;
            /* Allow wrapping */
        }

        .form-actions .btn {
            flex-grow: 1;
            /* Allow buttons to grow */
            text-align: center;
        }


        /* Mobile Scanner Interface */
        .scanner-interface {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            background-color: var(--background-color);
            padding: calc(var(--spacing-unit) * 4);
            text-align: center;
        }

        .scanner-area {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background-color: #333;
            /* Represents camera view */
            border-radius: var(--border-radius);
            margin-bottom: calc(var(--spacing-unit) * 4);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5em;
            overflow: hidden;
            /* Ensure camera view stays within bounds */
        }

        .scan-result {
            margin-top: calc(var(--spacing-unit) * 4);
            font-size: 1.2em;
            font-weight: 700;
            min-height: 1.5em;
            /* Reserve space */
        }

        .scan-result.valid {
            color: var(--seat-available);
        }

        .scan-result.invalid {
            color: var(--error-color);
        }

        /* Footer */
        footer {
            background-color: var(--text-color-primary);
            color: white;
            text-align: center;
            padding: calc(var(--spacing-unit) * 4);
            margin-top: calc(var(--spacing-unit) * 8);
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
        }

        footer p {
            margin: 0;
            font-size: 0.9em;
        }


        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .sr-only {
            /* For screen readers */
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            header {
                padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            }

            nav ul {
                display: none;
                /* Hidden by default on mobile */
                flex-direction: column;
                position: absolute;
                top: 60px;
                left: 0;
                width: 100%;
                background-color: var(--surface-color);
                box-shadow: var(--box-shadow);
                padding: var(--spacing-unit) 0;
                gap: var(--spacing-unit);
                border-top: 1px solid var(--background-color);
                max-height: calc(100vh - 60px);
                /* Limit height */
                overflow-y: auto;
                /* Add scroll */
            }

            nav ul.active {
                display: flex;
            }

            nav li {
                width: 100%;
                text-align: center;
            }

            nav a {
                display: block;
                padding: calc(var(--spacing-unit) * 1.5) var(--spacing-unit);
                border-radius: 0;
            }

            .hamburger-menu {
                display: block;
            }

            main {
                padding: calc(var(--spacing-unit) * 2);
            }

            section {
                padding: calc(var(--spacing-unit) * 3);
            }

            .hero h1 {
                font-size: 2em;
            }

            .hero p {
                font-size: 1em;
            }

            .show-listing {
                grid-template-columns: 1fr;
            }

            .seat-selection-container {
                flex-direction: column;
                /* Stack seat map and summary */
            }

            .seat-map-area {
                min-width: auto;
                /* Remove min-width on mobile */
            }

            .seat-summary {
                width: 100%;
                /* Full width on mobile */
            }

            .seat-map {
                grid-template-columns: repeat(auto-fit, minmax(30px, 1fr));
                /* Adjust for smaller screens */
            }

            .seat {
                width: 30px;
                height: 30px;
            }

            .workflow-steps {
                flex-wrap: wrap;
                gap: var(--spacing-unit) * 2;
                padding-top: 0;
                /* Remove top padding */
                justify-content: space-around;
                /* Distribute items */
            }

            .workflow-steps::before {
                display: none;
                /* Hide line on mobile */
            }

            .workflow-step {
                flex-basis: 45%;
                /* Allow two steps per row */
                margin-bottom: var(--spacing-unit) * 2;
            }

            .workflow-step:nth-child(odd) {
                /* Add margin to odd items for spacing */
                margin-right: var(--spacing-unit);
            }

            .workflow-step:nth-child(even) {
                /* Add margin to even items for spacing */
                margin-left: var(--spacing-unit);
            }

            .workflow-step:last-child {
                margin: 0 auto;
                /* Center last item if odd number of steps */
            }
        }
    </style>
</head>

<body>

    <header>
        <a href="#home" class="header-logo">Community Theater</a>
        <button class="hamburger-menu material-symbols-rounded" aria-label="Toggle navigation menu"
            aria-expanded="false" aria-controls="main-nav">
            menu
        </button>
        <nav id="main-nav">
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#shows">Shows</a></li>
                <li><a href="#buy-tickets">Buy Tickets</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <!-- Add a hidden link for scanner access - typically password protected or internal -->
                <li class="hidden-scanner-link"><a href="#scanner">Scanner (Admin)</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="home" class="active" role="region" aria-labelledby="home-heading">
            <h1 id="home-heading" class="sr-only">Home</h1>
            <div class="hero">
                <div class="hero-content">
                    <h2>Experience the Magic of Live Theater</h2>
                    <p>Your local stage for unforgettable stories and performances.</p>
                    <a href="#shows" class="btn">See Upcoming Shows</a>
                </div>
            </div>
            <!-- Could add 'About Us' snippet or 'Upcoming Events' here -->
            <div
                style="padding: calc(var(--spacing-unit)*4); margin-bottom: calc(var(--spacing-unit)*8); background-color: var(--surface-color); border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                <h3>About Our Theater</h3>
                <p>Welcome to the Community Theater! We are dedicated to bringing high-quality theatrical productions to
                    our local area. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor
                    incididunt ut labore et dolore magna aliqua.</p>
                <p><a href="#about" class="btn btn-secondary">Read More About Us</a></p>
            </div>
        </section>

        <section id="shows" class="hidden" role="region" aria-labelledby="shows-heading">
            <h2 id="shows-heading">Upcoming Productions</h2>
            <div class="show-listing">
                <!-- Example Show Card -->
                <div class="show-card" data-show-id="1" tabindex="0" role="link"
                    aria-label="Learn more about Play Title 1">
                    <img src="https://placehold.co/300x200?text=Play+Title+1" alt="Placeholder image for Play Title 1">
                    <div class="show-card-content">
                        <h3>Play Title 1</h3>
                        <p>A brief, engaging description of the play. Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit.</p>
                        <p><small>Dates: Oct 10 - Oct 20, 2024</small></p>
                        <button class="btn show-details-btn" aria-label="Learn more about Play Title 1">Learn
                            More</button>
                    </div>
                </div>
                <!-- Example Show Card -->
                <div class="show-card" data-show-id="2" tabindex="0" role="link"
                    aria-label="Learn more about Play Title 2">
                    <img src="https://placehold.co/300x200?text=Play+Title+2" alt="Placeholder image for Play Title 2">
                    <div class="show-card-content">
                        <h3>Play Title 2</h3>
                        <p>Another exciting production coming soon! Discover the story and characters.</p>
                        <p><small>Dates: Nov 15 - Nov 25, 2024</small></p>
                        <button class="btn show-details-btn" aria-label="Learn more about Play Title 2">Learn
                            More</button>
                    </div>
                </div>
                <!-- Example Show Card -->
                <div class="show-card" data-show-id="3" tabindex="0" role="link"
                    aria-label="Learn more about Play Title 3">
                    <img src="https://placehold.co/300x200?text=Play+Title+3" alt="Placeholder image for Play Title 3">
                    <div class="show-card-content">
                        <h3>Play Title 3</h3>
                        <p>A classic tale reinvented for our stage. Don't miss this limited run production!</p>
                        <p><small>Dates: Dec 1 - Dec 15, 2024</small></p>
                        <button class="btn show-details-btn" aria-label="Learn more about Play Title 3">Learn
                            More</button>
                    </div>
                </div>
                <!-- Add more show cards here -->
            </div>
        </section>

        <section id="show-detail" class="hidden" role="region" aria-labelledby="show-detail-heading">
            <h2 id="show-detail-heading" class="sr-only">Show Details</h2>
            <button class="btn btn-secondary back-to-shows">&larr; Back to Shows</button>
            <div id="show-detail-content">
                <!-- Show details will be loaded here by JS -->
                <h2>Play Title Placeholder</h2>
                <p>Detailed synopsis, cast, crew, images, etc.</p>
                <h3>Performances</h3>
                <ul id="performance-list" role="list">
                    <!-- Performance dates/times will be listed here -->
                    <li role="listitem">
                        <span>Oct 10, 2024 - 7:30 PM</span>
                        <button class="btn btn-secondary buy-ticket-btn" data-performance-id="perf-1"
                            aria-label="Buy tickets for Oct 10, 2024 - 7:30 PM">Buy Tickets</button>
                    </li>
                    <li role="listitem">
                        <span>Oct 11, 2024 - 7:30 PM</span>
                        <button class="btn btn-secondary buy-ticket-btn" data-performance-id="perf-2"
                            aria-label="Buy tickets for Oct 11, 2024 - 7:30 PM">Buy Tickets</button>
                    </li>
                </ul>
            </div>
        </section>

        <section id="buy-tickets" class="hidden" role="region" aria-labelledby="buy-tickets-heading">
            <h2 id="buy-tickets-heading">Purchase Tickets</h2>
            <button class="btn btn-secondary back-to-shows">&larr; Back to Shows</button>

            <div class="ticket-workflow" role="navigation" aria-label="Ticket purchase workflow steps">
                <div class="workflow-steps">
                    <div class="workflow-step active" data-step="select-performance" tabindex="0" role="button"
                        aria-current="step" aria-label="Step 1: Select Performance">
                        <div class="step-circle active">1</div>
                        <div class="step-label">Performance</div>
                    </div>
                    <div class="workflow-step" data-step="select-seats" tabindex="-1" role="button"
                        aria-label="Step 2: Select Seats">
                        <div class="step-circle">2</div>
                        <div class="step-label">Seats</div>
                    </div>
                    <div class="workflow-step" data-step="checkout" tabindex="-1" role="button"
                        aria-label="Step 3: Checkout">
                        <div class="step-circle">3</div>
                        <div class="step-label">Checkout</div>
                    </div>
                    <div class="workflow-step" data-step="confirmation" tabindex="-1" role="button"
                        aria-label="Step 4: Confirmation">
                        <div class="step-circle">4</div>
                        <div class="step-label">Confirmation</div>
                    </div>
                </div>

                <div class="workflow-content">
                    <div id="step-select-performance" class="active" role="region"
                        aria-labelledby="step-select-performance-heading">
                        <h3 id="step-select-performance-heading">Select a Performance</h3>
                        <!-- Performance list with dates/times and prices -->
                        <p>Please select a performance from the list on the show details page or below.</p>
                        <!-- Placeholder for performance selection UI if user lands directly here -->
                        <div id="direct-performance-selection">
                            <h4>Choose from available performances:</h4>
                            <ul id="direct-performance-list" role="list">
                                <!-- Performances will be loaded here -->
                                <li role="listitem">Loading performances...</li>
                            </ul>
                        </div>

                        <!-- Button to proceed - hidden initially, shown after selection or if coming from show detail -->
                        <button class="btn next-step" data-next-step="select-seats" id="continue-to-seats" disabled
                            style="margin-top: calc(var(--spacing-unit)*3);">Continue to Seat Selection</button>
                    </div>

                    <div id="step-select-seats" class="hidden" role="region"
                        aria-labelledby="step-select-seats-heading">
                        <h3 id="step-select-seats-heading">Select Your Seats</h3>
                        <div class="seat-selection-container">
                            <div class="seat-map-area">
                                <p>Stage is here &uarr;</p>
                                <div class="seat-map" id="theater-seat-map" role="grid" aria-label="Theater Seat Map">
                                    <!-- Seats will be generated here by JS -->
                                </div>
                                <div class="seat-legend" role="group" aria-label="Seat status legend">
                                    <div class="seat-legend-item"><span
                                            class="seat-legend-color seat-legend-color--available"></span> Available
                                    </div>
                                    <div class="seat-legend-item"><span
                                            class="seat-legend-color seat-legend-color--selected"></span> Selected</div>
                                    <div class="seat-legend-item"><span
                                            class="seat-legend-color seat-legend-color--sold"></span> Sold</div>
                                    <div class="seat-legend-item"><span
                                            class="seat-legend-color seat-legend-color--unavailable"></span> Unavailable
                                    </div>
                                </div>
                            </div>
                            <div class="seat-summary" role="complementary" aria-labelledby="seat-summary-heading">
                                <h3 id="seat-summary-heading">Your Selection</h3>
                                <ul class="selected-seats-list" id="selected-seats-list" role="list">
                                    <!-- Selected seats will appear here -->
                                    <li role="listitem">No seats selected</li>
                                </ul>
                                <div class="total-price">Total: $<span id="total-price">0.00</span></div>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary prev-step"
                                data-prev-step="select-performance">&larr; Back</button>
                            <button type="button" class="btn next-step" data-next-step="checkout"
                                id="continue-to-checkout" disabled>Continue to Checkout</button>
                        </div>
                    </div>

                    <div id="step-checkout" class="hidden" role="region" aria-labelledby="step-checkout-heading">
                        <h3 id="step-checkout-heading">Checkout</h3>
                        <form id="checkout-form" novalidate aria-live="polite">
                            <div class="form-group">
                                <label for="name">Full Name</label>
                                <input type="text" id="name" required aria-required="true">
                                <span class="error-message" id="name-error" aria-atomic="true" aria-live="polite">Please
                                    enter your full name.</span>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" required aria-required="true">
                                <span class="error-message" id="email-error" aria-atomic="true"
                                    aria-live="polite">Please enter a valid email address.</span>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number (Optional)</label>
                                <input type="tel" id="phone">
                                <span class="error-message" id="phone-error" aria-atomic="true"
                                    aria-live="polite">Please enter a valid phone number.</span>
                            </div>
                            <!-- Payment details placeholder -->
                            <div class="form-group">
                                <label>Payment Information</label>
                                <p>Placeholder for secure payment form fields (e.g., provided by Stripe/PayPal).</p>
                                <!-- Integrate payment gateway fields here -->
                                <div style="border: 1px dashed #ccc; padding: var(--spacing-unit)*3; text-align: center; border-radius: var(--border-radius);"
                                    aria-label="Secure payment form fields placeholder">
                                    Secure Payment Form Fields
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary prev-step"
                                    data-prev-step="select-seats">&larr; Back</button>
                                <button type="submit" class="btn">Complete Purchase</button>
                            </div>
                        </form>
                    </div>

                    <div id="step-confirmation" class="hidden" role="region"
                        aria-labelledby="step-confirmation-heading">
                        <h3 id="step-confirmation-heading">Order Confirmation</h3>
                        <p>Thank you for your purchase!</p>
                        <p>Your order has been confirmed. A confirmation email with your digital tickets (including QR
                            codes) has been sent to your email address.</p>
                        <p>Order Number: <strong id="order-number">#123456789</strong></p>
                        <!-- Link to view/download tickets -->
                        <p><a href="#" class="btn">View Digital Tickets</a></p>
                        <p><a href="#home" class="btn btn-secondary">Back to Home</a></p>
                    </div>
                </div>
            </div>
        </section>

        <section id="about" class="hidden" role="region" aria-labelledby="about-heading">
            <h2 id="about-heading">About Us</h2>
            <p>Information about the community theater, its history, mission, and team.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
                ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
                deserunt mollit anim id est laborum.</p>
            <p>Our mission is to enrich the cultural life of our community by providing accessible, high-quality
                theatrical experiences and educational opportunities for all ages.</p>
            <h3>Our Team</h3>
            <p>Details about key team members, volunteers, and board members.</p>
        </section>

        <section id="contact" class="hidden" role="region" aria-labelledby="contact-heading">
            <h2 id="contact-heading">Contact Us</h2>
            <p>Contact information, address, phone number, email, and potentially a contact form.</p>
            <p>Email: info@communitytheater.org</p>
            <p>Phone: (123) 456-7890</p>
            <p>Address: 123 Theater Lane, Artsville, CA 90210</p>
            <!-- Contact form placeholder -->
            <form id="contact-form">
                <div class="form-group">
                    <label for="contact-name">Name</label>
                    <input type="text" id="contact-name" required aria-required="true">
                    <span class="error-message" id="contact-name-error" aria-atomic="true" aria-live="polite">Please
                        enter your name.</span>
                </div>
                <div class="form-group">
                    <label for="contact-email">Email</label>
                    <input type="email" id="contact-email" required aria-required="true">
                    <span class="error-message" id="contact-email-error" aria-atomic="true" aria-live="polite">Please
                        enter a valid email address.</span>
                </div>
                <div class="form-group">
                    <label for="contact-message">Message</label>
                    <textarea id="contact-message" rows="5" required aria-required="true"></textarea>
                    <span class="error-message" id="contact-message-error" aria-atomic="true" aria-live="polite">Please
                        enter a message.</span>
                </div>
                <button type="submit" class="btn">Send Message</button>
            </form>
        </section>

        <!-- Mobile Ticket Scanner Interface Section -->
        <section id="scanner" class="hidden scanner-interface" role="region" aria-labelledby="scanner-heading">
            <h2 id="scanner-heading">Ticket Scanner</h2>
            <p>Use this interface to scan digital tickets at the door.</p>
            <div class="scanner-area" aria-label="Camera view area for scanning tickets">
                Camera View Area
            </div>
            <button id="scan-button" class="btn">Start Scan</button>
            <div id="scan-result" class="scan-result" aria-live="polite" aria-atomic="true"></div>
            <p style="margin-top: var(--spacing-unit)*4;"><a href="#home" class="btn btn-secondary">Back to Main
                    Site</a></p>
        </section>

    </main>

    <footer>
        <p>&copy; 2024 Community Theater. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('main section');
            const navLinks = document.querySelectorAll('nav a');
            const hamburger = document.querySelector('.hamburger-menu');
            const navUl = document.querySelector('nav ul');
            const showCards = document.querySelectorAll('.show-card');
            const backToShowsBtns = document.querySelectorAll('.back-to-shows');
            const buyTicketBtns = document.querySelectorAll('.buy-ticket-btn'); // Initial buttons on show-detail
            const workflowSteps = document.querySelectorAll('.workflow-step');
            const workflowContentDivs = document.querySelectorAll('.workflow-content > div');
            const nextStepBtns = document.querySelectorAll('.next-step');
            const prevStepBtns = document.querySelectorAll('.prev-step');
            const theaterSeatMap = document.getElementById('theater-seat-map');
            const selectedSeatsList = document.getElementById('selected-seats-list');
            const totalPriceSpan = document.getElementById('total-price');
            const continueToCheckoutBtn = document.getElementById('continue-to-checkout');
            const checkoutForm = document.getElementById('checkout-form');
            const scanButton = document.getElementById('scan-button');
            const scanResultDiv = document.getElementById('scan-result');
            const directPerformanceList = document.getElementById('direct-performance-list');
            const continueToSeatsBtn = document.getElementById('continue-to-seats');


            let currentStep = 'select-performance';
            let selectedSeats = []; // Array to hold selected seat objects {id, label, price}
            const seatPrice = 15.00; // Example static seat price
            let selectedPerformanceId = null; // Track selected performance


            // --- Navigation ---
            const showSection = (id) => {
                sections.forEach(section => {
                    section.classList.remove('active');
                    section.classList.add('hidden');
                    section.setAttribute('aria-hidden', 'true'); // Hide from screen readers
                });
                const targetSection = document.getElementById(id);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    targetSection.classList.add('active');
                    targetSection.setAttribute('aria-hidden', 'false'); // Show to screen readers
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top
                    // Announce section change for screen readers
                    const heading = targetSection.querySelector('h1, h2, h3');
                    if (heading) {
                        document.title = `Community Theater - ${heading.textContent.replace('(Admin)', '').trim()}`;
                        // Use an ARIA live region for more explicit announcement if needed,
                        // but changing document title is often sufficient for section navigation.
                    } else {
                        document.title = 'Community Theater';
                    }

                    // Special handling for the buy-tickets section
                    if (id === 'buy-tickets') {
                        // Ensure workflow starts at step 1
                        setCurrentStep('select-performance');
                        // If no performance is selected yet (e.g., direct link), show performance selection UI
                        if (!selectedPerformanceId) {
                            document.getElementById('direct-performance-selection').style.display = 'block';
                            continueToSeatsBtn.disabled = true;
                            loadDirectPerformanceList(); // Load performances if needed
                        } else {
                            document.getElementById('direct-performance-selection').style.display = 'none';
                            continueToSeatsBtn.disabled = false;
                        }
                        // Reset seat selection when entering the workflow
                        selectedSeats = [];
                        updateSeatSummary();
                        generateSeatMap(5, 10); // Regenerate seat map (or load specific map for performance)
                    } else {
                        // Reset selected performance when leaving the buy-tickets section
                        selectedPerformanceId = null;
                    }
                    // Special handling for scanner section
                    if (id === 'scanner') {
                        // Potentially add password check here in a real app
                        console.log("Accessing Scanner Interface");
                    }
                }
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    showSection(targetId);
                    // Close mobile menu if open
                    if (navUl.classList.contains('active')) {
                        navUl.classList.remove('active');
                        hamburger.textContent = 'menu'; // Reset icon
                        hamburger.setAttribute('aria-expanded', 'false');
                    }
                });
            });

            hamburger.addEventListener('click', () => {
                const isExpanded = navUl.classList.toggle('active');
                hamburger.textContent = isExpanded ? 'close' : 'menu';
                hamburger.setAttribute('aria-expanded', isExpanded);
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (navUl.classList.contains('active') && !navUl.contains(e.target) && !hamburger.contains(e.target)) {
                    navUl.classList.remove('active');
                    hamburger.textContent = 'menu';
                    hamburger.setAttribute('aria-expanded', 'false');
                }
            });


            // --- Show Details & Buy Tickets ---
            const attachShowCardListeners = () => {
                showCards.forEach(card => {
                    // Simulate clicking the card or the button goes to detail
                    card.addEventListener('click', (e) => {
                        // Only navigate if not clicking the button directly
                        if (!e.target.classList.contains('btn')) { // Check if it's a button click
                            navigateToShowDetail(card.dataset.showId);
                        }
                    });
                    // Add click listener specifically for the button too
                    card.querySelector('.show-details-btn').addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent card click event
                        navigateToShowDetail(card.dataset.showId);
                    });
                    // Allow keyboard activation for the card
                    card.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            navigateToShowDetail(card.dataset.showId);
                        }
                    });
                });
            };

            const navigateToShowDetail = (showId) => {
                showSection('show-detail');
                // Simulate loading details based on showId
                // In a real app, this would fetch data from a backend
                const showDetailContent = document.getElementById('show-detail-content');
                const showData = { // Mock data
                    '1': { title: 'Play Title 1', img: 'https://placehold.co/400x300?text=Play+Title+1', synopsis: 'This is a more detailed synopsis of Play Title 1. It delves deeper into the plot, characters, and themes. It would include information about the cast, director, and production notes.', performances: [{ id: 'perf-1', date: 'Oct 10, 2024', time: '7:30 PM', price: 20.00 }, { id: 'perf-2', date: 'Oct 11, 2024', time: '7:30 PM', price: 20.00 }, { id: 'perf-3', date: 'Oct 12, 2024', time: '2:00 PM', price: 18.00 }] },
                    '2': { title: 'Play Title 2', img: 'https://placehold.co/400x300?text=Play+Title+2', synopsis: 'Detailed synopsis for Play Title 2. Explore the exciting world of this production, meet the characters, and learn about the creative team.', performances: [{ id: 'perf-4', date: 'Nov 15, 2024', time: '8:00 PM', price: 22.00 }, { id: 'perf-5', date: 'Nov 16, 2024', time: '8:00 PM', price: 22.00 }] },
                    '3': { title: 'Play Title 3', img: 'https://placehold.co/400x300?text=Play+Title+3', synopsis: 'A beloved classic brought to life! This production features stunning costumes and set design.', performances: [{ id: 'perf-6', date: 'Dec 1, 2024', time: '7:00 PM', price: 25.00 }, { id: 'perf-7', date: 'Dec 2, 2024', time: '7:00 PM', price: 25.00 }, { id: 'perf-8', date: 'Dec 3, 2024', time: '7:00 PM', price: 25.00 }] }
                };
                const data = showData[showId] || showData['1']; // Default to show 1 if not found

                showDetailContent.innerHTML = `
                     <h2>${data.title}</h2>
                     <img src="${data.img}" alt="Image for ${data.title}">
                     <p>${data.synopsis}</p>
                     <h3>Performances</h3>
                     <ul id="performance-list" role="list">
                         ${data.performances.map(perf => `
                             <li role="listitem">
                                 <span>${perf.date} - ${perf.time} ($${perf.price.toFixed(2)})</span>
                                 <button class="btn btn-secondary buy-ticket-btn" data-performance-id="${perf.id}" data-performance-price="${perf.price}" aria-label="Buy tickets for ${data.title} on ${perf.date} at ${perf.time}">Buy Tickets</button>
                             </li>
                         `).join('')}
                     </ul>
                 `;
                attachBuyTicketListeners(); // Re-attach listeners to new buttons
            };

            backToShowsBtns.forEach(btn => {
                btn.addEventListener('click', () => showSection('shows'));
            });

            function attachBuyTicketListeners() {
                document.querySelectorAll('.buy-ticket-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        selectedPerformanceId = e.target.dataset.performanceId;
                        const performancePrice = parseFloat(e.target.dataset.performancePrice);
                        console.log('Buying tickets for performance:', selectedPerformanceId, 'Price:', performancePrice);
                        showSection('buy-tickets');
                        // Reset workflow to step 1 and activate it
                        setCurrentStep('select-performance');
                        // Hide direct selection UI and show continue button
                        document.getElementById('direct-performance-selection').style.display = 'none';
                        continueToSeatsBtn.disabled = false;
                        // Note: In a real app, the selected performance would be stored and used
                        // to load the correct seat map and set the base ticket price.
                        // For this demo, we use a static seatPrice.
                        // If dynamic pricing per performance was needed, seatPrice would be set here.
                    });
                });
            }
            attachShowCardListeners(); // Attach initially
            attachBuyTicketListeners(); // Attach initially (for direct link to buy-tickets section)

            // Load performances for direct selection if user lands on #buy-tickets directly
            function loadDirectPerformanceList() {
                // Simulate loading all upcoming performances
                const allPerformances = [
                    { id: 'perf-1', date: 'Oct 10, 2024', time: '7:30 PM', price: 20.00, showTitle: 'Play Title 1' },
                    { id: 'perf-2', date: 'Oct 11, 2024', time: '7:30 PM', price: 20.00, showTitle: 'Play Title 1' },
                    { id: 'perf-3', date: 'Oct 12, 2024', time: '2:00 PM', price: 18.00, showTitle: 'Play Title 1' },
                    { id: 'perf-4', date: 'Nov 15, 2024', time: '8:00 PM', price: 22.00, showTitle: 'Play Title 2' },
                    { id: 'perf-5', date: 'Nov 16, 2024', time: '8:00 PM', price: 22.00, showTitle: 'Play Title 2' },
                    { id: 'perf-6', date: 'Dec 1, 2024', time: '7:00 PM', price: 25.00, showTitle: 'Play Title 3' },
                    { id: 'perf-7', date: 'Dec 2, 2024', time: '7:00 PM', price: 25.00, showTitle: 'Play Title 3' },
                    { id: 'perf-8', date: 'Dec 3, 2024', time: '7:00 PM', price: 25.00, showTitle: 'Play Title 3' }
                ];

                directPerformanceList.innerHTML = allPerformances.map(perf => `
                      <li role="listitem" style="padding: var(--spacing-unit); border-bottom: 1px dashed var(--background-color); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-unit);">
                          <span>${perf.showTitle} - ${perf.date} ${perf.time} ($${perf.price.toFixed(2)})</span>
                          <button class="btn btn-secondary select-this-performance-btn" data-performance-id="${perf.id}" data-performance-price="${perf.price}" aria-label="Select ${perf.showTitle} on ${perf.date} at ${perf.time}">Select</button>
                      </li>
                  `).join('');

                document.querySelectorAll('.select-this-performance-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        selectedPerformanceId = e.target.dataset.performanceId;
                        const performancePrice = parseFloat(e.target.dataset.performancePrice);
                        console.log('Directly selected performance:', selectedPerformanceId, 'Price:', performancePrice);
                        // Note: In a real app, seatPrice would be set here.
                        document.getElementById('direct-performance-selection').style.display = 'none';
                        continueToSeatsBtn.disabled = false;
                        continueToSeatsBtn.focus(); // Move focus to the next button
                    });
                });
            }


            // --- Ticket Workflow Steps ---
            const setCurrentStep = (stepId) => {
                currentStep = stepId;
                const stepsOrder = ['select-performance', 'select-seats', 'checkout', 'confirmation'];
                const currentIndex = stepsOrder.indexOf(currentStep);

                workflowSteps.forEach((step, index) => {
                    const stepCircle = step.querySelector('.step-circle');
                    const stepLabel = step.querySelector('.step-label');
                    step.classList.remove('active', 'completed');
                    stepCircle.classList.remove('active', 'completed');
                    stepLabel.classList.remove('active', 'completed');
                    step.setAttribute('aria-current', 'false');
                    step.setAttribute('tabindex', '-1'); // Make non-interactive steps non-focusable

                    if (step.dataset.step === stepId) {
                        step.classList.add('active');
                        stepCircle.classList.add('active');
                        stepLabel.classList.add('active');
                        step.setAttribute('aria-current', 'step');
                        step.setAttribute('tabindex', '0'); // Make current step focusable
                    } else if (index < currentIndex) {
                        step.classList.add('completed');
                        stepCircle.classList.add('completed');
                        stepLabel.classList.add('completed');
                        step.setAttribute('tabindex', '0'); // Make completed steps focusable to go back
                    } else {
                        // Future steps remain non-focusable
                    }
                });

                workflowContentDivs.forEach(div => {
                    if (div.id === `step-${stepId}`) {
                        div.classList.remove('hidden');
                        div.classList.add('active');
                        div.setAttribute('aria-hidden', 'false');
                        // Focus the heading of the new step for accessibility
                        const heading = div.querySelector('h3');
                        if (heading) heading.focus();
                    } else {
                        div.classList.add('hidden');
                        div.classList.remove('active');
                        div.setAttribute('aria-hidden', 'true');
                    }
                });
                window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top
            };

            nextStepBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const nextStepId = btn.dataset.nextStep;
                    // Add validation before moving to next step
                    if (currentStep === 'select-performance' && !selectedPerformanceId) {
                        alert('Please select a performance first.');
                        return;
                    }
                    if (currentStep === 'select-seats' && selectedSeats.length === 0) {
                        alert('Please select at least one seat.');
                        return;
                    }
                    if (currentStep === 'checkout') {
                        // Validation handled by form submit listener
                        // If submit listener passes, it will call setCurrentStep('confirmation')
                        return;
                    }
                    setCurrentStep(nextStepId);
                });
            });

            prevStepBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const prevStepId = btn.dataset.prevStep;
                    setCurrentStep(prevStepId);
                });
            });

            // Allow clicking on workflow steps (if not the current or a future step)
            workflowSteps.forEach(step => {
                step.addEventListener('click', () => {
                    const stepId = step.dataset.step;
                    // Simple logic: allow going back to previous steps
                    const stepsOrder = ['select-performance', 'select-seats', 'checkout', 'confirmation'];
                    const currentIndex = stepsOrder.indexOf(currentStep);
                    const clickedIndex = stepsOrder.indexOf(stepId);

                    if (clickedIndex <= currentIndex) {
                        setCurrentStep(stepId);
                    }
                });
                // Allow keyboard activation for workflow steps
                step.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const stepId = step.dataset.step;
                        const stepsOrder = ['select-performance', 'select-seats', 'checkout', 'confirmation'];
                        const currentIndex = stepsOrder.indexOf(currentStep);
                        const clickedIndex = stepsOrder.indexOf(stepId);

                        if (clickedIndex <= currentIndex) {
                            setCurrentStep(stepId);
                        }
                    }
                });
            });


            // --- Seat Map Simulation ---
            const generateSeatMap = (rows, seatsPerRow) => {
                theaterSeatMap.innerHTML = ''; // Clear existing map
                // theaterSeatMap.style.gridTemplateColumns = `repeat(${seatsPerRow}, 35px)`; // Adjust grid columns - auto-fit handles this better

                const seatData = [];
                const rowLabels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

                for (let r = 0; r < rows; r++) {
                    for (let s = 1; s <= seatsPerRow; s++) {
                        const seatId = `${rowLabels[r]}${s}`;
                        let status = 'available';
                        // Simulate some sold/unavailable seats (more sold than unavailable)
                        const random = Math.random();
                        if (random < 0.2) status = 'sold'; // 20% sold
                        else if (random < 0.25) status = 'unavailable'; // 5% unavailable

                        // Ensure previously selected seats are marked as selected
                        const isSelected = selectedSeats.some(seat => seat.id === seatId);
                        if (isSelected) status = 'selected';


                        seatData.push({ id: seatId, label: seatId, status: status });
                    }
                }


                seatData.forEach(seat => {
                    const seatElement = document.createElement('div');
                    seatElement.classList.add('seat', `seat--${seat.status}`);
                    seatElement.dataset.seatId = seat.id;
                    seatElement.dataset.seatLabel = seat.label;
                    seatElement.dataset.seatPrice = seatPrice; // Use static price for now
                    seatElement.dataset.seatStatus = seat.status;
                    seatElement.textContent = seat.label.replace(/[A-Z]/g, ''); // Show just number for simplicity
                    seatElement.setAttribute('tabindex', (seat.status === 'available' || seat.status === 'selected') ? '0' : '-1'); // Make interactive seats focusable

                    // Add tooltip
                    const tooltip = document.createElement('div');
                    tooltip.classList.add('seat-info');
                    tooltip.textContent = `${seat.label} - $${seatPrice.toFixed(2)}`;
                    if (seat.status === 'sold') tooltip.textContent = `${seat.label} - Sold`;
                    if (seat.status === 'unavailable') tooltip.textContent = `${seat.label} - Unavailable`;
                    seatElement.appendChild(tooltip);


                    if (seat.status === 'available' || seat.status === 'selected') {
                        seatElement.addEventListener('click', handleSeatClick);
                        seatElement.setAttribute('role', 'checkbox');
                        seatElement.setAttribute('aria-checked', seat.status === 'selected' ? 'true' : 'false');
                        seatElement.setAttribute('aria-label', `Seat ${seat.label} - ${seat.status === 'selected' ? 'Selected' : 'Available'}`);
                        // Add keyboard listener for Enter/Space
                        seatElement.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                handleSeatClick({ target: seatElement });
                            }
                        });
                    } else {
                        seatElement.setAttribute('role', 'status');
                        seatElement.setAttribute('aria-label', `Seat ${seat.label} - ${seat.status}`);
                    }


                    theaterSeatMap.appendChild(seatElement);
                });
            };

            const handleSeatClick = (e) => {
                const seatElement = e.target.closest('.seat'); // Use closest to handle clicks on tooltip
                if (!seatElement) return;

                const seatId = seatElement.dataset.seatId;
                const seatLabel = seatElement.dataset.seatLabel;
                const seatPrice = parseFloat(seatElement.dataset.seatPrice);
                const seatStatus = seatElement.dataset.seatStatus;

                if (seatStatus === 'sold' || seatStatus === 'unavailable') {
                    return; // Do nothing if seat is sold or unavailable
                }

                const isSelected = seatElement.classList.contains('seat--selected');

                if (isSelected) {
                    // Deselect seat
                    seatElement.classList.remove('seat--selected');
                    seatElement.classList.add('seat--available');
                    seatElement.dataset.seatStatus = 'available'; // Update status in dataset
                    selectedSeats = selectedSeats.filter(seat => seat.id !== seatId);
                    seatElement.setAttribute('aria-checked', 'false');
                    seatElement.setAttribute('aria-label', `Seat ${seatLabel} - Available`);
                } else {
                    // Select seat
                    seatElement.classList.remove('seat--available');
                    seatElement.classList.add('seat--selected');
                    seatElement.dataset.seatStatus = 'selected'; // Update status in dataset
                    selectedSeats.push({ id: seatId, label: seatLabel, price: seatPrice });
                    seatElement.setAttribute('aria-checked', 'true');
                    seatElement.setAttribute('aria-label', `Seat ${seatLabel} - Selected`);
                }

                updateSeatSummary();
            };

            const updateSeatSummary = () => {
                selectedSeatsList.innerHTML = ''; // Clear list
                let total = 0;

                if (selectedSeats.length === 0) {
                    selectedSeatsList.innerHTML = '<li role="listitem">No seats selected</li>';
                    continueToCheckoutBtn.disabled = true;
                } else {
                    selectedSeats.sort((a, b) => { // Sort seats for consistent display
                        const rowA = a.label.charCodeAt(0);
                        const rowB = b.label.charCodeAt(0);
                        if (rowA !== rowB) return rowA - rowB;
                        return parseInt(a.label.substring(1)) - parseInt(b.label.substring(1));
                    });

                    selectedSeats.forEach(seat => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('selected-seat-item');
                        listItem.setAttribute('role', 'listitem');
                        listItem.innerHTML = `<span>${seat.label}</span><span>$${seat.price.toFixed(2)}</span>`;
                        selectedSeatsList.appendChild(listItem);
                        total += seat.price;
                    });
                    continueToCheckoutBtn.disabled = false;
                }


                totalPriceSpan.textContent = total.toFixed(2);
            };

            // Generate initial seat map when the page loads (or when seat step is activated)
            // For demo, generate on load
            generateSeatMap(5, 10); // Example: 5 rows, 10 seats per row

            // --- Form Validation ---
            const validateInput = (input) => {
                const errorElement = input.nextElementSibling;
                let isValid = true;
                let errorMessage = '';

                if (input.required && input.value.trim() === '') {
                    isValid = false;
                    errorMessage = `Please enter your ${input.labels[0].textContent.toLowerCase().replace(' (optional)', '')}.`;
                } else if (input.type === 'email') {
                    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (input.value.trim() !== '' && !emailPattern.test(input.value.trim())) {
                        isValid = false;
                        errorMessage = 'Please enter a valid email address.';
                    }
                }
                // Add more validation rules (e.g., phone number format) as needed

                if (!isValid) {
                    input.classList.add('invalid');
                    if (errorElement && errorElement.classList.contains('error-message')) {
                        errorElement.textContent = errorMessage;
                        errorElement.style.display = 'block';
                    }
                } else {
                    input.classList.remove('invalid');
                    if (errorElement && errorElement.classList.contains('error-message')) {
                        errorElement.style.display = 'none';
                    }
                }
                return isValid;
            };

            const validateForm = (form) => {
                let formIsValid = true;
                const inputsToValidate = form.querySelectorAll('input[required], input[type="email"], input[type="tel"], textarea[required]'); // Add other types if needed

                inputsToValidate.forEach(input => {
                    if (!validateInput(input)) {
                        formIsValid = false;
                    }
                });
                return formIsValid;
            }


            checkoutForm.addEventListener('submit', (e) => {
                e.preventDefault(); // Prevent actual form submission

                if (validateForm(checkoutForm)) {
                    console.log('Checkout form is valid. Simulating purchase...');
                    // Simulate processing...
                    // In a real app, this would send data to backend for payment processing
                    setTimeout(() => {
                        setCurrentStep('confirmation');
                        document.getElementById('order-number').textContent = `#${Math.floor(Math.random() * 1000000000)}`; // Generate a mock order number
                        // Clear form and reset state
                        checkoutForm.reset();
                        selectedSeats = [];
                        updateSeatSummary();
                        selectedPerformanceId = null; // Reset selected performance
                        generateSeatMap(5, 10); // Reset seat map state
                    }, 1000); // Simulate a delay
                } else {
                    console.log('Checkout form is invalid.');
                    // Focus the first invalid element for accessibility
                    const firstInvalid = checkoutForm.querySelector('.invalid');
                    if (firstInvalid) {
                        firstInvalid.focus();
                    }
                }
            });

            // Add real-time validation on input and blur for checkout form
            checkoutForm.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('input', () => {
                    // Validate on input, but only after first blur/submit attempt
                    if (input.classList.contains('invalid')) {
                        validateInput(input);
                    }
                });
                input.addEventListener('blur', () => {
                    validateInput(input); // Validate when user leaves the field
                });
            });

            // Add validation for contact form
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (validateForm(contactForm)) {
                        console.log('Contact form is valid. Simulating submission...');
                        alert('Thank you for your message! We will get back to you soon.');
                        contactForm.reset();
                    } else {
                        console.log('Contact form is invalid.');
                        const firstInvalid = contactForm.querySelector('.invalid');
                        if (firstInvalid) {
                            firstInvalid.focus();
                        }
                    }
                });
                contactForm.querySelectorAll('input, textarea').forEach(input => {
                    input.addEventListener('input', () => {
                        if (input.classList.contains('invalid')) {
                            validateInput(input);
                        }
                    });
                    input.addEventListener('blur', () => {
                        validateInput(input);
                    });
                });
            }


            // --- Mobile Scanner Simulation ---
            scanButton.addEventListener('click', () => {
                scanButton.textContent = 'Scanning...';
                scanButton.disabled = true;
                scanResultDiv.textContent = ''; // Clear previous result
                scanResultDiv.classList.remove('valid', 'invalid');
                scanResultDiv.removeAttribute('aria-label'); // Clear previous announcement

                // Simulate scanning delay
                setTimeout(() => {
                    // Simulate a random scan result
                    const isTicketValid = Math.random() > 0.3; // 70% chance of valid ticket

                    if (isTicketValid) {
                        scanResultDiv.innerHTML = 'Ticket Valid!';
                        scanResultDiv.classList.add('valid');
                        // Simulate showing ticket details
                        const ticketDetails = document.createElement('p');
                        ticketDetails.style.fontSize = '0.9em';
                        ticketDetails.style.marginTop = 'var(--spacing-unit)';
                        ticketDetails.innerHTML = '<small>Ticket ID: XYZ789<br>Seat: B5<br>Show: Play Title 1<br>Date: Oct 10, 7:30 PM</small>';
                        scanResultDiv.appendChild(ticketDetails);
                        // Announce scan result for screen readers
                        scanResultDiv.setAttribute('aria-label', 'Scan result: Ticket Valid!');
                    } else {
                        scanResultDiv.innerHTML = 'Invalid Ticket!';
                        scanResultDiv.classList.add('invalid');
                        const ticketDetails = document.createElement('p');
                        ticketDetails.style.fontSize = '0.9em';
                        ticketDetails.style.marginTop = 'var(--spacing-unit)';
                        ticketDetails.innerHTML = '<small>Reason: Already Scanned / Not Found</small>';
                        scanResultDiv.appendChild(ticketDetails);
                        // Announce scan result for screen readers
                        scanResultDiv.setAttribute('aria-label', 'Scan result: Invalid Ticket!');
                    }

                    scanButton.textContent = 'Scan Again';
                    scanButton.disabled = false;
                }, 2000); // Simulate 2-second scan time
            });

            // --- Initial View ---
            // Show the home section on page load or based on hash
            const initialSectionId = window.location.hash ? window.location.hash.substring(1) : 'home';
            showSection(initialSectionId);
        });
    </script>
</body>

</html>