<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Revitalization Plan</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --primary-color: #e74c3c; /* Warm Red/Orange */
            --primary-color-dark: #c0392b;
            --secondary-color: #34495e; /* Dark Blue/Grey */
            --secondary-color-light: #4a627a;
            --background-color: #f4f6f8; /* Soft Grey */
            --surface-color: #ffffff; /* Pure White */
            --text-color: #333333; /* Dark Grey */
            --text-color-light: #666666;
            --border-color: #dddddd; /* Light Grey */
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --warning-color: #f39c12;

            --spacing-unit: 8px;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --transition-speed: 0.2s;
            --sidebar-width: 280px; /* Slightly wider sidebar for desktop */
            --header-height: 60px;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
            font-size: 16px; /* Base font size */
        }

        header {
            background-color: var(--surface-color);
            color: var(--secondary-color);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: var(--header-height);
        }

        header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 700;
        }

        aside {
            width: var(--sidebar-width);
            background-color: var(--secondary-color);
            color: #ffffff;
            padding-top: calc(var(--header-height) + var(--spacing-unit) * 3); /* Space for fixed header */
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 900;
            overflow-y: auto;
            box-shadow: var(--box-shadow);
            transition: transform var(--transition-speed) ease-in-out;
            transform: translateX(0); /* Default desktop state */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: var(--secondary-color-light) var(--secondary-color); /* Firefox */
        }

        aside::-webkit-scrollbar {
            width: 8px;
        }

        aside::-webkit-scrollbar-track {
            background: var(--secondary-color);
        }

        aside::-webkit-scrollbar-thumb {
            background-color: var(--secondary-color-light);
            border-radius: 4px;
            border: 2px solid var(--secondary-color);
        }


        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin-bottom: var(--spacing-unit);
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 3);
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-weight: 600;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            border-left: 4px solid transparent;
            outline: none; /* Remove default outline */
            font-size: 1em;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a:focus {
            background-color: var(--secondary-color-light);
            color: #ffffff;
            outline: 2px solid rgba(255, 255, 255, 0.3); /* Focus ring */
            outline-offset: -2px;
        }

        .sidebar-nav a.active {
            background-color: var(--primary-color);
            color: #ffffff;
            border-left-color: #ffffff;
            outline: none; /* Active state doesn't need focus ring */
        }

        .sidebar-nav a .material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 20px;
            transition: transform var(--transition-speed) ease;
        }

         .sidebar-nav a:hover .material-symbols-rounded,
         .sidebar-nav a:focus .material-symbols-rounded {
             transform: scale(1.1);
         }


        main {
            flex-grow: 1;
            padding: calc(var(--header-height) + var(--spacing-unit) * 4) calc(var(--spacing-unit) * 4) calc(var(--spacing-unit) * 4) calc(var(--sidebar-width) + var(--spacing-unit) * 4); /* Space for fixed header and sidebar */
            transition: margin-left var(--transition-speed) ease-in-out, padding var(--transition-speed) ease-in-out;
        }

        .content-section {
            display: none;
            margin-bottom: calc(var(--spacing-unit) * 4);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity var(--transition-speed) ease-out, transform var(--transition-speed) ease-out;
        }

        .content-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .card {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: calc(var(--spacing-unit) * 3);
            border: 1px solid var(--border-color); /* Subtle border */
        }

        .card-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: calc(var(--spacing-unit) * 3);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--border-color);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: calc(var(--spacing-unit) * 3);
        }

        .metric-card {
            background-color: var(--background-color); /* Use background color for metric cards */
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: none; /* No shadow for nested cards */
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .metric-value {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-unit);
        }

        .metric-label {
            font-size: 1em;
            color: var(--text-color-light);
        }

        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
            position: relative; /* For help icon */
        }

        label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 600;
            color: var(--text-color);
            font-size: 1em;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="file"],
        textarea,
        select {
            width: 100%;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            font-family: 'Inter', sans-serif;
            color: var(--text-color);
            background-color: var(--surface-color);
        }

         input[type="file"] {
             padding-top: var(--spacing-unit);
             padding-bottom: var(--spacing-unit);
         }


        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="file"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2); /* Using RGBA for primary color */
            outline: none;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2.5);
            background-color: var(--primary-color);
            color: #ffffff;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, opacity var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            outline: none; /* Remove default outline */
            min-height: calc(var(--spacing-unit) * 2 + 1em + var(--spacing-unit) * 2 + 2px); /* Ensure consistent height */
        }

        button:hover {
            background-color: var(--primary-color-dark);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button:focus-visible {
             box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.4); /* Focus ring */
        }

        button:active {
            opacity: 0.9;
            box-shadow: none;
        }

        button:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .button-secondary {
            background-color: var(--secondary-color);
        }

        .button-secondary:hover {
            background-color: var(--secondary-color-light);
        }

         .button-secondary:focus-visible {
             box-shadow: 0 0 0 3px rgba(52, 73, 94, 0.4); /* Focus ring */
        }

        .button .material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 20px;
        }


        .chart-container {
            position: relative;
            height: 400px; /* Fixed height for chart */
            margin-top: calc(var(--spacing-unit) * 3);
            cursor: pointer; /* Indicate interactivity */
            background-color: var(--surface-color); /* Ensure chart area has a background */
            padding: calc(var(--spacing-unit) * 2); /* Add padding */
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .floating-controls {
            position: absolute;
            top: var(--spacing-unit) * 2;
            right: var(--spacing-unit) * 2;
            background: var(--surface-color);
            padding: calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-speed) ease;
            pointer-events: none;
            z-index: 500;
            width: 200px; /* Fixed width for controls */
            border: 1px solid var(--border-color);
        }

        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .control-group {
            margin-bottom: var(--spacing-unit) * 1.5;
        }

        .control-group label {
            font-size: 0.9em;
            margin-bottom: var(--spacing-unit);
            color: var(--text-color-light);
            font-weight: 400;
        }

        .control-group input[type="color"],
        .control-group input[type="number"],
        .control-group select {
            padding: var(--spacing-unit);
            font-size: 0.9em;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-sizing: border-box;
            background-color: var(--background-color); /* Lighter background for controls */
        }

        .control-group input[type="color"] {
            height: calc(var(--spacing-unit) * 2 + 0.9em + 2px + 2px); /* Match height of other inputs */
            padding: 4px; /* Adjust padding for color picker */
        }


        .progress-bar-container {
            width: 100%;
            background-color: var(--border-color);
            border-radius: var(--border-radius);
            margin-top: calc(var(--spacing-unit) * 3);
            overflow: hidden;
            height: calc(var(--spacing-unit) * 2.5);
        }

        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.5s ease-in-out, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: 0.9em;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1); /* Add subtle shadow for readability */
        }

         .progress-bar[style*="width: 0%"] {
             color: var(--text-color-light);
             background-color: transparent !important; /* Override dynamic color for 0% */
             justify-content: flex-start;
             padding-left: var(--spacing-unit);
             text-shadow: none;
         }


        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Darker overlay */
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity var(--transition-speed) ease-out;
            padding: calc(var(--spacing-unit) * 2); /* Add padding for small screens */
            box-sizing: border-box;
        }

         .modal.active {
             display: flex;
             opacity: 1;
         }

        .modal-content {
            background-color: var(--surface-color);
            margin: auto;
            padding: calc(var(--spacing-unit) * 4);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%; /* Responsive width */
            max-width: 600px;
            position: relative;
            transform: translateY(-20px);
            transition: transform var(--transition-speed) ease-out;
            box-sizing: border-box;
        }

         .modal.active .modal-content {
             transform: translateY(0);
         }

        .close-button {
            color: var(--text-color-light);
            position: absolute;
            top: calc(var(--spacing-unit) * 2);
            right: calc(var(--spacing-unit) * 2);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color var(--transition-speed) ease;
            background: none; /* Remove button default style */
            border: none;
            padding: var(--spacing-unit); /* Increase click area */
            line-height: 1;
            border-radius: var(--border-radius);
            outline: none;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--text-color);
            text-decoration: none;
             background-color: var(--background-color);
             outline: none;
        }

         .close-button:focus-visible {
             box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
         }


        .alert {
            padding: calc(var(--spacing-unit) * 2);
            margin-top: calc(var(--spacing-unit) * 3); /* Add margin-top */
            margin-bottom: 0; /* Remove margin-bottom if used after form */
            border-radius: var(--border-radius);
            font-weight: 600;
            display: none; /* Changed from flex to none for initial state */
            align-items: center;
            gap: var(--spacing-unit);
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            min-height: calc(var(--spacing-unit) * 4 + 1em); /* Ensure minimum height */
        }

        .alert.active {
            display: flex; /* Use flex when active */
            opacity: 1;
            transform: translateY(0);
        }

        .alert.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

         .alert.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }


        .alert .material-symbols-rounded {
            font-size: 20px;
             flex-shrink: 0; /* Prevent icon from shrinking */
        }

        /* Specific Goal List Styling */
        #goals-list .card {
            padding: calc(var(--spacing-unit) * 2);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-unit) * 2;
            display: flex;
            flex-direction: column;
            background-color: var(--background-color); /* Lighter background for goal items */
        }

        #goals-list .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-unit);
        }

        #goals-list .goal-header h4 {
             margin: 0;
             color: var(--secondary-color);
             font-size: 1.1em;
        }

         #goals-list .goal-description {
             margin: 0 0 var(--spacing-unit);
             font-size: 0.9em;
             color: var(--text-color-light);
         }

         #goals-list .goal-actions {
             margin-top: var(--spacing-unit) * 1.5;
             text-align: right;
         }

         #goals-list .goal-actions button {
             padding: var(--spacing-unit) var(--spacing-unit) * 1.5;
             font-size: 0.9em;
             margin-left: var(--spacing-unit);
             min-height: auto; /* Allow smaller height for action buttons */
         }

        #goals-list .goal-actions button .material-symbols-rounded {
            margin-right: var(--spacing-unit) * 0.5;
            font-size: 16px;
        }

        .help-icon {
            position: absolute;
            top: 50%; /* Align vertically with input/label */
            right: var(--spacing-unit); /* Position inside form-group */
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-color-light);
            cursor: help;
            transition: color var(--transition-speed) ease;
        }

        .help-icon:hover {
            color: var(--secondary-color);
        }

        .help-tooltip {
            visibility: hidden;
            width: 200px;
            background-color: var(--secondary-color);
            color: var(--surface-color);
            text-align: center;
            border-radius: var(--border-radius);
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the icon */
            left: 50%;
            margin-left: -100px; /* Center the tooltip */
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .help-tooltip::after {
            content: "";
            position: absolute;
            top: 100%; /* At the bottom of the tooltip */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--secondary-color) transparent transparent transparent;
        }

        .help-icon:hover + .help-tooltip,
        .help-icon:focus + .help-tooltip {
            visibility: visible;
            opacity: 1;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            aside {
                transform: translateX(-100%); /* Hide sidebar by default on mobile */
                width: 80%; /* Make sidebar wider on mobile */
                max-width: 300px;
            }

            aside.active {
                transform: translateX(0); /* Show sidebar when active */
            }

            main {
                margin-left: 0;
                padding: calc(var(--header-height) + var(--spacing-unit) * 4) calc(var(--spacing-unit) * 2);
            }

            header {
                padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            }

            .sidebar-toggle {
                display: block; /* Show toggle button on mobile */
            }

            .card {
                 padding: calc(var(--spacing-unit) * 2);
            }

             .modal-content {
                width: 95%;
                padding: calc(var(--spacing-unit) * 3);
            }

             .grid-container {
                 grid-template-columns: 1fr; /* Stack metrics on small screens */
             }

             .floating-controls {
                 top: auto;
                 bottom: var(--spacing-unit) * 2;
                 left: var(--spacing-unit) * 2;
                 right: var(--spacing-unit) * 2;
                 width: auto; /* Allow controls to take full width */
                 max-width: none;
             }

             .alert {
                 flex-direction: column;
                 align-items: flex-start;
             }

             .alert .material-symbols-rounded {
                 margin-bottom: var(--spacing-unit);
             }

             .help-icon {
                 right: var(--spacing-unit); /* Adjust position for smaller padding */
             }

             .help-tooltip {
                 bottom: auto;
                 top: 125%; /* Position below the icon on mobile */
                 left: 0; /* Align left */
                 margin-left: 0;
                 width: 95%; /* Take most of the width */
                 text-align: left;
             }
             .help-tooltip::after {
                 top: -5px; /* At the top of the tooltip */
                 left: 10%; /* Adjust arrow position */
                 margin-left: -5px;
                 border-color: transparent transparent var(--secondary-color) transparent;
             }
        }

         @media (min-width: 769px) {
            .sidebar-toggle {
                display: none; /* Hide toggle button on desktop */
            }
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--secondary-color);
            font-size: 24px;
            cursor: pointer;
            padding: var(--spacing-unit); /* Increase click area */
            margin-right: var(--spacing-unit);
            display: flex; /* Use flex to center icon */
            align-items: center;
            justify-content: center;
            outline: none;
            border-radius: var(--border-radius);
             transition: background-color var(--transition-speed) ease;
        }

         .sidebar-toggle:hover {
             background-color: var(--background-color);
         }

         .sidebar-toggle:focus-visible {
             box-shadow: 0 0 0 3px rgba(52, 73, 94, 0.4); /* Focus ring */
         }

        /* Accessibility: Hide content visually but keep for screen readers */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }


    </style>
</head>
<body>
    <header>
        <button class="sidebar-toggle" aria-label="Toggle navigation menu">
             <span class="material-symbols-rounded">menu</span>
        </button>
        <h1>Restaurant Revitalization Hub</h1>
        <!-- Optional: User profile or settings icon -->
    </header>

    <aside id="sidebar" aria-label="Main navigation">
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#dashboard" class="nav-link active" data-section="dashboard">
                    <span class="material-symbols-rounded" aria-hidden="true">dashboard</span> Dashboard
                </a></li>
                <li><a href="#data-analysis" class="nav-link" data-section="data-analysis">
                     <span class="material-symbols-rounded" aria-hidden="true">analytics</span> Data Analysis
                </a></li>
                 <li><a href="#data-upload" class="nav-link" data-section="data-upload">
                    <span class="material-symbols-rounded" aria-hidden="true">upload_file</span> Data Upload
                </a></li>
                <li><a href="#market-analysis" class="nav-link" data-section="market-analysis">
                    <span class="material-symbols-rounded" aria-hidden="true">storefront</span> Market Analysis
                </a></li>
                <li><a href="#swot-analysis" class="nav-link" data-section="swot-analysis">
                    <span class="material-symbols-rounded" aria-hidden="true">balance</span> SWOT Analysis
                </a></li>
                <li><a href="#strategy" class="nav-link" data-section="strategy">
                    <span class="material-symbols-rounded" aria-hidden="true">settings</span> Strategy
                </a></li>
                <li><a href="#goals" class="nav-link" data-section="goals">
                    <span class="material-symbols-rounded" aria-hidden="true">check_circle</span> Goals & Tracking
                </a></li>
                <li><a href="#plan-summary" class="nav-link" data-section="plan-summary">
                    <span class="material-symbols-rounded" aria-hidden="true">article</span> Plan Summary
                </a></li>
            </ul>
        </nav>
    </aside>

    <main id="main-content" aria-live="polite">
        <section id="dashboard" class="content-section active" role="region" aria-labelledby="dashboard-title">
            <h2 id="dashboard-title" class="card-title visually-hidden">Dashboard Overview</h2>
            <div class="card">
                <h3 class="card-title">Overview</h3>
                <div class="grid-container">
                    <div class="metric-card">
                        <div class="metric-value" id="metric-revenue">$12,345</div>
                        <div class="metric-label">Total Revenue (Last 30 Days)</div>
                    </div>
                     <div class="metric-card">
                        <div class="metric-value" id="metric-customers">456</div>
                        <div class="metric-label">Total Customers (Last 30 Days)</div>
                    </div>
                     <div class="metric-card">
                        <div class="metric-value" id="metric-rating">4.2/5</div>
                        <div class="metric-label">Average Customer Rating</div>
                    </div>
                     <div class="metric-card">
                        <div class="metric-value" id="metric-plan-completion">0%</div>
                        <div class="metric-label">Plan Completion</div>
                    </div>
                </div>
                 <div class="progress-bar-container">
                    <div class="progress-bar" id="plan-progress" style="width: 0%;">Start Plan</div>
                </div>
            </div>

             <div class="card">
                <h3 class="card-title">Quick Actions</h3>
                <div style="display: flex; gap: calc(var(--spacing-unit) * 2); flex-wrap: wrap;">
                    <button onclick="showSection('data-upload')"><span class="material-symbols-rounded" aria-hidden="true">upload_file</span> Upload Data</button>
                    <button class="button-secondary" onclick="showSection('goals')"><span class="material-symbols-rounded" aria-hidden="true">add_circle</span> Set New Goal</button>
                </div>
            </div>
        </section>

        <section id="data-upload" class="content-section" role="region" aria-labelledby="data-upload-title">
            <h2 id="data-upload-title" class="card-title visually-hidden">Data Upload</h2>
            <div class="card">
                <h3 class="card-title">Upload Data</h3>
                 <p style="color: var(--text-color-light); margin-bottom: calc(var(--spacing-unit) * 3);">Upload your sales data (CSV, Excel) and customer feedback (text files, surveys) to analyze your performance.</p>
                <div class="form-group">
                    <label for="sales-file">Sales Data (CSV, XLSX)</label>
                    <input type="file" id="sales-file" accept=".csv, .xlsx" aria-describedby="sales-file-help">
                    <p id="sales-file-help" class="visually-hidden">Accepted file formats are CSV and XLSX.</p>
                </div>
                 <div class="form-group">
                    <label for="feedback-file">Customer Feedback (TXT, CSV)</label>
                    <input type="file" id="feedback-file" accept=".txt, .csv" aria-describedby="feedback-file-help">
                     <p id="feedback-file-help" class="visually-hidden">Accepted file formats are TXT and CSV.</p>
                </div>
                 <button onclick="uploadFiles()"><span class="material-symbols-rounded" aria-hidden="true">analytics</span> Analyze Data</button>
                 <div id="upload-status" class="alert" role="status" aria-live="polite"></div>
            </div>
        </section>

        <section id="data-analysis" class="content-section" role="region" aria-labelledby="data-analysis-title">
            <h2 id="data-analysis-title" class="card-title visually-hidden">Data Analysis</h2>
            <div class="card">
                <h3 class="card-title">Data Analysis</h3>
                <p style="color: var(--text-color-light); margin-bottom: calc(var(--spacing-unit) * 3);">Visualize your sales trends and customer feedback insights.</p>

                <!-- Sales Trend Chart -->
                <div class="card">
                    <h4 class="card-title" style="margin-bottom: var(--spacing-unit) * 2; border-bottom: none;">üìà Sales Trend Over Time</h4>
                    <div class="chart-container" id="sales-chart-container" aria-label="Sales trend chart">
                        <canvas id="salesChart"></canvas>
                        <!-- Floating control panel -->
                        <div class="floating-controls" id="sales-chart-controls" aria-label="Sales chart controls">
                            <div class="control-group">
                                <label for="salesLineColor">Line Color</label>
                                <input type="color" id="salesLineColor" value="#e74c3c">
                            </div>
                            <div class="control-group">
                                <label for="salesFillColor">Fill Color</label>
                                <input type="color" id="salesFillColor" value="#f4f6f8">
                            </div>
                            <div class="control-group">
                                <label for="salesChartType">Chart Type</label>
                                <select id="salesChartType">
                                    <option value="line">Line</option>
                                    <option value="bar">Bar</option>
                                </select>
                            </div>
                             <div class="control-group">
                                <label for="salesDataFilter">Time Period</label>
                                <select id="salesDataFilter">
                                    <option value="all">All Time</option>
                                    <option value="12m">Last 12 Months</option>
                                    <option value="6m">Last 6 Months</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu Item Performance Chart -->
                 <div class="card">
                    <h4 class="card-title" style="margin-bottom: var(--spacing-unit) * 2; border-bottom: none;">üìä Menu Item Performance</h4>
                     <p style="color: var(--text-color-light);">Analyze sales performance across different menu items or categories.</p>
                     <div class="chart-container" id="menu-chart-container" aria-label="Menu item performance chart">
                         <canvas id="menuChart"></canvas>
                          <!-- Floating control panel -->
                        <div class="floating-controls" id="menu-chart-controls" aria-label="Menu chart controls">
                            <div class="control-group">
                                <label for="menuBarColor">Bar Color</label>
                                <input type="color" id="menuBarColor" value="#3498db"> <!-- Different color -->
                            </div>
                            <div class="control-group">
                                <label for="menuChartType">Chart Type</label>
                                <select id="menuChartType">
                                    <option value="bar">Bar</option>
                                    <option value="pie">Pie</option>
                                </select>
                            </div>
                             <div class="control-group">
                                <label for="menuDataFilter">Group By</label>
                                <select id="menuDataFilter">
                                    <option value="category">Category (Placeholder)</option>
                                    <option value="item">Item (Placeholder)</option>
                                </select>
                            </div>
                        </div>
                     </div>
                </div>

                 <!-- Customer Feedback Summary -->
                 <div class="card">
                    <h4 class="card-title" style="margin-bottom: var(--spacing-unit) * 2; border-bottom: none;">üó£Ô∏è Customer Feedback Summary</h4>
                     <p style="color: var(--text-color-light);">Insights from customer feedback will appear here, summarizing common themes and sentiment.</p>
                     <div id="feedback-summary-content" style="min-height: 150px; background-color: var(--background-color); border-radius: var(--border-radius); padding: var(--spacing-unit) * 2; color: var(--text-color); white-space: pre-wrap; border: 1px solid var(--border-color);" aria-live="polite">
                         <p>No feedback data analyzed yet. Upload customer feedback files to see insights here.</p>
                     </div>
                </div>
            </div>
        </section>

        <section id="market-analysis" class="content-section" role="region" aria-labelledby="market-analysis-title">
            <h2 id="market-analysis-title" class="card-title visually-hidden">Market Analysis</h2>
            <div class="card">
                <h3 class="card-title">Market Analysis</h3>
                 <div class="form-group">
                    <label for="market-content">Analysis Details</label>
                     <span class="material-symbols-rounded help-icon" aria-label="Help about Market Analysis" tabindex="0">help</span>
                     <div class="help-tooltip" role="tooltip">Analyze your local market, including demographics, competition, and trends relevant to your restaurant.</div>
                    <textarea id="market-content" placeholder="Describe the key demographic changes, list competitors and their strategies, and outline relevant industry trends."></textarea>
                </div>
                 <button onclick="saveSection('market-analysis')"><span class="material-symbols-rounded" aria-hidden="true">save</span> Save Analysis</button>
                 <div id="market-analysis-status" class="alert" role="status" aria-live="polite"></div>
            </div>
        </section>

        <section id="swot-analysis" class="content-section" role="region" aria-labelledby="swot-analysis-title">
            <h2 id="swot-analysis-title" class="card-title visually-hidden">SWOT Analysis</h2>
            <div class="card">
                <h3 class="card-title">SWOT Analysis</h3>
                 <div class="form-group">
                    <label for="swot-content">SWOT Details</label>
                     <span class="material-symbols-rounded help-icon" aria-label="Help about SWOT Analysis" tabindex="0">help</span>
                     <div class="help-tooltip" role="tooltip">Identify your restaurant's internal Strengths and Weaknesses, and external Opportunities and Threats.</div>
                    <textarea id="swot-content" placeholder="Outline your restaurant's Strengths, Weaknesses, Opportunities, and Threats."></textarea>
                </div>
                 <button onclick="saveSection('swot-analysis')"><span class="material-symbols-rounded" aria-hidden="true">save</span> Save Analysis</button>
                 <div id="swot-analysis-status" class="alert" role="status" aria-live="polite"></div>
            </div>
        </section>

        <section id="strategy" class="content-section" role="region" aria-labelledby="strategy-title">
            <h2 id="strategy-title" class="card-title visually-hidden">Strategy Development</h2>
            <div class="card">
                <h3 class="card-title">Strategy Development</h3>
                 <div class="form-group">
                    <label for="strategy-content">Strategy Details</label>
                     <span class="material-symbols-rounded help-icon" aria-label="Help about Strategy Development" tabindex="0">help</span>
                     <div class="help-tooltip" role="tooltip">Based on your analysis, outline your core strategy for revitalization, including target audience, marketing, and operations.</div>
                    <textarea id="strategy-content" placeholder="Define your vision, target audience, marketing strategy, and operational improvements."></textarea>
                </div>
                 <button onclick="saveSection('strategy')"><span class="material-symbols-rounded" aria-hidden="true">save</span> Save Strategy</button>
                 <div id="strategy-status" class="alert" role="status" aria-live="polite"></div>
            </div>
        </section>

        <section id="goals" class="content-section" role="region" aria-labelledby="goals-title">
             <h2 id="goals-title" class="card-title visually-hidden">Goals & Tracking</h2>
             <div class="card">
                <h3 class="card-title">Goals & Tracking</h3>
                 <p style="color: var(--text-color-light); margin-bottom: calc(var(--spacing-unit) * 3);">Set specific, measurable, achievable, relevant, and time-bound (SMART) goals.</p>

                 <div id="goals-list" aria-live="polite" aria-atomic="false">
                     <!-- Goals will be listed here dynamically -->
                 </div>

                 <button onclick="openGoalModal()"><span class="material-symbols-rounded" aria-hidden="true">add_circle</span> Add New Goal</button>
            </div>
        </section>

        <section id="plan-summary" class="content-section" role="region" aria-labelledby="plan-summary-title">
             <h2 id="plan-summary-title" class="card-title visually-hidden">Plan Summary</h2>
             <div class="card">
                <h3 class="card-title">Plan Summary</h3>
                 <p style="color: var(--text-color-light); margin-bottom: calc(var(--spacing-unit) * 3);">Review and finalize your comprehensive business revitalization plan.</p>
                 <div id="summary-content" style="min-height: 300px; background-color: var(--background-color); border-radius: var(--border-radius); padding: var(--spacing-unit) * 2; color: var(--text-color); white-space: pre-wrap; border: 1px solid var(--border-color);" aria-live="polite">
                     <!-- Summary will be compiled here from other sections -->
                     <p>Click "Generate Summary" to compile content from other sections.</p>
                 </div>
                 <div style="display: flex; gap: calc(var(--spacing-unit) * 2); margin-top: calc(var(--spacing-unit) * 3); flex-wrap: wrap;">
                    <button onclick="generateSummary()"><span class="material-symbols-rounded" aria-hidden="true">build</span> Generate Summary</button>
                    <button class="button-secondary" disabled><span class="material-symbols-rounded" aria-hidden="true">download</span> Export Plan (Placeholder)</button>
                 </div>
            </div>
        </section>

    </main>

    <!-- Modal for Goal Setting -->
    <div id="goalModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="goal-modal-title">
        <div class="modal-content">
            <button class="close-button" onclick="closeGoalModal()" aria-label="Close modal">&times;</button>
            <h3 id="goal-modal-title" class="card-title" style="margin-bottom: var(--spacing-unit) * 2; border-bottom: none;">Edit Goal</h3>
            <input type="hidden" id="goal-id">
            <div class="form-group">
                <label for="goal-title">Goal Title</label>
                <input type="text" id="goal-title" placeholder="e.g., Increase revenue, Improve rating" required>
            </div>
            <div class="form-group">
                <label for="goal-description">Description</label>
                <textarea id="goal-description" placeholder="Describe the steps to achieve this goal."></textarea>
            </div>
            <div class="form-group">
                <label for="goal-progress">Progress (%)</label>
                <input type="number" id="goal-progress" min="0" max="100" value="0">
            </div>
            <button onclick="saveGoal()"><span class="material-symbols-rounded" aria-hidden="true">save</span> Save Goal</button>
        </div>
    </div>


    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // --- State Management (using localStorage) ---
        const state = {
            sections: {
                'market-analysis': { content: '' },
                'swot-analysis': { content: '' },
                'strategy': { content: '' }
            },
            goals: [],
            data: { // Placeholder for uploaded/analyzed data
                sales: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    data: [10000, 11000, 9500, 10500, 11500, 10000, 9800, 9200, 8800, 8500, 8200, 8000], // Example declining data
                },
                 menu: { // Example menu data
                    labels: ['Pizza', 'Pasta', 'Salads', 'Drinks', 'Desserts'],
                    data: [5000, 4000, 1500, 2000, 1000],
                 },
                 feedback: { // Example feedback data
                     summary: "No feedback data analyzed yet. Upload customer feedback files to see insights here."
                 }
            }
        };

        function loadState() {
            const savedState = localStorage.getItem('revitalizationPlanState');
            if (savedState) {
                try {
                    const parsedState = JSON.parse(savedState);
                    // Merge saved state, ensuring structure is maintained if new fields are added
                    Object.assign(state.sections, parsedState.sections);
                    state.goals = parsedState.goals || [];
                     // Deep merge for data, or just assign if structure is simple
                    if (parsedState.data) {
                         Object.assign(state.data.sales, parsedState.data.sales);
                         Object.assign(state.data.menu, parsedState.data.menu);
                         Object.assign(state.data.feedback, parsedState.data.feedback);
                    }

                } catch (e) {
                    console.error("Failed to load state from localStorage:", e);
                    // Optionally clear invalid state
                    // localStorage.removeItem('revitalizationPlanState');
                }
            }
             // Load section content into textareas on page load (only for the initially active section)
             // Content for other sections is loaded when they become active via showSection
             const activeSectionId = document.querySelector('.content-section.active')?.id;
             if (activeSectionId) {
                 loadSectionContent(activeSectionId);
             }

             // Render goals on load
             renderGoals();
             // Update dashboard metrics and progress
             updateDashboardMetrics();
             updatePlanProgress();
             // Render charts with loaded data (or initial data if none loaded)
             renderSalesChart();
             renderMenuChart();
             renderFeedbackSummary();
        }

        function saveState() {
            // Save textarea content back to state before saving
             Object.keys(state.sections).forEach(sectionId => {
                 const textarea = document.querySelector(`#${sectionId} textarea`);
                 if (textarea) {
                     state.sections[sectionId].content = textarea.value;
                 }
             });
            localStorage.setItem('revitalizationPlanState', JSON.stringify(state));
            console.log('State saved to localStorage');
        }

        // Load state when the page loads
        window.addEventListener('load', loadState);
        // Save state periodically or on significant changes (e.g., before closing)
        // window.addEventListener('beforeunload', saveState); // Be cautious with beforeunload, can be annoying


        // --- Navigation Logic ---
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.querySelector('.sidebar-toggle');
        const mainContent = document.getElementById('main-content');
        const header = document.querySelector('header'); // Get header for focus management

        function showSection(sectionId) {
            // Save content of the *currently* active section before switching
             const currentActiveSection = document.querySelector('.content-section.active');
             if (currentActiveSection) {
                 const currentSectionId = currentActiveSection.id;
                 const textarea = document.querySelector(`#${currentSectionId} textarea`);
                 if (textarea && state.sections[currentSectionId]) {
                     state.sections[currentSectionId].content = textarea.value;
                 }
             }


            contentSections.forEach(section => {
                section.classList.remove('active');
            });
            navLinks.forEach(link => {
                link.classList.remove('active');
            });

            const targetSection = document.getElementById(sectionId);
            const targetLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);

            if (targetSection) {
                mainContent.setAttribute('aria-busy', 'true'); // Indicate content is loading
                // Allow transition to happen before setting active
                setTimeout(() => {
                    targetSection.classList.add('active');
                    mainContent.setAttribute('aria-busy', 'false'); // Indicate content is ready
                     // Set focus to the main content area or the first heading for accessibility
                     targetSection.setAttribute('tabindex', '-1'); // Make section focusable
                     targetSection.focus(); // Focus the section
                     targetSection.removeAttribute('tabindex'); // Remove tabindex once focused
                }, parseFloat(getCssVar('--transition-speed')) * 1000); // Short delay for transition effect

            }
            if (targetLink) {
                targetLink.classList.add('active');
            }

             // Hide sidebar on mobile after selection
            if (window.innerWidth <= 768) {
                 sidebar.classList.remove('active');
                 // Return focus to toggle button after closing sidebar
                 setTimeout(() => sidebarToggle.focus(), parseFloat(getCssVar('--transition-speed')) * 1000);
            }

            // Load content for the section if applicable (e.g., textareas)
             loadSectionContent(sectionId);
             // Re-render charts if the data-analysis section is shown
             if (sectionId === 'data-analysis') {
                 renderSalesChart();
                 renderMenuChart();
                 renderFeedbackSummary();
             }
             // Re-render goals if the goals section is shown
             if (sectionId === 'goals') {
                 renderGoals();
             }
        }

        function loadSectionContent(sectionId) {
             const sectionState = state.sections[sectionId];
             if (sectionState) {
                 const textarea = document.querySelector(`#${sectionId} textarea`);
                 if (textarea && sectionState.content !== undefined) {
                     textarea.value = sectionState.content;
                 }
             }
        }


        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.getAttribute('data-section');
                showSection(sectionId);
            });
        });

        sidebarToggle.addEventListener('click', () => {
             sidebar.classList.toggle('active');
             // Manage focus when sidebar opens/closes
             if (sidebar.classList.contains('active')) {
                 // Focus the first link in the sidebar
                 const firstLink = sidebar.querySelector('.sidebar-nav a');
                 if (firstLink) {
                     firstLink.focus();
                 }
             } else {
                 // Focus back on the toggle button
                 sidebarToggle.focus();
             }
        });

        // Close sidebar if clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && sidebar.classList.contains('active') &&
                !sidebar.contains(e.target) && !sidebarToggle.contains(e.target) && !header.contains(e.target)) { // Also exclude header clicks
                sidebar.classList.remove('active');
                 // Return focus to toggle button after closing sidebar
                 setTimeout(() => sidebarToggle.focus(), parseFloat(getCssVar('--transition-speed')) * 1000);
            }
        });

         // Close sidebar if Escape key is pressed on mobile
         window.addEventListener('keydown', (event) => {
             if (window.innerWidth <= 768 && event.key === 'Escape' && sidebar.classList.contains('active')) {
                 sidebar.classList.remove('active');
                 // Return focus to toggle button after closing sidebar
                 setTimeout(() => sidebarToggle.focus(), parseFloat(getCssVar('--transition-speed')) * 1000);
             }
         });


        // Initial section display
        showSection('dashboard');

        // --- Dashboard Metrics Update ---
        function updateDashboardMetrics() {
             // This is a placeholder. In a real app, these would come from data analysis.
             const totalRevenue = state.data.sales.data.reduce((sum, val) => sum + val, 0);
             document.getElementById('metric-revenue').textContent = totalRevenue.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
             document.getElementById('metric-customers').textContent = '456'; // Static placeholder
             document.getElementById('metric-rating').textContent = '4.2/5'; // Static placeholder
             // Plan completion is updated by updatePlanProgress()
        }


        // --- Data Upload Placeholder ---
        function uploadFiles() {
            const salesFile = document.getElementById('sales-file').files[0];
            const feedbackFile = document.getElementById('feedback-file').files[0];
            const statusDiv = document.getElementById('upload-status');
            statusDiv.classList.remove('success', 'error', 'warning', 'active');
            statusDiv.innerHTML = '';
            statusDiv.style.display = 'none';


            if (!salesFile && !feedbackFile) {
                statusDiv.classList.add('warning', 'active');
                 statusDiv.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">warning</span> Please select at least one file to upload.';
                 statusDiv.style.display = 'flex';
                return;
            }

            // Placeholder for actual upload and processing logic
            console.log('Simulating upload:', salesFile, feedbackFile);

            // Simulate upload success/processing
            statusDiv.classList.add('alert', 'active');
             statusDiv.style.display = 'flex';
             statusDiv.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">hourglass_empty</span> Processing files... (Placeholder)';


            setTimeout(() => {
                // Simulate success and update placeholder data
                 statusDiv.classList.remove('warning', 'error');
                statusDiv.classList.add('success');
                statusDiv.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">check_circle</span> Files uploaded and analysis complete (Placeholder).';

                 // --- Simulate Data Update ---
                 // In a real app, parse files and update state.data
                 state.data.sales.data = [9500, 10500, 11500, 10000, 9800, 9200, 8800, 8500, 8200, 8000, 8100, 8300]; // Slightly updated data
                 state.data.menu.data = [5200, 4100, 1600, 2100, 1100]; // Slightly updated data
                 state.data.feedback.summary = "Analysis of customer feedback reveals key themes:\n\nPositive:\n- Consistent praise for authentic Italian flavors.\n- Appreciation for friendly service staff.\n- Positive comments on recent menu additions.\n\nNegative:\n- Frequent mentions of slow service during peak dining hours.\n- Some feedback regarding outdated interior decor.\n- Suggestions for more diverse vegetarian/vegan options.\n\nOverall Sentiment: Generally positive, but operational improvements and ambiance updates are needed.";

                 // Re-render charts and update metrics if currently on Data Analysis or Dashboard
                 if (document.getElementById('data-analysis').classList.contains('active')) {
                     renderSalesChart();
                     renderMenuChart();
                     renderFeedbackSummary();
                 }
                 if (document.getElementById('dashboard').classList.contains('active')) {
                      updateDashboardMetrics();
                 } else {
                      // Update metrics even if not on dashboard, so they are correct when dashboard is visited
                      updateDashboardMetrics();
                 }


                 saveState(); // Save the updated placeholder data state

                 // Hide status after a few seconds
                 setTimeout(() => {
                     statusDiv.classList.remove('active');
                     setTimeout(() => statusDiv.style.display = 'none', parseFloat(getCssVar('--transition-speed')) * 1000);
                 }, 5000);


            }, 2000); // Simulate processing time
        }
        window.uploadFiles = uploadFiles; // Make function globally accessible for inline onclick

        // --- Business Plan Section Saving ---
        function saveSection(sectionId) {
            const statusDiv = document.getElementById(`${sectionId}-status`);
            statusDiv.classList.remove('success', 'error', 'warning', 'active');
            statusDiv.innerHTML = '';
             statusDiv.style.display = 'none';


            const textarea = document.querySelector(`#${sectionId} textarea`);
            if (textarea) {
                state.sections[sectionId].content = textarea.value;
                saveState(); // Save state after updating section content

                statusDiv.classList.add('alert', 'success', 'active');
                statusDiv.style.display = 'flex';
                statusDiv.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">check_circle</span> Content saved.';

                // Update progress bar
                updatePlanProgress();

                // Hide status after a few seconds
                 setTimeout(() => {
                     statusDiv.classList.remove('active');
                     setTimeout(() => statusDiv.style.display = 'none', parseFloat(getCssVar('--transition-speed')) * 1000);
                 }, 3000);

            } else {
                 statusDiv.classList.add('alert', 'error', 'active');
                 statusDiv.style.display = 'flex';
                 statusDiv.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">error</span> Could not find content to save.';
            }
        }
         window.saveSection = saveSection; // Make function globally accessible

        // --- Plan Progress Calculation ---
        function updatePlanProgress() {
            const totalSavableSections = Object.keys(state.sections).length; // Market, SWOT, Strategy
            // Consider a section "completed" if it has *any* content
            const completedSections = Object.values(state.sections).filter(section => section.content && section.content.trim() !== '').length;
             const totalGoals = state.goals.length;
             const completedGoals = state.goals.filter(goal => goal.progress >= 100).length;

             // Simple progress calculation: Weight sections and goals
             const sectionWeight = 0.6; // e.g., 60% of progress comes from completing sections
             const goalWeight = 0.4; // e.g., 40% of progress comes from completing goals

             let sectionProgress = totalSavableSections > 0 ? (completedSections / totalSavableSections) : 0;
             let goalProgress = totalGoals > 0 ? (completedGoals / totalGoals) : 0;

             // Add a small bonus if summary is generated (placeholder)
             const summaryContentDiv = document.getElementById('summary-content');
             const summaryGenerated = summaryContentDiv && summaryContentDiv.textContent.trim() !== 'Click "Generate Summary" to compile content from other sections.';
             const summaryBonus = summaryGenerated ? 0.05 : 0; // 5% bonus for generating summary


             let overallProgress = (sectionProgress * sectionWeight) + (goalProgress * goalWeight) + summaryBonus;
             overallProgress = Math.min(1, Math.max(0, overallProgress)); // Clamp between 0 and 1

            const progressPercentage = Math.floor(overallProgress * 100);


            const progressBar = document.getElementById('plan-progress');
            if (progressBar) {
                 progressBar.style.width = `${progressPercentage}%`;
                 progressBar.textContent = `${progressPercentage}% Complete`;
                 if (progressPercentage === 0) {
                     progressBar.textContent = 'Start Plan';
                     progressBar.style.backgroundColor = getCssVar('--border-color');
                     progressBar.style.color = getCssVar('--text-color-light');
                     progressBar.style.justifyContent = 'flex-start';
                     progressBar.style.paddingLeft = getCssVar('--spacing-unit');
                     progressBar.style.textShadow = 'none';
                 } else if (progressPercentage > 0 && progressPercentage < 100) {
                     progressBar.style.backgroundColor = getCssVar('--warning-color');
                     progressBar.style.color = '#ffffff';
                     progressBar.style.justifyContent = 'center';
                      progressBar.style.paddingLeft = '0';
                      progressBar.style.textShadow = '1px 1px 2px rgba(0,0,0,0.1)';
                 } else if (progressPercentage >= 100) {
                     progressBar.style.backgroundColor = getCssVar('--success-color');
                     progressBar.style.color = '#ffffff';
                     progressBar.style.justifyContent = 'center';
                     progressBar.style.paddingLeft = '0';
                     progressBar.style.textShadow = '1px 1px 2px rgba(0,0,0,0.1)';
                 }
            }
             // Update dashboard metric
            const dashboardProgressMetric = document.querySelector('#metric-plan-completion');
             if(dashboardProgressMetric) {
                 dashboardProgressMetric.textContent = `${progressPercentage}%`;
             }
        }

        // --- Goal Setting Modal ---
        const goalModal = document.getElementById('goalModal');
        const goalIdInput = document.getElementById('goal-id');
        const goalTitleInput = document.getElementById('goal-title');
        const goalDescriptionInput = document.getElementById('goal-description');
        const goalProgressInput = document.getElementById('goal-progress');
        const goalModalTitle = document.getElementById('goal-modal-title');
        let elementBeforeModalOpen = null; // To store focused element before modal opens

        function openGoalModal(goal = {}) {
             elementBeforeModalOpen = document.activeElement; // Store the element that was focused

            goalIdInput.value = goal.id || '';
            goalTitleInput.value = goal.title || '';
            goalDescriptionInput.value = goal.description || '';
            goalProgressInput.value = goal.progress || 0;
            goalModalTitle.textContent = goal.id ? 'Edit Goal' : 'Add New Goal';
            goalModal.classList.add('active');

             // Trap focus inside the modal
             setTimeout(() => {
                 const focusableElements = goalModal.querySelectorAll('input, textarea, button:not(.close-button)');
                 if (focusableElements.length > 0) {
                     focusableElements[0].focus(); // Focus the first focusable element
                 } else {
                     // If no other focusable elements, focus the close button
                      const closeBtn = goalModal.querySelector('.close-button');
                      if (closeBtn) closeBtn.focus();
                 }
             }, 100); // Small delay to allow modal to become visible
        }
         window.openGoalModal = openGoalModal; // Make function globally accessible

        function closeGoalModal() {
            goalModal.classList.remove('active');
             // Restore focus to the element that was focused before the modal opened
             if (elementBeforeModalOpen) {
                 elementBeforeModalOpen.focus();
                 elementBeforeModalOpen = null; // Clear the stored element
             }
             // Optional: Clear form fields
             goalIdInput.value = '';
             goalTitleInput.value = '';
             goalDescriptionInput.value = '';
             goalProgressInput.value = 0;
        }
         window.closeGoalModal = closeGoalModal; // Make function globally accessible

        function saveGoal() {
            const title = goalTitleInput.value.trim();
             if (!title) {
                 // Basic validation
                 alert("Goal title is required.");
                 goalTitleInput.focus();
                 return;
             }

            const id = goalIdInput.value;
            const goal = {
                id: id || Date.now(), // Simple ID generation
                title: title,
                description: goalDescriptionInput.value.trim(),
                progress: parseInt(goalProgressInput.value) || 0
            };

            if (id) {
                // Update existing goal
                const index = state.goals.findIndex(g => g.id == id);
                if (index !== -1) {
                    state.goals[index] = goal;
                }
            } else {
                // Add new goal
                state.goals.push(goal);
            }

            saveState();
            renderGoals();
            updatePlanProgress();
            closeGoalModal();
        }
         window.saveGoal = saveGoal; // Make function globally accessible

         function deleteGoal(id) {
             if (confirm('Are you sure you want to delete this goal?')) {
                 state.goals = state.goals.filter(goal => goal.id != id);
                 saveState();
                 renderGoals();
                 updatePlanProgress();
                 // Announce deletion for screen readers
                 const goalsList = document.getElementById('goals-list');
                 if (goalsList) {
                    // Create a temporary element for the announcement
                    const announcement = document.createElement('div');
                    announcement.classList.add('visually-hidden');
                    announcement.setAttribute('role', 'status');
                    announcement.setAttribute('aria-live', 'assertive');
                    announcement.textContent = `Goal deleted. ${state.goals.length} goals remaining.`;
                    document.body.appendChild(announcement);
                    // Clean up the announcement element after a short delay
                     setTimeout(() => announcement.remove(), 1000);
                 }

             }
         }
         window.deleteGoal = deleteGoal; // Make function globally accessible


        function renderGoals() {
            const goalsListDiv = document.getElementById('goals-list');
            if (!goalsListDiv) return;

            goalsListDiv.innerHTML = ''; // Clear current list

            if (state.goals.length === 0) {
                goalsListDiv.innerHTML = '<p style="color: var(--text-color-light);">No goals added yet. Click "Add New Goal" to get started.</p>';
                return;
            }

            state.goals.forEach(goal => {
                const goalElement = document.createElement('div');
                goalElement.classList.add('card');
                // Use a unique ID for each goal card for potential future use
                 goalElement.setAttribute('id', `goal-${goal.id}`);
                 goalElement.setAttribute('aria-labelledby', `goal-title-${goal.id}`);

                goalElement.innerHTML = `
                    <div class="goal-header">
                        <h4 id="goal-title-${goal.id}">${goal.title}</h4>
                        <button class="button-secondary" style="padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5); font-size: 0.9em;" onclick="openGoalModal(${JSON.stringify(goal).replace(/"/g, '&quot;')})" aria-label="Edit goal: ${goal.title}"><span class="material-symbols-rounded" aria-hidden="true">edit</span> Edit</button>
                    </div>
                    <p class="goal-description">${goal.description || 'No description provided.'}</p>
                     <div class="progress-bar-container" style="margin-top: var(--spacing-unit);">
                        <div class="progress-bar" style="width: ${goal.progress}%; background-color: ${getProgressBarColor(goal.progress)};">${goal.progress}%</div>
                    </div>
                     <div class="goal-actions">
                         <button onclick="deleteGoal(${goal.id})" class="button-secondary" style="background-color: var(--error-color); padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5); font-size: 0.9em;" aria-label="Delete goal: ${goal.title}"><span class="material-symbols-rounded" aria-hidden="true">delete</span> Delete</button>
                     </div>
                `;
                goalsListDiv.appendChild(goalElement);
            });
        }

        function getProgressBarColor(progress) {
             const successColor = getCssVar('--success-color');
             const warningColor = getCssVar('--warning-color');
             const primaryColor = getCssVar('--primary-color');
             // const borderColor = getCssVar('--border-color'); // For 0% - handled by CSS rule

             if (progress >= 100) {
                 return successColor;
             } else if (progress > 50) {
                 return warningColor;
             } else if (progress > 0) {
                 return primaryColor;
             } else {
                 return getCssVar('--border-color'); // Fallback, though CSS handles 0%
             }
        }


        // Close modal if clicked outside
        window.addEventListener('click', (event) => {
            if (event.target === goalModal) {
                closeGoalModal();
            }
        });

         // Close modal if Escape key is pressed
         window.addEventListener('keydown', (event) => {
             if (event.key === 'Escape' && goalModal.classList.contains('active')) {
                 closeGoalModal();
             }
         });

         // Trap focus within modal
         goalModal.addEventListener('keydown', function(event) {
            if (event.key === 'Tab') {
                const focusableElements = goalModal.querySelectorAll('input, textarea, button');
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (event.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstElement) {
                        lastElement.focus();
                        event.preventDefault();
                    }
                } else { // Tab
                    if (document.activeElement === lastElement) {
                        firstElement.focus();
                        event.preventDefault();
                    }
                }
            }
         });


        // --- Chart.js Integration ---
        const salesChartCanvas = document.getElementById('salesChart');
        const salesChartControls = document.getElementById('sales-chart-controls');
        let salesChartInstance = null; // Store chart instance

         const menuChartCanvas = document.getElementById('menuChart');
        const menuChartControls = document.getElementById('menu-chart-controls');
        let menuChartInstance = null; // Store chart instance


        // Function to get CSS variable value
        function getCssVar(name) {
            // Use getComputedStyle for reliable access to calculated values
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }

        function renderSalesChart() {
            if (!salesChartCanvas) return;

            if (salesChartInstance) {
                salesChartInstance.destroy(); // Destroy previous instance
            }

             // Get current control values or use defaults
             const lineColor = document.getElementById('salesLineColor')?.value || getCssVar('--primary-color');
             const fillColor = document.getElementById('salesFillColor')?.value || getCssVar('--background-color');
             const chartType = document.getElementById('salesChartType')?.value || 'line';
             const dataFilter = document.getElementById('salesDataFilter')?.value || 'all'; // Placeholder for filtering data

             // Apply filter logic here if needed (using state.data.sales)
             let filteredSalesData = { ...state.data.sales }; // Create a copy
             // Example filter logic (basic):
             if (dataFilter === '6m') {
                 filteredSalesData = {
                     labels: state.data.sales.labels.slice(-6),
                     data: state.data.sales.data.slice(-6)
                 };
             } else if (dataFilter === '12m') {
                  filteredSalesData = {
                     labels: state.data.sales.labels.slice(-12),
                     data: state.data.sales.data.slice(-12)
                 };
             }


            const salesChartConfig = {
                type: chartType,
                data: {
                    labels: filteredSalesData.labels,
                    datasets: [{
                        label: 'Monthly Sales ($)',
                        data: filteredSalesData.data,
                        backgroundColor: chartType === 'bar' ? lineColor : fillColor, // Use fill color for line area, line color for bars
                        borderColor: lineColor,
                        borderWidth: chartType === 'line' ? 2 : 1,
                        fill: chartType === 'line', // Fill only for line chart
                        tension: chartType === 'line' ? 0.3 : 0 // Smooth line only for line chart
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: getCssVar('--text-color-light'),
                                font: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), size: 14 } // Use Inter font
                            }
                        },
                        tooltip: {
                            backgroundColor: getCssVar('--secondary-color'),
                            titleColor: getCssVar('--surface-color'),
                            bodyColor: getCssVar('--surface-color'),
                            bodyFont: { family: getCssVar('font-family').split(',')[0].replace(/"/g, '') },
                            titleFont: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), weight: 'bold' },
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true, // Start Y axis at 0
                            ticks: {
                                color: getCssVar('--text-color-light'),
                                font: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), size: 12 },
                                callback: function(value) {
                                     // Format as currency
                                     return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', notation: 'compact', compactDisplay: 'short' }).format(value);
                                }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: {
                            ticks: {
                                color: getCssVar('--text-color-light'),
                                font: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), size: 12 }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        }
                    },
                     onClick: (e, elements) => {
                        // Toggle controls only if clicking the chart area itself, not a control
                        if (salesChartControls && !e.native.target.closest('.floating-controls')) {
                             salesChartControls.classList.toggle('active');
                        }
                     }
                }
            };

            // Create the chart instance
            salesChartInstance = new Chart(salesChartCanvas, salesChartConfig);

             // Ensure controls are updated to reflect the chart's current state
             if (salesChartControls) {
                 const lineColorInput = salesChartControls.querySelector('#salesLineColor');
                 const fillColorInput = salesChartControls.querySelector('#salesFillColor');
                 const chartTypeSelect = salesChartControls.querySelector('#salesChartType');
                 const dataFilterSelect = salesChartControls.querySelector('#salesDataFilter');


                 if(lineColorInput) lineColorInput.value = salesChartInstance.data.datasets[0].borderColor;
                 // Note: backgroundColor for line chart is fill color, for bar chart is bar color
                 if(fillColorInput) fillColorInput.value = salesChartInstance.data.datasets[0].backgroundColor;
                 if(chartTypeSelect) chartTypeSelect.value = salesChartInstance.config.type;
                 if(dataFilterSelect) dataFilterSelect.value = dataFilter; // Set filter state
             }
        }

        function renderMenuChart() {
             if (!menuChartCanvas) return;

            if (menuChartInstance) {
                menuChartInstance.destroy(); // Destroy previous instance
            }

             // Get current control values or use defaults
             const barColor = document.getElementById('menuBarColor')?.value || getCssVar('--secondary-color');
             const chartType = document.getElementById('menuChartType')?.value || 'bar';
             const dataFilter = document.getElementById('menuDataFilter')?.value || 'category'; // Placeholder for filtering data

             // Apply filter logic here if needed (using state.data.menu)
             let filteredMenuData = { ...state.data.menu }; // Create a copy
             // Example filter logic (basic):
             // if (dataFilter === 'item') { filteredMenuData = { labels: state.data.menu.labels, data: state.data.menu.data }; }
             // else if (dataFilter === 'category') { ... logic to aggregate by category ... }


            const menuChartConfig = {
                type: chartType,
                data: {
                    labels: filteredMenuData.labels,
                    datasets: [{
                        label: 'Sales ($)',
                        data: filteredMenuData.data,
                        backgroundColor: chartType === 'bar' ? barColor : [ // Use different colors for pie chart
                            getCssVar('--primary-color'), getCssVar('--secondary-color'), getCssVar('--success-color'), getCssVar('--warning-color'), '#9b59b6' // Use theme colors
                        ],
                        borderColor: getCssVar('--surface-color'), // White border for pie slices
                        borderWidth: chartType === 'pie' ? 2 : 1,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: chartType === 'pie' ? 'right' : 'top', // Legend position changes for pie
                            labels: {
                                color: getCssVar('--text-color-light'),
                                font: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), size: 14 }
                            }
                        },
                        tooltip: {
                            backgroundColor: getCssVar('--secondary-color'),
                            titleColor: getCssVar('--surface-color'),
                            bodyColor: getCssVar('--surface-color'),
                            bodyFont: { family: getCssVar('font-family').split(',')[0].replace(/"/g, '') },
                            titleFont: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), weight: 'bold' },
                             callbacks: {
                                label: function(context) {
                                    let label = context.label || ''; // Label for pie chart
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        const value = chartType === 'pie' ? context.parsed : context.parsed.y;
                                        label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
                                    }
                                     if (chartType === 'pie' && context.dataset.data.reduce((sum, val) => sum + val, 0) > 0) {
                                         const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                         const percentage = ((context.parsed / total) * 100).toFixed(1) + '%';
                                         label += ` (${percentage})`;
                                     }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            display: chartType !== 'pie', // Hide Y axis for pie chart
                            beginAtZero: true,
                            ticks: {
                                color: getCssVar('--text-color-light'),
                                font: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), size: 12 },
                                callback: function(value) {
                                     return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', notation: 'compact', compactDisplay: 'short' }).format(value);
                                }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: {
                            display: chartType !== 'pie', // Hide X axis for pie chart
                            ticks: {
                                color: getCssVar('--text-color-light'),
                                font: { family: getCssVar('font-family').split(',')[0].replace(/"/g, ''), size: 12 }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        }
                    },
                     onClick: (e, elements) => {
                        // Toggle controls only if clicking the chart area itself, not a control
                        if (menuChartControls && !e.native.target.closest('.floating-controls')) {
                             menuChartControls.classList.toggle('active');
                        }
                     }
                }
            };

            // Create the chart instance
            menuChartInstance = new Chart(menuChartCanvas, menuChartConfig);

             // Ensure controls are updated to reflect the chart's current state
             if (menuChartControls) {
                 const barColorInput = menuChartControls.querySelector('#menuBarColor');
                 const chartTypeSelect = menuChartControls.querySelector('#menuChartType');
                 const dataFilterSelect = menuChartControls.querySelector('#menuDataFilter');


                 if(barColorInput && chartType === 'bar') barColorInput.value = menuChartInstance.data.datasets[0].backgroundColor;
                  // Hide color picker for pie chart as it uses multiple colors
                 if(barColorInput) barColorInput.parentElement.style.display = chartType === 'bar' ? 'block' : 'none';

                 if(chartTypeSelect) chartTypeSelect.value = menuChartInstance.config.type;
                 if(dataFilterSelect) dataFilterSelect.value = dataFilter; // Set filter state
             }
        }

        function renderFeedbackSummary() {
             const feedbackContentDiv = document.getElementById('feedback-summary-content');
             if (feedbackContentDiv) {
                 feedbackContentDiv.textContent = state.data.feedback.summary;
             }
        }


        // Close chart controls when clicking outside
        document.addEventListener('click', (e) => {
            const salesChartContainer = document.getElementById('sales-chart-container');
            const menuChartContainer = document.getElementById('menu-chart-container');

            if (salesChartControls && salesChartContainer &&
                !e.target.closest('.floating-controls') &&
                !e.target.closest('.chart-container')) {
                salesChartControls.classList.remove('active');
            }
             if (menuChartControls && menuChartContainer &&
                !e.target.closest('.floating-controls') &&
                !e.target.closest('.chart-container')) {
                menuChartControls.classList.remove('active');
            }
        });

        // Dynamic chart updates from controls
        if (salesChartControls) {
            salesChartControls.querySelectorAll('input, select').forEach(element => {
                element.addEventListener('change', renderSalesChart); // Re-render on change
            });
        }
         if (menuChartControls) {
            menuChartControls.querySelectorAll('input, select').forEach(element => {
                element.addEventListener('change', renderMenuChart); // Re-render on change
            });
        }

        // --- Plan Summary Generation ---
        function generateSummary() {
            const summaryContentDiv = document.getElementById('summary-content');
            if (!summaryContentDiv) return;

            let summaryText = "Restaurant Revitalization Plan Summary\n\n";
            summaryText += "=======================================\n\n";

            summaryText += "--- Data Analysis Insights ---\n\n";
            // Placeholder summaries based on simulated data
            summaryText += "Sales Trend: " + (state.data.sales.data[state.data.sales.data.length - 1] < state.data.sales.data[0] ? "Overall declining trend observed over the past year." : "Sales trend is stable or improving.") + "\n";
            summaryText += "Menu Performance: " + (state.data.menu.labels.length > 0 ? `Top performer: ${state.data.menu.labels[state.data.menu.data.indexOf(Math.max(...state.data.menu.data))]}. Areas for review: ${state.data.menu.labels[state.data.menu.data.indexOf(Math.min(...state.data.menu.data))]}.` : "No menu data analyzed yet.") + "\n";
            summaryText += "Customer Feedback:\n" + (state.data.feedback.summary || "No feedback data analyzed yet.") + "\n\n";

            summaryText += "--- Market Analysis ---\n\n";
            summaryText += (state.sections['market-analysis']?.content || "Not analyzed yet.") + "\n\n";

            summaryText += "--- SWOT Analysis ---\n\n";
             summaryText += (state.sections['swot-analysis']?.content || "Not analyzed yet.") + "\n\n";

            summaryText += "--- Strategy Development ---\n\n";
             summaryText += (state.sections['strategy']?.content || "Not defined yet.") + "\n\n";

            summaryText += "--- Goals & Tracking ---\n\n";
            if (state.goals.length > 0) {
                state.goals.forEach(goal => {
                    summaryText += `- Goal: ${goal.title} (${goal.progress}% complete)\n`;
                    if (goal.description) {
                        summaryText += `  Description: ${goal.description}\n`;
                    }
                });
            } else {
                summaryText += "No goals set yet.\n";
            }
            summaryText += "\n";

            summaryContentDiv.textContent = summaryText;
             updatePlanProgress(); // Update progress after generating summary
             saveState(); // Save the generated summary content
        }
        window.generateSummary = generateSummary; // Make function globally accessible

    </script>
</body>
</html>
