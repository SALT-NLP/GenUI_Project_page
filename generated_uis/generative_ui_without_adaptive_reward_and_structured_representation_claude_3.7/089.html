<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Marketing Strategy Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <style>
        :root {
            --primary-color: #007bff;
            --primary-color-dark: #0056b3;
            --secondary-color: #6c757d;
            --secondary-color-dark: #5a6268;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-color: #212529;
            --text-light-color: #6c757d;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --success-color-dark: #218838;
            --danger-color: #dc3545;
            --danger-color-dark: #c82333;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --spacing-unit: 8px;
            --border-radius: 8px;
            --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            --box-shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.2s;
            --focus-shadow-color: rgba(0, 123, 255, 0.25); /* Primary color with transparency */
            --danger-focus-shadow-color: rgba(220, 53, 69, 0.25); /* Danger color with transparency */
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px; /* Base font size */
            overflow-y: auto; /* Enable scrolling on body if content overflows */
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }

        a:hover {
            color: var(--primary-color-dark);
            text-decoration: underline;
        }

        .layout-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--surface-color);
            box-shadow: var(--box-shadow);
            padding: calc(var(--spacing-unit) * 2);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            transition: width var(--transition-speed) ease-in-out;
            flex-shrink: 0; /* Prevent shrinking */
            position: sticky; /* Keep sidebar visible */
            top: 0;
            height: 100vh; /* Make sidebar full height */
            overflow-y: auto; /* Add scrolling if nav items overflow */
            box-sizing: border-box;
        }

        .sidebar.collapsed {
            width: 70px;
            align-items: center;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding-bottom: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
            border-bottom: 1px solid var(--border-color);
            width: 100%; /* Ensure header takes full width */
             box-sizing: border-box; /* Include padding in width */
             flex-shrink: 0; /* Prevent shrinking */
        }

        .sidebar.collapsed .sidebar-header {
             justify-content: center;
             padding-bottom: calc(var(--spacing-unit) * 2);
             margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .sidebar-header .logo {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .sidebar-header .app-title {
            margin-left: var(--spacing-unit);
            font-size: 1.2em;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar.collapsed .app-title {
            display: none;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
            width: 100%; /* Ensure nav takes full width */
        }

        .nav-item {
            margin-bottom: var(--spacing-unit);
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            color: var(--text-color);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            width: 100%; /* Ensure link takes full width */
            box-sizing: border-box;
        }

        .nav-link:hover,
        .nav-link:focus {
            background-color: rgba(0, 0, 0, 0.05);
            outline: none; /* Remove default outline */
        }

        .nav-link:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
        }


        .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        .nav-link.active .material-symbols-rounded {
            fill: 1; /* For filled icon */
        }

        .nav-link .material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 24px;
            flex-shrink: 0;
        }

        .sidebar.collapsed .nav-link .material-symbols-rounded {
             margin-right: 0;
        }

        .sidebar.collapsed .nav-link {
             justify-content: center;
             padding: var(--spacing-unit);
        }

        .sidebar.collapsed .nav-link .nav-text {
            display: none;
        }

        .nav-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-footer {
            padding-top: calc(var(--spacing-unit) * 3);
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            text-align: center;
            width: 100%; /* Ensure footer takes full width */
             box-sizing: border-box; /* Include padding in width */
             flex-shrink: 0; /* Prevent shrinking */
        }

        .sidebar-footer button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            transition: background-color var(--transition-speed) ease;
        }

         .sidebar-footer button:hover,
         .sidebar-footer button:focus {
            background-color: rgba(0, 0, 0, 0.05);
            outline: none;
         }

         .sidebar-footer button:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
         }


        .sidebar-footer button .material-symbols-rounded {
            margin-right: var(--spacing-unit);
        }

         .sidebar.collapsed .sidebar-footer button .material-symbols-rounded {
            margin-right: 0;
         }

         .sidebar.collapsed .sidebar-footer button .nav-text {
            display: none;
         }


        .main-content {
            flex-grow: 1;
            padding: calc(var(--spacing-unit) * 3);
            overflow-y: auto; /* Enable scrolling for main content */
            width: calc(100% - 250px); /* Adjust width based on sidebar */
             box-sizing: border-box;
        }

        .sidebar.collapsed + .main-content {
             width: calc(100% - 70px);
        }


        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-header {
            margin-bottom: calc(var(--spacing-unit) * 3);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: var(--spacing-unit); /* Gap between title and buttons */
        }

        .section-header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 700;
        }

        /* Card Styles */
        .card {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 3);
            border: 1px solid var(--border-color);
        }

        .card-header {
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--border-color);
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.4em;
            font-weight: 600;
        }

        .card-body {
            /* Content area */
        }

        /* Form Styles */
        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-unit);
            font-weight: 500;
            color: var(--text-light-color);
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="email"],
        .form-group input[type="url"],
        .form-group select,
        .form-group textarea {
            display: block;
            width: 100%;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            font-size: 1em;
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--surface-color);
            background-clip: padding-box;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            transition: border-color var(--transition-speed) ease-in-out, box-shadow var(--transition-speed) ease-in-out;
        }

         .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group input[type="email"]:focus,
        .form-group input[type="url"]:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: 0;
            box-shadow: 0 0 0 0.25rem var(--focus-shadow-color);
        }

         .form-group input.is-invalid,
         .form-group textarea.is-invalid,
         .form-group select.is-invalid {
             border-color: var(--danger-color);
         }

         .form-group input.is-invalid:focus,
         .form-group textarea.is-invalid:focus,
         .form-group select.is-invalid:focus {
             border-color: var(--danger-color);
             box-shadow: 0 0 0 0.25rem var(--danger-focus-shadow-color);
         }


         .form-group .invalid-feedback {
             display: none; /* Hidden by default */
             width: 100%;
             margin-top: calc(var(--spacing-unit) * 0.5);
             font-size: 0.8em;
             color: var(--danger-color);
         }

         .form-group input.is-invalid + .invalid-feedback,
         .form-group textarea.is-invalid + .invalid-feedback,
         .form-group select.is-invalid + .invalid-feedback {
             display: block; /* Show when invalid */
         }


        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group .radio-group,
        .form-group .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-unit) calc(var(--spacing-unit) * 2);
        }

        .form-group .radio-item,
        .form-group .checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .form-group input[type="radio"],
        .form-group input[type="checkbox"] {
            margin-right: var(--spacing-unit);
            flex-shrink: 0;
            cursor: pointer;
        }

         .form-group .radio-item label,
         .form-group .checkbox-item label {
             margin-bottom: 0;
             cursor: pointer;
             color: var(--text-color); /* Ensure label is standard text color */
         }


        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            font-size: 1em;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, color var(--transition-speed) ease, opacity var(--transition-speed) ease;
        }

        .btn:focus {
             outline: none;
        }

        .btn:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
        }


        .btn-primary {
            color: white;
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-color-dark);
            border-color: var(--primary-color-dark);
        }

        .btn-secondary {
            color: white; /* Changed for better contrast on secondary */
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-color-dark);
            border-color: var(--secondary-color-dark);
            color: white;
        }

        .btn-outline-secondary {
             color: var(--secondary-color);
             border-color: var(--secondary-color);
             background-color: transparent;
        }

        .btn-outline-secondary:hover {
             background-color: var(--secondary-color);
             color: white;
        }


        .btn-success {
            color: white;
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

         .btn-success:hover {
            background-color: var(--success-color-dark);
            border-color: var(--success-color-dark);
         }

        .btn-danger {
            color: white;
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

         .btn-danger:hover {
            background-color: var(--danger-color-dark);
            border-color: var(--danger-color-dark);
         }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-sm {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            font-size: 0.9em;
        }


        .btn .material-symbols-rounded {
            margin-right: var(--spacing-unit);
            font-size: 1.2em;
        }

         .btn:not(:has(.material-symbols-rounded)) .material-symbols-rounded {
            margin-right: 0;
         }

        .button-group {
            display: flex;
            gap: var(--spacing-unit);
            margin-top: calc(var(--spacing-unit) * 2);
            flex-wrap: wrap; /* Allow buttons to wrap */
        }

        .button-group.flex-end { justify-content: flex-end; }
        .button-group.flex-start { justify-content: flex-start; }
        .button-group.flex-center { justify-content: center; }


        /* Strategy Builder Specific Styles */
        .strategy-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: calc(var(--spacing-unit) * 4);
            position: relative;
            padding-top: 15px; /* Space for the line */
        }

        .strategy-steps::before {
            content: '';
            position: absolute;
            top: 29px; /* Align with indicator center */
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: 0;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer; /* Indicate interactive */
        }

         .step:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
             border-radius: var(--border-radius); /* Add focus style */
         }

        .step-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--border-color);
            color: var(--text-light-color);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: var(--spacing-unit);
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            border: 2px solid var(--background-color); /* Creates the gap in the line */
        }

        .step.active .step-indicator {
            background-color: var(--primary-color);
            color: white;
        }

        .step-label {
            font-size: 0.9em;
            color: var(--text-light-color);
            max-width: 100px; /* Prevent labels from overlapping too much */
            word-break: break-word;
        }

        .step.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .strategy-step-content {
            /* Content for each step */
        }

        /* Asset Management Styles */
        .asset-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 4);
            text-align: center;
            cursor: pointer;
            transition: border-color var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }

        .asset-upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.05); /* Subtle background on hover */
        }
         .asset-upload-area:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
             background-color: rgba(0, 123, 255, 0.05);
         }


        .asset-upload-area input[type="file"] {
            display: none;
        }

        .asset-upload-area .upload-icon .material-symbols-rounded {
            font-size: 48px;
            color: var(--text-light-color);
            margin-bottom: var(--spacing-unit);
        }

        .asset-upload-area p {
            margin: 0;
            color: var(--text-light-color);
            margin-bottom: var(--spacing-unit);
        }

        .asset-upload-area .btn {
            margin-top: var(--spacing-unit); /* Space between text and button */
        }

        .asset-previews {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); /* Smaller previews */
            gap: calc(var(--spacing-unit) * 2);
            margin-top: calc(var(--spacing-unit) * 3);
        }

        .asset-preview-item {
            position: relative;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e9ecef;
            box-shadow: var(--box-shadow);
        }

        .asset-preview-item img,
        .asset-preview-item video {
            display: block;
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }

        .asset-preview-item .delete-btn {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--danger-color);
            font-size: 16px;
            padding: 0;
            box-shadow: var(--box-shadow);
            transition: background-color var(--transition-speed) ease;
            z-index: 10; /* Ensure delete button is clickable */
        }

        .asset-preview-item .delete-btn:hover {
            background-color: rgba(255, 255, 255, 1);
        }
         .asset-preview-item .delete-btn:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
         }


        #upload-progress {
             margin-top: calc(var(--spacing-unit)*2);
             text-align: left;
        }

        #upload-progress label {
             display: block;
             margin-bottom: var(--spacing-unit);
             font-weight: 500;
        }

        #upload-progress progress {
             width: 100%;
             height: 20px;
             appearance: none;
             border: none;
             border-radius: var(--border-radius);
             overflow: hidden; /* Needed for border-radius to work */
        }

        #upload-progress progress::-webkit-progress-bar {
            background-color: var(--border-color);
            border-radius: var(--border-radius);
        }

        #upload-progress progress::-webkit-progress-value {
            background-color: var(--success-color);
            border-radius: var(--border-radius);
            transition: width 0.5s ease;
        }

        #upload-progress progress::-moz-progress-bar {
            background-color: var(--success-color);
            border-radius: var(--border-radius);
            transition: width 0.5s ease;
        }


        .asset-gallery {
            margin-top: calc(var(--spacing-unit) * 3);
        }

        .asset-gallery .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: calc(var(--spacing-unit) * 2);
        }

        .gallery-item {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            background-color: var(--surface-color);
            box-shadow: var(--box-shadow);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }

        .gallery-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-hover);
        }

        .gallery-item:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
        }

        .gallery-item .item-thumbnail {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .gallery-item .item-info {
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            font-size: 0.9em;
            flex-grow: 1;
        }

        .gallery-item .item-info h3 {
            margin: 0 0 var(--spacing-unit) 0;
            font-size: 1em;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .gallery-item .item-info p {
            margin: 0;
            color: var(--text-light-color);
            font-size: 0.8em;
        }

        /* Content Creation Styles */
        .content-editor-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: calc(var(--spacing-unit) * 3);
        }

        .editor-panel, .preview-panel {
            /* Panel styling */
        }

        .preview-panel {
            background-color: #e9ecef;
            border-radius: var(--border-radius);
            padding: calc(var(--spacing-unit) * 2);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align items to the top */
            min-height: 400px; /* Ensure minimum height */
        }

        .preview-panel h3 {
             margin-top: 0;
             margin-bottom: calc(var(--spacing-unit) * 2);
             font-size: 1.2em;
             font-weight: 600;
             color: var(--text-color);
        }

        .preview-panel .preview-content {
            max-width: 100%;
            max-height: 250px; /* Limit preview height */
            object-fit: contain;
            margin-bottom: var(--spacing-unit);
            border-radius: var(--border-radius); /* Match card radius */
            border: 1px solid var(--border-color); /* Subtle border */
        }

        .preview-panel .preview-text {
            font-size: 0.9em;
            color: var(--text-color);
            text-align: left;
            width: 100%;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            min-height: 80px; /* Ensure text area has minimum height */
            overflow-y: auto; /* Add scroll if text overflows */
        }

        /* Campaign Management Styles */
        .campaign-list table {
            width: 100%;
            border-collapse: collapse;
            margin-top: calc(var(--spacing-unit) * 2);
        }

        .campaign-list th,
        .campaign-list td {
            padding: calc(var(--spacing-unit) * 1.5);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .campaign-list th {
            background-color: #f1f3f5;
            font-weight: 600;
            color: var(--text-color);
        }

        .campaign-list tbody tr {
            transition: background-color var(--transition-speed) ease;
            cursor: pointer;
        }

        .campaign-list tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }
         .campaign-list tbody tr:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
         }


        .campaign-list td .status-badge {
            display: inline-block;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius);
            font-size: 0.8em;
            font-weight: 600;
            color: white; /* Default text color for badges */
        }

        .campaign-list td .status-badge.active {
            background-color: var(--success-color);
        }

        .campaign-list td .status-badge.paused {
            background-color: var(--warning-color);
            color: var(--text-color); /* Warning needs dark text */
        }

        .campaign-list td .status-badge.ended {
            background-color: var(--secondary-color);
        }

        .campaign-list td .button-group {
             margin-top: 0;
             gap: var(--spacing-unit);
        }


        /* Analytics Dashboard Styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Adjusted min width */
            gap: calc(var(--spacing-unit) * 3);
        }

        .kpi-card {
            text-align: center;
        }

        .kpi-card .kpi-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-unit);
        }

        .kpi-card .kpi-label {
            font-size: 1em;
            color: var(--text-light-color);
        }

        .chart-container {
            position: relative;
            height: 300px; /* Fixed height for charts */
            margin-top: calc(var(--spacing-unit) * 2);
            cursor: pointer; /* Indicate interactivity */
        }

        .floating-controls {
            position: absolute;
            top: var(--spacing-unit);
            right: var(--spacing-unit);
            background: rgba(255, 255, 255, 0.95);
            padding: var(--spacing-unit) * 1.5;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-hover); /* Use hover shadow for controls */
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10; /* Ensure controls are above chart */
            border: 1px solid var(--border-color);
            min-width: 180px; /* Ensure controls have minimum width */
        }

        .floating-controls.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .control-group {
            margin-bottom: calc(var(--spacing-unit) * 1.5);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-unit);
        }

        .control-group:last-child {
             margin-bottom: 0;
        }

        .control-group label {
            font-size: 0.9em;
            font-weight: 500;
            color: var(--text-light-color);
            margin-bottom: 0; /* Label already has gap from flex column */
        }

        .control-group input[type="color"],
        .control-group input[type="number"],
        .control-group select {
            padding: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9em;
            width: 100%;
            box-sizing: border-box;
        }

         .control-group input[type="color"] {
             padding: var(--spacing-unit) * 0.5; /* Smaller padding for color picker */
             height: 38px; /* Match height of select/number */
         }


        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--surface-color);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 600px;
            width: 90%;
            position: relative;
            transform: translateY(-20px);
            transition: transform var(--transition-speed) ease;
            max-height: 90vh; /* Limit modal height */
            overflow-y: auto; /* Add scrolling to modal content */
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-light-color);
            padding: 0;
            line-height: 1;
            transition: color var(--transition-speed) ease;
        }

        .modal-close-btn:hover {
            color: var(--text-color);
        }

         .modal-close-btn:focus-visible {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
             border-radius: var(--border-radius);
         }


        .modal-body {
            /* Content area */
        }

        .modal-body img,
        .modal-body video {
             display: block;
             max-width: 100%;
             height: auto;
             margin: 0 auto calc(var(--spacing-unit) * 2) auto; /* Center and add space below */
             border-radius: var(--border-radius);
             border: 1px solid var(--border-color);
        }

        .modal-body p {
             margin-bottom: var(--spacing-unit);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-unit);
            margin-top: calc(var(--spacing-unit) * 3);
            padding-top: calc(var(--spacing-unit) * 2);
            border-top: 1px solid var(--border-color);
             flex-wrap: wrap;
        }


        /* Utility Classes */
        .text-center { text-align: center; }
        .mb-3 { margin-bottom: calc(var(--spacing-unit) * 3); }
        .mt-3 { margin-top: calc(var(--spacing-unit) * 3); }
        .mr-2 { margin-right: calc(var(--spacing-unit) * 2); }
        .flex-end { justify-content: flex-end; }
        .flex-start { justify-content: flex-start; }
        .flex-center { justify-content: center; }
        .align-center { align-items: center; }
        .hidden { display: none !important; }
        .text-primary { color: var(--primary-color); }
        .text-light-color { color: var(--text-light-color); }


        /* Responsive Adjustments */
        @media (max-width: 1024px) {
             .sidebar {
                 width: 200px; /* Slightly smaller sidebar on tablet */
             }
             .sidebar.collapsed + .main-content {
                 width: calc(100% - 70px);
             }
             .main-content {
                 width: calc(100% - 200px);
             }

             .analytics-grid {
                 grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Adjust for smaller screens */
             }
        }


        @media (max-width: 768px) {
            .layout-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                padding: var(--spacing-unit) * 2;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                box-shadow: var(--box-shadow);
                position: sticky; /* Keep sidebar visible at top */
                top: 0;
                z-index: 20; /* Ensure it's above main content */
                overflow-y: visible; /* Allow content to flow */
            }

            .sidebar.collapsed {
                 width: 100%;
                 flex-direction: row;
                 align-items: center;
            }

             .sidebar-header {
                padding-bottom: 0;
                margin-bottom: 0;
                border-bottom: none;
                width: auto; /* Allow header to size based on content */
             }

             .sidebar-header .app-title {
                display: block; /* Show title on mobile */
             }

            .sidebar-nav {
                display: flex;
                flex-direction: row;
                overflow-x: auto; /* Enable horizontal scrolling for nav items */
                 -webkit-overflow-scrolling: touch;
                padding: var(--spacing-unit) 0;
                width: auto; /* Allow nav to size based on content */
                flex-grow: 0; /* Prevent nav from growing */
            }

            .nav-item {
                margin-bottom: 0;
                margin-right: var(--spacing-unit) * 2;
                flex-shrink: 0; /* Prevent items from shrinking */
            }

            .nav-item:last-child {
                 margin-right: 0;
            }

            .nav-link {
                flex-direction: column;
                align-items: center;
                padding: var(--spacing-unit);
                width: auto; /* Allow link to size based on content */
            }

            .nav-link .material-symbols-rounded {
                margin-right: 0;
                margin-bottom: var(--spacing-unit) * 0.5;
            }

            .nav-text {
                font-size: 0.8em;
            }

            .sidebar-footer {
                display: none; /* Hide footer on mobile */
            }

            .main-content {
                padding: calc(var(--spacing-unit) * 2);
                width: 100%; /* Main content takes full width */
            }

             .sidebar.collapsed + .main-content {
                 width: 100%;
            }


            .section-header {
                 flex-direction: column;
                 align-items: flex-start;
            }

            .section-header .button-group {
                 margin-top: var(--spacing-unit);
                 width: 100%;
                 justify-content: flex-start;
            }

            .strategy-steps {
                 flex-wrap: wrap;
                 gap: calc(var(--spacing-unit) * 2) 0;
                 padding-top: 0;
                 margin-bottom: calc(var(--spacing-unit) * 3);
            }

            .strategy-steps::before {
                 display: none; /* Hide line on mobile */
            }

            .step {
                 flex-basis: 50%; /* Two steps per row */
                 margin-bottom: var(--spacing-unit) * 2;
            }

             .step:nth-child(odd) { text-align: right; align-items: flex-end; padding-right: var(--spacing-unit);}
             .step:nth-child(even) { text-align: left; align-items: flex-start; padding-left: var(--spacing-unit);}

             .step-indicator { margin-bottom: var(--spacing-unit) * 0.5; border: none; }
             .step-label { max-width: none; }


            .content-editor-area {
                grid-template-columns: 1fr;
                gap: calc(var(--spacing-unit) * 2);
            }

            .analytics-grid {
                 grid-template-columns: 1fr;
            }

            .floating-controls {
                position: static; /* Position static on small screens */
                transform: translateY(0);
                opacity: 1;
                pointer-events: all;
                margin-top: calc(var(--spacing-unit) * 2);
                box-shadow: var(--box-shadow); /* Less prominent shadow */
            }

            .chart-container {
                min-height: 250px; /* Adjust chart height */
                height: auto;
            }
        }
    </style>
</head>
<body>

    <div class="layout-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar" aria-label="Main navigation">
            <div class="sidebar-header">
                <div class="logo">K</div>
                <div class="app-title">KitchenTool Marketing</div>
            </div>
            <ul class="sidebar-nav" role="menu">
                <li class="nav-item" role="none">
                    <a href="#strategy" class="nav-link active" data-section="strategy" role="menuitem" aria-current="page">
                        <span class="material-symbols-rounded" aria-hidden="true">lightbulb</span>
                        <span class="nav-text">Strategy Builder</span>
                    </a>
                </li>
                <li class="nav-item" role="none">
                    <a href="#assets" class="nav-link" data-section="assets" role="menuitem" tabindex="-1">
                        <span class="material-symbols-rounded" aria-hidden="true">folder_open</span>
                        <span class="nav-text">Assets</span>
                    </a>
                </li>
                <li class="nav-item" role="none">
                    <a href="#campaigns" class="nav-link" data-section="campaigns" role="menuitem" tabindex="-1">
                        <span class="material-symbols-rounded" aria-hidden="true">campaign</span>
                        <span class="nav-text">Campaigns</span>
                    </a>
                </li>
                <li class="nav-item" role="none">
                    <a href="#analytics" class="nav-link" data-section="analytics" role="menuitem" tabindex="-1">
                        <span class="material-symbols-rounded" aria-hidden="true">analytics</span>
                        <span class="nav-text">Analytics</span>
                    </a>
                </li>
                 <li class="nav-item" role="none">
                    <a href="#content" class="nav-link" data-section="content" role="menuitem" tabindex="-1">
                        <span class="material-symbols-rounded" aria-hidden="true">edit_note</span>
                        <span class="nav-text">Content Creator</span>
                    </a>
                </li>
                <li class="nav-item" role="none">
                    <a href="#audience" class="nav-link" data-section="audience" role="menuitem" tabindex="-1">
                        <span class="material-symbols-rounded" aria-hidden="true">group</span>
                        <span class="nav-text">Audience</span>
                    </a>
                </li>
                 <li class="nav-item" role="none">
                    <a href="#help" class="nav-link" data-section="help" role="menuitem" tabindex="-1">
                        <span class="material-symbols-rounded" aria-hidden="true">help</span>
                        <span class="nav-text">Help & Learning</span>
                    </a>
                </li>
            </ul>
            <div class="sidebar-footer">
                <button id="toggle-sidebar-btn" aria-label="Collapse sidebar">
                     <span class="material-symbols-rounded" aria-hidden="true">chevron_left</span>
                     <span class="nav-text">Collapse</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="main-content" tabindex="-1">

            <!-- Strategy Builder Section -->
            <section id="strategy" class="section active" role="region" aria-labelledby="strategy-heading">
                <div class="section-header">
                    <h1 id="strategy-heading">Strategy Builder</h1>
                </div>
                <div class="strategy-steps" role="tablist">
                    <div class="step active" data-step="1" role="tab" aria-controls="strategy-step-content-1" aria-selected="true" tabindex="0">
                        <div class="step-indicator">1</div>
                        <div class="step-label">Define Goals</div>
                    </div>
                    <div class="step" data-step="2" role="tab" aria-controls="strategy-step-content-2" aria-selected="false" tabindex="-1">
                        <div class="step-indicator">2</div>
                        <div class="step-label">Target Audience</div>
                    </div>
                    <div class="step" data-step="3" role="tab" aria-controls="strategy-step-content-3" aria-selected="false" tabindex="-1">
                        <div class="step-indicator">3</div>
                        <div class="step-label">Channels & Tactics</div>
                    </div>
                    <div class="step" data-step="4" role="tab" aria-controls="strategy-step-content-4" aria-selected="false" tabindex="-1">
                        <div class="step-indicator">4</div>
                        <div class="step-label">Content Plan</div>
                    </div>
                     <div class="step" data-step="5" role="tab" aria-controls="strategy-step-content-5" aria-selected="false" tabindex="-1">
                        <div class="step-indicator">5</div>
                        <div class="step-label">Review & Save</div>
                    </div>
                </div>

                <div class="card strategy-step-content" data-step-content="1" id="strategy-step-content-1" role="tabpanel" aria-labelledby="strategy-heading">
                    <div class="card-header"><h2>Step 1: Define Your Marketing Goals</h2></div>
                    <div class="card-body">
                        <p>What do you want to achieve with your digital marketing?</p>
                        <div class="form-group">
                            <label>Select your primary goal(s):</label>
                            <div class="checkbox-group" role="group" aria-label="Marketing Goals">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="goal-awareness" name="goals" value="Increase Brand Awareness">
                                    <label for="goal-awareness">Increase Brand Awareness</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="goal-sales" name="goals" value="Drive Direct Sales (E-commerce)">
                                    <label for="goal-sales">Drive Direct Sales (E-commerce)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="goal-leads" name="goals" value="Generate Leads (e.g., for retail partners)">
                                    <label for="goal-leads">Generate Leads (e.g., for retail partners)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="goal-engagement" name="goals" value="Build Community/Engagement">
                                    <label for="goal-engagement">Build Community/Engagement</label>
                                </div>
                            </div>
                        </div>
                         <div class="form-group">
                            <label for="goal-metric">How will you measure success?</label>
                            <input type="text" id="goal-metric" placeholder="e.g., Increase website traffic by 20%">
                        </div>
                    </div>
                </div>

                 <div class="card strategy-step-content hidden" data-step-content="2" id="strategy-step-content-2" role="tabpanel" aria-labelledby="strategy-heading" hidden>
                    <div class="card-header"><h2>Step 2: Identify Your Target Audience</h2></div>
                    <div class="card-body">
                        <p>Who are you trying to reach?</p>
                         <div class="form-group">
                            <label>Select your primary audience segments:</label>
                            <div class="checkbox-group" role="group" aria-label="Target Audience Segments">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="audience-homecooks" name="audience" value="Home Cooks">
                                    <label for="audience-homecooks">Home Cooks</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="audience-chefs" name="audience" value="Professional Chefs">
                                    <label for="audience-chefs">Professional Chefs</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="audience-enthusiasts" name="audience" value="Cooking Enthusiasts">
                                    <label for="audience-enthusiasts">Cooking Enthusiasts</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="audience-description">Describe your ideal customer:</label>
                            <textarea id="audience-description" placeholder="e.g., Age range, interests, cooking habits, where they spend time online..."></textarea>
                        </div>
                    </div>
                </div>

                 <div class="card strategy-step-content hidden" data-step-content="3" id="strategy-step-content-3" role="tabpanel" aria-labelledby="strategy-heading" hidden>
                    <div class="card-header"><h2>Step 3: Choose Channels and Tactics</h2></div>
                    <div class="card-body">
                        <p>Where will you reach your audience?</p>
                         <div class="form-group">
                            <label>Select digital marketing channels:</label>
                            <div class="checkbox-group" role="group" aria-label="Marketing Channels">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="channel-social" name="channels" value="Social Media">
                                    <label for="channel-social">Social Media (Facebook, Instagram, Pinterest, TikTok)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="channel-search" name="channels" value="Search Engine Optimization (SEO)">
                                    <label for="channel-search">Search Engine Optimization (SEO)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="channel-ads" name="channels" value="Paid Advertising">
                                    <label for="channel-ads">Paid Advertising (Google Ads, Social Ads)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="channel-email" name="channels" value="Email Marketing">
                                    <label for="channel-email">Email Marketing</label>
                                </div>
                                 <div class="checkbox-item">
                                    <input type="checkbox" id="channel-influencer" name="channels" value="Influencer Marketing">
                                    <label for="channel-influencer">Influencer Marketing</label>
                                </div>
                            </div>
                        </div>
                         <div class="form-group">
                            <label for="tactics">Briefly describe your planned tactics for selected channels:</label>
                            <textarea id="tactics" placeholder="e.g., Run Instagram video ads targeting cooking enthusiasts, Optimize product page for 'unique kitchen gadget' keywords..."></textarea>
                        </div>
                    </div>
                </div>

                 <div class="card strategy-step-content hidden" data-step-content="4" id="strategy-step-content-4" role="tabpanel" aria-labelledby="strategy-heading" hidden>
                    <div class="card-header"><h2>Step 4: Plan Your Content</h2></div>
                    <div class="card-body">
                        <p>What kind of content will you create?</p>
                         <div class="form-group">
                            <label>Select content types you will create:</label>
                            <div class="checkbox-group" role="group" aria-label="Content Types">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="content-photos" name="content-types" value="Product Photos">
                                    <label for="content-photos">Product Photos</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="content-videos" name="content-types" value="Demonstration Videos">
                                    <label for="content-videos">Demonstration Videos</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="content-testimonials" name="content-types" value="Testimonials/Reviews">
                                    <label for="content-testimonials">Testimonials/Reviews</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="content-recipes" name="content-types" value="Recipes using the tool">
                                    <label for="content-recipes">Recipes using the tool</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="content-blog" name="content-types" value="Blog Posts/Articles">
                                    <label for="content-blog">Blog Posts/Articles</label>
                                </div>
                            </div>
                        </div>
                         <div class="form-group">
                            <label for="content-themes">Suggest key messages or content themes:</label>
                            <textarea id="content-themes" placeholder="e.g., Focus on problem/solution, highlight unique features, show ease of use, share customer stories..."></textarea>
                        </div>
                    </div>
                </div>

                 <div class="card strategy-step-content hidden" data-step-content="5" id="strategy-step-content-5" role="tabpanel" aria-labelledby="strategy-heading" hidden>
                    <div class="card-header"><h2>Step 5: Review and Save</h2></div>
                    <div class="card-body">
                        <p>Review your strategy summary:</p>
                        <div class="form-group">
                            <label>Goals:</label>
                            <p id="review-goals" class="text-light-color">-</p>
                        </div>
                         <div class="form-group">
                            <label>Measurement Metric:</label>
                            <p id="review-metric" class="text-light-color">-</p>
                        </div>
                         <div class="form-group">
                            <label>Target Audience Segments:</label>
                            <p id="review-audience" class="text-light-color">-</p>
                        </div>
                        <div class="form-group">
                            <label>Audience Description:</label>
                            <p id="review-audience-desc" class="text-light-color">-</p>
                        </div>
                         <div class="form-group">
                            <label>Channels:</label>
                            <p id="review-channels" class="text-light-color">-</p>
                        </div>
                         <div class="form-group">
                            <label>Tactics Summary:</label>
                            <p id="review-tactics" class="text-light-color">-</p>
                        </div>
                         <div class="form-group">
                            <label>Content Types:</label>
                            <p id="review-content-types" class="text-light-color">-</p>
                        </div>
                         <div class="form-group">
                            <label>Content Themes:</label>
                            <p id="review-content-themes" class="text-light-color">-</p>
                        </div>
                    </div>
                </div>

                <div class="button-group flex-end">
                    <button class="btn btn-outline-secondary" id="strategy-prev-btn" disabled aria-label="Previous Step">Previous</button>
                    <button class="btn btn-primary" id="strategy-next-btn" aria-label="Next Step">Next</button>
                    <button class="btn btn-success hidden" id="strategy-save-btn" aria-label="Save Strategy">Save Strategy</button>
                </div>
            </section>

            <!-- Assets Section -->
            <section id="assets" class="section" role="region" aria-labelledby="assets-heading">
                <div class="section-header">
                    <h1 id="assets-heading">Asset Management</h1>
                     <button class="btn btn-primary" id="upload-asset-btn" aria-label="Upload New Asset">
                         <span class="material-symbols-rounded" aria-hidden="true">upload</span>
                         Upload Asset
                     </button>
                </div>

                 <div class="card hidden" id="asset-upload-card" aria-hidden="true">
                    <div class="card-header"><h2>Upload New Assets</h2></div>
                    <div class="card-body">
                         <div class="asset-upload-area" id="drag-drop-area" role="button" tabindex="0" aria-label="Drag and drop files here or click to select">
                            <input type="file" id="asset-file-input" multiple accept="image/*,video/*">
                            <div class="upload-icon">
                                <span class="material-symbols-rounded" aria-hidden="true">cloud_upload</span>
                            </div>
                            <p>Drag and drop files here, or</p>
                            <button class="btn btn-secondary" aria-controls="asset-file-input">Select Files</button>
                        </div>
                         <div id="upload-progress" class="hidden" aria-hidden="true">
                            <label>Uploading...</label>
                            <progress value="0" max="100" aria-label="File upload progress"></progress>
                         </div>
                        <div id="asset-previews" class="asset-previews" aria-live="polite" aria-atomic="true">
                            <!-- Asset previews will be added here -->
                        </div>
                         <div class="button-group flex-end mt-3">
                            <button class="btn btn-outline-secondary" id="cancel-upload-btn">Cancel</button>
                            <button class="btn btn-primary" id="start-upload-btn" disabled>Start Upload</button>
                         </div>
                    </div>
                 </div>


                <div class="card asset-gallery">
                     <div class="card-header"><h2>Your Assets</h2></div>
                     <div class="card-body">
                         <div class="gallery-grid" id="asset-gallery-grid" role="list">
                             <!-- Asset items will be loaded here -->
                             <!-- Initial placeholder items -->
                             <div class="gallery-item" role="listitem" tabindex="0" aria-label="View details for Product Photo 1.jpg" data-asset-id="1">
                                 <img src="https://placehold.co/300x200?text=Product+Photo+1" alt="Product Photo 1" class="item-thumbnail">
                                 <div class="item-info">
                                     <h3>Product Photo 1.jpg</h3>
                                     <p>Image | 1.2 MB</p>
                                 </div>
                             </div>
                              <div class="gallery-item" role="listitem" tabindex="0" aria-label="View details for Product Photo 2.jpg" data-asset-id="2">
                                 <img src="https://placehold.co/300x200?text=Product+Photo+2" alt="Product Photo 2" class="item-thumbnail">
                                 <div class="item-info">
                                     <h3>Product Photo 2.jpg</h3>
                                     <p>Image | 0.8 MB</p>
                                 </div>
                             </div>
                             <div class="gallery-item" role="listitem" tabindex="0" aria-label="View details for Demo Video.mp4" data-asset-id="3">
                                 <img src="https://placehold.co/300x200?text=Demo+Video" alt="Demo Video Thumbnail" class="item-thumbnail">
                                 <div class="item-info">
                                     <h3>Demo Video.mp4</h3>
                                     <p>Video | 15 MB</p>
                                 </div>
                             </div>
                             <div class="gallery-item" role="listitem" tabindex="0" aria-label="View details for Product in Use.jpg" data-asset-id="4">
                                 <img src="https://placehold.co/300x200?text=Product+in+Use" alt="Product in Use" class="item-thumbnail">
                                 <div class="item-info">
                                     <h3>Product in Use.jpg</h3>
                                     <p>Image | 1.5 MB</p>
                                 </div>
                             </div>
                         </div>
                     </div>
                </div>

            </section>

            <!-- Campaigns Section -->
            <section id="campaigns" class="section" role="region" aria-labelledby="campaigns-heading">
                <div class="section-header">
                    <h1 id="campaigns-heading">Campaign Management</h1>
                     <button class="btn btn-primary" id="create-campaign-btn" aria-label="Create New Campaign">
                         <span class="material-symbols-rounded" aria-hidden="true">add_circle</span>
                         Create New Campaign
                     </button>
                </div>

                 <div class="card hidden" id="campaign-form-card" aria-hidden="true">
                    <div class="card-header"><h2>New Campaign Details</h2></div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="campaign-name">Campaign Name</label>
                            <input type="text" id="campaign-name" placeholder="e.g., Summer Launch Promotion" required aria-required="true">
                            <div class="invalid-feedback" id="campaign-name-feedback">Campaign name is required.</div>
                        </div>
                         <div class="form-group">
                            <label for="campaign-objective">Objective</label>
                            <select id="campaign-objective" required aria-required="true">
                                <option value="">Select Objective</option>
                                <option value="Awareness">Awareness</option>
                                <option value="Sales">Sales</option>
                                <option value="Leads">Leads</option>
                                <option value="Engagement">Engagement</option>
                            </select>
                             <div class="invalid-feedback" id="campaign-objective-feedback">Objective is required.</div>
                        </div>
                         <div class="form-group">
                            <label for="campaign-budget">Budget ($)</label>
                            <input type="number" id="campaign-budget" placeholder="e.g., 500" min="0" required aria-required="true">
                             <div class="invalid-feedback" id="campaign-budget-feedback">Budget is required and must be a non-negative number.</div>
                        </div>
                         <div class="form-group">
                            <label for="campaign-duration">Duration (Days)</label>
                            <input type="number" id="campaign-duration" placeholder="e.g., 30" min="1">
                        </div>
                         <div class="form-group">
                            <label for="campaign-channels">Channels</label>
                            <input type="text" id="campaign-channels" placeholder="e.g., Instagram, Facebook Ads">
                        </div>
                         <div class="form-group">
                            <label for="campaign-content">Content Used</label>
                            <textarea id="campaign-content" placeholder="Describe content or link to assets..."></textarea>
                        </div>
                         <div class="button-group flex-end mt-3">
                            <button class="btn btn-outline-secondary" id="cancel-campaign-btn">Cancel</button>
                            <button class="btn btn-success" id="save-campaign-btn">Save Campaign</button>
                         </div>
                    </div>
                 </div>

                <div class="card campaign-list">
                    <div class="card-header"><h2>Active & Past Campaigns</h2></div>
                    <div class="card-body">
                        <table role="grid">
                            <thead>
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Objective</th>
                                    <th scope="col">Budget</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="campaign-table-body">
                                <!-- Campaign rows will be loaded here -->
                                <!-- Initial placeholder rows -->
                                <tr tabindex="0" aria-label="View details for Launch Awareness Campaign" data-campaign-id="1">
                                    <td>Launch Awareness Campaign</td>
                                    <td>Awareness</td>
                                    <td>$1,000</td>
                                    <td><span class="status-badge active">Active</span></td>
                                    <td>
                                        <div class="button-group">
                                            <button class="btn btn-sm btn-secondary" aria-label="View Campaign">View</button>
                                            <button class="btn btn-sm btn-danger" aria-label="End Campaign">End</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr tabindex="0" aria-label="View details for E-commerce Sales Push Q3" data-campaign-id="2">
                                    <td>E-commerce Sales Push Q3</td>
                                    <td>Sales</td>
                                    <td>$2,500</td>
                                    <td><span class="status-badge ended">Ended</span></td>
                                     <td>
                                        <div class="button-group">
                                            <button class="btn btn-sm btn-secondary" aria-label="View Campaign">View</button>
                                            <button class="btn btn-sm btn-danger" disabled aria-label="End Campaign (Disabled)">End</button>
                                        </div>
                                    </td>
                                </tr>
                                 <tr tabindex="0" aria-label="View details for Retail Partner Outreach" data-campaign-id="3">
                                    <td>Retail Partner Outreach</td>
                                    <td>Leads</td>
                                    <td>$500</td>
                                    <td><span class="status-badge paused">Paused</span></td>
                                     <td>
                                        <div class="button-group">
                                            <button class="btn btn-sm btn-secondary" aria-label="View Campaign">View</button>
                                            <button class="btn btn-sm btn-success" aria-label="Resume Campaign">Resume</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="section" role="region" aria-labelledby="analytics-heading">
                <div class="section-header">
                    <h1 id="analytics-heading">Performance Analytics</h1>
                    <div class="button-group">
                        <button class="btn btn-outline-secondary" aria-label="Select Date Range">Date Range</button>
                        <button class="btn btn-outline-secondary" aria-label="Apply Filters">Filter</button>
                    </div>
                </div>

                <div class="analytics-grid">
                    <div class="card kpi-card">
                        <div class="kpi-value">1,500</div>
                        <div class="kpi-label">Website Visits</div>
                    </div>
                     <div class="card kpi-card">
                        <div class="kpi-value">$5,200</div>
                        <div class="kpi-label">Total Sales</div>
                    </div>
                     <div class="card kpi-card">
                        <div class="kpi-value">3.5%</div>
                        <div class="kpi-label">Conversion Rate</div>
                    </div>
                     <div class="card kpi-card">
                        <div class="kpi-value">150</div>
                        <div class="kpi-label">Leads Generated</div>
                    </div>
                </div>

                 <div class="card">
                    <div class="card-header"><h2>Sales Trend</h2></div>
                    <div class="card-body">
                        <div class="chart-container" id="sales-chart-container" role="img" aria-label="Sales trend line chart">
                            <canvas id="salesChart"></canvas>
                             <!-- Floating control panel -->
                            <div class="floating-controls" id="sales-chart-controls" aria-hidden="true">
                                <div class="control-group">
                                    <label for="salesChartType">Chart Type</label>
                                    <select id="salesChartType" aria-controls="salesChart">
                                        <option value="line">Line</option>
                                        <option value="bar">Bar</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="salesChartColor">Line/Bar Color</label>
                                    <input type="color" id="salesChartColor" value="#007bff" aria-controls="salesChart">
                                </div>
                                 <div class="control-group">
                                    <label for="salesChartDataFilter">Data Filter (Simulated)</label>
                                    <select id="salesChartDataFilter" aria-controls="salesChart">
                                        <option value="monthly">Monthly</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="daily">Daily</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                 </div>

                 <div class="card">
                    <div class="card-header"><h2>Traffic Sources</h2></div>
                    <div class="card-body">
                         <div class="chart-container" id="traffic-chart-container" role="img" aria-label="Traffic sources pie chart">
                            <canvas id="trafficChart"></canvas>
                            <!-- Floating control panel -->
                            <div class="floating-controls" id="traffic-chart-controls" aria-hidden="true">
                                <div class="control-group">
                                    <label for="trafficChartType">Chart Type</label>
                                    <select id="trafficChartType" aria-controls="trafficChart">
                                        <option value="pie">Pie</option>
                                        <option value="doughnut">Doughnut</option>
                                        <option value="bar">Bar</option>
                                    </select>
                                </div>
                                 <div class="control-group">
                                    <label for="trafficChartDataFilter">Data Filter (Simulated)</label>
                                    <select id="trafficChartDataFilter" aria-controls="trafficChart">
                                        <option value="all">All Sources</option>
                                        <option value="social">Social Media</option>
                                        <option value="search">Search</option>
                                        <option value="direct">Direct</option>
                                    </select>
                                </div>
                            </div>
                         </div>
                    </div>
                 </div>

                 <div class="card">
                    <div class="card-header"><h2>Detailed Performance Data</h2></div>
                    <div class="card-body">
                        <table role="grid">
                            <thead>
                                <tr>
                                    <th scope="col">Date</th>
                                    <th scope="col">Visits</th>
                                    <th scope="col">Sales</th>
                                    <th scope="col">Conversion Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>2023-10-01</td><td>150</td><td>$300</td><td>2.0%</td></tr>
                                <tr><td>2023-10-02</td><td>180</td><td>$450</td><td>2.5%</td></tr>
                                <tr><td>2023-10-03</td><td>200</td><td>$500</td><td>2.5%</td></tr>
                                <tr><td>2023-10-04</td><td>220</td><td>$700</td><td>3.2%</td></tr>
                                <tr><td>2023-10-05</td><td>250</td><td>$1000</td><td>4.0%</td></tr>
                            </tbody>
                        </table>
                    </div>
                 </div>

            </section>

             <!-- Content Creator Section -->
            <section id="content" class="section" role="region" aria-labelledby="content-heading">
                <div class="section-header">
                    <h1 id="content-heading">Content Creator</h1>
                    <button class="btn btn-primary">
                        <span class="material-symbols-rounded" aria-hidden="true">save</span>
                        Save Content
                    </button>
                </div>

                 <div class="card">
                    <div class="card-header"><h2>Create Marketing Content</h2></div>
                    <div class="card-body content-editor-area">
                        <div class="editor-panel">
                            <div class="form-group">
                                <label for="content-title">Title / Headline</label>
                                <input type="text" id="content-title" placeholder="e.g., Solve Your Kitchen Problem!">
                            </div>
                             <div class="form-group">
                                <label for="content-body">Ad Copy / Post Text</label>
                                <textarea id="content-body" placeholder="Write your compelling marketing message here..."></textarea>
                            </div>
                             <div class="form-group">
                                <label for="content-asset">Select Asset</label>
                                <select id="content-asset">
                                    <option value="">-- Select an asset --</option>
                                    <!-- Options will be populated from uploaded assets -->
                                </select>
                            </div>
                        </div>
                        <div class="preview-panel">
                            <h3>Preview</h3>
                             <img src="https://placehold.co/300x200?text=Select+Asset" alt="Content Preview" class="preview-content" id="content-preview-img">
                             <video src="" controls class="preview-content hidden" id="content-preview-video"></video>
                             <div class="preview-text" id="content-preview-text" aria-live="polite">Your ad copy will appear here...</div>
                        </div>
                    </div>
                 </div>
            </section>

             <!-- Audience Segmentation Section -->
            <section id="audience" class="section" role="region" aria-labelledby="audience-heading">
                <div class="section-header">
                    <h1 id="audience-heading">Audience Segmentation</h1>
                    <button class="btn btn-primary">
                         <span class="material-symbols-rounded" aria-hidden="true">save</span>
                         Save Segment
                    </button>
                </div>

                 <div class="card">
                    <div class="card-header"><h2>Define Audience Segment</h2></div>
                    <div class="card-body">
                         <div class="form-group">
                            <label for="segment-name">Segment Name</label>
                            <input type="text" id="segment-name" placeholder="e.g., Enthusiastic Home Bakers">
                        </div>
                        <div class="form-group">
                            <label for="segment-criteria">Segmentation Criteria</label>
                            <textarea id="segment-criteria" placeholder="Describe the criteria for this segment (e.g., Interests: Baking, Cooking Shows; Demographics: Female, 25-55; Behaviors: Engaged with cooking content online)..."></textarea>
                        </div>
                         <div class="form-group">
                            <label for="segment-size">Estimated Size (Simulated)</label>
                            <input type="text" id="segment-size" value="N/A" disabled aria-describedby="segment-size-help">
                             <small id="segment-size-help" class="form-text text-light-color">This is a simulated value and does not reflect real data.</small>
                        </div>
                    </div>
                 </div>

                 <div class="card">
                    <div class="card-header"><h2>Saved Segments</h2></div>
                    <div class="card-body">
                        <table role="grid">
                            <thead>
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Criteria Summary</th>
                                    <th scope="col">Estimated Size</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Home Cooks (General)</td>
                                    <td>Interests: Cooking, Recipes; Demographics: All Adults</td>
                                    <td>Large</td>
                                     <td>
                                        <div class="button-group">
                                            <button class="btn btn-sm btn-secondary">Edit</button>
                                            <button class="btn btn-sm btn-danger">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Professional Chefs (Targeted)</td>
                                    <td>Job Title: Chef, Cook; Interests: Culinary Techniques</td>
                                    <td>Medium</td>
                                     <td>
                                        <div class="button-group">
                                            <button class="btn btn-sm btn-secondary">Edit</button>
                                            <button class="btn btn-sm btn-danger">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                 </div>
            </section>

             <!-- Help & Learning Section -->
            <section id="help" class="section" role="region" aria-labelledby="help-heading">
                <div class="section-header">
                    <h1 id="help-heading">Help & Learning Center</h1>
                </div>

                 <div class="card">
                    <div class="card-header"><h2>Getting Started</h2></div>
                    <div class="card-body">
                        <p>Welcome! This platform is designed to help you build and manage your digital marketing strategy.</p>
                        <ul>
                            <li>Use the <strong>Strategy Builder</strong> to define your goals and plan.</li>
                            <li>Upload your product photos and videos in <strong>Assets</strong>.</li>
                            <li>Plan and track your marketing activities in <strong>Campaigns</strong>.</li>
                            <li>Monitor your performance using the charts and data in <strong>Analytics</strong>.</li>
                            <li>Create specific ad copy and posts in the <strong>Content Creator</strong>.</li>
                             <li>Define who you want to reach in <strong>Audience Segmentation</strong>.</li>
                        </ul>
                    </div>
                 </div>

                 <div class="card">
                    <div class="card-header"><h2>Tutorials & Guides</h2></div>
                    <div class="card-body">
                        <p>Explore our guides to learn more:</p>
                         <ul>
                            <li><a href="#" class="text-primary">How to Define Your Marketing Goals</a></li>
                            <li><a href="#" class="text-primary">Best Practices for Product Photography</a></li>
                            <li><a href="#" class="text-primary">Setting Up Your First Campaign</a></li>
                            <li><a href="#" class="text-primary">Understanding Your Analytics Dashboard</a></li>
                         </ul>
                    </div>
                 </div>

                 <div class="card">
                    <div class="card-header"><h2>FAQ</h2></div>
                    <div class="card-body">
                        <p>Find answers to common questions.</p>
                         <!-- Placeholder for FAQ content -->
                    </div>
                 </div>
            </section>

        </main>
    </div>

    <!-- Modal Placeholder (e.g., for viewing asset details) -->
    <div class="modal-overlay" id="asset-detail-modal" role="dialog" aria-modal="true" aria-labelledby="modal-asset-title" aria-hidden="true" tabindex="-1">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-asset-title">Asset Details</h2>
                <button class="modal-close-btn" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Media preview area -->
                <div id="modal-media-preview" style="max-width: 100%; margin: 0 auto calc(var(--spacing-unit) * 2) auto; text-align: center;">
                     <img src="" alt="Asset Preview" id="modal-asset-preview-img" style="max-width: 100%; height: auto; display: none; border-radius: var(--border-radius); border: 1px solid var(--border-color);">
                     <video src="" controls id="modal-asset-preview-video" style="max-width: 100%; height: auto; display: none; border-radius: var(--border-radius); border: 1px solid var(--border-color);"></video>
                     <!-- Placeholder for other types if needed -->
                </div>


                <p><strong>File Name:</strong> <span id="modal-asset-filename"></span></p>
                <p><strong>File Type:</strong> <span id="modal-asset-filetype"></span></p>
                <p><strong>File Size:</strong> <span id="modal-asset-filesize"></span></p>
                <!-- Add more details like upload date, usage count etc. -->
            </div>
            <div class="modal-footer">
                 <button class="btn btn-outline-secondary">Edit Metadata</button>
                 <button class="btn btn-danger">Delete Asset</button>
                 <button class="btn btn-primary modal-close-btn">Close</button>
            </div>
        </div>
    </div>


    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // --- State Management ---
        const state = {
            currentSection: 'strategy',
            strategyStep: 1,
            uploadedFiles: [],
            assets: [ // Simulate stored assets
                 { id: 1, filename: 'Product Photo 1.jpg', filetype: 'Image', filesize: '1.2 MB', url: 'https://placehold.co/300x200?text=Product+Photo+1' },
                 { id: 2, filename: 'Product Photo 2.jpg', filetype: 'Image', filesize: '0.8 MB', url: 'https://placehold.co/300x200?text=Product+Photo+2' },
                 { id: 3, filename: 'Demo Video.mp4', filetype: 'Video', filesize: '15 MB', url: 'https://placehold.co/300x200?text=Demo+Video' }, // Using placeholder URL, ideally a real video URL
                 { id: 4, filename: 'Product in Use.jpg', filetype: 'Image', filesize: '1.5 MB', url: 'https://placehold.co/300x200?text=Product+in+Use' },
            ],
            campaigns: [ // Simulate stored campaigns
                 { id: 1, name: 'Launch Awareness Campaign', objective: 'Awareness', budget: '$1,000', status: 'Active' },
                 { id: 2, name: 'E-commerce Sales Push Q3', objective: 'Sales', budget: '$2,500', status: 'Ended' },
                 { id: 3, name: 'Retail Partner Outreach', objective: 'Leads', budget: '$500', status: 'Paused' },
            ],
            strategyData: {
                goals: [],
                metric: '',
                audienceSegments: [],
                audienceDescription: '',
                channels: [],
                tactics: '',
                contentTypes: [],
                contentThemes: ''
            }
        };

        // --- DOM Elements ---
        const sidebar = document.getElementById('sidebar');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const strategySteps = document.querySelectorAll('.strategy-steps .step');
        const strategyStepContents = document.querySelectorAll('.strategy-step-content');
        const strategyPrevBtn = document.getElementById('strategy-prev-btn');
        const strategyNextBtn = document.getElementById('strategy-next-btn');
        const strategySaveBtn = document.getElementById('strategy-save-btn');
        const assetUploadCard = document.getElementById('asset-upload-card');
        const uploadAssetBtn = document.getElementById('upload-asset-btn');
        const dragDropArea = document.getElementById('drag-drop-area');
        const assetFileInput = document.getElementById('asset-file-input');
        const assetPreviewsContainer = document.getElementById('asset-previews');
        const uploadProgress = document.getElementById('upload-progress');
        const startUploadBtn = document.getElementById('start-upload-btn');
        const cancelUploadBtn = document.getElementById('cancel-upload-btn');
        const assetGalleryGrid = document.getElementById('asset-gallery-grid');
        const campaignFormCard = document.getElementById('campaign-form-card');
        const createCampaignBtn = document.getElementById('create-campaign-btn');
        const cancelCampaignBtn = document.getElementById('cancel-campaign-btn');
        const saveCampaignBtn = document.getElementById('save-campaign-btn');
        const campaignTableBody = document.getElementById('campaign-table-body');
        const contentAssetSelect = document.getElementById('content-asset');
        const contentPreviewImg = document.getElementById('content-preview-img');
        const contentPreviewVideo = document.getElementById('content-preview-video');
        const contentPreviewText = document.getElementById('content-preview-text');
        const contentBodyTextarea = document.getElementById('content-body');
        const assetDetailModal = document.getElementById('asset-detail-modal');
        const modalCloseBtns = assetDetailModal.querySelectorAll('.modal-close-btn');
        const modalAssetTitle = document.getElementById('modal-asset-title');
        const modalAssetPreviewImg = document.getElementById('modal-asset-preview-img');
        const modalAssetPreviewVideo = document.getElementById('modal-asset-preview-video');
        const modalAssetFilename = document.getElementById('modal-asset-filename');
        const modalAssetFiletype = document.getElementById('modal-asset-filetype');
        const modalAssetFilesize = document.getElementById('modal-asset-filesize');

        // Form validation elements (Campaigns)
        const campaignNameInput = document.getElementById('campaign-name');
        const campaignObjectiveSelect = document.getElementById('campaign-objective');
        const campaignBudgetInput = document.getElementById('campaign-budget');
        const campaignNameFeedback = document.getElementById('campaign-name-feedback');
        const campaignObjectiveFeedback = document.getElementById('campaign-objective-feedback');
        const campaignBudgetFeedback = document.getElementById('campaign-budget-feedback');
        const campaignDurationInput = document.getElementById('campaign-duration');
        const campaignChannelsInput = document.getElementById('campaign-channels');
        const campaignContentTextarea = document.getElementById('campaign-content');


        // --- Chart Instances ---
        let salesChart = null;
        let trafficChart = null;

        // --- Functions ---

        // Navigation
        function renderSection(sectionId) {
            sections.forEach(section => {
                const isActive = section.id === sectionId;
                section.classList.toggle('active', isActive);
                section.setAttribute('aria-hidden', !isActive);
                if (isActive) {
                    section.removeAttribute('hidden');
                } else {
                    section.setAttribute('hidden', '');
                }
            });
             navLinks.forEach(link => {
                const isActive = link.dataset.section === sectionId;
                link.classList.toggle('active', isActive);
                link.setAttribute('aria-selected', isActive);
                link.setAttribute('tabindex', isActive ? '0' : '-1');
                if (isActive) {
                    link.setAttribute('aria-current', 'page');
                } else {
                    link.removeAttribute('aria-current');
                }
            });
            state.currentSection = sectionId;

            // Specific section initialization
            if (sectionId === 'analytics') {
                if (!salesChart) {
                     initializeCharts();
                } else {
                    // Ensure charts are responsive when section becomes active
                    salesChart.resize();
                    trafficChart.resize();
                }
            } else {
                 // Destroy charts when leaving analytics to free up resources
                 if (salesChart) {
                     salesChart.destroy();
                     salesChart = null;
                 }
                 if (trafficChart) {
                     trafficChart.destroy();
                     trafficChart = null;
                 }
            }

             if (sectionId === 'assets') {
                 renderAssetGallery();
             }
             if (sectionId === 'content') {
                 populateContentAssets();
                 updateContentPreview(); // Initial preview
             }
             if (sectionId === 'campaigns') {
                 renderCampaignTable();
             }


             // Hide floating chart controls when switching sections
             document.querySelectorAll('.floating-controls').forEach(controls => {
                 controls.classList.remove('active');
                 controls.setAttribute('aria-hidden', true);
             });

             // Scroll main content to top
             document.getElementById('main-content').scrollTop = 0;
             document.getElementById('main-content').focus(); // Focus main content for accessibility
        }

        // Strategy Builder
        function renderStrategyStep(step) {
            strategySteps.forEach(s => {
                const stepNumber = parseInt(s.dataset.step);
                const isActive = stepNumber <= step;
                const isCurrent = stepNumber === step;

                s.classList.toggle('active', isActive);
                 s.setAttribute('aria-selected', isCurrent);
                 s.setAttribute('tabindex', isCurrent ? '0' : '-1');
            });
            strategyStepContents.forEach(content => {
                const isCurrent = parseInt(content.dataset.stepContent) === step;
                content.classList.toggle('hidden', !isCurrent);
                 content.setAttribute('aria-hidden', !isCurrent);
                 if (isCurrent) {
                     content.removeAttribute('hidden');
                 } else {
                     content.setAttribute('hidden', '');
                 }
            });

            strategyPrevBtn.disabled = step === 1;
            strategyNextBtn.classList.toggle('hidden', step === 5);
            strategyNextBtn.setAttribute('aria-hidden', step === 5);
            strategySaveBtn.classList.toggle('hidden', step !== 5);
            strategySaveBtn.setAttribute('aria-hidden', step !== 5);


            // Populate review step
            if (step === 5) {
                 collectStrategyData();
                 document.getElementById('review-goals').textContent = state.strategyData.goals.join(', ') || '-';
                 document.getElementById('review-metric').textContent = state.strategyData.metric || '-';
                 document.getElementById('review-audience').textContent = state.strategyData.audienceSegments.join(', ') || '-';
                 document.getElementById('review-audience-desc').textContent = state.strategyData.audienceDescription || '-';
                 document.getElementById('review-channels').textContent = state.strategyData.channels.join(', ') || '-';
                 document.getElementById('review-tactics').textContent = state.strategyData.tactics || '-';
                 document.getElementById('review-content-types').textContent = state.strategyData.contentTypes.join(', ') || '-';
                 document.getElementById('review-content-themes').textContent = state.strategyData.contentThemes || '-';
            }
        }

        function collectStrategyData() {
            // Step 1
            state.strategyData.goals = Array.from(document.querySelectorAll('#strategy [data-step-content="1"] input[name="goals"]:checked')).map(input => input.value);
            state.strategyData.metric = document.getElementById('goal-metric').value.trim();
            // Step 2
            state.strategyData.audienceSegments = Array.from(document.querySelectorAll('#strategy [data-step-content="2"] input[name="audience"]:checked')).map(input => input.value);
            state.strategyData.audienceDescription = document.getElementById('audience-description').value.trim();
            // Step 3
            state.strategyData.channels = Array.from(document.querySelectorAll('#strategy [data-step-content="3"] input[name="channels"]:checked')).map(input => input.value);
            state.strategyData.tactics = document.getElementById('tactics').value.trim();
            // Step 4
            state.strategyData.contentTypes = Array.from(document.querySelectorAll('#strategy [data-step-content="4"] input[name="content-types"]:checked')).map(input => input.value);
            state.strategyData.contentThemes = document.getElementById('content-themes').value.trim();
        }

        // Asset Management
        function renderAssetGallery() {
            assetGalleryGrid.innerHTML = ''; // Clear current gallery

            if (state.assets.length === 0) {
                 assetGalleryGrid.innerHTML = '<p class="text-center text-light-color">No assets uploaded yet.</p>';
                 return;
            }

            state.assets.forEach(asset => {
                const galleryItem = document.createElement('div');
                galleryItem.classList.add('gallery-item');
                galleryItem.setAttribute('role', 'listitem');
                galleryItem.setAttribute('tabindex', '0');
                galleryItem.setAttribute('aria-label', `View details for ${asset.filename}`);
                galleryItem.dataset.assetId = asset.id; // Store asset ID

                let thumbnailHtml = '';
                if (asset.filetype.startsWith('Image')) {
                     thumbnailHtml = `<img src="${asset.url}" alt="${asset.filename}" class="item-thumbnail">`;
                } else if (asset.filetype.startsWith('Video')) {
                     // Use a placeholder or generate a thumbnail for video
                     thumbnailHtml = `<img src="https://placehold.co/300x120?text=Video+Thumbnail" alt="Video thumbnail for ${asset.filename}" class="item-thumbnail">`;
                } else {
                     thumbnailHtml = `<div class="item-thumbnail flex-center align-center"><span class="material-symbols-rounded" style="font-size: 48px; color: var(--text-light-color);">insert_drive_file</span></div>`;
                }


                galleryItem.innerHTML = `
                    ${thumbnailHtml}
                    <div class="item-info">
                        <h3>${asset.filename}</h3>
                        <p>${asset.filetype} | ${asset.filesize}</p>
                    </div>
                `;
                assetGalleryGrid.appendChild(galleryItem);
            });
        }


        function handleFileSelect(files) {
            state.uploadedFiles = [];
            assetPreviewsContainer.innerHTML = ''; // Clear previous previews
            uploadProgress.classList.add('hidden');
            uploadProgress.setAttribute('aria-hidden', true);
            uploadProgress.querySelector('progress').value = 0;
            startUploadBtn.disabled = true;

            if (files.length > 0) {
                assetUploadCard.classList.remove('hidden');
                assetUploadCard.setAttribute('aria-hidden', false);
                for (const file of files) {
                    state.uploadedFiles.push(file);
                    renderAssetPreview(file);
                }
                 startUploadBtn.disabled = state.uploadedFiles.length === 0;
            } else {
                 assetUploadCard.classList.add('hidden');
                 assetUploadCard.setAttribute('aria-hidden', true);
            }
        }

        function renderAssetPreview(file) {
            const previewItem = document.createElement('div');
            previewItem.classList.add('asset-preview-item');
            previewItem.setAttribute('role', 'figure'); // Use figure role for media preview
            previewItem.setAttribute('aria-label', `Preview of ${file.name}`);


            const deleteBtn = document.createElement('button');
            deleteBtn.classList.add('delete-btn');
            deleteBtn.innerHTML = '<span class="material-symbols-rounded" aria-hidden="true">close</span>';
            deleteBtn.title = `Remove ${file.name}`;
            deleteBtn.setAttribute('aria-label', `Remove ${file.name}`);
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent triggering file input click
                // Remove file from state and DOM
                state.uploadedFiles = state.uploadedFiles.filter(f => f !== file);
                previewItem.remove();
                if (state.uploadedFiles.length === 0) {
                    assetUploadCard.classList.add('hidden');
                    assetUploadCard.setAttribute('aria-hidden', true);
                }
                 startUploadBtn.disabled = state.uploadedFiles.length === 0;
            });

            if (file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.alt = `Preview of ${file.name}`;
                previewItem.appendChild(img);
            } else if (file.type.startsWith('video/')) {
                const video = document.createElement('video');
                video.src = URL.createObjectURL(file);
                video.controls = false; // No controls in preview
                video.muted = true;
                 // Attempt autoplay silently, handle potential errors
                video.play().catch(error => console.warn('Video autoplay failed:', error));
                previewItem.appendChild(video);
            } else {
                 const icon = document.createElement('span');
                 icon.classList.add('material-symbols-rounded');
                 icon.textContent = 'insert_drive_file';
                 icon.style.fontSize = '48px';
                 icon.style.color = "var('--text-light-color')"; // Use CSS variable in JS
                 previewItem.appendChild(icon);
            }

             previewItem.appendChild(deleteBtn);
            assetPreviewsContainer.appendChild(previewItem);
        }

        function startUpload() {
            if (state.uploadedFiles.length === 0) return;

            uploadProgress.classList.remove('hidden');
            uploadProgress.setAttribute('aria-hidden', false);
            const progressBar = uploadProgress.querySelector('progress');
            progressBar.value = 0;
            startUploadBtn.disabled = true;
            cancelUploadBtn.disabled = true;


            // Simulate upload progress
            let progress = 0;
            const uploadInterval = setInterval(() => {
                progress += 10;
                progressBar.value = progress;
                if (progress >= 100) {
                    clearInterval(uploadInterval);
                    // Simulate adding uploaded files to assets
                     state.uploadedFiles.forEach(file => {
                        state.assets.push({
                             id: state.assets.length > 0 ? Math.max(...state.assets.map(a => a.id)) + 1 : 1, // Generate next ID
                             filename: file.name,
                             filetype: file.type.split('/')[0].charAt(0).toUpperCase() + file.type.split('/')[0].slice(1), // Image, Video etc.
                             filesize: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                             url: URL.createObjectURL(file) // Use local URL for simulation
                        });
                     });

                    alert('Upload Complete! (Simulated)');

                    state.uploadedFiles = [];
                    assetPreviewsContainer.innerHTML = '';
                    uploadProgress.classList.add('hidden');
                    uploadProgress.setAttribute('aria-hidden', true);
                    assetUploadCard.classList.add('hidden');
                     assetUploadCard.setAttribute('aria-hidden', true);
                    startUploadBtn.disabled = false;
                    cancelUploadBtn.disabled = false;

                    renderAssetGallery(); // Refresh gallery
                    populateContentAssets(); // Update content asset dropdown
                }
            }, 100); // Faster simulation
        }

        function cancelUpload() {
             state.uploadedFiles.forEach(file => URL.revokeObjectURL(file)); // Clean up object URLs
             state.uploadedFiles = [];
             assetPreviewsContainer.innerHTML = '';
             uploadProgress.classList.add('hidden');
             uploadProgress.setAttribute('aria-hidden', true);
             assetUploadCard.classList.add('hidden');
             assetUploadCard.setAttribute('aria-hidden', true);
             startUploadBtn.disabled = true;
             cancelUploadBtn.disabled = false;
        }

        function showAssetDetailModal(assetData) {
            modalAssetTitle.textContent = assetData.filename;
            modalAssetFilename.textContent = assetData.filename;
            modalAssetFiletype.textContent = assetData.filetype;
            modalAssetFilesize.textContent = assetData.filesize;

            modalAssetPreviewImg.style.display = 'none';
            modalAssetPreviewVideo.style.display = 'none';
             modalAssetPreviewVideo.pause(); // Pause any currently playing video


            if (assetData.filetype.startsWith('Image')) {
                 modalAssetPreviewImg.src = assetData.url;
                 modalAssetPreviewImg.style.display = 'block';
                 modalAssetPreviewImg.setAttribute('alt', `Preview of ${assetData.filename}`);
                 modalAssetPreviewVideo.removeAttribute('alt');
            } else if (assetData.filetype.startsWith('Video')) {
                 modalAssetPreviewVideo.src = assetData.url;
                 modalAssetPreviewVideo.style.display = 'block';
                 modalAssetPreviewVideo.setAttribute('alt', `Preview of video asset: ${assetData.filename}`);
                 modalAssetPreviewImg.removeAttribute('alt');
            } else {
                 // Handle other file types if necessary, maybe show an icon
                 modalAssetPreviewImg.style.display = 'none';
                 modalAssetPreviewVideo.style.display = 'none';
                 // Could add a placeholder icon here
            }


            assetDetailModal.classList.add('active');
            assetDetailModal.setAttribute('aria-hidden', false);
            // Focus the modal content or a focusable element inside
            modalCloseBtns[0].focus();
        }

        function hideAssetDetailModal() {
            assetDetailModal.classList.remove('active');
            assetDetailModal.setAttribute('aria-hidden', true);
             // Pause video if playing
             modalAssetPreviewVideo.pause();
             // Return focus to the element that opened the modal (if possible)
             // This requires storing the triggering element, which is more complex.
             // For now, focus the main content area.
             document.getElementById('main-content').focus();
        }


        // Content Creator
        function populateContentAssets() {
             contentAssetSelect.innerHTML = '<option value="">-- Select an asset --</option>'; // Clear existing options
             state.assets.forEach(asset => {
                 const option = document.createElement('option');
                 option.value = asset.url; // Use URL as value
                 option.textContent = asset.filename;
                 option.dataset.filetype = asset.filetype; // Store filetype
                 contentAssetSelect.appendChild(option);
             });
             // Ensure preview is updated if an asset was already selected
             updateContentPreview();
        }

        function updateContentPreview() {
             const selectedOption = contentAssetSelect.options[contentAssetSelect.selectedIndex];
             const selectedAssetUrl = selectedOption ? selectedOption.value : '';
             const selectedAssetType = selectedOption ? selectedOption.dataset.filetype : '';
             const contentText = contentBodyTextarea.value;

             // Update text preview
             contentPreviewText.textContent = contentText || 'Your ad copy will appear here...';

             // Update media preview
             contentPreviewImg.classList.add('hidden');
             contentPreviewImg.setAttribute('aria-hidden', true);
             contentPreviewVideo.classList.add('hidden');
             contentPreviewVideo.setAttribute('aria-hidden', true);

             contentPreviewImg.src = '';
             contentPreviewVideo.src = '';
             contentPreviewImg.alt = 'Content Preview Placeholder';
             contentPreviewVideo.removeAttribute('alt');


             if (selectedAssetUrl) {
                 if (selectedAssetType === 'Image') {
                     contentPreviewImg.src = selectedAssetUrl;
                     contentPreviewImg.classList.remove('hidden');
                     contentPreviewImg.setAttribute('aria-hidden', false);
                      const selectedOptionText = selectedOption.text;
                     contentPreviewImg.alt = `Preview of asset: ${selectedOptionText}`;
                 } else if (selectedAssetType === 'Video') {
                     contentPreviewVideo.src = selectedAssetUrl;
                     contentPreviewVideo.classList.remove('hidden');
                     contentPreviewVideo.setAttribute('aria-hidden', false);
                      const selectedOptionText = selectedOption.text;
                      contentPreviewVideo.setAttribute('alt', `Preview of video asset: ${selectedOptionText}`);
                 } else {
                     // Default placeholder for unknown types
                     contentPreviewImg.src = "https://placehold.co/300x200?text=Unsupported+Preview";
                     contentPreviewImg.classList.remove('hidden');
                     contentPreviewImg.setAttribute('aria-hidden', false);
                      contentPreviewImg.alt = "Unsupported asset type preview";
                 }
             } else {
                  contentPreviewImg.src = "https://placehold.co/300x200?text=Select+Asset";
                  contentPreviewImg.classList.remove('hidden');
                  contentPreviewImg.setAttribute('aria-hidden', false);
                   contentPreviewImg.alt = "Select an asset to see preview";
             }
        }

        // Campaign Management
        function renderCampaignTable() {
             campaignTableBody.innerHTML = ''; // Clear current rows

             if (state.campaigns.length === 0) {
                 campaignTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-light-color">No campaigns created yet.</td></tr>';
                 return;
             }

             state.campaigns.forEach(campaign => {
                 const row = document.createElement('tr');
                 row.setAttribute('tabindex', '0');
                 row.setAttribute('aria-label', `View details for campaign ${campaign.name}`);
                 row.dataset.campaignId = campaign.id; // Store campaign ID

                 let statusClass = '';
                 let actionButtons = '';
                 let viewButton = `<button class="btn btn-sm btn-secondary view-campaign-btn" aria-label="View Campaign ${campaign.name}">View</button>`;

                 if (campaign.status === 'Active') {
                     statusClass = 'active';
                     actionButtons = `${viewButton} <button class="btn btn-sm btn-danger end-campaign-btn" aria-label="End Campaign ${campaign.name}">End</button>`;
                 } else if (campaign.status === 'Paused') {
                     statusClass = 'paused';
                     actionButtons = `${viewButton} <button class="btn btn-sm btn-success resume-campaign-btn" aria-label="Resume Campaign ${campaign.name}">Resume</button>`;
                 } else { // Ended
                      statusClass = 'ended';
                      actionButtons = `${viewButton} <button class="btn btn-sm btn-danger" disabled aria-label="End Campaign ${campaign.name} (Disabled)">End</button>`;
                 }


                 row.innerHTML = `
                    <td>${campaign.name}</td>
                    <td>${campaign.objective}</td>
                    <td>${campaign.budget}</td>
                    <td><span class="status-badge ${statusClass}">${campaign.status}</span></td>
                    <td><div class="button-group">${actionButtons}</div></td>
                 `;

                 // Add event listeners to action buttons within the row
                 row.querySelector('.view-campaign-btn').addEventListener('click', (e) => {
                     e.stopPropagation(); // Prevent row click
                     alert(`Simulating View for Campaign: ${campaign.name}`);
                     console.log('View Campaign:', campaign);
                 });
                 const endButton = row.querySelector('.end-campaign-btn');
                 if (endButton && !endButton.disabled) {
                     endButton.addEventListener('click', (e) => {
                         e.stopPropagation();
                         if (confirm(`Are you sure you want to end the campaign "${campaign.name}"?`)) {
                             // Simulate ending campaign
                             campaign.status = 'Ended';
                             renderCampaignTable(); // Re-render table
                             alert(`Campaign "${campaign.name}" ended. (Simulated)`);
                             console.log('Ended Campaign:', campaign);
                         }
                     });
                 }
                 const resumeButton = row.querySelector('.resume-campaign-btn');
                  if (resumeButton) {
                     resumeButton.addEventListener('click', (e) => {
                         e.stopPropagation();
                         // Simulate resuming campaign
                         campaign.status = 'Active';
                         renderCampaignTable(); // Re-render table
                         alert(`Campaign "${campaign.name}" resumed. (Simulated)`);
                         console.log('Resumed Campaign:', campaign);
                     });
                 }


                 campaignTableBody.appendChild(row);
             });
        }

        function validateCampaignForm() {
            let isValid = true;

            // Reset validation styles and messages
            const inputs = [campaignNameInput, campaignObjectiveSelect, campaignBudgetInput];
            const feedbacks = [campaignNameFeedback, campaignObjectiveFeedback, campaignBudgetFeedback];

            inputs.forEach(input => input.classList.remove('is-invalid'));
            feedbacks.forEach(feedback => feedback.classList.add('hidden'));


            if (!campaignNameInput.value.trim()) {
                campaignNameInput.classList.add('is-invalid');
                campaignNameFeedback.classList.remove('hidden');
                isValid = false;
            }
            if (!campaignObjectiveSelect.value) {
                 campaignObjectiveSelect.classList.add('is-invalid');
                 campaignObjectiveFeedback.classList.remove('hidden');
                 isValid = false;
            }
             const budget = parseFloat(campaignBudgetInput.value);
            if (isNaN(budget) || budget < 0) {
                 campaignBudgetInput.classList.add('is-invalid');
                 campaignBudgetFeedback.classList.remove('hidden');
                 campaignBudgetFeedback.textContent = 'Budget is required and must be a non-negative number.';
                 isValid = false;
            } else if (campaignBudgetInput.value.trim() === '') {
                 // Handle empty string specifically if required attribute isn't enough
                 campaignBudgetInput.classList.add('is-invalid');
                 campaignBudgetFeedback.classList.remove('hidden');
                 campaignBudgetFeedback.textContent = 'Budget is required.';
                 isValid = false;
            }


            return isValid;
        }


        function saveCampaign() {
             if (!validateCampaignForm()) {
                 // Focus the first invalid element
                 document.querySelector('.form-group input.is-invalid, .form-group select.is-invalid, .form-group textarea.is-invalid')?.focus();
                 return;
             }

             // Simulate saving campaign data
             const campaignData = {
                 id: state.campaigns.length > 0 ? Math.max(...state.campaigns.map(c => c.id)) + 1 : 1, // Generate next ID
                 name: campaignNameInput.value.trim(),
                 objective: campaignObjectiveSelect.value,
                 budget: '$' + parseFloat(campaignBudgetInput.value).toFixed(0), // Format budget
                 duration: campaignDurationInput.value || 'N/A',
                 channels: campaignChannelsInput.value.trim() || 'N/A',
                 content: campaignContentTextarea.value.trim() || 'N/A',
                 status: 'Active' // Default status for new campaigns
             };


             state.campaigns.push(campaignData); // Add to simulated state
             alert('Campaign Saved! (Simulated)');
             console.log('Saved Campaign:', campaignData);

             // Hide form and refresh list (simulated)
             cancelCampaignBtn.click(); // Use the cancel logic to clear form and hide card
             renderCampaignTable(); // Re-render table with new data
        }

        function clearCampaignForm() {
             campaignNameInput.value = '';
             campaignObjectiveSelect.value = '';
             campaignBudgetInput.value = '';
             campaignDurationInput.value = '';
             campaignChannelsInput.value = '';
             campaignContentTextarea.value = '';

             // Reset validation styles and messages
            const inputs = [campaignNameInput, campaignObjectiveSelect, campaignBudgetInput];
            const feedbacks = [campaignNameFeedback, campaignObjectiveFeedback, campaignBudgetFeedback];
            inputs.forEach(input => input.classList.remove('is-invalid'));
            feedbacks.forEach(feedback => feedback.classList.add('hidden'));
        }


        // Analytics Charts
        function initializeCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'], // Simulated labels
                    datasets: [{
                        label: 'Weekly Sales ($)',
                        data: [150, 200, 350, 400, 550, 600], // Simulated data
                        backgroundColor: "rgba(0, 123, 255, 0.5)", // Use CSS variable in JS string
                        borderColor: "var(--primary-color)", // Use CSS variable in JS string
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                     onClick: (e) => toggleChartControls('sales-chart-controls'),
                    plugins: {
                        legend: { display: true },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: { beginAtZero: true },
                        x: { }
                    }
                }
            });

            // Traffic Chart
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            trafficChart = new Chart(trafficCtx, {
                type: 'pie',
                data: {
                    labels: ['Social Media', 'Search', 'Direct', 'Referral'], // Simulated labels
                    datasets: [{
                        label: 'Traffic Share',
                        data: [300, 450, 200, 100], // Simulated data
                        backgroundColor: [
                            "rgba(0, 123, 255, 0.7)", // Primary
                            "rgba(40, 167, 69, 0.7)", // Success
                            "rgba(255, 193, 7, 0.7)", // Warning
                            "rgba(108, 117, 125, 0.7)" // Secondary
                        ],
                        borderColor: "var(--surface-color)", // Use CSS variable in JS string
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                     onClick: (e) => toggleChartControls('traffic-chart-controls'),
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { }
                    }
                }
            });

             // Add click listener to chart containers to toggle controls
             document.getElementById('sales-chart-container').addEventListener('click', (e) => {
                 // Check if the click was NOT on the controls themselves or their children
                 if (!e.target.closest('.floating-controls')) {
                     toggleChartControls('sales-chart-controls');
                 }
             });
             document.getElementById('traffic-chart-container').addEventListener('click', (e) => {
                 if (!e.target.closest('.floating-controls')) {
                     toggleChartControls('traffic-chart-controls');
                 }
             });

             // Close controls when clicking outside any chart container or controls
             document.addEventListener('click', (e) => {
                 const clickedOnChart = e.target.closest('.chart-container');
                 const clickedOnControls = e.target.closest('.floating-controls');

                 if (!clickedOnChart && !clickedOnControls) {
                     document.getElementById('sales-chart-controls').classList.remove('active');
                     document.getElementById('sales-chart-controls').setAttribute('aria-hidden', true);
                     document.getElementById('traffic-chart-controls').classList.remove('active');
                      document.getElementById('traffic-chart-controls').setAttribute('aria-hidden', true);
                 }
             });

             // Chart Control Listeners
             document.getElementById('salesChartType').addEventListener('change', (e) => {
                 salesChart.config.type = e.target.value;
                 salesChart.update();
             });
             document.getElementById('salesChartColor').addEventListener('input', (e) => { // Use input for live update
                 const color = e.target.value;
                 salesChart.data.datasets[0].borderColor = color;
                 // Simple transparency calculation for background color
                 const hexToRgba = (hex, alpha) => {
                     const r = parseInt(hex.slice(1, 3), 16);
                     const g = parseInt(hex.slice(3, 5), 16);
                     const b = parseInt(hex.slice(5, 7), 16);
                     return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                 };
                 salesChart.data.datasets[0].backgroundColor = hexToRgba(color, 0.5);
                 salesChart.update();
             });
              document.getElementById('salesChartDataFilter').addEventListener('change', (e) => {
                 // Simulate data change based on filter
                 const filter = e.target.value;
                 let labels, data;
                 if (filter === 'weekly') {
                     labels = ['Wk 1', 'Wk 2', 'Wk 3', 'Wk 4', 'Wk 5', 'Wk 6'];
                     data = [150, 200, 350, 400, 550, 600];
                 } else if (filter === 'daily') {
                      labels = ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
                      data = [20, 30, 25, 40, 50, 35, 60];
                 } else { // monthly
                     labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                     data = [1000, 1200, 1500, 1800, 2000, 2500];
                 }
                 salesChart.data.labels = labels;
                 salesChart.data.datasets[0].data = data;
                 salesChart.update();
             });


             document.getElementById('trafficChartType').addEventListener('change', (e) => {
                 trafficChart.config.type = e.target.value;
                 trafficChart.update();
             });
              document.getElementById('trafficChartDataFilter').addEventListener('change', (e) => {
                 // Simulate data change based on filter
                 const filter = e.target.value;
                 let labels, data;
                 if (filter === 'social') {
                     labels = ['Instagram', 'Facebook', 'Pinterest', 'TikTok'];
                     data = [150, 100, 30, 20];
                 } else if (filter === 'search') {
                     labels = ['Google', 'Bing'];
                     data = [300, 150];
                 } else { // all
                      labels = ['Social Media', 'Search', 'Direct', 'Referral'];
                      data = [300, 450, 200, 100];
                 }
                 trafficChart.data.labels = labels;
                 trafficChart.data.datasets[0].data = data;
                 trafficChart.update();
             });
        }

        function toggleChartControls(controlsId) {
             const controls = document.getElementById(controlsId);
             const allControls = document.querySelectorAll('.floating-controls');
             allControls.forEach(c => {
                 if (c.id !== controlsId) {
                     c.classList.remove('active');
                     c.setAttribute('aria-hidden', true);
                 }
             });
             const isActive = controls.classList.toggle('active');
             controls.setAttribute('aria-hidden', !isActive);
        }


        // --- Event Listeners ---

        // Sidebar Navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.dataset.section;
                renderSection(sectionId);
                // Update URL hash for deep linking and history (optional but good practice)
                history.pushState(null, '', `#${sectionId}`);
            });
             link.addEventListener('keydown', (e) => {
                 if (e.key === 'Enter' || e.key === ' ') {
                     e.preventDefault();
                     link.click(); // Simulate click for keyboard activation
                 }
             });
        });

        // Handle browser back/forward based on hash
        window.addEventListener('popstate', () => {
             const sectionId = window.location.hash.substring(1) || 'strategy'; // Default to strategy
             renderSection(sectionId);
        });


        // Toggle Sidebar
        toggleSidebarBtn.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
             const icon = toggleSidebarBtn.querySelector('.material-symbols-rounded');
             if (sidebar.classList.contains('collapsed')) {
                 icon.textContent = 'chevron_right';
                 toggleSidebarBtn.setAttribute('aria-label', 'Expand sidebar');
             } else {
                 icon.textContent = 'chevron_left';
                 toggleSidebarBtn.setAttribute('aria-label', 'Collapse sidebar');
             }
             // Resize charts if analytics is active
             if (state.currentSection === 'analytics' && salesChart) {
                 salesChart.resize();
                 trafficChart.resize();
             }
        });


        // Strategy Builder Navigation
        strategyNextBtn.addEventListener('click', () => {
            if (state.strategyStep < 5) {
                state.strategyStep++;
                renderStrategyStep(state.strategyStep);
                 // Scroll to the top of the step content
                 strategyStepContents[state.strategyStep - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                 // Focus the first focusable element in the new step
                 strategyStepContents[state.strategyStep - 1].querySelector('input, select, textarea, button, [tabindex="0"]')?.focus();
            }
        });

        strategyPrevBtn.addEventListener('click', () => {
            if (state.strategyStep > 1) {
                state.strategyStep--;
                renderStrategyStep(state.strategyStep);
                 // Scroll to the top of the step content
                 strategyStepContents[state.strategyStep - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                 // Focus the first focusable element in the new step
                 strategyStepContents[state.strategyStep - 1].querySelector('input, select, textarea, button, [tabindex="0"]')?.focus();
            }
        });

        strategySaveBtn.addEventListener('click', () => {
             collectStrategyData();
            alert('Strategy Saved! (Simulated)');
            console.log('Saved Strategy:', state.strategyData);
            // In a real app, send state.strategyData to backend
        });

        // Strategy Step Click (for accessibility/keyboard)
        strategySteps.forEach(step => {
             step.addEventListener('click', () => {
                 const stepNumber = parseInt(step.dataset.step);
                 if (stepNumber <= state.strategyStep) { // Allow going back to previous steps
                      state.strategyStep = stepNumber;
                      renderStrategyStep(state.strategyStep);
                       // Scroll to the top of the step content
                      strategyStepContents[state.strategyStep - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                      // Focus the step indicator itself
                      step.focus();
                 }
             });
              step.addEventListener('keydown', (e) => {
                 if (e.key === 'Enter' || e.key === ' ') {
                     e.preventDefault();
                      const stepNumber = parseInt(step.dataset.step);
                      if (stepNumber <= state.strategyStep) {
                         state.strategyStep = stepNumber;
                         renderStrategyStep(state.strategyStep);
                          // Scroll to the top of the step content
                         strategyStepContents[state.strategyStep - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                         // Focus the step indicator itself
                         step.focus();
                      }
                 }
              });
        });


        // Asset Management Upload
        uploadAssetBtn.addEventListener('click', () => {
             assetUploadCard.classList.remove('hidden');
             assetUploadCard.setAttribute('aria-hidden', false);
             // Scroll to upload area
             assetUploadCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
             dragDropArea.focus(); // Focus the drag/drop area for keyboard users
        });

        dragDropArea.addEventListener('click', () => {
            assetFileInput.click();
        });

         // Allow dragDropArea to be activated by keyboard
         dragDropArea.addEventListener('keydown', (e) => {
             if (e.key === 'Enter' || e.key === ' ') {
                 e.preventDefault();
                 assetFileInput.click();
             }
         });


        assetFileInput.addEventListener('change', (e) => {
            handleFileSelect(e.target.files);
        });

        dragDropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dragDropArea.style.borderColor = "var('--primary-color')"; // Use CSS variable in JS string
             dragDropArea.style.backgroundColor = "rgba(0, 123, 255, 0.05)";
        });

        dragDropArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dragDropArea.style.borderColor = "var('--border-color')"; // Use CSS variable in JS string
            dragDropArea.style.backgroundColor = "";
        });

        dragDropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dragDropArea.style.borderColor = "var('--border-color')"; // Use CSS variable in JS string
             dragDropArea.style.backgroundColor = "";
            handleFileSelect(e.dataTransfer.files);
        });

        startUploadBtn.addEventListener('click', startUpload);
        cancelUploadBtn.addEventListener('click', cancelUpload);

        // Asset Gallery Item Click (Simulated detail view)
        assetGalleryGrid.addEventListener('click', (e) => {
            const galleryItem = e.target.closest('.gallery-item');
            if (galleryItem) {
                const assetId = parseInt(galleryItem.dataset.assetId);
                const assetData = state.assets.find(asset => asset.id === assetId);
                if (assetData) {
                    showAssetDetailModal(assetData);
                }
            }
        });

         // Asset Gallery Item Keyboard Activation
         assetGalleryGrid.addEventListener('keydown', (e) => {
             if (e.key === 'Enter' || e.key === ' ') {
                 const galleryItem = e.target.closest('.gallery-item');
                 if (galleryItem) {
                     e.preventDefault();
                     const assetId = parseInt(galleryItem.dataset.assetId);
                     const assetData = state.assets.find(asset => asset.id === assetId);
                     if (assetData) {
                         showAssetDetailModal(assetData);
                     }
                 }
             }
         });


        // Modal Close
        modalCloseBtns.forEach(btn => {
             btn.addEventListener('click', hideAssetDetailModal);
        });

        assetDetailModal.addEventListener('click', (e) => {
             // Close modal if clicking on the overlay itself
             if (e.target === assetDetailModal) {
                 hideAssetDetailModal();
             }
        });

         // Close modal with Escape key
         document.addEventListener('keydown', (e) => {
             if (e.key === 'Escape' && assetDetailModal.classList.contains('active')) {
                 hideAssetDetailModal();
             }
         });

         // Modal Focus Trapping (Basic)
         assetDetailModal.addEventListener('transitionend', () => {
             if (assetDetailModal.classList.contains('active')) {
                 // Find all focusable elements within the modal
                 const focusableElements = assetDetailModal.querySelectorAll(
                     'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                 );
                 const firstFocusableElement = focusableElements[0];
                 const lastFocusableElement = focusableElements[focusableElements.length - 1];

                 if (!firstFocusableElement) return; // No focusable elements

                 // Trap focus within the modal
                 assetDetailModal.addEventListener('keydown', (e) => {
                     const isTabPressed = e.key === 'Tab' || e.keyCode === 9;

                     if (!isTabPressed) {
                         return;
                     }

                     if (e.shiftKey) { // Shift + Tab
                         if (document.activeElement === firstFocusableElement) {
                             lastFocusableElement.focus();
                             e.preventDefault();
                         }
                     } else { // Tab
                         if (document.activeElement === lastFocusableElement) {
                             firstFocusableElement.focus();
                             e.preventDefault();
                         }
                     }
                 });

                 // Focus the first focusable element when modal opens
                 firstFocusableElement.focus();
             }
         });


        // Campaign Management
        createCampaignBtn.addEventListener('click', () => {
             campaignFormCard.classList.remove('hidden');
             campaignFormCard.setAttribute('aria-hidden', false);
              // Scroll to form
             campaignFormCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
             campaignNameInput.focus(); // Focus the first input
        });

        cancelCampaignBtn.addEventListener('click', () => {
            campaignFormCard.classList.add('hidden');
            campaignFormCard.setAttribute('aria-hidden', true);
            clearCampaignForm(); // Clear form fields
        });

        saveCampaignBtn.addEventListener('click', saveCampaign);

        // Add input event listeners for validation feedback
        campaignNameInput.addEventListener('input', validateCampaignForm);
        campaignObjectiveSelect.addEventListener('change', validateCampaignForm);
        campaignBudgetInput.addEventListener('input', validateCampaignForm);


        // Content Creator Preview
        contentAssetSelect.addEventListener('change', updateContentPreview);
        contentBodyTextarea.addEventListener('input', updateContentPreview);


        // --- Initial Render ---

        // Check URL hash for initial section
        const initialSectionId = window.location.hash.substring(1) || 'strategy';
        renderSection(initialSectionId);
        renderStrategyStep(state.strategyStep);
        // Initial render of campaign table and asset gallery is handled by renderSection
        // populateContentAssets(); // Initial population is handled by renderSection

    </script>

</body>
</html>
