<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Customer Lifetime Value Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #212529;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --transition: all 0.3s ease;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--gray-800);
            background-color: var(--gray-100);
            line-height: 1.6;
        }

        .app-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: 60px 1fr;
            grid-template-areas:
                "header header"
                "sidebar main";
            height: 100vh;
            overflow: hidden;
        }

        .header {
            grid-area: header;
            background-color: white;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-title h1 {
            font-size: 18px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .user-profile:hover {
            background-color: var(--gray-200);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .sidebar {
            grid-area: sidebar;
            background-color: white;
            border-right: 1px solid var(--gray-200);
            padding: 20px 0;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--gray-600);
            font-weight: 600;
            padding: 0 20px;
            margin-bottom: 10px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu-item {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .sidebar-menu-item:hover {
            background-color: var(--gray-100);
        }

        .sidebar-menu-item.active {
            background-color: var(--gray-100);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .sidebar-menu-item .material-symbols-rounded {
            font-size: 20px;
        }

        .main-content {
            grid-area: main;
            padding: 20px;
            overflow-y: auto;
        }

        .page-title {
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-body {
            padding: 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stat-title {
            font-size: 14px;
            color: var(--gray-600);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .stat-change.positive {
            color: #10b981;
        }

        .stat-change.negative {
            color: #ef4444;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 14px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--gray-300);
            color: var(--gray-700);
        }

        .btn-outline:hover {
            background-color: var(--gray-100);
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            position: relative;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .data-table th {
            background-color: var(--gray-100);
            font-weight: 600;
            color: var(--gray-700);
        }

        .data-table tbody tr:hover {
            background-color: var(--gray-100);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-primary {
            background-color: var(--primary-light);
            color: white;
        }

        .badge-success {
            background-color: var(--success);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning);
            color: white;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--gray-300);
            margin-bottom: 20px;
        }

        .tab-item {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            font-weight: 500;
        }

        .tab-item:hover {
            color: var(--primary);
        }

        .tab-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .form-check-input {
            width: 16px;
            height: 16px;
        }

        .upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--primary);
        }

        .upload-icon {
            font-size: 40px;
            color: var(--gray-500);
            margin-bottom: 10px;
        }

        .upload-text {
            margin-bottom: 10px;
            color: var(--gray-700);
        }

        .upload-hint {
            font-size: 12px;
            color: var(--gray-600);
        }

        .progress {
            height: 8px;
            background-color: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 12px;
            color: var(--gray-600);
            display: flex;
            justify-content: space-between;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal-backdrop.show .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: var(--gray-600);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .steps {
            display: flex;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 0 10px;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: var(--gray-300);
            z-index: 1;
        }

        .step.completed:not(:last-child)::after {
            background-color: var(--primary);
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--gray-300);
            color: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            z-index: 2;
            font-weight: 600;
            font-size: 14px;
        }

        .step.active .step-number {
            background-color: var(--primary);
            color: white;
        }

        .step.completed .step-number {
            background-color: var(--primary);
            color: white;
        }

        .step-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .step.active .step-title {
            color: var(--primary);
            font-weight: 600;
        }

        .step-description {
            font-size: 12px;
            color: var(--gray-600);
        }

        .floating-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 15px;
            z-index: 10;
            display: none;
        }

        .floating-controls.show {
            display: block;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--gray-800);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .alert {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-info {
            background-color: rgba(67, 97, 238, 0.1);
            border-left: 4px solid var(--primary);
            color: var(--primary);
        }

        .alert-warning {
            background-color: rgba(247, 37, 133, 0.1);
            border-left: 4px solid var(--warning);
            color: var(--warning);
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "header"
                    "main";
            }

            .sidebar {
                position: fixed;
                left: -250px;
                top: 60px;
                height: calc(100vh - 60px);
                z-index: 100;
                transition: var(--transition);
            }

            .sidebar.show {
                left: 0;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-title">
                <span class="material-symbols-rounded">analytics</span>
                <h1>CLV Analysis Dashboard</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline btn-sm">
                    <span class="material-symbols-rounded">help</span>
                    Help
                </button>
                <div class="user-profile">
                    <div class="user-avatar">A</div>
                    <span>Admin</span>
                </div>
            </div>
        </header>

        <aside class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Analysis</h3>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item active">
                        <span class="material-symbols-rounded">dashboard</span>
                        Dashboard
                    </li>
                    <li class="sidebar-menu-item">
                        <span class="material-symbols-rounded">upload_file</span>
                        Data Upload
                    </li>
                    <li class="sidebar-menu-item">
                        <span class="material-symbols-rounded">table_chart</span>
                        Data Explorer
                    </li>
                    <li class="sidebar-menu-item">
                        <span class="material-symbols-rounded">monitoring</span>
                        CLV Analysis
                    </li>
                    <li class="sidebar-menu-item">
                        <span class="material-symbols-rounded">group</span>
                        Customer Segments
                    </li>
                    <li class="sidebar-menu-item">
                        <span class="material-symbols-rounded">insights</span>
                        Insights
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Settings</h3>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <span class="material-symbols-rounded">settings</span>
                        Preferences
                    </li>
                    <li class="sidebar-menu-item">
                        <span class="material-symbols-rounded">help</span>
                        Help & Support
                    </li>
                </ul>
            </div>
        </aside>

        <main class="main-content">
            <h1 class="page-title">Dashboard Overview</h1>

            <div class="steps">
                <div class="step completed">
                    <div class="step-number">1</div>
                    <div class="step-title">Data Upload</div>
                    <div class="step-description">Import your customer data</div>
                </div>
                <div class="step active">
                    <div class="step-number">2</div>
                    <div class="step-title">Data Exploration</div>
                    <div class="step-description">Review and clean your data</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-title">CLV Analysis</div>
                    <div class="step-description">Run lifetime value models</div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-title">Segmentation</div>
                    <div class="step-description">Group customers by behavior</div>
                </div>
                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-title">Insights</div>
                    <div class="step-description">Review actionable findings</div>
                </div>
            </div>

            <div class="alert alert-info">
                <span class="material-symbols-rounded">info</span>
                <div>
                    <strong>Welcome to your CLV Analysis Dashboard!</strong> Your data has been uploaded successfully. Let's start exploring your customer purchase patterns.
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-title">Total Customers</div>
                    <div class="stat-value">4,752</div>
                    <div class="stat-change positive">
                        <span class="material-symbols-rounded">trending_up</span>
                        12.5% vs. last year
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Average CLV</div>
                    <div class="stat-value">$342.18</div>
                    <div class="stat-change positive">
                        <span class="material-symbols-rounded">trending_up</span>
                        8.3% vs. last year
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Repeat Purchase Rate</div>
                    <div class="stat-value">37.2%</div>
                    <div class="stat-change negative">
                        <span class="material-symbols-rounded">trending_down</span>
                        2.1% vs. last year
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Average Order Value</div>
                    <div class="stat-value">$78.45</div>
                    <div class="stat-change positive">
                        <span class="material-symbols-rounded">trending_up</span>
                        5.7% vs. last year
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-symbols-rounded">monitoring</span>
                        Customer Lifetime Value Trends
                    </div>
                    <button class="btn btn-outline btn-sm" id="clvChartControlsBtn">
                        <span class="material-symbols-rounded">tune</span>
                        Customize
                    </button>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="clvChart"></canvas>
                        <div class="floating-controls" id="clvChartControls">
                            <div class="control-group">
                                <label class="form-label">Time Period</label>
                                <select class="form-select" id="clvTimePeriod">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly" selected>Quarterly</option>
                                    <option value="yearly">Yearly</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="form-label">Customer Segment</label>
                                <select class="form-select" id="clvSegment">
                                    <option value="all" selected>All Customers</option>
                                    <option value="new">New Customers</option>
                                    <option value="returning">Returning Customers</option>
                                    <option value="vip">VIP Customers</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="form-label">Chart Type</label>
                                <select class="form-select" id="clvChartType">
                                    <option value="line" selected>Line Chart</option>
                                    <option value="bar">Bar Chart</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="form-label">Show Forecast</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="clvShowForecast">
                                    <label for="clvShowForecast">Include 6-month forecast</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-symbols-rounded">donut_large</span>
                        Key Factors Influencing CLV
                    </div>
                    <button class="btn btn-outline btn-sm" id="factorsChartControlsBtn">
                        <span class="material-symbols-rounded">tune</span>
                        Customize
                    </button>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="factorsChart"></canvas>
                        <div class="floating-controls" id="factorsChartControls">
                            <div class="control-group">
                                <label class="form-label">Analysis Type</label>
                                <select class="form-select" id="factorsAnalysisType">
                                    <option value="correlation" selected>Correlation Analysis</option>
                                    <option value="importance">Feature Importance</option>
                                    <option value="regression">Regression Coefficients</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="form-label">Top Factors</label>
                                <select class="form-select" id="factorsCount">
                                    <option value="5">Top 5</option>
                                    <option value="10" selected>Top 10</option>
                                    <option value="15">Top 15</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="form-label">Factor Category</label>
                                <select class="form-select" id="factorsCategory">
                                    <option value="all" selected>All Categories</option>
                                    <option value="demographic">Demographics</option>
                                    <option value="behavioral">Behavioral</option>
                                    <option value="transactional">Transactional</option>
                                    <option value="survey">Survey Responses</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-symbols-rounded">group</span>
                        Customer Segments by CLV
                    </div>
                </div>
                <div class="card-body">
                    <div class="tab-container">
                        <div class="tab-nav">
                            <div class="tab-item active" data-tab="segment-overview">Segment Overview</div>
                            <div class="tab-item" data-tab="segment-details">Segment Details</div>
                            <div class="tab-item" data-tab="segment-comparison">Segment Comparison</div>
                        </div>
                        <div class="tab-content active" id="segment-overview">
                            <div class="chart-container">
                                <canvas id="segmentOverviewChart"></canvas>
                            </div>
                        </div>
                        <div class="tab-content" id="segment-details">
                            <div class="form-group">
                                <label class="form-label">Select Segment</label>
                                <select class="form-select" id="segmentSelector">
                                    <option value="high-value">High Value (Top 20%)</option>
                                    <option value="mid-value">Mid Value (Middle 30%)</option>
                                    <option value="low-value">Low Value (Bottom 50%)</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="segmentDetailsChart"></canvas>
                            </div>
                        </div>
                        <div class="tab-content" id="segment-comparison">
                            <div class="form-group">
                                <label class="form-label">Compare Metrics</label>
                                <select class="form-select" id="compareMetric">
                                    <option value="avg-order">Average Order Value</option>
                                    <option value="purchase-frequency">Purchase Frequency</option>
                                    <option value="retention">Retention Rate</option>
                                    <option value="product-categories">Product Categories</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="segmentComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-symbols-rounded">lightbulb</span>
                        Actionable Insights
                    </div>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <span class="material-symbols-rounded">insights</span>
                        <div>
                            <strong>Key Finding:</strong> Customers who browse product reviews spend 42% more over their lifetime compared to those who don't.
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <span class="material-symbols-rounded">insights</span>
                        <div>
                            <strong>Key Finding:</strong> First-time customers who purchase during promotional periods have a 28% lower repeat purchase rate.
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <span class="material-symbols-rounded">insights</span>
                        <div>
                            <strong>Key Finding:</strong> Customers who complete post-purchase surveys have 3.2x higher CLV than non-respondents.
                        </div>
                    </div>
                    <div class="alert alert-warning">
                        <span class="material-symbols-rounded">priority_high</span>
                        <div>
                            <strong>Opportunity:</strong> Email campaigns targeting customers who haven't purchased in 60-90 days show the highest potential ROI.
                        </div>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 15px;">
                        <span class="material-symbols-rounded">download</span>
                        Download Full Insights Report
                    </button>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-backdrop" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Upload Customer Data</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="dropZone">
                    <span class="material-symbols-rounded upload-icon">cloud_upload</span>
                    <div class="upload-text">Drag and drop your CSV file here</div>
                    <div class="upload-hint">or click to browse files (CSV, Excel, or JSON)</div>
                    <input type="file" id="fileInput" style="display: none;">
                </div>
                <div style="margin-top: 20px; display: none;" id="uploadProgress">
                    <div class="progress">
                        <div class="progress-bar" style="width: 0%;"></div>
                    </div>
                    <div class="progress-text">
                        <span>Uploading...</span>
                        <span>0%</span>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label class="form-label">Data Source Type</label>
                    <select class="form-select">
                        <option value="transactions">Transaction Data</option>
                        <option value="customers">Customer Profiles</option>
                        <option value="browsing">Browsing Behavior</option>
                        <option value="surveys">Survey Responses</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Date Range</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="date" class="form-control" placeholder="Start Date">
                        <input type="date" class="form-control" placeholder="End Date">
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="headerRow" checked>
                        <label for="headerRow">File contains header row</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelUpload">Cancel</button>
                <button class="btn btn-primary" id="startUpload">Upload Data</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { Chart } from "https://esm.sh/chart.js/auto";

        // Initialize tabs
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                
                // Update active tab
                document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Toggle chart controls
        document.getElementById('clvChartControlsBtn').addEventListener('click', () => {
            document.getElementById('clvChartControls').classList.toggle('show');
        });

        document.getElementById('factorsChartControlsBtn').addEventListener('click', () => {
            document.getElementById('factorsChartControls').classList.toggle('show');
        });

        // Close controls when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#clvChartControls') && !e.target.closest('#clvChartControlsBtn')) {
                document.getElementById('clvChartControls').classList.remove('show');
            }
            
            if (!e.target.closest('#factorsChartControls') && !e.target.closest('#factorsChartControlsBtn')) {
                document.getElementById('factorsChartControls').classList.remove('show');
            }
        });

        // CLV Trend Chart
        const clvChartCtx = document.getElementById('clvChart').getContext('2d');
        const clvChart = new Chart(clvChartCtx, {
            type: 'line',
            data: {
                labels: ['Q1 2020', 'Q2 2020', 'Q3 2020', 'Q4 2020', 'Q1 2021', 'Q2 2021', 'Q3 2021', 'Q4 2021', 'Q1 2022', 'Q2 2022', 'Q3 2022', 'Q4 2022'],
                datasets: [{
                    label: 'Average CLV ($)',
                    data: [245, 258, 270, 285, 298, 310, 325, 335, 348, 355, 365, 380],
                    borderColor: '#4361ee',
                    backgroundColor: 'rgba(67, 97, 238, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return `CLV: $${context.raw}`;
                            }
                        }
                    },
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Customer Lifetime Value ($)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Quarter'
                        }
                    }
                }
            }
        });

        // Update CLV chart based on controls
        document.getElementById('clvTimePeriod').addEventListener('change', updateClvChart);
        document.getElementById('clvSegment').addEventListener('change', updateClvChart);
        document.getElementById('clvChartType').addEventListener('change', updateClvChart);
        document.getElementById('clvShowForecast').addEventListener('change', updateClvChart);

        function updateClvChart() {
            const timePeriod = document.getElementById('clvTimePeriod').value;
            const segment = document.getElementById('clvSegment').value;
            const chartType = document.getElementById('clvChartType').value;
            const showForecast = document.getElementById('clvShowForecast').checked;
            
            // Update chart type
            clvChart.config.type = chartType;
            
            // Update data based on segment
            let data;
            if (segment === 'all') {
                data = [245, 258, 270, 285, 298, 310, 325, 335, 348, 355, 365, 380];
            } else if (segment === 'new') {
                data = [180, 195, 210, 228, 240, 255, 268, 280, 295, 310, 325, 340];
            } else if (segment === 'returning') {
                data = [320, 335, 350, 365, 380, 395, 410, 425, 440, 455, 470, 485];
            } else if (segment === 'vip') {
                data = [520, 545, 570, 595, 620, 645, 670, 695, 720, 745, 770, 795];
            }
            
            // Update labels based on time period
            let labels;
            if (timePeriod === 'monthly') {
                labels = [
                    'Jan 2020', 'Feb 2020', 'Mar 2020', 'Apr 2020', 'May 2020', 'Jun 2020',
                    'Jul 2020', 'Aug 2020', 'Sep 2020', 'Oct 2020', 'Nov 2020', 'Dec 2020',
                    'Jan 2021', 'Feb 2021', 'Mar 2021', 'Apr 2021', 'May 2021', 'Jun 2021',
                    'Jul 2021', 'Aug 2021', 'Sep 2021', 'Oct 2021', 'Nov 2021', 'Dec 2021',
                    'Jan 2022', 'Feb 2022', 'Mar 2022', 'Apr 2022', 'May 2022', 'Jun 2022',
                    'Jul 2022', 'Aug 2022', 'Sep 2022', 'Oct 2022', 'Nov 2022', 'Dec 2022'
                ];
                // Generate monthly data by interpolating quarterly data
                data = [];
                for (let i = 0; i < 12; i++) {
                    const q1 = 245 + i * 12;
                    const q2 = 258 + i * 12;
                    const q3 = 270 + i * 12;
                    const q4 = 285 + i * 12;
                    data.push(q1, q1 + (q2-q1)/3, q1 + 2*(q2-q1)/3, 
                              q2, q2 + (q3-q2)/3, q2 + 2*(q3-q2)/3,
                              q3, q3 + (q4-q3)/3, q3 + 2*(q4-q3)/3);
                }
            } else if (timePeriod === 'quarterly') {
                labels = ['Q1 2020', 'Q2 2020', 'Q3 2020', 'Q4 2020', 'Q1 2021', 'Q2 2021', 'Q3 2021', 'Q4 2021', 'Q1 2022', 'Q2 2022', 'Q3 2022', 'Q4 2022'];
            } else if (timePeriod === 'yearly') {
                labels = ['2020', '2021', '2022'];
                // Aggregate data to yearly
                if (segment === 'all') {
                    data = [264, 317, 362]; // Average of quarterly values
                } else if (segment === 'new') {
                    data = [203, 261, 318];
                } else if (segment === 'returning') {
                    data = [342, 403, 463];
                } else if (segment === 'vip') {
                    data = [558, 658, 758];
                }
            }
            
            // Add forecast data if selected
            if (showForecast) {
                if (timePeriod === 'monthly') {
                    labels = labels.concat(['Jan 2023', 'Feb 2023', 'Mar 2023', 'Apr 2023', 'May 2023', 'Jun 2023']);
                    // Add 6 forecast points with slight uptrend
                    const lastValue = data[data.length - 1];
                    for (let i = 1; i <= 6; i++) {
                        data.push(lastValue + i * 5);
                    }
                } else if (timePeriod === 'quarterly') {
                    labels = labels.concat(['Q1 2023', 'Q2 2023']);
                    // Add 2 forecast quarters
                    const lastValue = data[data.length - 1];
                    data.push(lastValue + 15, lastValue + 30);
                } else if (timePeriod === 'yearly') {
                    labels = labels.concat(['2023 (forecast)']);
                    // Add 1 forecast year
                    const lastValue = data[data.length - 1];
                    data.push(lastValue + 45);
                }
                
                // Create a second dataset for the forecast part
                const forecastStartIndex = timePeriod === 'monthly' ? 36 : (timePeriod === 'quarterly' ? 12 : 3);
                
                // Split data into actual and forecast
                const actualData = data.slice(0, forecastStartIndex);
                const forecastData = Array(forecastStartIndex).fill(null).concat(data.slice(forecastStartIndex));
                
                clvChart.data.datasets = [
                    {
                        label: 'Actual CLV ($)',
                        data: actualData,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Forecast CLV ($)',
                        data: forecastData,
                        borderColor: '#f72585',
                        backgroundColor: 'rgba(247, 37, 133, 0.1)',
                        borderDash: [5, 5],
                        tension: 0.3,
                        fill: true
                    }
                ];
            } else {
                clvChart.data.datasets = [{
                    label: 'Average CLV ($)',
                    data: data,
                    borderColor: '#4361ee',
                    backgroundColor: 'rgba(67, 97, 238, 0.1)',
                    tension: 0.3,
                    fill: true
                }];
            }
            
            clvChart.data.labels = labels;
            clvChart.update();
        }

        // Key Factors Chart
        const factorsChartCtx = document.getElementById('factorsChart').getContext('2d');
        const factorsChart = new Chart(factorsChartCtx, {
            type: 'bar',
            data: {
                labels: [
                    'Purchase Frequency', 
                    'Avg Order Value', 
                    'Product Reviews Usage', 
                    'Email Engagement', 
                    'Mobile App Usage', 
                    'Loyalty Program', 
                    'Returns Rate', 
                    'Payment Method', 
                    'Shipping Method', 
                    'Product Categories'
                ],
                datasets: [{
                    label: 'Correlation with CLV',
                    data: [0.78, 0.72, 0.65, 0.61, 0.58, 0.52, -0.48, 0.42, 0.38, 0.35],
                    backgroundColor: [
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(247, 37, 133, 0.7)',
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(67, 97, 238, 0.7)'
                    ],
                    borderColor: [
                        'rgba(67, 97, 238, 1)',
                        'rgba(67, 97, 238, 1)',
                        'rgba(67, 97, 238, 1)',
                        'rgba(67, 97, 238, 1)',
                        'rgba(67, 97, 238, 1)',
                        'rgba(67, 97, 238, 1)',
                        'rgba(247, 37, 133, 1)',
                        'rgba(67, 97, 238, 1)',
                        'rgba(67, 97, 238, 1)',
                        'rgba(67, 97, 238, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.raw;
                                return `Correlation: ${value > 0 ? '+' : ''}${value.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        min: -1,
                        max: 1,
                        title: {
                            display: true,
                            text: 'Correlation Coefficient'
                        }
                    }
                }
            }
        });

        // Update factors chart based on controls
        document.getElementById('factorsAnalysisType').addEventListener('change', updateFactorsChart);
        document.getElementById('factorsCount').addEventListener('change', updateFactorsChart);
        document.getElementById('factorsCategory').addEventListener('change', updateFactorsChart);

        function updateFactorsChart() {
            const analysisType = document.getElementById('factorsAnalysisType').value;
            const factorsCount = parseInt(document.getElementById('factorsCount').value);
            const category = document.getElementById('factorsCategory').value;
            
            let labels, data, backgroundColor, borderColor;
            
            if (analysisType === 'correlation') {
                if (category === 'all' || category === 'behavioral') {
                    labels = [
                        'Purchase Frequency', 
                        'Product Reviews Usage', 
                        'Email Engagement', 
                        'Mobile App Usage', 
                        'Loyalty Program', 
                        'Returns Rate', 
                        'Payment Method', 
                        'Shipping Method', 
                        'Product Categories',
                        'Time on Site',
                        'Cart Abandonment Rate',
                        'Wishlist Usage',
                        'Social Media Engagement',
                        'Support Tickets',
                        'Referral Program'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.78, 0.65, 0.61, 0.58, 0.52, -0.48, 0.42, 0.38, 0.35, 0.32, -0.30, 0.28, 0.25, -0.22, 0.20
                    ].slice(0, factorsCount);
                } else if (category === 'demographic') {
                    labels = [
                        'Age Group', 
                        'Income Level', 
                        'Location Type', 
                        'Family Size', 
                        'Education Level', 
                        'Occupation', 
                        'Housing Type', 
                        'Gender',
                        'Marital Status',
                        'Distance from Store'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.45, 0.42, 0.38, 0.35, 0.32, 0.28, 0.25, 0.15, 0.12, 0.10
                    ].slice(0, factorsCount);
                } else if (category === 'transactional') {
                    labels = [
                        'Avg Order Value', 
                        'Payment Method', 
                        'Shipping Method', 
                        'Returns Rate', 
                        'Discount Usage', 
                        'Seasonal Purchasing', 
                        'Weekend vs Weekday', 
                        'Time of Day',
                        'Product Bundle Purchases',
                        'Gift Wrapping'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.72, 0.42, 0.38, -0.48, -0.35, 0.32, 0.25, 0.22, 0.38, 0.15
                    ].slice(0, factorsCount);
                } else if (category === 'survey') {
                    labels = [
                        'Overall Satisfaction', 
                        'Product Quality Rating', 
                        'Shipping Experience', 
                        'Customer Service', 
                        'Website Usability', 
                        'Price Perception', 
                        'Likelihood to Recommend', 
                        'Brand Perception',
                        'Return Process',
                        'Product Selection'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.68, 0.65, 0.52, 0.48, 0.45, 0.42, 0.62, 0.55, 0.38, 0.35
                    ].slice(0, factorsCount);
                }
            } else if (analysisType === 'importance') {
                // Feature importance values (different scale)
                if (category === 'all' || category === 'behavioral') {
                    labels = [
                        'Purchase Frequency', 
                        'Email Engagement', 
                        'Product Reviews Usage', 
                        'Mobile App Usage', 
                        'Loyalty Program', 
                        'Returns Rate', 
                        'Product Categories',
                        'Time on Site',
                        'Wishlist Usage',
                        'Payment Method',
                        'Shipping Method',
                        'Cart Abandonment Rate',
                        'Social Media Engagement',
                        'Support Tickets',
                        'Referral Program'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.25, 0.18, 0.15, 0.12, 0.10, 0.08, 0.07, 0.06, 0.05, 0.04, 0.03, 0.03, 0.02, 0.02, 0.01
                    ].slice(0, factorsCount);
                } else if (category === 'demographic') {
                    // Different order for importance vs correlation
                    labels = [
                        'Income Level', 
                        'Age Group', 
                        'Location Type', 
                        'Education Level', 
                        'Family Size', 
                        'Occupation', 
                        'Distance from Store',
                        'Housing Type', 
                        'Marital Status',
                        'Gender'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.22, 0.18, 0.15, 0.12, 0.10, 0.08, 0.06, 0.05, 0.03, 0.01
                    ].slice(0, factorsCount);
                } else if (category === 'transactional') {
                    labels = [
                        'Avg Order Value', 
                        'Returns Rate', 
                        'Discount Usage', 
                        'Payment Method', 
                        'Shipping Method', 
                        'Seasonal Purchasing', 
                        'Product Bundle Purchases',
                        'Weekend vs Weekday', 
                        'Time of Day',
                        'Gift Wrapping'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.28, 0.18, 0.15, 0.12, 0.08, 0.07, 0.05, 0.04, 0.02, 0.01
                    ].slice(0, factorsCount);
                } else if (category === 'survey') {
                    labels = [
                        'Likelihood to Recommend', 
                        'Overall Satisfaction', 
                        'Product Quality Rating', 
                        'Brand Perception',
                        'Customer Service', 
                        'Shipping Experience', 
                        'Price Perception', 
                        'Website Usability', 
                        'Product Selection',
                        'Return Process'
                    ].slice(0, factorsCount);
                    
                    data = [
                        0.22, 0.20, 0.18, 0.12, 0.10, 0.08, 0.05, 0.03, 0.02, 0.01
                    ].slice(0, factorsCount);
                }
            } else if (analysisType === 'regression') {
                // Regression coefficients
                if (category === 'all' || category === 'behavioral') {
                    labels = [
                        'Purchase Frequency', 
                        'Mobile App Usage', 
                        'Product Reviews Usage', 
                        'Email Engagement', 
                        'Loyalty Program', 
                        'Returns Rate', 
                        'Time on Site',
                        'Product Categories',
                        'Wishlist Usage',
                        'Cart Abandonment Rate',
                        'Payment Method',
                        'Shipping Method',
                        'Social Media Engagement',
                        'Support Tickets',
                        'Referral Program'
                    ].slice(0, factorsCount);
                    
                    data = [
                        85.2, 62.8, 58.5, 45.2, 42.1, -38.7, 32.5, 28.9, 25.4, -22.8, 18.5, 15.2, 12.8, -10.5, 8.2
                    ].slice(0, factorsCount);
                } else if (category === 'demographic') {
                    labels = [
                        'Income Level', 
                        'Age Group', 
                        'Education Level', 
                        'Location Type', 
                        'Family Size', 
                        'Occupation', 
                        'Distance from Store',
                        'Housing Type', 
                        'Marital Status',
                        'Gender'
                    ].slice(0, factorsCount);
                    
                    data = [
                        45.8, 38.2, 32.5, 28.7, 22.4, 18.5, -15.2, 12.8, 8.5, 5.2
                    ].slice(0, factorsCount);
                } else if (category === 'transactional') {
                    labels = [
                        'Avg Order Value', 
                        'Returns Rate', 
                        'Discount Usage', 
                        'Product Bundle Purchases',
                        'Payment Method', 
                        'Shipping Method', 
                        'Seasonal Purchasing', 
                        'Weekend vs Weekday', 
                        'Time of Day',
                        'Gift Wrapping'
                    ].slice(0, factorsCount);
                    
                    data = [
                        72.5, -48.2, -35.8, 32.5, 28.7, 25.4, 22.8, 18.5, 12.4, 8.2
                    ].slice(0, factorsCount);
                } else if (category === 'survey') {
                    labels = [
                        'Likelihood to Recommend', 
                        'Product Quality Rating', 
                        'Overall Satisfaction', 
                        'Brand Perception',
                        'Customer Service', 
                        'Shipping Experience', 
                        'Price Perception', 
                        'Website Usability', 
                        'Return Process',
                        'Product Selection'
                    ].slice(0, factorsCount);
                    
                    data = [
                        68.5, 62.4, 58.7, 52.1, 45.8, 38.2, 32.5, 25.4, 18.7, 15.2
                    ].slice(0, factorsCount);
                }
            }
            
            // Generate colors based on values
            backgroundColor = data.map(value => {
                if (analysisType === 'correlation') {
                    return value >= 0 ? 'rgba(67, 97, 238, 0.7)' : 'rgba(247, 37, 133, 0.7)';
                } else if (analysisType === 'importance') {
                    // All positive for importance
                    return 'rgba(67, 97, 238, 0.7)';
                } else {
                    // For regression, use different colors for positive/negative
                    return value >= 0 ? 'rgba(67, 97, 238, 0.7)' : 'rgba(247, 37, 133, 0.7)';
                }
            });
            
            borderColor = data.map(value => {
                if (analysisType === 'correlation') {
                    return value >= 0 ? 'rgba(67, 97, 238, 1)' : 'rgba(247, 37, 133, 1)';
                } else if (analysisType === 'importance') {
                    // All positive for importance
                    return 'rgba(67, 97, 238, 1)';
                } else {
                    // For regression, use different colors for positive/negative
                    return value >= 0 ? 'rgba(67, 97, 238, 1)' : 'rgba(247, 37, 133, 1)';
                }
            });
            
            // Update chart data
            factorsChart.data.labels = labels;
            factorsChart.data.datasets[0].data = data;
            factorsChart.data.datasets[0].backgroundColor = backgroundColor;
            factorsChart.data.datasets[0].borderColor = borderColor;
            
            // Update chart title based on analysis type
            if (analysisType === 'correlation') {
                factorsChart.data.datasets[0].label = 'Correlation with CLV';
                factorsChart.options.scales.x.title.text = 'Correlation Coefficient';
                factorsChart.options.scales.x.min = -1;
                factorsChart.options.scales.x.max = 1;
            } else if (analysisType === 'importance') {
                factorsChart.data.datasets[0].label = 'Feature Importance';
                factorsChart.options.scales.x.title.text = 'Relative Importance';
                factorsChart.options.scales.x.min = 0;
                factorsChart.options.scales.x.max = 0.3;
            } else {
                factorsChart.data.datasets[0].label = 'Regression Coefficient';
                factorsChart.options.scales.x.title.text = 'Effect on CLV ($)';
                factorsChart.options.scales.x.min = -50;
                factorsChart.options.scales.x.max = 100;
            }
            
            factorsChart.update();
        }

        // Customer Segments Overview Chart
        const segmentOverviewCtx = document.getElementById('segmentOverviewChart').getContext('2d');
        const segmentOverviewChart = new Chart(segmentOverviewCtx, {
            type: 'doughnut',
            data: {
                labels: ['High Value (20%)', 'Mid Value (30%)', 'Low Value (50%)'],
                datasets: [{
                    label: 'Revenue Contribution',
                    data: [65, 25, 10],
                    backgroundColor: [
                        '#4361ee',
                        '#4cc9f0',
                        '#f72585'
                    ],
                    borderColor: [
                        '#3f37c9',
                        '#3a86ff',
                        '#e63946'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw;
                                const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${percentage}% of revenue`;
                            }
                        }
                    }
                }
            }
        });

        // Segment Details Chart (initially hidden)
        const segmentDetailsCtx = document.getElementById('segmentDetailsChart').getContext('2d');
        const segmentDetailsChart = new Chart(segmentDetailsCtx, {
            type: 'radar',
            data: {
                labels: [
                    'Purchase Frequency',
                    'Avg Order Value',
                    'Product Reviews',
                    'Email Engagement',
                    'Mobile App Usage',
                    'Loyalty Program'
                ],
                datasets: [{
                    label: 'High Value Segment',
                    data: [4.8, 4.5, 4.2, 4.7, 3.8, 4.6],
                    fill: true,
                    backgroundColor: 'rgba(67, 97, 238, 0.2)',
                    borderColor: 'rgb(67, 97, 238)',
                    pointBackgroundColor: 'rgb(67, 97, 238)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(67, 97, 238)'
                }]
            },
            options: {
                elements: {
                    line: {
                        borderWidth: 3
                    }
                },
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 5
                    }
                }
            }
        });

        // Update segment details chart when segment changes
        document.getElementById('segmentSelector').addEventListener('change', function() {
            const segment = this.value;
            let data, label;
            
            if (segment === 'high-value') {
                data = [4.8, 4.5, 4.2, 4.7, 3.8, 4.6];
                label = 'High Value Segment';
                segmentDetailsChart.data.datasets[0].backgroundColor = 'rgba(67, 97, 238, 0.2)';
                segmentDetailsChart.data.datasets[0].borderColor = 'rgb(67, 97, 238)';
                segmentDetailsChart.data.datasets[0].pointBackgroundColor = 'rgb(67, 97, 238)';
                segmentDetailsChart.data.datasets[0].pointHoverBorderColor = 'rgb(67, 97, 238)';
            } else if (segment === 'mid-value') {
                data = [3.2, 3.0, 2.8, 3.5, 2.5, 3.0];
                label = 'Mid Value Segment';
                segmentDetailsChart.data.datasets[0].backgroundColor = 'rgba(76, 201, 240, 0.2)';
                segmentDetailsChart.data.datasets[0].borderColor = 'rgb(76, 201, 240)';
                segmentDetailsChart.data.datasets[0].pointBackgroundColor = 'rgb(76, 201, 240)';
                segmentDetailsChart.data.datasets[0].pointHoverBorderColor = 'rgb(76, 201, 240)';
            } else {
                data = [1.5, 1.8, 1.2, 1.0, 0.8, 0.5];
                label = 'Low Value Segment';
                segmentDetailsChart.data.datasets[0].backgroundColor = 'rgba(247, 37, 133, 0.2)';
                segmentDetailsChart.data.datasets[0].borderColor = 'rgb(247, 37, 133)';
                segmentDetailsChart.data.datasets[0].pointBackgroundColor = 'rgb(247, 37, 133)';
                segmentDetailsChart.data.datasets[0].pointHoverBorderColor = 'rgb(247, 37, 133)';
            }
            
            segmentDetailsChart.data.datasets[0].data = data;
            segmentDetailsChart.data.datasets[0].label = label;
            segmentDetailsChart.update();
        });

        // Segment Comparison Chart
        const segmentComparisonCtx = document.getElementById('segmentComparisonChart').getContext('2d');
        const segmentComparisonChart = new Chart(segmentComparisonCtx, {
            type: 'bar',
            data: {
                labels: ['High Value', 'Mid Value', 'Low Value'],
                datasets: [{
                    label: 'Average Order Value ($)',
                    data: [125, 75, 45],
                    backgroundColor: [
                        '#4361ee',
                        '#4cc9f0',
                        '#f72585'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Average Order Value ($)'
                        }
                    }
                }
            }
        });

        // Update segment comparison chart when metric changes
        document.getElementById('compareMetric').addEventListener('change', function() {
            const metric = this.value;
            let data, label, yAxisLabel;
            
            if (metric === 'avg-order') {
                data = [125, 75, 45];
                label = 'Average Order Value ($)';
                yAxisLabel = 'Average Order Value ($)';
            } else if (metric === 'purchase-frequency') {
                data = [12.5, 5.8, 2.1];
                label = 'Purchase Frequency (per year)';
                yAxisLabel = 'Purchases per Year';
            } else if (metric === 'retention') {
                data = [85, 45, 22];
                label = 'Retention Rate (%)';
                yAxisLabel = 'Retention Rate (%)';
            } else if (metric === 'product-categories') {
                data = [4.8, 2.5, 1.2];
                label = 'Unique Product Categories';
                yAxisLabel = 'Avg. Categories Purchased';
            }
            
            segmentComparisonChart.data.datasets[0].data = data;
            segmentComparisonChart.data.datasets[0].label = label;
            segmentComparisonChart.options.scales.y.title.text = yAxisLabel;
            segmentComparisonChart.update();
        });

        // Upload Modal
        const uploadModal = document.getElementById('uploadModal');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressBar = uploadProgress.querySelector('.progress-bar');
        const progressText = uploadProgress.querySelector('.progress-text span:last-child');
        
        // Open modal from sidebar
        document.querySelector('.sidebar-menu-item:nth-child(2)').addEventListener('click', () => {
            uploadModal.classList.add('show');
        });
        
        // Close modal
        document.querySelector('.modal-close').addEventListener('click', () => {
            uploadModal.classList.remove('show');
        });
        
        document.getElementById('cancelUpload').addEventListener('click', () => {
            uploadModal.classList.remove('show');
        });
        
        // Click to browse files
        dropZone.addEventListener('click', () => {
            fileInput.click();
        });
        
        // Handle file selection
        fileInput.addEventListener('change', handleFileUpload);
        
        // Drag and drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#4361ee';
            dropZone.style.backgroundColor = 'rgba(67, 97, 238, 0.05)';
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '';
            dropZone.style.backgroundColor = '';
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '';
            dropZone.style.backgroundColor = '';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileUpload();
            }
        });
        
        // Start upload
        document.getElementById('startUpload').addEventListener('click', () => {
            if (fileInput.files.length) {
                simulateUpload();
            }
        });
        
        function handleFileUpload() {
            if (fileInput.files.length) {
                const fileName = fileInput.files[0].name;
                dropZone.querySelector('.upload-text').textContent = `Selected: ${fileName}`;
            }
        }
        
        function simulateUpload() {
            uploadProgress.style.display = 'block';
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 5;
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        uploadModal.classList.remove('show');
                        // Reset for next time
                        uploadProgress.style.display = 'none';
                        progressBar.style.width = '0%';
                        progressText.textContent = '0%';
                        dropZone.querySelector('.upload-text').textContent = 'Drag and drop your CSV file here';
                    }, 500);
                }
            }, 100);
        }

        // Close modal when clicking outside
        uploadModal.addEventListener('click', (e) => {
            if (e.target === uploadModal) {
                uploadModal.classList.remove('show');
            }
        });
    </script>
</body>
</html>