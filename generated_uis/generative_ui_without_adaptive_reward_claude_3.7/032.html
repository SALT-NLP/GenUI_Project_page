<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Event Poster Designer</title>
    <style>
        :root {
            --primary: #4a6bff;
            --secondary: #ff6b6b;
            --accent: #ffbe0b;
            --dark: #2d3748;
            --light: #f8f9fa;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #e53e3e;
            --text: #1a202c;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            background-color: white;
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 4px var(--shadow);
            z-index: 10;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-right: 20px;
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }

        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .tools-panel {
            width: 240px;
            background: white;
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 16px;
        }

        .canvas-container {
            flex: 1;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
            position: relative;
        }

        .properties-panel {
            width: 280px;
            background: white;
            border-left: 1px solid var(--border);
            overflow-y: auto;
            padding: 16px;
        }

        .canvas {
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--dark);
        }

        .tool-section {
            margin-bottom: 24px;
        }

        .tool-section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .tool-section-title .toggle {
            font-size: 12px;
            color: var(--primary);
            cursor: pointer;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .tool-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--light);
            border-radius: 8px;
            padding: 12px 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-item:hover {
            background: rgba(74, 107, 255, 0.1);
        }

        .tool-item.active {
            background: rgba(74, 107, 255, 0.2);
        }

        .tool-icon {
            font-size: 20px;
            margin-bottom: 6px;
            color: var(--primary);
        }

        .tool-name {
            font-size: 12px;
            font-weight: 500;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .template-item {
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            box-shadow: 0 2px 4px var(--shadow);
        }

        .template-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow);
        }

        .template-item img {
            width: 100%;
            height: auto;
            display: block;
        }

        .template-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 6px;
            font-size: 12px;
            text-align: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--light);
            color: var(--dark);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #e2e6ea;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #3a5bef;
        }

        .btn-icon {
            margin-right: 6px;
            font-size: 16px;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .property-row {
            display: flex;
            margin-bottom: 12px;
            align-items: center;
        }

        .property-label {
            width: 80px;
            font-size: 13px;
            color: var(--dark);
        }

        .property-value {
            flex: 1;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 13px;
            transition: border 0.2s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary);
            outline: none;
        }

        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .color-option.active {
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary);
        }

        .font-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .font-option {
            padding: 6px;
            border: 1px solid var(--border);
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .font-option:hover {
            border-color: var(--primary);
        }

        .font-option.active {
            border-color: var(--primary);
            background: rgba(74, 107, 255, 0.1);
        }

        .canvas-element {
            position: absolute;
            cursor: move;
            border: 1px solid transparent;
        }

        .canvas-element.selected {
            border: 1px dashed var(--primary);
        }

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border: 1px solid var(--primary);
            border-radius: 50%;
        }

        .handle-nw {
            top: -5px;
            left: -5px;
            cursor: nw-resize;
        }

        .handle-ne {
            top: -5px;
            right: -5px;
            cursor: ne-resize;
        }

        .handle-sw {
            bottom: -5px;
            left: -5px;
            cursor: sw-resize;
        }

        .handle-se {
            bottom: -5px;
            right: -5px;
            cursor: se-resize;
        }

        .text-element {
            padding: 8px;
            min-width: 50px;
            min-height: 30px;
        }

        .image-element img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .shape-element {
            min-width: 50px;
            min-height: 50px;
        }

        .footer {
            height: 50px;
            background-color: white;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
        }

        .footer-actions {
            display: flex;
            gap: 10px;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .zoom-value {
            font-size: 14px;
            font-weight: 500;
            min-width: 40px;
            text-align: center;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            padding: 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark);
        }

        .template-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .template-category {
            padding: 8px 16px;
            background: var(--light);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .template-category.active {
            background: var(--primary);
            color: white;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .tooltip {
            position: absolute;
            background: var(--dark);
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .tooltip.visible {
            opacity: 1;
        }

        /* Material Icons */
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        @media (max-width: 1200px) {
            .properties-panel, .tools-panel {
                width: 220px;
            }
        }

        @media (max-width: 992px) {
            .tools-panel {
                width: 60px;
            }
            
            .tool-name, .panel-title, .tool-section-title {
                display: none;
            }
            
            .tool-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .properties-panel {
                position: fixed;
                right: 0;
                top: 60px;
                bottom: 50px;
                transform: translateX(100%);
                transition: transform 0.3s;
                z-index: 10;
            }
            
            .properties-panel.active {
                transform: translateX(0);
            }
            
            .properties-toggle {
                display: block;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">Poster Designer</div>
        <div class="header-actions">
            <button class="btn" id="templateBtn">
                <i class="material-icons btn-icon">collections</i>
                Templates
            </button>
            <button class="btn btn-primary" id="exportBtn">
                <i class="material-icons btn-icon">file_download</i>
                Export
            </button>
        </div>
    </header>
    
    <main>
        <aside class="tools-panel">
            <h3 class="panel-title">Design Tools</h3>
            
            <div class="tool-section">
                <div class="tool-section-title">
                    <span>Add Elements</span>
                    <span class="toggle">+</span>
                </div>
                <div class="tool-grid">
                    <div class="tool-item" data-tool="text">
                        <i class="material-icons tool-icon">text_fields</i>
                        <span class="tool-name">Text</span>
                    </div>
                    <div class="tool-item" data-tool="image">
                        <i class="material-icons tool-icon">image</i>
                        <span class="tool-name">Image</span>
                    </div>
                    <div class="tool-item" data-tool="shape">
                        <i class="material-icons tool-icon">category</i>
                        <span class="tool-name">Shape</span>
                    </div>
                    <div class="tool-item" data-tool="background">
                        <i class="material-icons tool-icon">format_color_fill</i>
                        <span class="tool-name">Background</span>
                    </div>
                </div>
            </div>
            
            <div class="tool-section">
                <div class="tool-section-title">
                    <span>Templates</span>
                </div>
                <div class="template-grid">
                    <div class="template-item" data-template="event1">
                        <img src="https://placehold.co/200x280/4a6bff/ffffff?text=Event" alt="Event Template">
                        <div class="template-name">Event</div>
                    </div>
                    <div class="template-item" data-template="event2">
                        <img src="https://placehold.co/200x280/ff6b6b/ffffff?text=Festival" alt="Festival Template">
                        <div class="template-name">Festival</div>
                    </div>
                    <div class="template-item" data-template="event3">
                        <img src="https://placehold.co/200x280/48bb78/ffffff?text=Workshop" alt="Workshop Template">
                        <div class="template-name">Workshop</div>
                    </div>
                    <div class="template-item" data-template="event4">
                        <img src="https://placehold.co/200x280/ed8936/ffffff?text=Meetup" alt="Meetup Template">
                        <div class="template-name">Meetup</div>
                    </div>
                </div>
            </div>
        </aside>
        
        <div class="canvas-container">
            <div class="canvas" id="designCanvas" style="width: 600px; height: 800px;">
                <!-- Canvas elements will be added here dynamically -->
            </div>
        </div>
        
        <aside class="properties-panel" id="propertiesPanel">
            <h3 class="panel-title">Properties</h3>
            
            <div class="property-group" id="textProperties" style="display: none;">
                <div class="property-title">Text Properties</div>
                
                <div class="property-row">
                    <div class="property-label">Content</div>
                    <div class="property-value">
                        <textarea id="textContent" rows="3"></textarea>
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Font</div>
                    <div class="property-value">
                        <select id="fontFamily">
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                            <option value="'Segoe UI', sans-serif">Segoe UI</option>
                            <option value="'Roboto', sans-serif">Roboto</option>
                            <option value="'Open Sans', sans-serif">Open Sans</option>
                            <option value="'Montserrat', sans-serif">Montserrat</option>
                        </select>
                        
                        <div class="font-options">
                            <div class="font-option" data-weight="normal">Normal</div>
                            <div class="font-option" data-weight="bold">Bold</div>
                            <div class="font-option" data-style="italic">Italic</div>
                            <div class="font-option" data-decoration="underline">Underline</div>
                        </div>
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Size</div>
                    <div class="property-value">
                        <input type="number" id="fontSize" min="8" max="120" value="16">
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Color</div>
                    <div class="property-value">
                        <div class="color-picker" id="textColorPicker">
                            <div class="color-option" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-option" style="background-color: #ffffff;" data-color="#ffffff"></div>
                            <div class="color-option" style="background-color: #4a6bff;" data-color="#4a6bff"></div>
                            <div class="color-option" style="background-color: #ff6b6b;" data-color="#ff6b6b"></div>
                            <div class="color-option" style="background-color: #ffbe0b;" data-color="#ffbe0b"></div>
                            <div class="color-option" style="background-color: #48bb78;" data-color="#48bb78"></div>
                            <div class="color-option" style="background-color: #ed8936;" data-color="#ed8936"></div>
                            <div class="color-option" style="background-color: #e53e3e;" data-color="#e53e3e"></div>
                        </div>
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Alignment</div>
                    <div class="property-value" style="display: flex; gap: 8px;">
                        <button class="btn" data-align="left">
                            <i class="material-icons">format_align_left</i>
                        </button>
                        <button class="btn" data-align="center">
                            <i class="material-icons">format_align_center</i>
                        </button>
                        <button class="btn" data-align="right">
                            <i class="material-icons">format_align_right</i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="property-group" id="imageProperties" style="display: none;">
                <div class="property-title">Image Properties</div>
                
                <div class="property-row">
                    <div class="property-label">Source</div>
                    <div class="property-value">
                        <input type="file" id="imageUpload" accept="image/*">
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Size</div>
                    <div class="property-value" style="display: flex; gap: 8px;">
                        <input type="number" id="imageWidth" placeholder="Width">
                        <input type="number" id="imageHeight" placeholder="Height">
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Border</div>
                    <div class="property-value">
                        <input type="number" id="imageBorder" min="0" max="20" value="0">
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Border Color</div>
                    <div class="property-value">
                        <div class="color-picker" id="imageBorderColorPicker">
                            <div class="color-option" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-option" style="background-color: #ffffff;" data-color="#ffffff"></div>
                            <div class="color-option" style="background-color: #4a6bff;" data-color="#4a6bff"></div>
                            <div class="color-option" style="background-color: #ff6b6b;" data-color="#ff6b6b"></div>
                            <div class="color-option" style="background-color: #ffbe0b;" data-color="#ffbe0b"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="property-group" id="shapeProperties" style="display: none;">
                <div class="property-title">Shape Properties</div>
                
                <div class="property-row">
                    <div class="property-label">Type</div>
                    <div class="property-value">
                        <select id="shapeType">
                            <option value="rectangle">Rectangle</option>
                            <option value="circle">Circle</option>
                            <option value="triangle">Triangle</option>
                            <option value="star">Star</option>
                        </select>
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Size</div>
                    <div class="property-value" style="display: flex; gap: 8px;">
                        <input type="number" id="shapeWidth" placeholder="Width">
                        <input type="number" id="shapeHeight" placeholder="Height">
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Fill Color</div>
                    <div class="property-value">
                        <div class="color-picker" id="shapeFillColorPicker">
                            <div class="color-option" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-option" style="background-color: #ffffff;" data-color="#ffffff"></div>
                            <div class="color-option" style="background-color: #4a6bff;" data-color="#4a6bff"></div>
                            <div class="color-option" style="background-color: #ff6b6b;" data-color="#ff6b6b"></div>
                            <div class="color-option" style="background-color: #ffbe0b;" data-color="#ffbe0b"></div>
                            <div class="color-option" style="background-color: #48bb78;" data-color="#48bb78"></div>
                            <div class="color-option" style="background-color: #ed8936;" data-color="#ed8936"></div>
                            <div class="color-option" style="background-color: #e53e3e;" data-color="#e53e3e"></div>
                        </div>
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Border</div>
                    <div class="property-value">
                        <input type="number" id="shapeBorder" min="0" max="20" value="0">
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Border Color</div>
                    <div class="property-value">
                        <div class="color-picker" id="shapeBorderColorPicker">
                            <div class="color-option" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-option" style="background-color: #ffffff;" data-color="#ffffff"></div>
                            <div class="color-option" style="background-color: #4a6bff;" data-color="#4a6bff"></div>
                            <div class="color-option" style="background-color: #ff6b6b;" data-color="#ff6b6b"></div>
                            <div class="color-option" style="background-color: #ffbe0b;" data-color="#ffbe0b"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="property-group" id="canvasProperties">
                <div class="property-title">Poster Properties</div>
                
                <div class="property-row">
                    <div class="property-label">Size</div>
                    <div class="property-value" style="display: flex; gap: 8px;">
                        <input type="number" id="canvasWidth" value="600">
                        <input type="number" id="canvasHeight" value="800">
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Background</div>
                    <div class="property-value">
                        <div class="color-picker" id="canvasBgColorPicker">
                            <div class="color-option" style="background-color: #ffffff;" data-color="#ffffff"></div>
                            <div class="color-option" style="background-color: #f0f2f5;" data-color="#f0f2f5"></div>
                            <div class="color-option" style="background-color: #4a6bff;" data-color="#4a6bff"></div>
                            <div class="color-option" style="background-color: #ff6b6b;" data-color="#ff6b6b"></div>
                            <div class="color-option" style="background-color: #ffbe0b;" data-color="#ffbe0b"></div>
                            <div class="color-option" style="background-color: #48bb78;" data-color="#48bb78"></div>
                            <div class="color-option" style="background-color: #ed8936;" data-color="#ed8936"></div>
                            <div class="color-option" style="background-color: #e53e3e;" data-color="#e53e3e"></div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>
    
    <footer class="footer">
        <div class="footer-actions">
            <button class="btn" id="undoBtn">
                <i class="material-icons">undo</i>
            </button>
            <button class="btn" id="redoBtn">
                <i class="material-icons">redo</i>
            </button>
        </div>
        
        <div class="zoom-controls">
            <button class="btn" id="zoomOutBtn">
                <i class="material-icons">remove</i>
            </button>
            <span class="zoom-value" id="zoomValue">100%</span>
            <button class="btn" id="zoomInBtn">
                <i class="material-icons">add</i>
            </button>
        </div>
        
        <div class="footer-actions">
            <button class="btn" id="propertiesToggle">
                <i class="material-icons">settings</i>
            </button>
            <button class="btn" id="deleteBtn">
                <i class="material-icons">delete</i>
            </button>
        </div>
    </footer>
    
    <!-- Template Modal -->
    <div class="modal" id="templateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Choose a Template</h3>
                <button class="modal-close" id="closeTemplateModal">&times;</button>
            </div>
            
            <div class="template-categories">
                <div class="template-category active" data-category="all">All</div>
                <div class="template-category" data-category="event">Events</div>
                <div class="template-category" data-category="festival">Festivals</div>
                <div class="template-category" data-category="workshop">Workshops</div>
                <div class="template-category" data-category="meetup">Meetups</div>
                <div class="template-category" data-category="concert">Concerts</div>
            </div>
            
            <div class="templates-grid">
                <div class="template-item" data-template="event1">
                    <img src="https://placehold.co/300x400/4a6bff/ffffff?text=Community+Event" alt="Community Event">
                    <div class="template-name">Community Event</div>
                </div>
                <div class="template-item" data-template="festival1">
                    <img src="https://placehold.co/300x400/ff6b6b/ffffff?text=Summer+Festival" alt="Summer Festival">
                    <div class="template-name">Summer Festival</div>
                </div>
                <div class="template-item" data-template="workshop1">
                    <img src="https://placehold.co/300x400/48bb78/ffffff?text=Workshop" alt="Workshop">
                    <div class="template-name">Workshop</div>
                </div>
                <div class="template-item" data-template="meetup1">
                    <img src="https://placehold.co/300x400/ed8936/ffffff?text=Tech+Meetup" alt="Tech Meetup">
                    <div class="template-name">Tech Meetup</div>
                </div>
                <div class="template-item" data-template="concert1">
                    <img src="https://placehold.co/300x400/e53e3e/ffffff?text=Concert" alt="Concert">
                    <div class="template-name">Concert</div>
                </div>
                <div class="template-item" data-template="event2">
                    <img src="https://placehold.co/300x400/4a6bff/ffffff?text=Charity+Event" alt="Charity Event">
                    <div class="template-name">Charity Event</div>
                </div>
                <div class="template-item" data-template="festival2">
                    <img src="https://placehold.co/300x400/ff6b6b/ffffff?text=Food+Festival" alt="Food Festival">
                    <div class="template-name">Food Festival</div>
                </div>
                <div class="template-item" data-template="workshop2">
                    <img src="https://placehold.co/300x400/48bb78/ffffff?text=Art+Workshop" alt="Art Workshop">
                    <div class="template-name">Art Workshop</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Export Poster</h3>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            
            <div class="property-group">
                <div class="property-row">
                    <div class="property-label">Format</div>
                    <div class="property-value">
                        <select id="exportFormat">
                            <option value="png">PNG Image</option>
                            <option value="jpg">JPG Image</option>
                            <option value="pdf">PDF Document</option>
                        </select>
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">Quality</div>
                    <div class="property-value">
                        <select id="exportQuality">
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                
                <div class="property-row">
                    <div class="property-label">File Name</div>
                    <div class="property-value">
                        <input type="text" id="exportFileName" value="community-event-poster">
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" id="downloadBtn">
                    <i class="material-icons btn-icon">file_download</i>
                    Download
                </button>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // State management
        const state = {
            canvas: {
                width: 600,
                height: 800,
                backgroundColor: '#ffffff',
                zoom: 1
            },
            elements: [],
            selectedElement: null,
            history: [],
            historyIndex: -1,
            activeTool: null
        };
        
        // DOM Elements
        const canvas = document.getElementById('designCanvas');
        const propertiesPanel = document.getElementById('propertiesPanel');
        const textProperties = document.getElementById('textProperties');
        const imageProperties = document.getElementById('imageProperties');
        const shapeProperties = document.getElementById('shapeProperties');
        const canvasProperties = document.getElementById('canvasProperties');
        const templateModal = document.getElementById('templateModal');
        const exportModal = document.getElementById('exportModal');
        const tooltip = document.getElementById('tooltip');
        
        // Tool buttons
        const toolButtons = document.querySelectorAll('.tool-item');
        const templateButtons = document.querySelectorAll('.template-item');
        const templateBtn = document.getElementById('templateBtn');
        const exportBtn = document.getElementById('exportBtn');
        const closeTemplateModal = document.getElementById('closeTemplateModal');
        const closeExportModal = document.getElementById('closeExportModal');
        const undoBtn = document.getElementById('undoBtn');
        const redoBtn = document.getElementById('redoBtn');
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');
        const zoomValue = document.getElementById('zoomValue');
        const propertiesToggle = document.getElementById('propertiesToggle');
        const deleteBtn = document.getElementById('deleteBtn');
        
        // Initialize
        function init() {
            // Set up event listeners
            setupEventListeners();
            
            // Initialize canvas
            updateCanvas();
            
            // Add default template
            loadTemplate('event1');
            
            // Save initial state
            saveState();
        }
        
        // Event listeners
        function setupEventListeners() {
            // Tool selection
            toolButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tool = button.dataset.tool;
                    setActiveTool(tool);
                });
                
                // Tooltip for tools
                button.addEventListener('mouseenter', (e) => {
                    showTooltip(button.querySelector('.tool-name').textContent, e);
                });
                
                button.addEventListener('mouseleave', () => {
                    hideTooltip();
                });
            });
            
            // Template selection
            templateButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const template = button.dataset.template;
                    loadTemplate(template);
                });
            });
            
            // Canvas properties
            document.getElementById('canvasWidth').addEventListener('change', (e) => {
                state.canvas.width = parseInt(e.target.value);
                updateCanvas();
                saveState();
            });
            
            document.getElementById('canvasHeight').addEventListener('change', (e) => {
                state.canvas.height = parseInt(e.target.value);
                updateCanvas();
                saveState();
            });
            
            // Canvas background color
            const bgColorOptions = document.querySelectorAll('#canvasBgColorPicker .color-option');
            bgColorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const color = option.dataset.color;
                    state.canvas.backgroundColor = color;
                    canvas.style.backgroundColor = color;
                    
                    // Update active class
                    bgColorOptions.forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    
                    saveState();
                });
            });
            
            // Text properties
            document.getElementById('textContent').addEventListener('input', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'text') {
                    state.selectedElement.content = e.target.value;
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            document.getElementById('fontFamily').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'text') {
                    state.selectedElement.fontFamily = e.target.value;
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            document.getElementById('fontSize').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'text') {
                    state.selectedElement.fontSize = parseInt(e.target.value);
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            // Text color
            const textColorOptions = document.querySelectorAll('#textColorPicker .color-option');
            textColorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    if (state.selectedElement && state.selectedElement.type === 'text') {
                        const color = option.dataset.color;
                        state.selectedElement.color = color;
                        updateElement(state.selectedElement);
                        
                        // Update active class
                        textColorOptions.forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        
                        saveState();
                    }
                });
            });
            
            // Text alignment
            const alignButtons = document.querySelectorAll('[data-align]');
            alignButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (state.selectedElement && state.selectedElement.type === 'text') {
                        const align = button.dataset.align;
                        state.selectedElement.textAlign = align;
                        updateElement(state.selectedElement);
                        saveState();
                    }
                });
            });
            
            // Font options
            const fontOptions = document.querySelectorAll('.font-option');
            fontOptions.forEach(option => {
                option.addEventListener('click', () => {
                    if (state.selectedElement && state.selectedElement.type === 'text') {
                        if (option.dataset.weight) {
                            state.selectedElement.fontWeight = option.dataset.weight;
                        }
                        if (option.dataset.style) {
                            state.selectedElement.fontStyle = option.dataset.style;
                        }
                        if (option.dataset.decoration) {
                            state.selectedElement.textDecoration = option.dataset.decoration;
                        }
                        
                        // Toggle active class
                        option.classList.toggle('active');
                        
                        updateElement(state.selectedElement);
                        saveState();
                    }
                });
            });
            
            // Image upload
            document.getElementById('imageUpload').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'image') {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            state.selectedElement.src = event.target.result;
                            updateElement(state.selectedElement);
                            saveState();
                        };
                        reader.readAsDataURL(file);
                    }
                }
            });
            
            // Image properties
            document.getElementById('imageWidth').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'image') {
                    state.selectedElement.width = parseInt(e.target.value);
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            document.getElementById('imageHeight').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'image') {
                    state.selectedElement.height = parseInt(e.target.value);
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            document.getElementById('imageBorder').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'image') {
                    state.selectedElement.borderWidth = parseInt(e.target.value);
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            // Image border color
            const imageBorderColorOptions = document.querySelectorAll('#imageBorderColorPicker .color-option');
            imageBorderColorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    if (state.selectedElement && state.selectedElement.type === 'image') {
                        const color = option.dataset.color;
                        state.selectedElement.borderColor = color;
                        updateElement(state.selectedElement);
                        
                        // Update active class
                        imageBorderColorOptions.forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        
                        saveState();
                    }
                });
            });
            
            // Shape properties
            document.getElementById('shapeType').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'shape') {
                    state.selectedElement.shapeType = e.target.value;
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            document.getElementById('shapeWidth').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'shape') {
                    state.selectedElement.width = parseInt(e.target.value);
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            document.getElementById('shapeHeight').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'shape') {
                    state.selectedElement.height = parseInt(e.target.value);
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            document.getElementById('shapeBorder').addEventListener('change', (e) => {
                if (state.selectedElement && state.selectedElement.type === 'shape') {
                    state.selectedElement.borderWidth = parseInt(e.target.value);
                    updateElement(state.selectedElement);
                    saveState();
                }
            });
            
            // Shape fill color
            const shapeFillColorOptions = document.querySelectorAll('#shapeFillColorPicker .color-option');
            shapeFillColorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    if (state.selectedElement && state.selectedElement.type === 'shape') {
                        const color = option.dataset.color;
                        state.selectedElement.fillColor = color;
                        updateElement(state.selectedElement);
                        
                        // Update active class
                        shapeFillColorOptions.forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        
                        saveState();
                    }
                });
            });
            
            // Shape border color
            const shapeBorderColorOptions = document.querySelectorAll('#shapeBorderColorPicker .color-option');
            shapeBorderColorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    if (state.selectedElement && state.selectedElement.type === 'shape') {
                        const color = option.dataset.color;
                        state.selectedElement.borderColor = color;
                        updateElement(state.selectedElement);
                        
                        // Update active class
                        shapeBorderColorOptions.forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        
                        saveState();
                    }
                });
            });
            
            // Template modal
            templateBtn.addEventListener('click', () => {
                templateModal.classList.add('active');
            });
            
            closeTemplateModal.addEventListener('click', () => {
                templateModal.classList.remove('active');
            });
            
            // Export modal
            exportBtn.addEventListener('click', () => {
                exportModal.classList.add('active');
            });
            
            closeExportModal.addEventListener('click', () => {
                exportModal.classList.remove('active');
            });
            
            document.getElementById('downloadBtn').addEventListener('click', () => {
                // Implement export functionality
                alert('Poster downloaded successfully!');
                exportModal.classList.remove('active');
            });
            
            // Template categories
            const templateCategories = document.querySelectorAll('.template-category');
            templateCategories.forEach(category => {
                category.addEventListener('click', () => {
                    const categoryValue = category.dataset.category;
                    
                    // Update active class
                    templateCategories.forEach(c => c.classList.remove('active'));
                    category.classList.add('active');
                    
                    // Filter templates
                    // Implementation would filter the templates based on category
                });
            });
            
            // Undo/Redo
            undoBtn.addEventListener('click', undo);
            redoBtn.addEventListener('click', redo);
            
            // Zoom controls
            zoomInBtn.addEventListener('click', zoomIn);
            zoomOutBtn.addEventListener('click', zoomOut);
            
            // Properties panel toggle
            propertiesToggle.addEventListener('click', () => {
                propertiesPanel.classList.toggle('active');
            });
            
            // Delete element
            deleteBtn.addEventListener('click', deleteSelectedElement);
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === templateModal) {
                    templateModal.classList.remove('active');
                }
                
                if (e.target === exportModal) {
                    exportModal.classList.remove('active');
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Delete key
                if (e.key === 'Delete' && state.selectedElement) {
                    deleteSelectedElement();
                }
                
                // Undo: Ctrl+Z
                if (e.key === 'z' && (e.ctrlKey || e.metaKey)) {
                    undo();
                    e.preventDefault();
                }
                
                // Redo: Ctrl+Y or Ctrl+Shift+Z
                if ((e.key === 'y' && (e.ctrlKey || e.metaKey)) || 
                    (e.key === 'z' && (e.ctrlKey || e.metaKey) && e.shiftKey)) {
                    redo();
                    e.preventDefault();
                }
            });
        }
        
        // Set active tool
        function setActiveTool(tool) {
            state.activeTool = tool;
            
            // Update UI
            toolButtons.forEach(button => {
                button.classList.remove('active');
                if (button.dataset.tool === tool) {
                    button.classList.add('active');
                }
            });
            
            // Add new element based on tool
            if (tool === 'text') {
                addTextElement();
            } else if (tool === 'image') {
                // Trigger file upload
                document.getElementById('imageUpload').click();
            } else if (tool === 'shape') {
                addShapeElement();
            } else if (tool === 'background') {
                // Focus on background properties
                // This just highlights the canvas properties panel
            }
        }
        
        // Add text element
        function addTextElement() {
            const element = {
                id: generateId(),
                type: 'text',
                content: 'Double-click to edit text',
                x: 100,
                y: 100,
                width: 200,
                height: 50,
                fontFamily: 'Arial, sans-serif',
                fontSize: 16,
                fontWeight: 'normal',
                fontStyle: 'normal',
                textDecoration: 'none',
                color: '#000000',
                textAlign: 'left'
            };
            
            state.elements.push(element);
            renderElement(element);
            selectElement(element);
            saveState();
        }
        
        // Add image element
        function addImageElement(src) {
            const element = {
                id: generateId(),
                type: 'image',
                src: src || 'https://placehold.co/300x200/cccccc/666666?text=Select+Image',
                x: 100,
                y: 100,
                width: 200,
                height: 150,
                borderWidth: 0,
                borderColor: '#000000'
            };
            
            state.elements.push(element);
            renderElement(element);
            selectElement(element);
            saveState();
        }
        
        // Add shape element
        function addShapeElement() {
            const element = {
                id: generateId(),
                type: 'shape',
                shapeType: 'rectangle',
                x: 100,
                y: 100,
                width: 100,
                height: 100,
                fillColor: '#4a6bff',
                borderWidth: 0,
                borderColor: '#000000'
            };
            
            state.elements.push(element);
            renderElement(element);
            selectElement(element);
            saveState();
        }
        
        // Render element
        function renderElement(element) {
            let el;
            
            // Check if element already exists
            const existingEl = document.getElementById(`element-${element.id}`);
            if (existingEl) {
                el = existingEl;
            } else {
                el = document.createElement('div');
                el.id = `element-${element.id}`;
                el.classList.add('canvas-element');
                
                // Add event listeners
                el.addEventListener('mousedown', (e) => {
                    if (e.target === el || e.target.parentNode === el) {
                        selectElement(element);
                        startDrag(e, element);
                    }
                });
                
                // Double click to edit text
                if (element.type === 'text') {
                    el.addEventListener('dblclick', () => {
                        const input = document.createElement('textarea');
                        input.value = element.content;
                        input.style.width = '100%';
                        input.style.height = '100%';
                        input.style.border = 'none';
                        input.style.outline = 'none';
                        input.style.resize = 'none';
                        input.style.background = 'transparent';
                        input.style.fontFamily = element.fontFamily;
                        input.style.fontSize = `${element.fontSize}px`;
                        input.style.color = element.color;
                        input.style.textAlign = element.textAlign;
                        input.style.fontWeight = element.fontWeight;
                        input.style.fontStyle = element.fontStyle;
                        input.style.textDecoration = element.textDecoration;
                        
                        el.innerHTML = '';
                        el.appendChild(input);
                        input.focus();
                        
                        input.addEventListener('blur', () => {
                            element.content = input.value;
                            updateElement(element);
                            saveState();
                        });
                        
                        input.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' && !e.shiftKey) {
                                input.blur();
                                e.preventDefault();
                            }
                        });
                    });
                }
                
                canvas.appendChild(el);
            }
            
            // Set position and size
            el.style.left = `${element.x}px`;
            el.style.top = `${element.y}px`;
            el.style.width = `${element.width}px`;
            el.style.height = `${element.height}px`;
            
            // Set content based on type
            if (element.type === 'text') {
                el.classList.add('text-element');
                el.innerHTML = element.content;
                el.style.fontFamily = element.fontFamily;
                el.style.fontSize = `${element.fontSize}px`;
                el.style.color = element.color;
                el.style.textAlign = element.textAlign;
                el.style.fontWeight = element.fontWeight;
                el.style.fontStyle = element.fontStyle;
                el.style.textDecoration = element.textDecoration;
            } else if (element.type === 'image') {
                el.classList.add('image-element');
                
                // Check if image already exists
                let img = el.querySelector('img');
                if (!img) {
                    img = document.createElement('img');
                    el.innerHTML = '';
                    el.appendChild(img);
                }
                
                img.src = element.src;
                el.style.borderWidth = `${element.borderWidth}px`;
                el.style.borderStyle = element.borderWidth > 0 ? 'solid' : 'none';
                el.style.borderColor = element.borderColor;
            } else if (element.type === 'shape') {
                el.classList.add('shape-element');
                
                // Render shape based on type
                if (element.shapeType === 'rectangle') {
                    el.style.backgroundColor = element.fillColor;
                    el.style.borderWidth = `${element.borderWidth}px`;
                    el.style.borderStyle = element.borderWidth > 0 ? 'solid' : 'none';
                    el.style.borderColor = element.borderColor;
                } else if (element.shapeType === 'circle') {
                    el.style.backgroundColor = element.fillColor;
                    el.style.borderWidth = `${element.borderWidth}px`;
                    el.style.borderStyle = element.borderWidth > 0 ? 'solid' : 'none';
                    el.style.borderColor = element.borderColor;
                    el.style.borderRadius = '50%';
                } else if (element.shapeType === 'triangle') {
                    el.style.width = '0';
                    el.style.height = '0';
                    el.style.borderLeft = `${element.width / 2}px solid transparent`;
                    el.style.borderRight = `${element.width / 2}px solid transparent`;
                    el.style.borderBottom = `${element.height}px solid ${element.fillColor}`;
                    el.style.backgroundColor = 'transparent';
                }
            }
            
            return el;
        }
        
        // Update element
        function updateElement(element) {
            renderElement(element);
            
            // Update property panel values
            if (element.type === 'text') {
                document.getElementById('textContent').value = element.content;
                document.getElementById('fontFamily').value = element.fontFamily;
                document.getElementById('fontSize').value = element.fontSize;
                
                // Update color picker active state
                const textColorOptions = document.querySelectorAll('#textColorPicker .color-option');
                textColorOptions.forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.color === element.color) {
                        option.classList.add('active');
                    }
                });
                
                // Update font options active state
                const fontOptions = document.querySelectorAll('.font-option');
                fontOptions.forEach(option => {
                    option.classList.remove('active');
                    
                    if (option.dataset.weight && option.dataset.weight === element.fontWeight) {
                        option.classList.add('active');
                    }
                    
                    if (option.dataset.style && option.dataset.style === element.fontStyle) {
                        option.classList.add('active');
                    }
                    
                    if (option.dataset.decoration && option.dataset.decoration === element.textDecoration) {
                        option.classList.add('active');
                    }
                });
            } else if (element.type === 'image') {
                document.getElementById('imageWidth').value = element.width;
                document.getElementById('imageHeight').value = element.height;
                document.getElementById('imageBorder').value = element.borderWidth;
                
                // Update color picker active state
                const imageBorderColorOptions = document.querySelectorAll('#imageBorderColorPicker .color-option');
                imageBorderColorOptions.forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.color === element.borderColor) {
                        option.classList.add('active');
                    }
                });
            } else if (element.type === 'shape') {
                document.getElementById('shapeType').value = element.shapeType;
                document.getElementById('shapeWidth').value = element.width;
                document.getElementById('shapeHeight').value = element.height;
                document.getElementById('shapeBorder').value = element.borderWidth;
                
                // Update color picker active state
                const shapeFillColorOptions = document.querySelectorAll('#shapeFillColorPicker .color-option');
                shapeFillColorOptions.forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.color === element.fillColor) {
                        option.classList.add('active');
                    }
                });
                
                const shapeBorderColorOptions = document.querySelectorAll('#shapeBorderColorPicker .color-option');
                shapeBorderColorOptions.forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.color === element.borderColor) {
                        option.classList.add('active');
                    }
                });
            }
        }
        
        // Select element
        function selectElement(element) {
            // Deselect previous element
            if (state.selectedElement) {
                const previousEl = document.getElementById(`element-${state.selectedElement.id}`);
                if (previousEl) {
                    previousEl.classList.remove('selected');
                    
                    // Remove resize handles
                    const handles = previousEl.querySelectorAll('.resize-handle');
                    handles.forEach(handle => handle.remove());
                }
            }
            
            state.selectedElement = element;
            
            if (element) {
                const el = document.getElementById(`element-${element.id}`);
                el.classList.add('selected');
                
                // Add resize handles
                addResizeHandles(el, element);
                
                // Show appropriate properties panel
                textProperties.style.display = 'none';
                imageProperties.style.display = 'none';
                shapeProperties.style.display = 'none';
                
                if (element.type === 'text') {
                    textProperties.style.display = 'block';
                } else if (element.type === 'image') {
                    imageProperties.style.display = 'block';
                } else if (element.type === 'shape') {
                    shapeProperties.style.display = 'block';
                }
                
                // Update property values
                updateElement(element);
                
                // Show properties panel on mobile
                propertiesPanel.classList.add('active');
            } else {
                // Hide all property panels
                textProperties.style.display = 'none';
                imageProperties.style.display = 'none';
                shapeProperties.style.display = 'none';
            }
        }
        
        // Add resize handles
        function addResizeHandles(el, element) {
            const positions = ['nw', 'ne', 'sw', 'se'];
            
            positions.forEach(pos => {
                const handle = document.createElement('div');
                handle.classList.add('resize-handle', `handle-${pos}`);
                
                handle.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    startResize(e, element, pos);
                });
                
                el.appendChild(handle);
            });
        }
        
        // Start drag
        function startDrag(e, element) {
            e.preventDefault();
            
            const startX = e.clientX;
            const startY = e.clientY;
            const startLeft = element.x;
            const startTop = element.y;
            
            function mousemove(e) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                element.x = startLeft + dx;
                element.y = startTop + dy;
                
                updateElement(element);
            }
            
            function mouseup() {
                document.removeEventListener('mousemove', mousemove);
                document.removeEventListener('mouseup', mouseup);
                saveState();
            }
            
            document.addEventListener('mousemove', mousemove);
            document.addEventListener('mouseup', mouseup);
        }
        
        // Start resize
        function startResize(e, element, position) {
            e.preventDefault();
            
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = element.width;
            const startHeight = element.height;
            const startLeft = element.x;
            const startTop = element.y;
            
            function mousemove(e) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                if (position.includes('e')) {
                    element.width = Math.max(50, startWidth + dx);
                }
                
                if (position.includes('s')) {
                    element.height = Math.max(30, startHeight + dy);
                }
                
                if (position.includes('w')) {
                    const newWidth = Math.max(50, startWidth - dx);
                    element.x = startLeft + startWidth - newWidth;
                    element.width = newWidth;
                }
                
                if (position.includes('n')) {
                    const newHeight = Math.max(30, startHeight - dy);
                    element.y = startTop + startHeight - newHeight;
                    element.height = newHeight;
                }
                
                updateElement(element);
            }
            
            function mouseup() {
                document.removeEventListener('mousemove', mousemove);
                document.removeEventListener('mouseup', mouseup);
                saveState();
            }
            
            document.addEventListener('mousemove', mousemove);
            document.addEventListener('mouseup', mouseup);
        }
        
        // Delete selected element
        function deleteSelectedElement() {
            if (state.selectedElement) {
                const elementIndex = state.elements.findIndex(el => el.id === state.selectedElement.id);
                if (elementIndex !== -1) {
                    // Remove from DOM
                    const el = document.getElementById(`element-${state.selectedElement.id}`);
                    if (el) {
                        el.remove();
                    }
                    
                    // Remove from state
                    state.elements.splice(elementIndex, 1);
                    selectElement(null);
                    saveState();
                }
            }
        }
        
        // Load template
        function loadTemplate(templateId) {
            // Clear current elements
            state.elements.forEach(element => {
                const el = document.getElementById(`element-${element.id}`);
                if (el) {
                    el.remove();
                }
            });
            
            state.elements = [];
            
            // Add template elements
            if (templateId === 'event1') {
                // Set canvas properties
                state.canvas.width = 600;
                state.canvas.height = 800;
                state.canvas.backgroundColor = '#ffffff';
                updateCanvas();
                
                // Add background shape
                const bgShape = {
                    id: generateId(),
                    type: 'shape',
                    shapeType: 'rectangle',
                    x: 0,
                    y: 0,
                    width: 600,
                    height: 200,
                    fillColor: '#4a6bff',
                    borderWidth: 0,
                    borderColor: '#000000'
                };
                
                state.elements.push(bgShape);
                renderElement(bgShape);
                
                // Add title
                const title = {
                    id: generateId(),
                    type: 'text',
                    content: 'COMMUNITY EVENT',
                    x: 50,
                    y: 220,
                    width: 500,
                    height: 60,
                    fontFamily: 'Arial, sans-serif',
                    fontSize: 48,
                    fontWeight: 'bold',
                    fontStyle: 'normal',
                    textDecoration: 'none',
                    color: '#000000',
                    textAlign: 'center'
                };
                
                state.elements.push(title);
                renderElement(title);
                
                // Add subtitle
                const subtitle = {
                    id: generateId(),
                    type: 'text',
                    content: 'JOIN US FOR A DAY OF FUN AND COMMUNITY',
                    x: 50,
                    y: 290,
                    width: 500,
                    height: 40,
                    fontFamily: 'Arial, sans-serif',
                    fontSize: 20,
                    fontWeight: 'normal',
                    fontStyle: 'normal',
                    textDecoration: 'none',
                    color: '#666666',
                    textAlign: 'center'
                };
                
                state.elements.push(subtitle);
                renderElement(subtitle);
                
                // Add date
                const date = {
                    id: generateId(),
                    type: 'text',
                    content: 'SATURDAY, OCTOBER 15, 2023',
                    x: 50,
                    y: 350,
                    width: 500,
                    height: 40,
                    fontFamily: 'Arial, sans-serif',
                    fontSize: 24,
                    fontWeight: 'bold',
                    fontStyle: 'normal',
                    textDecoration: 'none',
                    color: '#4a6bff',
                    textAlign: 'center'
                };
                
                state.elements.push(date);
                renderElement(date);
                
                // Add time
                const time = {
                    id: generateId(),
                    type: 'text',
                    content: '10:00 AM - 4:00 PM',
                    x: 50,
                    y: 400,
                    width: 500,
                    height: 30,
                    fontFamily: 'Arial, sans-serif',
                    fontSize: 20,
                    fontWeight: 'normal',
                    fontStyle: 'normal',
                    textDecoration: 'none',
                    color: '#000000',
                    textAlign: 'center'
                };
                
                state.elements.push(time);
                renderElement(time);
                
                // Add location
                const location = {
                    id: generateId(),
                    type: 'text',
                    content: 'COMMUNITY CENTER\n123 MAIN STREET, ANYTOWN',
                    x: 50,
                    y: 440,
                    width: 500,
                    height: 60,
                    fontFamily: 'Arial, sans-serif',
                    fontSize: 20,
                    fontWeight: 'normal',
                    fontStyle: 'normal',
                    textDecoration: 'none',
                    color: '#000000',
                    textAlign: 'center'
                };
                
                state.elements.push(location);
                renderElement(location);
                
                // Add description
                const description = {
                    id: generateId(),
                    type: 'text',
                    content: 'Join us for a day of activities, food, music, and fun for the whole family! This community event brings together local businesses, artists, and neighbors for a celebration of our town.',
                    x: 50,
                    y: 520,
                    width: 500,
                    height: 100,
                    fontFamily: 'Arial, sans-serif',
                    fontSize: 16,
                    fontWeight: 'normal',
                    fontStyle: 'normal',
                    textDecoration: 'none',
                    color: '#666666',
                    textAlign: 'center'
                };
                
                state.elements.push(description);
                renderElement(description);
                
                // Add footer
                const footer = {
                    id: generateId(),
                    type: 'text',
                    content: 'FOR MORE INFORMATION VISIT: WWW.COMMUNITYEVENT.COM\nOR CALL: (123) 456-7890',
                    x: 50,
                    y: 650,
                    width: 500,
                    height: 60,
                    fontFamily: 'Arial, sans-serif',
                    fontSize: 14,
                    fontWeight: 'bold',
                    fontStyle: 'normal',
                    textDecoration: 'none',
                    color: '#4a6bff',
                    textAlign: 'center'
                };
                
                state.elements.push(footer);
                renderElement(footer);
                
                // Add logo placeholder
                const logo = {
                    id: generateId(),
                    type: 'image',
                    src: 'https://placehold.co/150x150/4a6bff/ffffff?text=LOGO',
                    x: 225,
                    y: 50,
                    width: 150,
                    height: 150,
                    borderWidth: 0,
                    borderColor: '#000000'
                };
                
                state.elements.push(logo);
                renderElement(logo);
                
                // Add bottom shape
                const bottomShape = {
                    id: generateId(),
                    type: 'shape',
                    shapeType: 'rectangle',
                    x: 0,
                    y: 730,
                    width: 600,
                    height: 70,
                    fillColor: '#4a6bff',
                    borderWidth: 0,
                    borderColor: '#000000'
                };
                
                state.elements.push(bottomShape);
                renderElement(bottomShape);
            } else if (templateId === 'event2') {
                // Implement other templates
                // ...
            }
            
            // Select no element
            selectElement(null);
            
            // Save state
            saveState();
        }
        
        // Update canvas
        function updateCanvas() {
            canvas.style.width = `${state.canvas.width}px`;
            canvas.style.height = `${state.canvas.height}px`;
            canvas.style.backgroundColor = state.canvas.backgroundColor;
            
            // Update input values
            document.getElementById('canvasWidth').value = state.canvas.width;
            document.getElementById('canvasHeight').value = state.canvas.height;
            
            // Update background color active state
            const bgColorOptions = document.querySelectorAll('#canvasBgColorPicker .color-option');
            bgColorOptions.forEach(option => {
                option.classList.remove('active');
                if (option.dataset.color === state.canvas.backgroundColor) {
                    option.classList.add('active');
                }
            });
        }
        
        // Zoom in
        function zoomIn() {
            state.canvas.zoom = Math.min(2, state.canvas.zoom + 0.1);
            applyZoom();
        }
        
        // Zoom out
        function zoomOut() {
            state.canvas.zoom = Math.max(0.5, state.canvas.zoom - 0.1);
            applyZoom();
        }
        
        // Apply zoom
        function applyZoom() {
            canvas.style.transform = `scale(${state.canvas.zoom})`;
            zoomValue.textContent = `${Math.round(state.canvas.zoom * 100)}%`;
        }
        
        // Save state for undo/redo
        function saveState() {
            // If we're not at the end of the history, remove future states
            if (state.historyIndex < state.history.length - 1) {
                state.history = state.history.slice(0, state.historyIndex + 1);
            }
            
            // Clone the current state
            const newState = {
                canvas: { ...state.canvas },
                elements: JSON.parse(JSON.stringify(state.elements)),
                selectedElement: state.selectedElement ? state.selectedElement.id : null
            };
            
            // Add to history
            state.history.push(newState);
            state.historyIndex = state.history.length - 1;
            
            // Limit history size
            if (state.history.length > 50) {
                state.history.shift();
                state.historyIndex--;
            }
            
            // Update undo/redo buttons
            updateUndoRedoButtons();
        }
        
        // Undo
        function undo() {
            if (state.historyIndex > 0) {
                state.historyIndex--;
                restoreState();
            }
        }
        
        // Redo
        function redo() {
            if (state.historyIndex < state.history.length - 1) {
                state.historyIndex++;
                restoreState();
            }
        }
        
        // Restore state from history
        function restoreState() {
            const historyState = state.history[state.historyIndex];
            
            // Restore canvas properties
            state.canvas = { ...historyState.canvas };
            updateCanvas();
            
            // Clear current elements
            state.elements.forEach(element => {
                const el = document.getElementById(`element-${element.id}`);
                if (el) {
                    el.remove();
                }
            });
            
            // Restore elements
            state.elements = JSON.parse(JSON.stringify(historyState.elements));
            state.elements.forEach(element => {
                renderElement(element);
            });
            
            // Restore selected element
            if (historyState.selectedElement) {
                const selectedElement = state.elements.find(el => el.id === historyState.selectedElement);
                if (selectedElement) {
                    selectElement(selectedElement);
                } else {
                    selectElement(null);
                }
            } else {
                selectElement(null);
            }
            
            // Update undo/redo buttons
            updateUndoRedoButtons();
        }
        
        // Update undo/redo buttons
        function updateUndoRedoButtons() {
            undoBtn.disabled = state.historyIndex <= 0;
            redoBtn.disabled = state.historyIndex >= state.history.length - 1;
            
            // Visual indication
            undoBtn.style.opacity = undoBtn.disabled ? '0.5' : '1';
            redoBtn.style.opacity = redoBtn.disabled ? '0.5' : '1';
        }
        
        // Show tooltip
        function showTooltip(text, event) {
            tooltip.textContent = text;
            tooltip.style.left = `${event.clientX + 10}px`;
            tooltip.style.top = `${event.clientY + 10}px`;
            tooltip.classList.add('visible');
        }
        
        // Hide tooltip
        function hideTooltip() {
            tooltip.classList.remove('visible');
        }
        
        // Generate unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }
        
        // Initialize the app
        init();
    </script>
</body>
</html>