<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Health & Environment Data Platform</title>
    <style>
        :root {
            --primary: #2E7D32;
            --primary-light: #4CAF50;
            --primary-dark: #1B5E20;
            --secondary: #1976D2;
            --secondary-light: #42A5F5;
            --secondary-dark: #0D47A1;
            --accent: #FF6D00;
            --accent-light: #FF9E40;
            --accent-dark: #E65100;
            --text-primary: #212121;
            --text-secondary: #757575;
            --background: #FFFFFF;
            --background-light: #F5F5F5;
            --background-dark: #E0E0E0;
            --success: #4CAF50;
            --warning: #FFC107;
            --error: #F44336;
            --border-radius: 8px;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 8px rgba(0,0,0,0.15);
            --transition: all 0.3s ease;
            --font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            color: var(--text-primary);
            background-color: var(--background-light);
            line-height: 1.6;
        }

        .container {
            display: grid;
            grid-template-columns: 240px 1fr;
            grid-template-rows: auto 1fr auto;
            grid-template-areas:
                "header header"
                "sidebar main"
                "footer footer";
            height: 100vh;
        }

        .header {
            grid-area: header;
            background-color: var(--primary);
            color: white;
            padding: var(--spacing-md) var(--spacing-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .header-icon {
            font-size: 1.8rem;
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .user-profile:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .sidebar {
            grid-area: sidebar;
            background-color: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            padding: var(--spacing-md);
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: var(--spacing-xl);
        }

        .nav-section h3 {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-md);
            padding-left: var(--spacing-sm);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            text-decoration: none;
            margin-bottom: var(--spacing-xs);
            cursor: pointer;
            transition: var(--transition);
        }

        .nav-item:hover {
            background-color: var(--background-light);
        }

        .nav-item.active {
            background-color: var(--primary-light);
            color: white;
        }

        .nav-item i {
            font-size: 1.2rem;
        }

        .main-content {
            grid-area: main;
            padding: var(--spacing-lg);
            overflow-y: auto;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-lg);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .card-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1.1rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .btn-icon:hover {
            background-color: var(--background-light);
            color: var(--text-primary);
        }

        .card-content {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 500;
        }

        .section-actions {
            display: flex;
            gap: var(--spacing-md);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--background-dark);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: var(--background-dark);
            filter: brightness(0.95);
        }

        .btn-text {
            background: none;
            color: var(--primary);
            padding: var(--spacing-sm);
        }

        .btn-text:hover {
            background-color: rgba(46, 125, 50, 0.1);
        }

        .data-integration-section {
            margin-bottom: var(--spacing-xl);
        }

        .data-sources {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .data-source-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .data-source-card:hover {
            border-color: var(--primary-light);
        }

        .data-source-card.selected {
            border-color: var(--primary);
            background-color: rgba(76, 175, 80, 0.05);
        }

        .data-source-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        .data-source-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius);
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .data-source-info h4 {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .data-source-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .data-source-stats {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-sm);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .upload-area {
            border: 2px dashed var(--primary-light);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            text-align: center;
            margin-bottom: var(--spacing-lg);
            background-color: rgba(76, 175, 80, 0.05);
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-area:hover {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: var(--spacing-md);
        }

        .upload-text h3 {
            margin-bottom: var(--spacing-sm);
            color: var(--primary-dark);
        }

        .upload-text p {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
        }

        .file-types {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .file-type {
            padding: var(--spacing-xs) var(--spacing-md);
            background-color: var(--background-dark);
            border-radius: 16px;
            font-size: 0.85rem;
        }

        .integration-mapping {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .dataset-columns {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-md);
            max-height: 500px;
            overflow-y: auto;
        }

        .dataset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--background-dark);
            margin-bottom: var(--spacing-md);
        }

        .dataset-title {
            font-weight: 500;
        }

        .dataset-search {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            background-color: var(--background-light);
            border-radius: 20px;
            padding: var(--spacing-xs) var(--spacing-md);
        }

        .dataset-search input {
            border: none;
            background: none;
            outline: none;
            font-size: 0.9rem;
            width: 150px;
        }

        .column-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-sm);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-xs);
            cursor: pointer;
            transition: var(--transition);
        }

        .column-item:hover {
            background-color: var(--background-light);
        }

        .column-item.selected {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .column-icon {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .column-info {
            flex: 1;
        }

        .column-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .column-type {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .mapping-controls {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-md);
        }

        .mapping-arrow {
            width: 100%;
            height: 2px;
            background-color: var(--primary);
            position: relative;
        }

        .mapping-arrow::before,
        .mapping-arrow::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 2px;
            background-color: var(--primary);
            right: 0;
        }

        .mapping-arrow::before {
            transform: rotate(40deg);
            transform-origin: right;
        }

        .mapping-arrow::after {
            transform: rotate(-40deg);
            transform-origin: right;
        }

        .mapping-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .mapping-btn:hover {
            background-color: var(--primary-dark);
        }

        .mapping-type {
            width: 100%;
            padding: var(--spacing-xs);
            border: 1px solid var(--background-dark);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            margin-top: var(--spacing-md);
        }

        .analysis-section {
            margin-bottom: var(--spacing-xl);
        }

        .analysis-config {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
        }

        .config-panel {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-lg);
        }

        .config-panel h3 {
            margin-bottom: var(--spacing-md);
            font-weight: 500;
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid var(--background-dark);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }

        .checkbox-group {
            margin-top: var(--spacing-md);
        }

        .checkbox-group h4 {
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .checkbox-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-sm) var(--spacing-lg);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .checkbox-item input {
            width: 16px;
            height: 16px;
        }

        .visualization-section {
            margin-bottom: var(--spacing-xl);
        }

        .visualization-tabs {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--background-dark);
            padding-bottom: var(--spacing-xs);
        }

        .viz-tab {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: var(--transition);
        }

        .viz-tab:hover {
            color: var(--primary);
        }

        .viz-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .visualization-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
        }

        .chart-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-lg);
            position: relative;
        }

        .chart-container {
            height: 400px;
            position: relative;
        }

        .chart-controls {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-md);
            z-index: 10;
            display: none;
        }

        .chart-card:hover .chart-controls {
            display: block;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-row label {
            font-size: 0.85rem;
            width: 100px;
        }

        .control-row select,
        .control-row input {
            flex: 1;
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--background-dark);
            border-radius: var(--border-radius);
            font-size: 0.85rem;
        }

        .footer {
            grid-area: footer;
            background-color: white;
            padding: var(--spacing-md) var(--spacing-xl);
            border-top: 1px solid var(--background-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            gap: var(--spacing-lg);
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--primary);
        }

        /* Modal styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal-backdrop.show .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--background-dark);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--error);
        }

        .modal-body {
            padding: var(--spacing-lg);
        }

        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--background-dark);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
        }

        /* Material icons */
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(76, 175, 80, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Notification badge */
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--error);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Progress bar */
        .progress-bar {
            height: 6px;
            background-color: var(--background-dark);
            border-radius: 3px;
            overflow: hidden;
            margin-top: var(--spacing-xs);
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0;
            transition: width 0.3s ease;
        }

        /* For the map visualization */
        #map-visualization {
            height: 400px;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 200px 1fr;
            }
            
            .analysis-config {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .container {
                grid-template-columns: 60px 1fr;
            }
            
            .sidebar {
                padding: var(--spacing-sm);
            }
            
            .nav-section h3, 
            .nav-item span {
                display: none;
            }
            
            .nav-item {
                justify-content: center;
                padding: var(--spacing-sm);
            }
            
            .integration-mapping {
                grid-template-columns: 1fr;
                grid-template-rows: auto 80px auto;
            }
            
            .mapping-controls {
                flex-direction: row;
            }
            
            .mapping-arrow {
                width: 2px;
                height: 40px;
            }
            
            .mapping-arrow::before,
            .mapping-arrow::after {
                width: 2px;
                height: 10px;
                bottom: 0;
            }
            
            .mapping-arrow::before {
                transform: rotate(-40deg);
                transform-origin: bottom;
            }
            
            .mapping-arrow::after {
                transform: rotate(40deg);
                transform-origin: bottom;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet/dist/leaflet.css" />
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>
                <i class="material-icons header-icon">eco</i>
                Urban Health & Environment Data Platform
            </h1>
            <div class="header-actions">
                <button class="btn-icon">
                    <i class="material-icons">notifications</i>
                </button>
                <button class="btn-icon">
                    <i class="material-icons">help_outline</i>
                </button>
                <div class="user-profile">
                    <div class="user-avatar">
                        <span>JD</span>
                    </div>
                    <span>John Doe</span>
                    <i class="material-icons">arrow_drop_down</i>
                </div>
            </div>
        </header>

        <aside class="sidebar">
            <div class="nav-section">
                <h3>Project</h3>
                <a class="nav-item active">
                    <i class="material-icons">dashboard</i>
                    <span>Dashboard</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">folder</i>
                    <span>Projects</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">history</i>
                    <span>Recent</span>
                </a>
            </div>

            <div class="nav-section">
                <h3>Data</h3>
                <a class="nav-item">
                    <i class="material-icons">cloud_upload</i>
                    <span>Upload Data</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">merge_type</i>
                    <span>Integrate Data</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">storage</i>
                    <span>My Datasets</span>
                </a>
            </div>

            <div class="nav-section">
                <h3>Analysis</h3>
                <a class="nav-item">
                    <i class="material-icons">analytics</i>
                    <span>Analysis Tools</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">model_training</i>
                    <span>Models</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">science</i>
                    <span>Variables</span>
                </a>
            </div>

            <div class="nav-section">
                <h3>Visualization</h3>
                <a class="nav-item">
                    <i class="material-icons">bar_chart</i>
                    <span>Charts</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">map</i>
                    <span>Maps</span>
                </a>
                <a class="nav-item">
                    <i class="material-icons">table_chart</i>
                    <span>Reports</span>
                </a>
            </div>
        </aside>

        <main class="main-content">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Project Overview</h3>
                        <div class="card-actions">
                            <button class="btn-icon">
                                <i class="material-icons">more_vert</i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="width: 100%;">
                            <h4 style="margin-bottom: 10px;">Urban Green Space Impact Study</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">Multi-city analysis of health impacts from environmental interventions</p>
                            
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <div>
                                    <span style="font-size: 0.8rem; color: var(--text-secondary);">Cities</span>
                                    <div style="font-weight: 500;">8</div>
                                </div>
                                <div>
                                    <span style="font-size: 0.8rem; color: var(--text-secondary);">Data Sources</span>
                                    <div style="font-weight: 500;">5</div>
                                </div>
                                <div>
                                    <span style="font-size: 0.8rem; color: var(--text-secondary);">Variables</span>
                                    <div style="font-weight: 500;">124</div>
                                </div>
                                <div>
                                    <span style="font-size: 0.8rem; color: var(--text-secondary);">Status</span>
                                    <div style="font-weight: 500; color: var(--primary);">Active</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <span style="font-size: 0.8rem; color: var(--text-secondary);">Project Progress</span>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill" style="width: 65%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Data Integration Status</h3>
                        <div class="card-actions">
                            <button class="btn-icon">
                                <i class="material-icons">more_vert</i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="width: 100%;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background-color: var(--success); margin-right: 8px;"></div>
                                <span>Health Department Data</span>
                                <span style="margin-left: auto; font-weight: 500;">100%</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background-color: var(--success); margin-right: 8px;"></div>
                                <span>Environmental Sensors</span>
                                <span style="margin-left: auto; font-weight: 500;">100%</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background-color: var(--success); margin-right: 8px;"></div>
                                <span>Census Records</span>
                                <span style="margin-left: auto; font-weight: 500;">100%</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background-color: var(--primary); margin-right: 8px;"></div>
                                <span>Property Values</span>
                                <span style="margin-left: auto; font-weight: 500;">75%</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background-color: var(--warning); margin-right: 8px;"></div>
                                <span>Survey Responses</span>
                                <span style="margin-left: auto; font-weight: 500;">45%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                        <div class="card-actions">
                            <button class="btn-icon">
                                <i class="material-icons">more_vert</i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="width: 100%; max-height: 100%; overflow-y: auto;">
                            <div style="display: flex; align-items: flex-start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--background-dark);">
                                <i class="material-icons" style="color: var(--primary); margin-right: 10px;">add_circle</i>
                                <div>
                                    <div style="font-weight: 500;">Added Environmental Sensor Data</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">2 hours ago by John Doe</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: flex-start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--background-dark);">
                                <i class="material-icons" style="color: var(--secondary); margin-right: 10px;">merge_type</i>
                                <div>
                                    <div style="font-weight: 500;">Integrated Health and Census Data</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Yesterday by Sarah Johnson</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: flex-start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--background-dark);">
                                <i class="material-icons" style="color: var(--accent); margin-right: 10px;">analytics</i>
                                <div>
                                    <div style="font-weight: 500;">Ran Regression Analysis</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">2 days ago by John Doe</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: flex-start;">
                                <i class="material-icons" style="color: var(--primary-dark); margin-right: 10px;">bar_chart</i>
                                <div>
                                    <div style="font-weight: 500;">Created Health Metrics Visualization</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">3 days ago by Michael Chen</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <section class="data-integration-section">
                <div class="section-header">
                    <h2 class="section-title">Data Integration</h2>
                    <div class="section-actions">
                        <button class="btn btn-secondary">
                            <i class="material-icons">refresh</i>
                            Refresh
                        </button>
                        <button class="btn btn-primary" id="upload-data-btn">
                            <i class="material-icons">cloud_upload</i>
                            Upload Data
                        </button>
                    </div>
                </div>

                <div class="data-sources">
                    <div class="data-source-card selected">
                        <div class="data-source-header">
                            <div class="data-source-icon">
                                <i class="material-icons">medication</i>
                            </div>
                            <div class="data-source-info">
                                <h4>Health Department</h4>
                                <p>Pre/post intervention metrics</p>
                            </div>
                        </div>
                        <div class="data-source-stats">
                            <span>42 variables</span>
                            <span>8 cities</span>
                        </div>
                    </div>

                    <div class="data-source-card">
                        <div class="data-source-header">
                            <div class="data-source-icon" style="background-color: var(--secondary);">
                                <i class="material-icons">air</i>
                            </div>
                            <div class="data-source-info">
                                <h4>Environmental Sensors</h4>
                                <p>Air quality, temperature, etc.</p>
                            </div>
                        </div>
                        <div class="data-source-stats">
                            <span>28 variables</span>
                            <span>124 sensors</span>
                        </div>
                    </div>

                    <div class="data-source-card">
                        <div class="data-source-header">
                            <div class="data-source-icon" style="background-color: var(--accent);">
                                <i class="material-icons">people</i>
                            </div>
                            <div class="data-source-info">
                                <h4>Census Records</h4>
                                <p>Demographic information</p>
                            </div>
                        </div>
                        <div class="data-source-stats">
                            <span>36 variables</span>
                            <span>8 cities</span>
                        </div>
                    </div>

                    <div class="data-source-card">
                        <div class="data-source-header">
                            <div class="data-source-icon" style="background-color: var(--primary-dark);">
                                <i class="material-icons">home</i>
                            </div>
                            <div class="data-source-info">
                                <h4>Property Values</h4>
                                <p>Real estate data</p>
                            </div>
                        </div>
                        <div class="data-source-stats">
                            <span>12 variables</span>
                            <span>6 cities</span>
                        </div>
                    </div>

                    <div class="data-source-card">
                        <div class="data-source-header">
                            <div class="data-source-icon" style="background-color: var(--secondary-dark);">
                                <i class="material-icons">question_answer</i>
                            </div>
                            <div class="data-source-info">
                                <h4>Survey Responses</h4>
                                <p>Resident interviews</p>
                            </div>
                        </div>
                        <div class="data-source-stats">
                            <span>18 variables</span>
                            <span>1,245 responses</span>
                        </div>
                    </div>
                </div>

                <div class="upload-area" id="upload-area">
                    <div class="upload-icon">
                        <i class="material-icons">cloud_upload</i>
                    </div>
                    <div class="upload-text">
                        <h3>Drag & Drop Files to Upload</h3>
                        <p>or click to select files</p>
                    </div>
                    <div class="file-types">
                        <div class="file-type">CSV</div>
                        <div class="file-type">Excel</div>
                        <div class="file-type">JSON</div>
                        <div class="file-type">Shapefile</div>
                    </div>
                    <input type="file" id="file-upload" style="display: none;" multiple>
                </div>

                <div class="integration-mapping">
                    <div class="dataset-columns">
                        <div class="dataset-header">
                            <h3 class="dataset-title">Health Department Data</h3>
                            <div class="dataset-search">
                                <i class="material-icons" style="font-size: 0.9rem; color: var(--text-secondary);">search</i>
                                <input type="text" placeholder="Search columns...">
                            </div>
                        </div>
                        
                        <div class="column-item selected">
                            <i class="material-icons column-icon">public</i>
                            <div class="column-info">
                                <div class="column-name">city_id</div>
                                <div class="column-type">String (Key)</div>
                            </div>
                            <i class="material-icons" style="color: var(--primary);">check_circle</i>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">calendar_today</i>
                            <div class="column-info">
                                <div class="column-name">date</div>
                                <div class="column-type">Date</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">label</i>
                            <div class="column-info">
                                <div class="column-name">intervention_type</div>
                                <div class="column-type">Categorical</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">pin_drop</i>
                            <div class="column-info">
                                <div class="column-name">location_code</div>
                                <div class="column-type">String</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">trending_up</i>
                            <div class="column-info">
                                <div class="column-name">respiratory_health_index</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">trending_up</i>
                            <div class="column-info">
                                <div class="column-name">cardiovascular_health_index</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">trending_up</i>
                            <div class="column-info">
                                <div class="column-name">mental_health_score</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">trending_up</i>
                            <div class="column-info">
                                <div class="column-name">physical_activity_minutes</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mapping-controls">
                        <button class="mapping-btn">
                            <i class="material-icons">link</i>
                        </button>
                        <div class="mapping-arrow"></div>
                        <button class="mapping-btn">
                            <i class="material-icons">autorenew</i>
                        </button>
                        <select class="mapping-type">
                            <option>Inner Join</option>
                            <option>Left Join</option>
                            <option>Right Join</option>
                            <option>Full Join</option>
                        </select>
                    </div>
                    
                    <div class="dataset-columns">
                        <div class="dataset-header">
                            <h3 class="dataset-title">Environmental Sensors Data</h3>
                            <div class="dataset-search">
                                <i class="material-icons" style="font-size: 0.9rem; color: var(--text-secondary);">search</i>
                                <input type="text" placeholder="Search columns...">
                            </div>
                        </div>
                        
                        <div class="column-item selected">
                            <i class="material-icons column-icon">public</i>
                            <div class="column-info">
                                <div class="column-name">city_id</div>
                                <div class="column-type">String (Key)</div>
                            </div>
                            <i class="material-icons" style="color: var(--primary);">check_circle</i>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">calendar_today</i>
                            <div class="column-info">
                                <div class="column-name">timestamp</div>
                                <div class="column-type">DateTime</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">pin_drop</i>
                            <div class="column-info">
                                <div class="column-name">sensor_id</div>
                                <div class="column-type">String</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">location_on</i>
                            <div class="column-info">
                                <div class="column-name">latitude</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">location_on</i>
                            <div class="column-info">
                                <div class="column-name">longitude</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">trending_up</i>
                            <div class="column-info">
                                <div class="column-name">air_quality_index</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">trending_up</i>
                            <div class="column-info">
                                <div class="column-name">pm25_concentration</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                        
                        <div class="column-item">
                            <i class="material-icons column-icon">trending_up</i>
                            <div class="column-info">
                                <div class="column-name">temperature</div>
                                <div class="column-type">Numeric</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="analysis-section">
                <div class="section-header">
                    <h2 class="section-title">Statistical Analysis</h2>
                    <div class="section-actions">
                        <button class="btn btn-secondary">
                            <i class="material-icons">save</i>
                            Save Configuration
                        </button>
                        <button class="btn btn-primary" id="run-analysis-btn">
                            <i class="material-icons">play_arrow</i>
                            Run Analysis
                        </button>
                    </div>
                </div>

                <div class="analysis-config">
                    <div class="config-panel">
                        <h3>Model Configuration</h3>
                        
                        <div class="form-group">
                            <label>Analysis Type</label>
                            <select id="analysis-type">
                                <option>Linear Regression</option>
                                <option>Multiple Regression</option>
                                <option>Difference-in-Differences</option>
                                <option>Fixed Effects Panel Model</option>
                                <option>Hierarchical Model</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Dependent Variable</label>
                            <select id="dependent-var">
                                <option>respiratory_health_index</option>
                                <option>cardiovascular_health_index</option>
                                <option>mental_health_score</option>
                                <option>physical_activity_minutes</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Independent Variables</label>
                            <select id="independent-var" multiple size="4">
                                <option selected>intervention_type</option>
                                <option selected>air_quality_index</option>
                                <option selected>pm25_concentration</option>
                                <option>temperature</option>
                                <option>green_space_area</option>
                                <option>distance_to_park</option>
                                <option>tree_canopy_percentage</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Time Period</label>
                            <select id="time-period">
                                <option>Pre-intervention only</option>
                                <option>Post-intervention only</option>
                                <option selected>Pre-post comparison</option>
                                <option>Custom time range</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="config-panel">
                        <h3>Confounding Variables</h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md); font-size: 0.9rem;">
                            Select variables to control for potential confounding effects in your analysis.
                        </p>
                        
                        <div class="checkbox-group">
                            <h4>Demographic Factors</h4>
                            <div class="checkbox-items">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="age" checked>
                                    <label for="age">Age Distribution</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="income" checked>
                                    <label for="income">Income Level</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="education">
                                    <label for="education">Education Level</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="race" checked>
                                    <label for="race">Race/Ethnicity</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="household">
                                    <label for="household">Household Size</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="employment">
                                    <label for="employment">Employment Status</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="checkbox-group">
                            <h4>Environmental Factors</h4>
                            <div class="checkbox-items">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="climate" checked>
                                    <label for="climate">Climate Zone</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="density" checked>
                                    <label for="density">Population Density</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="pollution">
                                    <label for="pollution">Industrial Pollution</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="traffic" checked>
                                    <label for="traffic">Traffic Volume</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="water">
                                    <label for="water">Water Quality</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="existing-green">
                                    <label for="existing-green">Existing Green Space</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="checkbox-group">
                            <h4>Policy Factors</h4>
                            <div class="checkbox-items">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="healthcare" checked>
                                    <label for="healthcare">Healthcare Access</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="public-transit">
                                    <label for="public-transit">Public Transit</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="zoning">
                                    <label for="zoning">Zoning Regulations</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="funding" checked>
                                    <label for="funding">Public Funding</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="visualization-section">
                <div class="section-header">
                    <h2 class="section-title">Data Visualization</h2>
                    <div class="section-actions">
                        <button class="btn btn-secondary">
                            <i class="material-icons">save_alt</i>
                            Export
                        </button>
                        <button class="btn btn-primary">
                            <i class="material-icons">add</i>
                            New Visualization
                        </button>
                    </div>
                </div>

                <div class="visualization-tabs">
                    <div class="viz-tab active">Health Outcomes</div>
                    <div class="viz-tab">Environmental Factors</div>
                    <div class="viz-tab">Demographic Analysis</div>
                    <div class="viz-tab">Geographic Distribution</div>
                    <div class="viz-tab">Time Series</div>
                </div>

                <div class="visualization-container">
                    <div class="chart-card">
                        <div class="card-header">
                            <h3 class="card-title">Pre-Post Intervention Health Outcomes</h3>
                            <div class="card-actions">
                                <button class="btn-icon">
                                    <i class="material-icons">fullscreen</i>
                                </button>
                                <button class="btn-icon">
                                    <i class="material-icons">more_vert</i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container" id="health-outcomes-chart">
                            <!-- Chart will be rendered here -->
                        </div>
                        <div class="chart-controls">
                            <div class="control-row">
                                <label>Chart Type</label>
                                <select id="chart-type">
                                    <option>Bar Chart</option>
                                    <option selected>Grouped Bar Chart</option>
                                    <option>Line Chart</option>
                                    <option>Scatter Plot</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Health Metric</label>
                                <select id="health-metric">
                                    <option>All Metrics</option>
                                    <option selected>Respiratory Health</option>
                                    <option>Cardiovascular Health</option>
                                    <option>Mental Health</option>
                                    <option>Physical Activity</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Group By</label>
                                <select id="group-by">
                                    <option selected>Intervention Type</option>
                                    <option>City</option>
                                    <option>Income Level</option>
                                    <option>Age Group</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Color Scheme</label>
                                <select id="color-scheme">
                                    <option>Sequential Green</option>
                                    <option selected>Diverging Red-Blue</option>
                                    <option>Categorical</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="card-header">
                            <h3 class="card-title">Environmental Factors vs. Health Outcomes</h3>
                            <div class="card-actions">
                                <button class="btn-icon">
                                    <i class="material-icons">fullscreen</i>
                                </button>
                                <button class="btn-icon">
                                    <i class="material-icons">more_vert</i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container" id="correlation-chart">
                            <!-- Chart will be rendered here -->
                        </div>
                        <div class="chart-controls">
                            <div class="control-row">
                                <label>Chart Type</label>
                                <select id="corr-chart-type">
                                    <option>Heatmap</option>
                                    <option selected>Scatter Plot</option>
                                    <option>Bubble Chart</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>X-Axis</label>
                                <select id="x-variable">
                                    <option>Air Quality Index</option>
                                    <option selected>PM2.5 Concentration</option>
                                    <option>Green Space Area</option>
                                    <option>Tree Canopy Percentage</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Y-Axis</label>
                                <select id="y-variable">
                                    <option>Cardiovascular Health</option>
                                    <option selected>Respiratory Health</option>
                                    <option>Mental Health Score</option>
                                    <option>Physical Activity</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Color By</label>
                                <select id="color-variable">
                                    <option>None</option>
                                    <option selected>Intervention Type</option>
                                    <option>Income Level</option>
                                    <option>City</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Size By</label>
                                <select id="size-variable">
                                    <option selected>None</option>
                                    <option>Population</option>
                                    <option>Intervention Size</option>
                                    <option>Funding Amount</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Regression Line</label>
                                <select id="regression-type">
                                    <option>None</option>
                                    <option selected>Linear</option>
                                    <option>Polynomial</option>
                                    <option>LOESS</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="card-header">
                            <h3 class="card-title">Geographic Distribution of Interventions & Outcomes</h3>
                            <div class="card-actions">
                                <button class="btn-icon">
                                    <i class="material-icons">fullscreen</i>
                                </button>
                                <button class="btn-icon">
                                    <i class="material-icons">more_vert</i>
                                </button>
                            </div>
                        </div>
                        <div id="map-visualization">
                            <!-- Map will be rendered here -->
                        </div>
                        <div class="chart-controls">
                            <div class="control-row">
                                <label>Map Type</label>
                                <select id="map-type">
                                    <option>Basic</option>
                                    <option selected>Choropleth</option>
                                    <option>Point Clusters</option>
                                    <option>Heat Map</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Color Variable</label>
                                <select id="map-variable">
                                    <option>Intervention Type</option>
                                    <option selected>Health Improvement</option>
                                    <option>Air Quality Change</option>
                                    <option>Green Space Coverage</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Boundaries</label>
                                <select id="map-boundaries">
                                    <option>Census Tracts</option>
                                    <option selected>Neighborhoods</option>
                                    <option>City Districts</option>
                                    <option>Counties</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Overlay</label>
                                <select id="map-overlay">
                                    <option>None</option>
                                    <option selected>Intervention Sites</option>
                                    <option>Sensor Locations</option>
                                    <option>Population Density</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div>Urban Health & Environment Data Platform © 2023</div>
            <div class="footer-links">
                <a href="#" class="footer-link">Terms</a>
                <a href="#" class="footer-link">Privacy</a>
                <a href="#" class="footer-link">Help</a>
                <a href="#" class="footer-link">Contact</a>
            </div>
        </footer>

        <!-- Modal for file upload progress -->
        <div class="modal-backdrop" id="upload-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">Uploading Files</h3>
                    <button class="modal-close" id="close-upload-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="upload-progress">
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>survey_data_2023.csv</span>
                                <span>75%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill" style="width: 75%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>environmental_readings.xlsx</span>
                                <span>100%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>neighborhood_boundaries.geojson</span>
                                <span>45%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill" style="width: 45%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; color: var(--text-secondary);">
                        <p>Please don't close this window while files are uploading</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancel-upload">Cancel</button>
                    <button class="btn btn-primary" id="process-files" disabled>Process Files</button>
                </div>
            </div>
        </div>

        <!-- Modal for analysis results -->
        <div class="modal-backdrop" id="analysis-modal">
            <div class="modal" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Analysis Results</h3>
                    <button class="modal-close" id="close-analysis-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="analysis-spinner" style="text-align: center; padding: 40px;">
                        <div class="spinner"></div>
                        <p style="margin-top: 20px; color: var(--text-secondary);">Running analysis...</p>
                    </div>
                    
                    <div id="analysis-results" style="display: none;">
                        <h4 style="margin-bottom: 15px;">Model Summary: Multiple Regression</h4>
                        
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <tr style="background-color: var(--background-light);">
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Dependent Variable</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">R-squared</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Adj. R-squared</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">F-statistic</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">p-value</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">respiratory_health_index</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">0.782</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">0.768</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">42.31</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                            </tr>
                        </table>
                        
                        <h4 style="margin-bottom: 15px;">Coefficients</h4>
                        
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <tr style="background-color: var(--background-light);">
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Variable</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Coefficient</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Std. Error</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">t-value</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">p-value</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Significance</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Intercept</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">56.23</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">8.45</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">6.65</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">***</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">intervention_type[Park]</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">12.34</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">2.67</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">4.62</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">***</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">intervention_type[Green Roof]</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">8.76</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">2.12</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">4.13</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">***</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">intervention_type[Urban Forest]</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">15.21</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">3.04</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">5.00</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">***</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">air_quality_index</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">-2.45</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">0.56</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">-4.38</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">***</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">pm25_concentration</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">-3.72</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">0.89</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">-4.18</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">***</td>
                            </tr>
                        </table>
                        
                        <p style="margin-bottom: 15px; color: var(--text-secondary);">Significance codes: *** p&lt;0.001, ** p&lt;0.01, * p&lt;0.05, . p&lt;0.1</p>
                        
                        <h4 style="margin-bottom: 15px;">Confounding Variable Effects</h4>
                        
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background-color: var(--background-light);">
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Confounder</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Effect Size</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">p-value</th>
                                <th style="text-align: left; padding: 8px; border: 1px solid var(--background-dark);">Significance</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Age Distribution</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Medium</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">0.008</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">**</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Income Level</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Strong</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">&lt;0.001</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">***</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Race/Ethnicity</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Medium</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">0.012</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">*</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Climate Zone</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Weak</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--text-secondary);">0.214</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);"></td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Population Density</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Strong</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">0.003</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">**</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Traffic Volume</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">Medium</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark); color: var(--success);">0.035</td>
                                <td style="padding: 8px; border: 1px solid var(--background-dark);">*</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="close-results">Close</button>
                    <button class="btn btn-primary" id="export-results">
                        <i class="material-icons">save_alt</i>
                        Export Results
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as d3 from "https://esm.sh/d3";
        import * as L from "https://esm.sh/leaflet";
        
        // DOM Elements
        const uploadBtn = document.getElementById('upload-data-btn');
        const uploadArea = document.getElementById('upload-area');
        const fileUpload = document.getElementById('file-upload');
        const uploadModal = document.getElementById('upload-modal');
        const closeUploadModal = document.getElementById('close-upload-modal');
        const cancelUpload = document.getElementById('cancel-upload');
        const processFiles = document.getElementById('process-files');
        
        const runAnalysisBtn = document.getElementById('run-analysis-btn');
        const analysisModal = document.getElementById('analysis-modal');
        const closeAnalysisModal = document.getElementById('close-analysis-modal');
        const closeResults = document.getElementById('close-results');
        const exportResults = document.getElementById('export-results');
        const analysisSpinner = document.getElementById('analysis-spinner');
        const analysisResults = document.getElementById('analysis-results');
        
        // Upload functionality
        uploadBtn.addEventListener('click', () => {
            fileUpload.click();
        });
        
        uploadArea.addEventListener('click', () => {
            fileUpload.click();
        });
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.backgroundColor = 'rgba(76, 175, 80, 0.05)';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = 'rgba(76, 175, 80, 0.05)';
            
            if (e.dataTransfer.files.length > 0) {
                showUploadModal();
                simulateUpload();
            }
        });
        
        fileUpload.addEventListener('change', () => {
            if (fileUpload.files.length > 0) {
                showUploadModal();
                simulateUpload();
            }
        });
        
        function showUploadModal() {
            uploadModal.classList.add('show');
        }
        
        function hideUploadModal() {
            uploadModal.classList.remove('show');
        }
        
        closeUploadModal.addEventListener('click', hideUploadModal);
        cancelUpload.addEventListener('click', hideUploadModal);
        
        function simulateUpload() {
            const progressBars = document.querySelectorAll('.progress-bar-fill');
            let completed = 0;
            
            progressBars.forEach((bar, index) => {
                const width = parseInt(bar.style.width);
                if (width === 100) {
                    completed++;
                } else {
                    const interval = setInterval(() => {
                        const currentWidth = parseInt(bar.style.width);
                        if (currentWidth < 100) {
                            const increment = Math.floor(Math.random() * 10) + 1;
                            const newWidth = Math.min(currentWidth + increment, 100);
                            bar.style.width = newWidth + '%';
                            
                            const percentText = bar.parentElement.previousElementSibling.querySelector('span:last-child');
                            percentText.textContent = newWidth + '%';
                            
                            if (newWidth === 100) {
                                clearInterval(interval);
                                completed++;
                                
                                if (completed === progressBars.length) {
                                    processFiles.disabled = false;
                                }
                            }
                        }
                    }, 500);
                }
            });
        }
        
        processFiles.addEventListener('click', () => {
            hideUploadModal();
            
            // Show success notification
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = 'var(--success)';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = 'var(--border-radius)';
            notification.style.boxShadow = 'var(--shadow)';
            notification.style.zIndex = '1000';
            notification.textContent = 'Files processed successfully!';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s ease';
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        });
        
        // Analysis functionality
        runAnalysisBtn.addEventListener('click', () => {
            analysisModal.classList.add('show');
            analysisSpinner.style.display = 'block';
            analysisResults.style.display = 'none';
            
            // Simulate analysis running
            setTimeout(() => {
                analysisSpinner.style.display = 'none';
                analysisResults.style.display = 'block';
            }, 3000);
        });
        
        closeAnalysisModal.addEventListener('click', () => {
            analysisModal.classList.remove('show');
        });
        
        closeResults.addEventListener('click', () => {
            analysisModal.classList.remove('show');
        });
        
        exportResults.addEventListener('click', () => {
            // Simulate export
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = 'var(--success)';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = 'var(--border-radius)';
            notification.style.boxShadow = 'var(--shadow)';
            notification.style.zIndex = '1000';
            notification.textContent = 'Results exported successfully!';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s ease';
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        });
        
        // Initialize charts
        function initializeCharts() {
            // Health Outcomes Chart
            const healthData = {
                labels: ['Park', 'Green Roof', 'Urban Forest', 'Community Garden', 'Green Corridor'],
                datasets: [
                    {
                        label: 'Pre-Intervention',
                        data: [65, 59, 61, 70, 56],
                        backgroundColor: '#7986CB',
                        borderColor: '#3F51B5',
                        borderWidth: 1
                    },
                    {
                        label: 'Post-Intervention',
                        data: [75, 69, 80, 81, 66],
                        backgroundColor: '#4CAF50',
                        borderColor: '#2E7D32',
                        borderWidth: 1
                    }
                ]
            };
            
            const healthCtx = document.getElementById('health-outcomes-chart');
            const healthChart = new BarChart(healthCtx, healthData, {
                title: 'Respiratory Health Index by Intervention Type',
                xLabel: 'Intervention Type',
                yLabel: 'Respiratory Health Index',
                barSpacing: 0.2,
                colors: ['#7986CB', '#4CAF50']
            });
            
            // Correlation Chart
            const corrData = [];
            for (let i = 0; i < 50; i++) {
                corrData.push({
                    pm25: Math.random() * 30 + 10,
                    respiratory: Math.random() * 30 + 50 - (Math.random() * 30 + 10) * 0.8 + Math.random() * 10,
                    intervention: ['Park', 'Green Roof', 'Urban Forest', 'Community Garden', 'Green Corridor'][Math.floor(Math.random() * 5)]
                });
            }
            
            const corrCtx = document.getElementById('correlation-chart');
            const corrChart = new ScatterChart(corrCtx, corrData, {
                title: 'PM2.5 Concentration vs. Respiratory Health',
                xLabel: 'PM2.5 Concentration (μg/m³)',
                yLabel: 'Respiratory Health Index',
                xKey: 'pm25',
                yKey: 'respiratory',
                colorKey: 'intervention',
                colorScale: d3.scaleOrdinal()
                    .domain(['Park', 'Green Roof', 'Urban Forest', 'Community Garden', 'Green Corridor'])
                    .range(['#4CAF50', '#2196F3', '#9C27B0', '#FF9800', '#F44336']),
                showRegression: true
            });
            
            // Initialize Map
            const mapContainer = document.getElementById('map-visualization');
            const map = L.map(mapContainer).setView([40.7128, -74.0060], 11);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add some sample data points
            const interventionSites = [
                { lat: 40.7128, lng: -74.0060, type: 'Park', size: 5, health: 15 },
                { lat: 40.7328, lng: -73.9860, type: 'Green Roof', size: 3, health: 10 },
                { lat: 40.7028, lng: -73.9760, type: 'Urban Forest', size: 8, health: 18 },
                { lat: 40.7228, lng: -74.0160, type: 'Community Garden', size: 2, health: 8 },
                { lat: 40.7428, lng: -74.0260, type: 'Green Corridor', size: 4, health: 12 }
            ];
            
            const getMarkerColor = (type) => {
                const colors = {
                    'Park': '#4CAF50',
                    'Green Roof': '#2196F3',
                    'Urban Forest': '#9C27B0',
                    'Community Garden': '#FF9800',
                    'Green Corridor': '#F44336'
                };
                return colors[type] || '#4CAF50';
            };
            
            interventionSites.forEach(site => {
                const marker = L.circleMarker([site.lat, site.lng], {
                    radius: site.size * 2,
                    fillColor: getMarkerColor(site.type),
                    color: '#fff',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);
                
                marker.bindPopup(`
                    <strong>${site.type}</strong><br>
                    Health Improvement: ${site.health}%<br>
                    Size: ${site.size} acres
                `);
            });
            
            // Add a GeoJSON layer with random data
            const randomPolygon = (center, size) => {
                const points = [];
                const centerLat = center[0];
                const centerLng = center[1];
                
                for (let i = 0; i < 6; i++) {
                    const angle = i * 60 * Math.PI / 180;
                    const lat = centerLat + Math.cos(angle) * size * (0.8 + Math.random() * 0.4);
                    const lng = centerLng + Math.sin(angle) * size * (0.8 + Math.random() * 0.4);
                    points.push([lat, lng]);
                }
                
                points.push(points[0]); // Close the polygon
                return [points];
            };
            
            const neighborhoods = [];
            for (let i = 0; i < 10; i++) {
                const center = [
                    40.7128 + (Math.random() - 0.5) * 0.1,
                    -74.0060 + (Math.random() - 0.5) * 0.1
                ];
                
                const healthImprovement = Math.floor(Math.random() * 20) + 5;
                
                neighborhoods.push({
                    type: 'Feature',
                    properties: {
                        name: `Neighborhood ${i + 1}`,
                        healthImprovement: healthImprovement
                    },
                    geometry: {
                        type: 'Polygon',
                        coordinates: randomPolygon(center, 0.01)
                    }
                });
            }
            
            const getColor = (value) => {
                return value > 20 ? '#1B5E20' :
                       value > 15 ? '#2E7D32' :
                       value > 10 ? '#388E3C' :
                       value > 5 ? '#4CAF50' :
                       '#81C784';
            };
            
            L.geoJSON({ type: 'FeatureCollection', features: neighborhoods }, {
                style: (feature) => {
                    return {
                        fillColor: getColor(feature.properties.healthImprovement),
                        weight: 2,
                        opacity: 1,
                        color: 'white',
                        dashArray: '3',
                        fillOpacity: 0.7
                    };
                },
                onEachFeature: (feature, layer) => {
                    layer.bindPopup(`
                        <strong>${feature.properties.name}</strong><br>
                        Health Improvement: ${feature.properties.healthImprovement}%
                    `);
                }
            }).addTo(map);
            
            // Add a legend
            const legend = L.control({ position: 'bottomright' });
            
            legend.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'info legend');
                const grades = [0, 5, 10, 15, 20];
                
                div.style.backgroundColor = 'white';
                div.style.padding = '10px';
                div.style.borderRadius = '5px';
                div.style.boxShadow = '0 1px 5px rgba(0,0,0,0.4)';
                
                div.innerHTML = '<h4 style="margin-top: 0; margin-bottom: 5px;">Health Improvement</h4>';
                
                for (let i = 0; i < grades.length; i++) {
                    div.innerHTML +=
                        '<div style="display: flex; align-items: center; margin-bottom: 3px;">' +
                        '<i style="background:' + getColor(grades[i] + 1) + '; width: 15px; height: 15px; display: inline-block; margin-right: 5px;"></i> ' +
                        grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '%' : '+%') +
                        '</div>';
                }
                
                return div;
            };
            
            legend.addTo(map);
        }
        
        // Custom D3 Charts
        class BarChart {
            constructor(container, data, options = {}) {
                this.container = container;
                this.data = data;
                this.options = Object.assign({
                    width: container.clientWidth,
                    height: container.clientHeight,
                    margin: { top: 50, right: 30, bottom: 50, left: 50 },
                    title: '',
                    xLabel: '',
                    yLabel: '',
                    barSpacing: 0.1,
                    colors: ['#4CAF50', '#2196F3']
                }, options);
                
                this.svg = d3.select(container)
                    .append('svg')
                    .attr('width', this.options.width)
                    .attr('height', this.options.height);
                
                this.render();
            }
            
            render() {
                const { width, height, margin, title, xLabel, yLabel, barSpacing, colors } = this.options;
                const { labels, datasets } = this.data;
                
                // Calculate dimensions
                const innerWidth = width - margin.left - margin.right;
                const innerHeight = height - margin.top - margin.bottom;
                
                // Create scales
                const x0 = d3.scaleBand()
                    .domain(labels)
                    .range([0, innerWidth])
                    .paddingInner(barSpacing)
                    .paddingOuter(barSpacing / 2);
                
                const x1 = d3.scaleBand()
                    .domain(datasets.map((d, i) => i))
                    .range([0, x0.bandwidth()])
                    .padding(0.05);
                
                const y = d3.scaleLinear()
                    .domain([0, d3.max(datasets, d => d3.max(d.data))])
                    .nice()
                    .range([innerHeight, 0]);
                
                // Create color scale
                const colorScale = d3.scaleOrdinal()
                    .domain(datasets.map((d, i) => i))
                    .range(colors);
                
                // Create group for the chart
                const g = this.svg.append('g')
                    .attr('transform', `translate(${margin.left},${margin.top})`);
                
                // Add title
                g.append('text')
                    .attr('x', innerWidth / 2)
                    .attr('y', -margin.top / 2)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '1.2em')
                    .attr('font-weight', 'bold')
                    .text(title);
                
                // Add x-axis
                g.append('g')
                    .attr('transform', `translate(0,${innerHeight})`)
                    .call(d3.axisBottom(x0))
                    .append('text')
                    .attr('x', innerWidth / 2)
                    .attr('y', margin.bottom - 10)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'currentColor')
                    .text(xLabel);
                
                // Add y-axis
                g.append('g')
                    .call(d3.axisLeft(y))
                    .append('text')
                    .attr('transform', 'rotate(-90)')
                    .attr('y', -margin.left + 15)
                    .attr('x', -innerHeight / 2)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'currentColor')
                    .text(yLabel);
                
                // Add bars
                labels.forEach((label, i) => {
                    datasets.forEach((dataset, j) => {
                        g.append('rect')
                            .attr('x', x0(label) + x1(j))
                            .attr('y', y(dataset.data[i]))
                            .attr('width', x1.bandwidth())
                            .attr('height', innerHeight - y(dataset.data[i]))
                            .attr('fill', colorScale(j));
                    });
                });
                
                // Add legend
                const legend = g.append('g')
                    .attr('font-family', 'sans-serif')
                    .attr('font-size', 10)
                    .attr('text-anchor', 'start')
                    .selectAll('g')
                    .data(datasets)
                    .enter().append('g')
                    .attr('transform', (d, i) => `translate(0,${i * 20})`);
                
                legend.append('rect')
                    .attr('x', innerWidth - 19)
                    .attr('width', 19)
                    .attr('height', 19)
                    .attr('fill', (d, i) => colorScale(i));
                
                legend.append('text')
                    .attr('x', innerWidth - 24)
                    .attr('y', 9.5)
                    .attr('dy', '0.32em')
                    .attr('text-anchor', 'end')
                    .text(d => d.label);
            }
        }
        
        class ScatterChart {
            constructor(container, data, options = {}) {
                this.container = container;
                this.data = data;
                this.options = Object.assign({
                    width: container.clientWidth,
                    height: container.clientHeight,
                    margin: { top: 50, right: 100, bottom: 50, left: 50 },
                    title: '',
                    xLabel: '',
                    yLabel: '',
                    xKey: 'x',
                    yKey: 'y',
                    colorKey: null,
                    colorScale: d3.scaleOrdinal(d3.schemeCategory10),
                    showRegression: false
                }, options);
                
                this.svg = d3.select(container)
                    .append('svg')
                    .attr('width', this.options.width)
                    .attr('height', this.options.height);
                
                this.render();
            }
            
            render() {
                const { width, height, margin, title, xLabel, yLabel, xKey, yKey, colorKey, colorScale, showRegression } = this.options;
                
                // Calculate dimensions
                const innerWidth = width - margin.left - margin.right;
                const innerHeight = height - margin.top - margin.bottom;
                
                // Create scales
                const x = d3.scaleLinear()
                    .domain([0, d3.max(this.data, d => d[xKey])])
                    .nice()
                    .range([0, innerWidth]);
                
                const y = d3.scaleLinear()
                    .domain([0, d3.max(this.data, d => d[yKey])])
                    .nice()
                    .range([innerHeight, 0]);
                
                // Create group for the chart
                const g = this.svg.append('g')
                    .attr('transform', `translate(${margin.left},${margin.top})`);
                
                // Add title
                g.append('text')
                    .attr('x', innerWidth / 2)
                    .attr('y', -margin.top / 2)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '1.2em')
                    .attr('font-weight', 'bold')
                    .text(title);
                
                // Add x-axis
                g.append('g')
                    .attr('transform', `translate(0,${innerHeight})`)
                    .call(d3.axisBottom(x))
                    .append('text')
                    .attr('x', innerWidth / 2)
                    .attr('y', margin.bottom - 10)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'currentColor')
                    .text(xLabel);
                
                // Add y-axis
                g.append('g')
                    .call(d3.axisLeft(y))
                    .append('text')
                    .attr('transform', 'rotate(-90)')
                    .attr('y', -margin.left + 15)
                    .attr('x', -innerHeight / 2)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'currentColor')
                    .text(yLabel);
                
                // Add regression line if requested
                if (showRegression) {
                    // Calculate regression line
                    const xValues = this.data.map(d => d[xKey]);
                    const yValues = this.data.map(d => d[yKey]);
                    
                    const xMean = d3.mean(xValues);
                    const yMean = d3.mean(yValues);
                    
                    const ssXY = d3.sum(this.data.map(d => (d[xKey] - xMean) * (d[yKey] - yMean)));
                    const ssXX = d3.sum(this.data.map(d => Math.pow(d[xKey] - xMean, 2)));
                    
                    const slope = ssXY / ssXX;
                    const intercept = yMean - slope * xMean;
                    
                    const x1 = d3.min(xValues);
                    const y1 = slope * x1 + intercept;
                    const x2 = d3.max(xValues);
                    const y2 = slope * x2 + intercept;
                    
                    g.append('line')
                        .attr('x1', x(x1))
                        .attr('y1', y(y1))
                        .attr('x2', x(x2))
                        .attr('y2', y(y2))
                        .attr('stroke', '#666')
                        .attr('stroke-width', 2)
                        .attr('stroke-dasharray', '5,5');
                }
                
                // Add points
                g.selectAll('circle')
                    .data(this.data)
                    .enter().append('circle')
                    .attr('cx', d => x(d[xKey]))
                    .attr('cy', d => y(d[yKey]))
                    .attr('r', 5)
                    .attr('fill', d => colorKey ? colorScale(d[colorKey]) : '#4CAF50')
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 1);
                
                // Add legend if using colors
                if (colorKey) {
                    const categories = [...new Set(this.data.map(d => d[colorKey]))];
                    
                    const legend = g.append('g')
                        .attr('font-family', 'sans-serif')
                        .attr('font-size', 10)
                        .attr('text-anchor', 'start')
                        .selectAll('g')
                        .data(categories)
                        .enter().append('g')
                        .attr('transform', (d, i) => `translate(${innerWidth + 10},${i * 20})`);
                    
                    legend.append('circle')
                        .attr('r', 5)
                        .attr('fill', d => colorScale(d))
                        .attr('stroke', '#fff')
                        .attr('stroke-width', 1);
                    
                    legend.append('text')
                        .attr('x', 10)
                        .attr('y', 3)
                        .attr('dy', '0.1em')
                        .text(d => d);
                }
            }
        }
        
        // Initialize everything when the document is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeCharts();
        });
    </script>
</body>
</html>